var e=Object.defineProperty,t=(t,i,s)=>(((t,i,s)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s})(t,"symbol"!=typeof i?i+"":i,s),s);import{g as i,a as s,P as a,b as n,p as o,U as l,c as r,S as d,s as c,d as h,T as m,e as u,f as p,C as g,h as f,I,i as w,j as b,k as v,l as x,m as S,n as E,A as y,o as P,q as k,r as C,G as L,t as T,u as _,H as N,v as R,w as A,L as D,x as M,y as V,z as U,B as F,D as W,E as O,F as H,M as q,J as B,K as z,N as j,O as $,Q as G,R as K,V as J,W as Z,X as Y,Y as Q,Z as X,_ as ee,$ as te,a0 as ie,a1 as se,a2 as ae,a3 as ne,a4 as oe,a5 as le,a6 as re,a7 as de,a8 as ce,a9 as he,aa as me,ab as ue,ac as pe,ad as ge,ae as fe,af as Ie,ag as we,ah as be,ai as ve,aj as xe,ak as Se,al as Ee,am as ye,an as Pe,ao as ke,ap as Ce,aq as Le,ar as Te,as as _e,at as Ne,au as Re,av as Ae,aw as De,ax as Me,ay as Ve,az as Ue,aA as Fe,aB as We,aC as Oe,aD as He,aE as qe,aF as Be,aG as ze,aH as je,aI as $e,aJ as Ge,aK as Ke,aL as Je,aM as Ze,aN as Ye,aO as Qe,aP as Xe,aQ as et,aR as tt,aS as it,aT as st,aU as at,aV as nt,aW as ot,aX as lt,aY as rt,aZ as dt,a_ as ct,a$ as ht,b0 as mt,b1 as ut,b2 as pt,b3 as gt,b4 as ft,b5 as It,b6 as wt,b7 as bt,b8 as vt,b9 as xt,ba as St,bb as Et,bc as yt,bd as Pt,be as kt,bf as Ct,bg as Lt,bh as Tt,bi as _t,bj as Nt,bk as Rt,bl as At,bm as Dt,bn as Mt,bo as Vt,bp as Ut,bq as Ft,br as Wt,bs as Ot,bt as Ht,bu as qt,bv as Bt,bw as zt,bx as jt,by as $t,bz as Gt,bA as Kt,bB as Jt,bC as Zt,bD as Yt,bE as Qt,bF as Xt,bG as ei,bH as ti,bI as ii,bJ as si,bK as ai,bL as ni,bM as oi,bN as li,bO as ri,bP as di,bQ as ci,bR as hi,bS as mi,bT as ui,bU as pi,bV as gi,bW as fi,bX as Ii,bY as wi,bZ as bi,b_ as vi,b$ as xi,c0 as Si,c1 as Ei,c2 as yi,c3 as Pi,c4 as ki,c5 as Ci,c6 as Li,c7 as Ti,c8 as _i,c9 as Ni,ca as Ri,cb as Ai,cc as Di,cd as Mi,ce as Vi,cf as Ui,cg as Fi,ch as Wi,ci as Oi,cj as Hi,ck as qi,cl as Bi,cm as zi,cn as ji,co as $i,cp as Gi,cq as Ki,cr as Ji,cs as Zi,ct as Yi,cu as Qi,cv as Xi,cw as es,cx as ts,cy as is,cz as ss,cA as as,cB as ns,cC as os,cD as ls,cE as rs,cF as ds,cG as cs,cH as hs,cI as ms,cJ as us,cK as ps,cL as gs,cM as fs,cN as Is,cO as ws,cP as bs,cQ as vs,cR as xs,cS as Ss,cT as Es,cU as ys,cV as Ps,cW as ks,cX as Cs,cY as Ls,cZ as Ts,c_ as _s,c$ as Ns,d0 as Rs,d1 as As,d2 as Ds,d3 as Ms,d4 as Vs,d5 as Us,d6 as Fs,d7 as Ws,d8 as Os,d9 as Hs,da as qs,db as Bs,dc as zs,dd as js,de as $s,df as Gs,dg as Ks,dh as Js,di as Zs,dj as Ys,dk as Qs,dl as Xs,dm as ea,dn as ta,dp as ia,dq as sa,dr as aa,ds as na,dt as oa,du as la,dv as ra}from"./detailed_results-34fd0d97.chunk.js";import{T as da,M as ca,P as ha}from"./index-50a990e3.chunk.js";const ma=i(s).length,ua=i(a).length;class pa{constructor(e,i){t(this,"stat"),t(this,"pseudoStat"),this.stat=e,this.pseudoStat=i}isStat(){return null!=this.stat}isPseudoStat(){return null!=this.pseudoStat}getStat(){if(!this.isStat())throw new Error("Not a stat!");return this.stat}getPseudoStat(){if(!this.isPseudoStat())throw new Error("Not a pseudo stat!");return this.pseudoStat}equals(e){return this.stat==e.stat&&this.pseudoStat==e.pseudoStat}getName(e){return this.isStat()?n(this.stat,e):o.get(this.pseudoStat)}getProtoValue(e){return this.isStat()?e.stats[this.stat]:e.pseudoStats[this.pseudoStat]}setProtoValue(e,t){this.isStat()?e.stats[this.stat]=t:e.pseudoStats[this.pseudoStat]=t}static fromStat(e){return new pa(e,null)}static fromPseudoStat(e){return new pa(null,e)}static getAll(){const e=i(s).filter((e=>![s.StatEnergy,s.StatRage].includes(e))),t=i(a);return[e.map((e=>pa.fromStat(e))),t.map((e=>pa.fromPseudoStat(e)))].flat()}}class ga{constructor(e,i){t(this,"stats"),t(this,"pseudoStats"),this.stats=ga.initStatsArray(ma,e),this.pseudoStats=ga.initStatsArray(ua,i)}static initStatsArray(e,t){let i=t?.slice(0,e)||[];i.length<e&&(i=i.concat(new Array(e-(t?.length||0)).fill(0)));for(let s=0;s<e;s++)null==i[s]&&(i[s]=0);return i}equals(e){return this.stats.every(((t,i)=>t==e.getStat(i)))&&this.pseudoStats.every(((t,i)=>t==e.getPseudoStat(i)))}getStat(e){return this.stats[e]}getPseudoStat(e){return this.pseudoStats[e]}getUnitStat(e){return e.isStat()?this.stats[e.getStat()]:this.pseudoStats[e.getPseudoStat()]}withStat(e,t){const i=this.stats.slice();return i[e]=t,new ga(i,this.pseudoStats)}withPseudoStat(e,t){const i=this.pseudoStats.slice();return i[e]=t,new ga(this.stats,i)}withUnitStat(e,t){return e.isStat()?this.withStat(e.getStat(),t):this.withPseudoStat(e.getPseudoStat(),t)}addStat(e,t){return this.withStat(e,this.getStat(e)+t)}add(e){return new ga(this.stats.map(((t,i)=>t+e.stats[i])),this.pseudoStats.map(((t,i)=>t+e.pseudoStats[i])))}subtract(e){return new ga(this.stats.map(((t,i)=>t-e.stats[i])),this.pseudoStats.map(((t,i)=>t-e.pseudoStats[i])))}scale(e){return new ga(this.stats.map(((t,i)=>t*e)),this.pseudoStats.map(((t,i)=>t*e)))}computeEP(e){let t=0;return this.stats.forEach(((i,s)=>{t+=i*e.stats[s]})),this.pseudoStats.forEach(((i,s)=>{t+=i*e.pseudoStats[s]})),t}belowCaps(e){for(const[t,i]of this.stats.entries())if(e.stats[t]>0&&i>e.stats[t])return!1;return!0}asArray(){return this.stats.slice()}toJson(){return l.toJson(this.toProto())}toProto(){return l.create({stats:this.stats.slice(),pseudoStats:this.pseudoStats.slice()})}static fromJson(e){return ga.fromProto(l.fromJson(e))}static fromMap(e,t){const i=new Array(ma).fill(0);Object.entries(e).forEach((e=>{const[t,s]=e;i[Number(t)]=s}));const s=new Array(ua).fill(0);return t&&Object.entries(t).forEach((e=>{const[t,i]=e;s[Number(t)]=i})),new ga(i,s)}static fromProto(e){return e?new ga(e.stats,e.pseudoStats):new ga}}var fa=(e=>(e[e.Unlaunched=0]="Unlaunched",e[e.Alpha=1]="Alpha",e[e.Beta=2]="Beta",e))(fa||{});const Ia={phase:r.Phase1,status:0},wa={[d.SpecBalanceDruid]:{phase:r.Phase2,status:1},[d.SpecFeralDruid]:{phase:r.Phase2,status:1},[d.SpecFeralTankDruid]:{phase:r.Phase1,status:0},[d.SpecRestorationDruid]:{phase:r.Phase1,status:0},[d.SpecElementalShaman]:{phase:r.Phase2,status:2},[d.SpecEnhancementShaman]:{phase:r.Phase2,status:2},[d.SpecRestorationShaman]:{phase:r.Phase1,status:0},[d.SpecHunter]:{phase:r.Phase2,status:1},[d.SpecMage]:{phase:r.Phase1,status:0},[d.SpecRogue]:{phase:r.Phase1,status:0},[d.SpecHolyPaladin]:{phase:r.Phase1,status:0},[d.SpecProtectionPaladin]:{phase:r.Phase1,status:0},[d.SpecRetributionPaladin]:{phase:r.Phase1,status:0},[d.SpecHealingPriest]:{phase:r.Phase1,status:0},[d.SpecShadowPriest]:{phase:r.Phase1,status:0},[d.SpecWarlock]:{phase:r.Phase2,status:1},[d.SpecTankWarlock]:{phase:r.Phase2,status:1},[d.SpecWarrior]:{phase:r.Phase2,status:1},[d.SpecProtectionWarrior]:{phase:r.Phase1,status:0}};function ba(e){return Object.keys(c).map((e=>parseInt(e))).filter((t=>c[t]==e&&wa[t].status>0))}const va=5;class xa{constructor(e,i){t(this,"sim"),t(this,"raid"),t(this,"buffs",h.create()),t(this,"compChangeEmitter",new m),t(this,"buffsChangeEmitter",new m),t(this,"changeEmitter"),t(this,"players"),t(this,"playerChangeListener"),this.sim=i,this.raid=e,this.players=[...Array(5).keys()].map((e=>null)),this.playerChangeListener=e=>this.changeEmitter.emit(e),this.changeEmitter=m.onAny([this.compChangeEmitter,this.buffsChangeEmitter],"PartyChange")}size(){return this.players.filter((e=>null!=e)).length}isEmpty(){return 0==this.size()}clear(e){this.setBuffs(e,h.create());for(let t=0;t<5;t++)this.setPlayer(e,t,null)}getIndex(){return this.raid.getParties().indexOf(this)}getPlayers(){return this.players.slice()}getPlayer(e){return this.players[e]}setPlayer(e,t,i){if(t<0||t>=5)throw new Error("Invalid player index: "+t);i!=this.players[t]&&m.freezeAllAndDo((()=>{const s=this.players[t];if(null!=s&&(s.changeEmitter.off(this.playerChangeListener),s.setParty(null)),null!=i){const s=i.getParty();s&&s.setPlayer(e,i.getPartyIndex(),null),this.players[t]=i,i.changeEmitter.on(this.playerChangeListener),i.setParty(this)}else this.players[t]=null;this.compChangeEmitter.emit(e)}))}getBuffs(){return h.clone(this.buffs)}setBuffs(e,t){h.equals(this.buffs,t)||(this.buffs=h.clone(t),this.buffsChangeEmitter.emit(e))}toProto(e,t){return u.create({players:this.players.map((i=>null==i?p.create():i.toProto(e,t))),buffs:this.buffs})}fromProto(e,t){m.freezeAllAndDo((()=>{this.setBuffs(e,t.buffs||h.create());for(let i=0;i<5;i++){if(!t.players[i]||t.players[i].class==g.ClassUnknown){this.setPlayer(e,i,null);continue}const s=t.players[i],a=f(s),n=this.players[i];if(n&&a==n.spec)n.fromProto(e,s);else{const t=new Ba(a,this.sim);t.fromProto(e,s),this.setPlayer(e,i,t)}}}))}}class Sa extends I{constructor(e,i,s){super(e,"talents-picker-root",i,{...s,inline:!0}),t(this,"config"),t(this,"numRows"),t(this,"numCols"),t(this,"pointsPerRow"),t(this,"maxPoints"),t(this,"trees"),this.config=s,this.pointsPerRow=s.pointsPerRow,this.maxPoints=s.maxPoints,this.numRows=Math.max(...s.trees.map((e=>e.talents.map((e=>e.location.rowIdx)).flat())).flat())+1,this.numCols=Math.max(...s.trees.map((e=>e.talents.map((e=>e.location.colIdx)).flat())).flat())+1,this.rootElem.appendChild(w("div",{id:"talents-carousel",className:"carousel slide"},w("div",{className:"carousel-inner"}),w("button",{className:"carousel-control-prev",type:"button"},w("span",{className:"carousel-control-prev-icon",attributes:{"aria-hidden":!0}}),w("span",{className:"visually-hidden"},"Previous")),w("button",{className:"carousel-control-next",type:"button"},w("span",{className:"carousel-control-next-icon",attributes:{"aria-hidden":!0}}),w("span",{className:"visually-hidden"},"Next"))));const a=this.rootElem.querySelector(".carousel-inner"),n=this.rootElem.querySelector(".carousel-control-prev"),o=this.rootElem.querySelector(".carousel-control-next");this.trees=s.trees.map(((e,t)=>{const i=document.createElement("div");return a.appendChild(i),i.classList.add("carousel-item"),1===t&&i.classList.add("active"),"Ferocity"===e.name&&(t+=3),"Tenacity"===e.name&&(t+=4),"Cunning"===e.name&&(t+=5),new Ea(i,e,this,s.klass,t)})),this.trees.forEach((e=>e.talents.forEach((e=>e.setPoints(0,!1)))));let l=0;n.addEventListener("click",(()=>{l>=1||(l+=1,a.style.transform=`translateX(${33.3*l}%)`,a.children[Math.abs(l-2)%3].classList.remove("active"),a.children[Math.abs(l-1)%3].classList.add("active"))})),o.addEventListener("click",(()=>{l<=-1||(l-=1,a.style.transform=`translateX(${33.3*l}%)`,a.children[Math.abs(l)%3].classList.remove("active"),a.children[Math.abs(l)+1].classList.add("active"))})),this.init()}getInputElem(){return this.rootElem}getInputValue(){return this.trees.map((e=>e.getTalentsString())).join("-").replace(/-+$/g,"")}setInputValue(e){const t=e.split("-");this.trees.forEach(((e,i)=>e.setTalentsString(t[i]||""))),this.updateTrees()}updateTrees(){this.isFull()?this.rootElem.classList.add("talents-full"):this.rootElem.classList.remove("talents-full"),this.trees.forEach((e=>e.update()))}get numPoints(){return b(this.trees.map((e=>e.numPoints)))}isFull(){return this.numPoints>=this.maxPoints}setMaxPoints(e){e!=this.maxPoints&&(this.maxPoints=e,this.updateTrees())}isHunterPet(){return["Cunning","Ferocity","Tenacity"].includes(this.config.trees[0].name)}}class Ea extends v{constructor(e,i,s,a,n){super(e,"talent-tree-picker-root"),t(this,"config"),t(this,"title"),t(this,"pointsElem"),t(this,"talents"),t(this,"picker"),t(this,"numPoints"),this.config=i,this.numPoints=0,this.picker=s,this.rootElem.appendChild(w(S,null,w("div",{className:"talent-tree-header"},w("img",{src:x(a,n),className:"talent-tree-icon"}),w("span",{className:"talent-tree-title"}),w("span",{className:"talent-tree-points"}),w("button",{className:"talent-tree-reset btn btn-link link-danger"},w("i",{className:"fa fa-times"}))),w("div",{className:"talent-tree-background"}),w("div",{className:"talent-tree-main"}))),this.title=this.rootElem.getElementsByClassName("talent-tree-title")[0],this.pointsElem=this.rootElem.querySelector(".talent-tree-points");this.rootElem.querySelector(".talent-tree-background").style.backgroundImage=`url('${i.backgroundUrl}')`;const o=this.rootElem.querySelector(".talent-tree-main");o.style.gridTemplateRows=`repeat(${this.picker.numRows}, 1fr)`,o.style.gridTemplateColumns=`repeat(${this.picker.numCols}, 1fr)`;const l="3.5rem";o.style.height=`calc(${l} * ${this.picker.numRows})`,o.style.maxWidth=`calc(${l} * ${this.picker.numCols})`,this.rootElem.style.maxWidth=`calc(${l} * ${this.picker.numCols+2})`,this.talents=i.talents.map((e=>new Pa(o,e,this))),this.talents.forEach((e=>{e.config.prereqLocation&&this.getTalent(e.config.prereqLocation).config.childLocations.push(e.config.location)}));const r=(e,t)=>{e.initChildReqs(),e.zIndex=t;for(const i of e.config.childLocations){const s=this.getTalent(i);s.parentReq=e.getChildReqArrow(i),r(s,t-2)}};for(const t of this.talents)0!=t.config.childLocations.length&&void 0===t.config.prereqLocation&&r(t,20);const d=this.rootElem.querySelector(".talent-tree-reset");new da(d,{title:"Reset talent points"}),d.addEventListener("click",(e=>{this.talents.forEach((e=>e.setPoints(0,!1))),this.picker.inputChanged(m.nextEventID())}))}update(){this.title.innerHTML=this.config.name,this.pointsElem.textContent=`${this.numPoints} / ${this.getMaxSpendablePoints()}`,this.talents.forEach((e=>e.update()))}getTalent(e){const t=this.talents.find((t=>t.getRow()==e.rowIdx&&t.getCol()==e.colIdx));if(!t)throw new Error("No talent found with location: "+e);return t}getTalentsString(){return this.talents.map((e=>String(e.getPoints()))).join("").replace(/0+$/g,"")}setTalentsString(e){this.talents.forEach(((t,i)=>t.setPoints(Number(e.charAt(i)),!1)))}getMaxSpendablePoints(){return this.picker.isHunterPet()?16:71}}class ya extends v{constructor(e,i,s){super(e,"talent-picker-req-arrow",document.createElement("div")),t(this,"dir"),t(this,"zIdx"),t(this,"parentLoc"),t(this,"childLoc"),this.zIdx=0,this.parentLoc=i,this.childLoc=s,this.rootElem.style.gridRow=String(i.rowIdx+1),this.rootElem.style.gridColumn=String(i.colIdx+1);let a=Math.max(i.rowIdx,s.rowIdx)+1,n=Math.max(i.colIdx,s.colIdx)+1;i.rowIdx==s.rowIdx?(this.dir=i.colIdx<s.colIdx?"right":"left",this.rootElem.dataset.reqArrowColSize=String(Math.abs(i.colIdx-s.colIdx)),n="left"==this.dir?n+1:n-1):i.colIdx==s.colIdx?(this.dir="down",this.rootElem.dataset.reqArrowRowSize=String(Math.abs(i.rowIdx-s.rowIdx)),a+=1):(this.dir=i.colIdx<s.colIdx?"rightdown":"leftdown",this.rootElem.dataset.reqArrowColSize=String(Math.abs(i.colIdx-s.colIdx)),this.rootElem.dataset.reqArrowRowSize=String(Math.abs(i.rowIdx-s.rowIdx)),a+=1,n="rightdown"==this.dir?n+1:n-1,this.rootElem.appendChild(w("div",null))),this.rootElem.style.gridRowEnd=String(a),this.rootElem.style.gridColumnEnd=String(n),this.rootElem.classList.add(`talent-picker-req-arrow-${this.dir}`)}get zIndex(){return this.zIdx}set zIndex(e){this.zIdx=e,this.rootElem.style.zIndex=String(e)}setReqFufilled(e){e?this.rootElem.dataset.reqActive="true":delete this.rootElem.dataset.reqActive}}class Pa extends v{constructor(e,i,s){super(e,"talent-picker-root",document.createElement("a")),t(this,"config"),t(this,"tree"),t(this,"pointsDisplay"),t(this,"longTouchTimer"),t(this,"childReqs"),t(this,"zIdx"),t(this,"parentReq"),this.config=i,this.tree=s,this.childReqs=[],this.parentReq=null,this.zIdx=0,this.rootElem.style.gridRow=String(this.config.location.rowIdx+1),this.rootElem.style.gridColumn=String(this.config.location.colIdx+1),this.rootElem.dataset.maxPoints=String(this.config.maxPoints),this.rootElem.dataset.whtticon="false",this.pointsDisplay=document.createElement("span"),this.pointsDisplay.classList.add("talent-picker-points"),this.rootElem.appendChild(this.pointsDisplay),this.rootElem.addEventListener("click",(e=>{e.preventDefault()})),this.rootElem.addEventListener("contextmenu",(e=>{e.preventDefault()})),this.rootElem.addEventListener("touchmove",(e=>{null!=this.longTouchTimer&&(clearTimeout(this.longTouchTimer),this.longTouchTimer=void 0)})),this.rootElem.addEventListener("touchstart",(e=>{e.preventDefault(),this.longTouchTimer=window.setTimeout((()=>{this.setPoints(0,!0),this.tree.picker.inputChanged(m.nextEventID()),this.longTouchTimer=void 0}),750)})),this.rootElem.addEventListener("touchend",(e=>{if(e.preventDefault(),null!=this.longTouchTimer){clearTimeout(this.longTouchTimer),this.longTouchTimer=void 0;var t=this.getPoints()+1;this.config.maxPoints<t&&(t=0),this.setPoints(t,!0),this.tree.picker.inputChanged(m.nextEventID())}})),this.rootElem.addEventListener("mousedown",(e=>{E(e)?this.setPoints(this.getPoints()-1,!0):this.setPoints(this.getPoints()+1,!0),this.tree.picker.inputChanged(m.nextEventID())}))}initChildReqs(){if(0!=this.config.childLocations.length)for(const e of this.config.childLocations)this.childReqs.push(new ya(this.rootElem.parentElement,this.config.location,e))}getChildReqArrow(e){for(let t of this.childReqs)if(t.childLoc===e)return t;throw Error("missing child prereq?")}get zIndex(){return this.zIdx}set zIndex(e){this.zIdx=e,this.rootElem.style.zIndex=String(this.zIdx);for(const t of this.childReqs)t.zIndex=this.zIdx-1}getRow(){return this.config.location.rowIdx}getCol(){return this.config.location.colIdx}getPoints(){const e=Number(this.rootElem.dataset.points);return isNaN(e)?0:e}isFull(){return this.getPoints()>=this.config.maxPoints}canSetPoints(e){const t=this.getPoints();if(e>t){const i=e-t;if(this.tree.picker.numPoints+i>this.tree.picker.maxPoints)return!1;if(this.tree.numPoints<this.getRow()*this.tree.picker.pointsPerRow)return!1;if(this.config.prereqLocation&&!this.tree.getTalent(this.config.prereqLocation).isFull())return!1}else{const i=t-e,s=[...Array(this.tree.picker.numRows).keys()].map((e=>this.tree.talents.filter((t=>t.getRow()==e)))).map((e=>b(e.map((e=>e.getPoints())))));s[this.getRow()]-=i;const a=s.map(((e,t)=>b(s.slice(0,t+1))));if(!this.tree.talents.every((e=>0==e.getPoints()||0==e.getRow()||a[e.getRow()-1]>=e.getRow()*this.tree.picker.pointsPerRow)))return!1;for(const e of this.config.childLocations)if(this.tree.getTalent(e).getPoints()>0)return!1}return!0}setPoints(e,t){const i=this.getPoints();if(e=Math.max(0,e),e=Math.min(this.config.maxPoints,e),t&&!this.canSetPoints(e))return;this.tree.numPoints+=e-i,this.rootElem.dataset.points=String(e),this.pointsDisplay.textContent=e+"/"+this.config.maxPoints,this.isFull()?this.rootElem.classList.add("talent-full"):this.rootElem.classList.remove("talent-full");const s=this.getSpellIdForPoints(e);y.fromSpellId(s).fill().then((e=>{e.setWowheadHref(this.rootElem),this.rootElem.style.backgroundImage=`url('${e.iconUrl}')`}))}getSpellIdForPoints(e){const t=Math.max(0,e-1);if(this.config.spellIds[t])return this.config.spellIds[t];throw new Error(`No rank ${e} for talent ${String(this.config.fieldName)}`)}update(){let e=this.canSetPoints(this.getPoints()+1);e?this.rootElem.classList.add("talent-picker-can-add"):this.rootElem.classList.remove("talent-picker-can-add"),this.parentReq&&this.parentReq.setReqFufilled(e||this.isFull())}}function ka(e){return e.forEach((e=>{e.talents.forEach(((t,i)=>{if(t.childLocations=[],0!=i){const s=e.talents[i-1];if(t.location.rowIdx<s.location.rowIdx||t.location.rowIdx==s.location.rowIdx&&t.location.colIdx<=s.location.colIdx)throw new Error(`Out-of-order talent: ${String(t.fieldName)}`)}if(t.spellIds.length<t.maxPoints){let e=t.spellIds[t.spellIds.length-1];for(let i=t.spellIds.length;i<t.maxPoints;i++)e++,t.spellIds.push(e)}}))})),e}const Ca=ka([{name:"Balance",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/283.jpg",talents:[{fieldName:"improvedWrath",location:{rowIdx:0,colIdx:0},spellIds:[16814,16815,16816,16817,16818],maxPoints:5},{fieldName:"naturesGrasp",location:{rowIdx:0,colIdx:1},spellIds:[16689],maxPoints:1},{fieldName:"improvedNaturesGrasp",location:{rowIdx:0,colIdx:2},spellIds:[17245,17247,17248,17249],maxPoints:4,prereqLocation:{rowIdx:0,colIdx:1}},{fieldName:"improvedEntanglingRoots",location:{rowIdx:1,colIdx:0},spellIds:[16918,16919,16920],maxPoints:3},{fieldName:"improvedMoonfire",location:{rowIdx:1,colIdx:1},spellIds:[16821,16822,16823,16824,16825],maxPoints:5},{fieldName:"naturalWeapons",location:{rowIdx:1,colIdx:2},spellIds:[16902,16903,16904,16905,16906],maxPoints:5},{fieldName:"naturalShapeshifter",location:{rowIdx:1,colIdx:3},spellIds:[16833,16834,16835],maxPoints:3},{fieldName:"improvedThorns",location:{rowIdx:2,colIdx:0},spellIds:[16836,16839,16840],maxPoints:3},{fieldName:"omenOfClarity",location:{rowIdx:2,colIdx:2},spellIds:[16864],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"naturesReach",location:{rowIdx:2,colIdx:3},spellIds:[16819,16820],maxPoints:2},{fieldName:"vengeance",location:{rowIdx:3,colIdx:1},spellIds:[16909,16910,16911,16912,16913],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"improvedStarfire",location:{rowIdx:3,colIdx:2},spellIds:[16850,16923,16924,16925,16926],maxPoints:5},{fieldName:"naturesGrace",location:{rowIdx:4,colIdx:1},spellIds:[16880],maxPoints:1},{fieldName:"moonglow",location:{rowIdx:4,colIdx:2},spellIds:[16845,16846,16847],maxPoints:3},{fieldName:"moonfury",location:{rowIdx:5,colIdx:1},spellIds:[16896,16897,16899,16900,16901],maxPoints:5,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"moonkinForm",location:{rowIdx:6,colIdx:1},spellIds:[24858],maxPoints:1}]},{name:"Feral Combat",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/281.jpg",talents:[{fieldName:"ferocity",location:{rowIdx:0,colIdx:1},spellIds:[16934,16935,16936,16937,16938],maxPoints:5},{fieldName:"feralAggression",location:{rowIdx:0,colIdx:2},spellIds:[16858,16859,16860,16861,16862],maxPoints:5},{fieldName:"feralInstinct",location:{rowIdx:1,colIdx:0},spellIds:[16947,16948,16949,16950,16951],maxPoints:5},{fieldName:"brutalImpact",location:{rowIdx:1,colIdx:1},spellIds:[16940,16941],maxPoints:2},{fieldName:"thickHide",location:{rowIdx:1,colIdx:2},spellIds:[16929,16930,16931,16932,16933],maxPoints:5},{fieldName:"felineSwiftness",location:{rowIdx:2,colIdx:0},spellIds:[17002,24866],maxPoints:2},{fieldName:"feralCharge",location:{rowIdx:2,colIdx:1},spellIds:[16979],maxPoints:1},{fieldName:"sharpenedClaws",location:{rowIdx:2,colIdx:2},spellIds:[16942,16943,16944],maxPoints:3},{fieldName:"improvedShred",location:{rowIdx:3,colIdx:0},spellIds:[16966,16968],maxPoints:2},{fieldName:"predatoryStrikes",location:{rowIdx:3,colIdx:1},spellIds:[16972,16974,16975],maxPoints:3},{fieldName:"bloodFrenzy",location:{rowIdx:3,colIdx:2},spellIds:[16952,16954],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"primalFury",location:{rowIdx:3,colIdx:3},spellIds:[16958,16961],maxPoints:2},{fieldName:"savageFury",location:{rowIdx:4,colIdx:0},spellIds:[16998,16999],maxPoints:2},{fieldName:"faerieFireFeral",location:{rowIdx:4,colIdx:2},spellIds:[16857],maxPoints:1},{fieldName:"heartOfTheWild",location:{rowIdx:5,colIdx:1},spellIds:[17003,17004,17005,17006,24894],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"leaderOfThePack",location:{rowIdx:6,colIdx:1},spellIds:[17007],maxPoints:1}]},{name:"Restoration",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/282.jpg",talents:[{fieldName:"improvedMarkOfTheWild",location:{rowIdx:0,colIdx:1},spellIds:[17050,17051,17053,17054,17055],maxPoints:5},{fieldName:"furor",location:{rowIdx:0,colIdx:2},spellIds:[17056,17058,17059,17060,17061],maxPoints:5},{fieldName:"improvedHealingTouch",location:{rowIdx:1,colIdx:0},spellIds:[17069,17070,17071,17072,17073],maxPoints:5},{fieldName:"naturesFocus",location:{rowIdx:1,colIdx:1},spellIds:[17063,17065,17066,17067,17068],maxPoints:5},{fieldName:"improvedEnrage",location:{rowIdx:1,colIdx:2},spellIds:[17079,17082],maxPoints:2},{fieldName:"reflection",location:{rowIdx:2,colIdx:1},spellIds:[17106,17107,17108],maxPoints:3},{fieldName:"insectSwarm",location:{rowIdx:2,colIdx:2},spellIds:[5570],maxPoints:1},{fieldName:"subtlety",location:{rowIdx:2,colIdx:3},spellIds:[17118,17119,17120,17121,17122],maxPoints:5},{fieldName:"tranquilSpirit",location:{rowIdx:3,colIdx:1},spellIds:[24968,24969,24970,24971,24972],maxPoints:5},{fieldName:"improvedRejuvenation",location:{rowIdx:3,colIdx:3},spellIds:[17111,17112,17113],maxPoints:3},{fieldName:"naturesSwiftness",location:{rowIdx:4,colIdx:0},spellIds:[17116],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:0}},{fieldName:"giftOfNature",location:{rowIdx:4,colIdx:2},spellIds:[17104,24943,24944,24945,24946],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"improvedTranquility",location:{rowIdx:4,colIdx:3},spellIds:[17123,17124],maxPoints:2},{fieldName:"improvedRegrowth",location:{rowIdx:5,colIdx:2},spellIds:[17074,17075,17076,17077,17078],maxPoints:5},{fieldName:"swiftmend",location:{rowIdx:6,colIdx:1},spellIds:[18562],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}}]}]),La=ka([{name:"Beast Mastery",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/361.jpg",talents:[{fieldName:"improvedAspectOfTheHawk",location:{rowIdx:0,colIdx:1},spellIds:[19552,19553,19554,19555,19556],maxPoints:5},{fieldName:"enduranceTraining",location:{rowIdx:0,colIdx:2},spellIds:[19583,19584,19585,19586,19587],maxPoints:5},{fieldName:"improvedEyesOfTheBeast",location:{rowIdx:1,colIdx:0},spellIds:[19557,19558],maxPoints:2},{fieldName:"improvedAspectOfTheMonkey",location:{rowIdx:1,colIdx:1},spellIds:[19549,19550,19551,24386,24387],maxPoints:5},{fieldName:"thickHide",location:{rowIdx:1,colIdx:2},spellIds:[19609,19610,19612],maxPoints:3},{fieldName:"improvedRevivePet",location:{rowIdx:1,colIdx:3},spellIds:[24443,19575],maxPoints:2},{fieldName:"pathfinding",location:{rowIdx:2,colIdx:0},spellIds:[19559,19560],maxPoints:2},{fieldName:"bestialSwiftness",location:{rowIdx:2,colIdx:1},spellIds:[19596],maxPoints:1},{fieldName:"unleashedFury",location:{rowIdx:2,colIdx:2},spellIds:[19616,19617,19618,19619,19620],maxPoints:5},{fieldName:"improvedMendPet",location:{rowIdx:3,colIdx:1},spellIds:[19572,19573],maxPoints:2},{fieldName:"ferocity",location:{rowIdx:3,colIdx:2},spellIds:[19598,19599,19600,19601,19602],maxPoints:5},{fieldName:"spiritBond",location:{rowIdx:4,colIdx:0},spellIds:[19578,20895],maxPoints:2},{fieldName:"intimidation",location:{rowIdx:4,colIdx:1},spellIds:[19577],maxPoints:1},{fieldName:"bestialDiscipline",location:{rowIdx:4,colIdx:3},spellIds:[19590,19592],maxPoints:2},{fieldName:"frenzy",location:{rowIdx:5,colIdx:2},spellIds:[19621,19622,19623,19624,19625],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"bestialWrath",location:{rowIdx:6,colIdx:1},spellIds:[19574],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Marksmanship",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/363.jpg",talents:[{fieldName:"improvedConcussiveShot",location:{rowIdx:0,colIdx:1},spellIds:[19407,19412,19413,19414,19415],maxPoints:5},{fieldName:"efficiency",location:{rowIdx:0,colIdx:2},spellIds:[19416,19417,19418,19419,19420],maxPoints:5},{fieldName:"improvedHuntersMark",location:{rowIdx:1,colIdx:1},spellIds:[19421,19422,19423,19424,19425],maxPoints:5},{fieldName:"lethalShots",location:{rowIdx:1,colIdx:2},spellIds:[19426,19427,19429,19430,19431],maxPoints:5},{fieldName:"aimedShot",location:{rowIdx:2,colIdx:0},spellIds:[19434],maxPoints:1},{fieldName:"improvedArcaneShot",location:{rowIdx:2,colIdx:1},spellIds:[19454,19455,19456,19457,19458],maxPoints:5},{fieldName:"hawkEye",location:{rowIdx:2,colIdx:3},spellIds:[19498,19499,19500],maxPoints:3},{fieldName:"improvedSerpentSting",location:{rowIdx:3,colIdx:1},spellIds:[19464,19465,19466,19467,19468],maxPoints:5},{fieldName:"mortalShots",location:{rowIdx:3,colIdx:2},spellIds:[19485,19487,19488,19489,19490],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"scatterShot",location:{rowIdx:4,colIdx:0},spellIds:[19503],maxPoints:1},{fieldName:"barrage",location:{rowIdx:4,colIdx:1},spellIds:[19461,19462,24691],maxPoints:3},{fieldName:"improvedScorpidSting",location:{rowIdx:4,colIdx:2},spellIds:[19491,19493,19494],maxPoints:3},{fieldName:"rangedWeaponSpecialization",location:{rowIdx:5,colIdx:2},spellIds:[19507,19508,19509,19510,19511],maxPoints:5},{fieldName:"trueshotAura",location:{rowIdx:6,colIdx:1},spellIds:[19506],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Survival",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/362.jpg",talents:[{fieldName:"monsterSlaying",location:{rowIdx:0,colIdx:0},spellIds:[24293,24294,24295],maxPoints:3},{fieldName:"humanoidSlaying",location:{rowIdx:0,colIdx:1},spellIds:[19151,19152,19153],maxPoints:3},{fieldName:"deflection",location:{rowIdx:0,colIdx:2},spellIds:[19295,19297,19298,19300,19301],maxPoints:5},{fieldName:"entrapment",location:{rowIdx:1,colIdx:0},spellIds:[19184,19387,19388,19389,19390],maxPoints:5},{fieldName:"savageStrikes",location:{rowIdx:1,colIdx:1},spellIds:[19159,19160],maxPoints:2},{fieldName:"improvedWingClip",location:{rowIdx:1,colIdx:2},spellIds:[19228,19232,19233,19234,19235],maxPoints:5},{fieldName:"cleverTraps",location:{rowIdx:2,colIdx:0},spellIds:[19239,19245],maxPoints:2},{fieldName:"survivalist",location:{rowIdx:2,colIdx:1},spellIds:[19255,19256,19257,19258,19259],maxPoints:5},{fieldName:"deterrence",location:{rowIdx:2,colIdx:2},spellIds:[19263],maxPoints:1},{fieldName:"trapMastery",location:{rowIdx:3,colIdx:0},spellIds:[19376,19377],maxPoints:2},{fieldName:"surefooted",location:{rowIdx:3,colIdx:1},spellIds:[19290,19294,24283],maxPoints:3},{fieldName:"improvedFeignDeath",location:{rowIdx:3,colIdx:3},spellIds:[19286,19287],maxPoints:2},{fieldName:"killerInstinct",location:{rowIdx:4,colIdx:1},spellIds:[19370,19371,19373],maxPoints:3},{fieldName:"counterattack",location:{rowIdx:4,colIdx:2},spellIds:[19306],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"lightningReflexes",location:{rowIdx:5,colIdx:2},spellIds:[19168,19180,19181,24296,24297],maxPoints:5},{fieldName:"wyvernSting",location:{rowIdx:6,colIdx:1},spellIds:[19386],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),Ta=ka([{name:"Arcane",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/81.jpg",talents:[{fieldName:"arcaneSubtlety",location:{rowIdx:0,colIdx:0},spellIds:[11210,12592],maxPoints:2},{fieldName:"arcaneFocus",location:{rowIdx:0,colIdx:1},spellIds:[11222,12839,12840,12841,12842],maxPoints:5},{fieldName:"improvedArcaneMissiles",location:{rowIdx:0,colIdx:2},spellIds:[11237,12463,12464,16769,16770],maxPoints:5},{fieldName:"wandSpecialization",location:{rowIdx:1,colIdx:0},spellIds:[6057,6085],maxPoints:2},{fieldName:"magicAbsorption",location:{rowIdx:1,colIdx:1},spellIds:[29441,29444,29445,29446,29447],maxPoints:5},{fieldName:"arcaneConcentration",location:{rowIdx:1,colIdx:2},spellIds:[11213,12574,12575,12576,12577],maxPoints:5},{fieldName:"magicAttunement",location:{rowIdx:2,colIdx:0},spellIds:[11247,12606],maxPoints:2},{fieldName:"improvedArcaneExplosion",location:{rowIdx:2,colIdx:1},spellIds:[11242,12467,12469],maxPoints:3},{fieldName:"arcaneResilience",location:{rowIdx:2,colIdx:2},spellIds:[28574],maxPoints:1},{fieldName:"improvedManaShield",location:{rowIdx:3,colIdx:0},spellIds:[11252,12605],maxPoints:2},{fieldName:"improvedCounterspell",location:{rowIdx:3,colIdx:1},spellIds:[11255,12598],maxPoints:2},{fieldName:"arcaneMeditation",location:{rowIdx:3,colIdx:3},spellIds:[18462,18463,18464],maxPoints:3},{fieldName:"presenceOfMind",location:{rowIdx:4,colIdx:1},spellIds:[12043],maxPoints:1},{fieldName:"arcaneMind",location:{rowIdx:4,colIdx:2},spellIds:[11232,12500,12501,12502,12503],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"arcaneInstability",location:{rowIdx:5,colIdx:1},spellIds:[15058,15059,15060],maxPoints:3,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"arcanePower",location:{rowIdx:6,colIdx:1},spellIds:[12042],maxPoints:1,prereqLocation:{rowIdx:5,colIdx:1}}]},{name:"Fire",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/41.jpg",talents:[{fieldName:"improvedFireball",location:{rowIdx:0,colIdx:1},spellIds:[11069,12338,12339,12340,12341],maxPoints:5},{fieldName:"impact",location:{rowIdx:0,colIdx:2},spellIds:[11103,12357,12358,12359,12360],maxPoints:5},{fieldName:"ignite",location:{rowIdx:1,colIdx:0},spellIds:[11119,11120,12846,12847,12848],maxPoints:5},{fieldName:"flameThrowing",location:{rowIdx:1,colIdx:1},spellIds:[11100,12353],maxPoints:2},{fieldName:"improvedFireBlast",location:{rowIdx:1,colIdx:2},spellIds:[11078,11080,12342],maxPoints:3},{fieldName:"incinerate",location:{rowIdx:2,colIdx:0},spellIds:[18459,18460],maxPoints:2},{fieldName:"improvedFlamestrike",location:{rowIdx:2,colIdx:1},spellIds:[11108,12349,12350],maxPoints:3},{fieldName:"pyroblast",location:{rowIdx:2,colIdx:2},spellIds:[11366],maxPoints:1},{fieldName:"burningSoul",location:{rowIdx:2,colIdx:3},spellIds:[11083,12351],maxPoints:2},{fieldName:"improvedScorch",location:{rowIdx:3,colIdx:0},spellIds:[11095,12872,12873],maxPoints:3},{fieldName:"improvedFireWard",location:{rowIdx:3,colIdx:1},spellIds:[11094,13043],maxPoints:2},{fieldName:"masterOfElements",location:{rowIdx:3,colIdx:3},spellIds:[29074,29075,29076],maxPoints:3},{fieldName:"criticalMass",location:{rowIdx:4,colIdx:1},spellIds:[11115,11367,11368],maxPoints:3},{fieldName:"blastWave",location:{rowIdx:4,colIdx:2},spellIds:[11113],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"firePower",location:{rowIdx:5,colIdx:2},spellIds:[11124,12378,12398,12399,12400],maxPoints:5},{fieldName:"combustion",location:{rowIdx:6,colIdx:1},spellIds:[11129],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Frost",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/61.jpg",talents:[{fieldName:"frostWarding",location:{rowIdx:0,colIdx:0},spellIds:[11189,28332],maxPoints:2},{fieldName:"improvedFrostbolt",location:{rowIdx:0,colIdx:1},spellIds:[11070,12473,16763,16765,16766],maxPoints:5},{fieldName:"elementalPrecision",location:{rowIdx:0,colIdx:2},spellIds:[29438,29439,29440],maxPoints:3},{fieldName:"iceShards",location:{rowIdx:1,colIdx:0},spellIds:[11207,12672,15047,15052,15053],maxPoints:5},{fieldName:"frostbite",location:{rowIdx:1,colIdx:1},spellIds:[11071,12496,12497],maxPoints:3},{fieldName:"improvedFrostNova",location:{rowIdx:1,colIdx:2},spellIds:[11165,12475],maxPoints:2},{fieldName:"permafrost",location:{rowIdx:1,colIdx:3},spellIds:[11175,12569,12571],maxPoints:3},{fieldName:"piercingIce",location:{rowIdx:2,colIdx:0},spellIds:[11151,12952,12953],maxPoints:3},{fieldName:"coldSnap",location:{rowIdx:2,colIdx:1},spellIds:[12472],maxPoints:1},{fieldName:"improvedBlizzard",location:{rowIdx:2,colIdx:3},spellIds:[11185,12487,12488],maxPoints:3},{fieldName:"arcticReach",location:{rowIdx:3,colIdx:0},spellIds:[16757,16758],maxPoints:2},{fieldName:"frostChanneling",location:{rowIdx:3,colIdx:1},spellIds:[11160,12518,12519],maxPoints:3},{fieldName:"shatter",location:{rowIdx:3,colIdx:2},spellIds:[11170,12982,12983,12984,12985],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"iceBlock",location:{rowIdx:4,colIdx:1},spellIds:[11958],maxPoints:1},{fieldName:"improvedConeOfCold",location:{rowIdx:4,colIdx:2},spellIds:[11190,12489,12490],maxPoints:3},{fieldName:"wintersChill",location:{rowIdx:5,colIdx:2},spellIds:[11180,28592,28593,28594,28595],maxPoints:5},{fieldName:"iceBarrier",location:{rowIdx:6,colIdx:1},spellIds:[11426],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),_a=ka([{name:"Holy",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/382.jpg",talents:[{fieldName:"divineStrength",location:{rowIdx:0,colIdx:1},spellIds:[20262,20263,20264,20265,20266],maxPoints:5},{fieldName:"divineIntellect",location:{rowIdx:0,colIdx:2},spellIds:[20257,20258,20259,20260,20261],maxPoints:5},{fieldName:"spiritualFocus",location:{rowIdx:1,colIdx:1},spellIds:[20205,20206,20207,20208,20209],maxPoints:5},{fieldName:"improvedSealOfRighteousness",location:{rowIdx:1,colIdx:2},spellIds:[20224,20225,20330,20331,20332],maxPoints:5},{fieldName:"healingLight",location:{rowIdx:2,colIdx:0},spellIds:[20237,20238,20239],maxPoints:3},{fieldName:"consecration",location:{rowIdx:2,colIdx:1},spellIds:[26573],maxPoints:1},{fieldName:"improvedLayOnHands",location:{rowIdx:2,colIdx:2},spellIds:[20234,20235],maxPoints:2},{fieldName:"unyieldingFaith",location:{rowIdx:2,colIdx:3},spellIds:[9453,25836],maxPoints:2},{fieldName:"illumination",location:{rowIdx:3,colIdx:1},spellIds:[20210,20212,20213,20214,20215],maxPoints:5},{fieldName:"improvedBlessingOfWisdom",location:{rowIdx:3,colIdx:2},spellIds:[20244,20245],maxPoints:2},{fieldName:"divineFavor",location:{rowIdx:4,colIdx:1},spellIds:[20216],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"lastingJudgement",location:{rowIdx:4,colIdx:2},spellIds:[20359,20360,20361],maxPoints:3},{fieldName:"holyPower",location:{rowIdx:5,colIdx:2},spellIds:[5923,5924,5925,5926,25829],maxPoints:5},{fieldName:"holyShock",location:{rowIdx:6,colIdx:1},spellIds:[20473],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Protection",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/383.jpg",talents:[{fieldName:"improvedDevotionAura",location:{rowIdx:0,colIdx:1},spellIds:[20138,20139,20140,20141,20142],maxPoints:5},{fieldName:"redoubt",location:{rowIdx:0,colIdx:2},spellIds:[20127,20130,20135,20136,20137],maxPoints:5},{fieldName:"precision",location:{rowIdx:1,colIdx:0},spellIds:[20189,20192,20193],maxPoints:3},{fieldName:"guardiansFavor",location:{rowIdx:1,colIdx:1},spellIds:[20174,20175],maxPoints:2},{fieldName:"toughness",location:{rowIdx:1,colIdx:3},spellIds:[20143,20144,20145,20146,20147],maxPoints:5},{fieldName:"blessingOfKings",location:{rowIdx:2,colIdx:0},spellIds:[20217],maxPoints:1},{fieldName:"improvedRighteousFury",location:{rowIdx:2,colIdx:1},spellIds:[20468,20469,20470],maxPoints:3},{fieldName:"shieldSpecialization",location:{rowIdx:2,colIdx:2},spellIds:[20148,20149,20150],maxPoints:3,prereqLocation:{rowIdx:0,colIdx:2}},{fieldName:"anticipation",location:{rowIdx:2,colIdx:3},spellIds:[20096,20097,20098,20099,20100],maxPoints:5},{fieldName:"improvedHammerOfJustice",location:{rowIdx:3,colIdx:1},spellIds:[20487,20488,20489],maxPoints:3},{fieldName:"improvedConcentrationAura",location:{rowIdx:3,colIdx:2},spellIds:[20254,20255,20256],maxPoints:3},{fieldName:"blessingOfSanctuary",location:{rowIdx:4,colIdx:1},spellIds:[20911],maxPoints:1},{fieldName:"reckoning",location:{rowIdx:4,colIdx:2},spellIds:[20177,20179,20180,20181,20182],maxPoints:5},{fieldName:"oneHandedWeaponSpecialization",location:{rowIdx:5,colIdx:2},spellIds:[20196,20197,20198,20199,20200],maxPoints:5},{fieldName:"holyShield",location:{rowIdx:6,colIdx:1},spellIds:[20925],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Retribution",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/381.jpg",talents:[{fieldName:"improvedBlessingOfMight",location:{rowIdx:0,colIdx:1},spellIds:[20042,20045,20046,20047,20048],maxPoints:5},{fieldName:"benediction",location:{rowIdx:0,colIdx:2},spellIds:[20101,20102,20103,20104,20105],maxPoints:5},{fieldName:"improvedJudgement",location:{rowIdx:1,colIdx:0},spellIds:[25956,25957],maxPoints:2},{fieldName:"improvedSealOfTheCrusader",location:{rowIdx:1,colIdx:1},spellIds:[20335,20336,20337],maxPoints:3},{fieldName:"deflection",location:{rowIdx:1,colIdx:2},spellIds:[20060,20061,20062,20063,20064],maxPoints:5},{fieldName:"vindication",location:{rowIdx:2,colIdx:0},spellIds:[9452,26016,26021],maxPoints:3},{fieldName:"conviction",location:{rowIdx:2,colIdx:1},spellIds:[20117,20118,20119,20120,20121],maxPoints:5},{fieldName:"sealOfCommand",location:{rowIdx:2,colIdx:2},spellIds:[20375],maxPoints:1},{fieldName:"pursuitOfJustice",location:{rowIdx:2,colIdx:3},spellIds:[26022,26023],maxPoints:2},{fieldName:"eyeForAnEye",location:{rowIdx:3,colIdx:0},spellIds:[9799,25988],maxPoints:2},{fieldName:"improvedRetributionAura",location:{rowIdx:3,colIdx:2},spellIds:[20091,20092],maxPoints:2},{fieldName:"twoHandedWeaponSpecialization",location:{rowIdx:4,colIdx:0},spellIds:[20111,20112,20113],maxPoints:3},{fieldName:"sanctityAura",location:{rowIdx:4,colIdx:2},spellIds:[20218],maxPoints:1},{fieldName:"vengeance",location:{rowIdx:5,colIdx:1},spellIds:[20049,20056,20057,20058,20059],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"repentance",location:{rowIdx:6,colIdx:1},spellIds:[20066],maxPoints:1}]}]),Na=ka([{name:"Discipline",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/201.jpg",talents:[{fieldName:"unbreakableWill",location:{rowIdx:0,colIdx:1},spellIds:[14522,14788,14789,14790,14791],maxPoints:5},{fieldName:"wandSpecialization",location:{rowIdx:0,colIdx:2},spellIds:[14524,14525,14526,14527,14528],maxPoints:5},{fieldName:"silentResolve",location:{rowIdx:1,colIdx:0},spellIds:[14523,14784,14785,14786,14787],maxPoints:5},{fieldName:"improvedPowerWordFortitude",location:{rowIdx:1,colIdx:1},spellIds:[14749,14767],maxPoints:2},{fieldName:"improvedPowerWordShield",location:{rowIdx:1,colIdx:2},spellIds:[14748,14768,14769],maxPoints:3},{fieldName:"martyrdom",location:{rowIdx:1,colIdx:3},spellIds:[14531,14774],maxPoints:2},{fieldName:"innerFocus",location:{rowIdx:2,colIdx:1},spellIds:[14751],maxPoints:1},{fieldName:"meditation",location:{rowIdx:2,colIdx:2},spellIds:[14521,14776,14777],maxPoints:3},{fieldName:"improvedInnerFire",location:{rowIdx:3,colIdx:0},spellIds:[14747,14770,14771],maxPoints:3},{fieldName:"mentalAgility",location:{rowIdx:3,colIdx:1},spellIds:[14520,14780,14781,14782,14783],maxPoints:5},{fieldName:"improvedManaBurn",location:{rowIdx:3,colIdx:3},spellIds:[14750,14772],maxPoints:2},{fieldName:"mentalStrength",location:{rowIdx:4,colIdx:1},spellIds:[18551,18552,18553,18554,18555],maxPoints:5},{fieldName:"divineSpirit",location:{rowIdx:4,colIdx:2},spellIds:[14752],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"forceOfWill",location:{rowIdx:5,colIdx:2},spellIds:[18544,18547,18548,18549,18550],maxPoints:5},{fieldName:"powerInfusion",location:{rowIdx:6,colIdx:1},spellIds:[10060],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Holy",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/202.jpg",talents:[{fieldName:"healingFocus",location:{rowIdx:0,colIdx:0},spellIds:[14913,15012],maxPoints:2},{fieldName:"improvedRenew",location:{rowIdx:0,colIdx:1},spellIds:[14908,15020,17191],maxPoints:3},{fieldName:"holySpecialization",location:{rowIdx:0,colIdx:2},spellIds:[14889,15008,15009,15010,15011],maxPoints:5},{fieldName:"spellWarding",location:{rowIdx:1,colIdx:1},spellIds:[27900,27901,27902,27903,27904],maxPoints:5},{fieldName:"divineFury",location:{rowIdx:1,colIdx:2},spellIds:[18530,18531,18533,18534,18535],maxPoints:5},{fieldName:"holyNova",location:{rowIdx:2,colIdx:0},spellIds:[15237],maxPoints:1},{fieldName:"blessedRecovery",location:{rowIdx:2,colIdx:1},spellIds:[27811,27815,27816],maxPoints:3},{fieldName:"inspiration",location:{rowIdx:2,colIdx:3},spellIds:[14892,15362,15363],maxPoints:3},{fieldName:"holyReach",location:{rowIdx:3,colIdx:0},spellIds:[27789,27790],maxPoints:2},{fieldName:"improvedHealing",location:{rowIdx:3,colIdx:1},spellIds:[14912,15013,15014],maxPoints:3},{fieldName:"searingLight",location:{rowIdx:3,colIdx:2},spellIds:[14909,15017],maxPoints:2,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"improvedPrayerOfHealing",location:{rowIdx:4,colIdx:0},spellIds:[14911,15018],maxPoints:2},{fieldName:"spiritOfRedemption",location:{rowIdx:4,colIdx:1},spellIds:[20711],maxPoints:1},{fieldName:"spiritualGuidance",location:{rowIdx:4,colIdx:2},spellIds:[14901,15028,15029,15030,15031],maxPoints:5},{fieldName:"spiritualHealing",location:{rowIdx:5,colIdx:2},spellIds:[14898,15349,15354,15355,15356],maxPoints:5},{fieldName:"lightwell",location:{rowIdx:6,colIdx:1},spellIds:[724],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Shadow",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/203.jpg",talents:[{fieldName:"spiritTap",location:{rowIdx:0,colIdx:1},spellIds:[15270,15335,15336,15337,15338],maxPoints:5},{fieldName:"blackout",location:{rowIdx:0,colIdx:2},spellIds:[15268,15323,15324,15325,15326],maxPoints:5},{fieldName:"shadowAffinity",location:{rowIdx:1,colIdx:0},spellIds:[15318,15272,15320],maxPoints:3},{fieldName:"improvedShadowWordPain",location:{rowIdx:1,colIdx:1},spellIds:[15275,15317],maxPoints:2},{fieldName:"shadowFocus",location:{rowIdx:1,colIdx:2},spellIds:[15260,15327,15328],maxPoints:5},{fieldName:"improvedPsychicScream",location:{rowIdx:2,colIdx:0},spellIds:[15392,15448],maxPoints:2},{fieldName:"improvedMindBlast",location:{rowIdx:2,colIdx:1},spellIds:[15273,15312,15313,15314,15316],maxPoints:5},{fieldName:"mindFlay",location:{rowIdx:2,colIdx:2},spellIds:[15407],maxPoints:1},{fieldName:"improvedFade",location:{rowIdx:3,colIdx:1},spellIds:[15274,15311],maxPoints:2},{fieldName:"shadowReach",location:{rowIdx:3,colIdx:2},spellIds:[17322,17323,17325],maxPoints:3},{fieldName:"shadowWeaving",location:{rowIdx:3,colIdx:3},spellIds:[15257,15331,15332,15333,15334],maxPoints:5},{fieldName:"silence",location:{rowIdx:4,colIdx:0},spellIds:[15487],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:0}},{fieldName:"vampiricEmbrace",location:{rowIdx:4,colIdx:1},spellIds:[15286],maxPoints:1},{fieldName:"improvedVampiricEmbrace",location:{rowIdx:4,colIdx:2},spellIds:[27839,27840],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"darkness",location:{rowIdx:5,colIdx:2},spellIds:[15259,15307,15308,15309,15310],maxPoints:5},{fieldName:"shadowform",location:{rowIdx:6,colIdx:1},spellIds:[15473],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),Ra=ka([{name:"Assassination",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/182.jpg",talents:[{fieldName:"improvedEviscerate",location:{rowIdx:0,colIdx:0},spellIds:[14162,14163,14164],maxPoints:3},{fieldName:"remorselessAttacks",location:{rowIdx:0,colIdx:1},spellIds:[14144,14148],maxPoints:2},{fieldName:"malice",location:{rowIdx:0,colIdx:2},spellIds:[14138,14139,14140,14141,14142],maxPoints:5},{fieldName:"ruthlessness",location:{rowIdx:1,colIdx:0},spellIds:[14156,14160,14161],maxPoints:3},{fieldName:"murder",location:{rowIdx:1,colIdx:1},spellIds:[14158,14159],maxPoints:2},{fieldName:"improvedSliceAndDice",location:{rowIdx:1,colIdx:3},spellIds:[14165,14166,14167],maxPoints:3},{fieldName:"relentlessStrikes",location:{rowIdx:2,colIdx:0},spellIds:[14179],maxPoints:1},{fieldName:"improvedExposeArmor",location:{rowIdx:2,colIdx:1},spellIds:[14168,14169],maxPoints:2},{fieldName:"lethality",location:{rowIdx:2,colIdx:2},spellIds:[14128,14132,14135,14136,14137],maxPoints:5,prereqLocation:{rowIdx:0,colIdx:2}},{fieldName:"vilePoisons",location:{rowIdx:3,colIdx:1},spellIds:[16513,16514,16515,16719,16720],maxPoints:5},{fieldName:"improvedPoisons",location:{rowIdx:3,colIdx:2},spellIds:[14113,14114,14115,14116,14117],maxPoints:5},{fieldName:"coldBlood",location:{rowIdx:4,colIdx:1},spellIds:[14177],maxPoints:1},{fieldName:"improvedKidneyShot",location:{rowIdx:4,colIdx:2},spellIds:[14174,14175,14176],maxPoints:3},{fieldName:"sealFate",location:{rowIdx:5,colIdx:1},spellIds:[14186,14190,14193,14194,14195],maxPoints:5,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"vigor",location:{rowIdx:6,colIdx:1},spellIds:[14983],maxPoints:1}]},{name:"Combat",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/181.jpg",talents:[{fieldName:"improvedGouge",location:{rowIdx:0,colIdx:0},spellIds:[13741,13792,13793],maxPoints:3},{fieldName:"improvedSinisterStrike",location:{rowIdx:0,colIdx:1},spellIds:[13732,13863],maxPoints:2},{fieldName:"lightningReflexes",location:{rowIdx:0,colIdx:2},spellIds:[13712,13788,13789,13790,13791],maxPoints:5},{fieldName:"improvedBackstab",location:{rowIdx:1,colIdx:0},spellIds:[13733,13865,13866],maxPoints:3},{fieldName:"deflection",location:{rowIdx:1,colIdx:1},spellIds:[13713,13853,13854,13855,13856],maxPoints:5},{fieldName:"precision",location:{rowIdx:1,colIdx:2},spellIds:[13705,13832,13843,13844,13845],maxPoints:5},{fieldName:"endurance",location:{rowIdx:2,colIdx:0},spellIds:[13742,13872],maxPoints:2},{fieldName:"riposte",location:{rowIdx:2,colIdx:1},spellIds:[14251],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"improvedSprint",location:{rowIdx:2,colIdx:3},spellIds:[13743,13875],maxPoints:2},{fieldName:"improvedKick",location:{rowIdx:3,colIdx:0},spellIds:[13754,13867],maxPoints:2},{fieldName:"daggerSpecialization",location:{rowIdx:3,colIdx:1},spellIds:[13706,13804,13805,13806,13807],maxPoints:5},{fieldName:"dualWieldSpecialization",location:{rowIdx:3,colIdx:2},spellIds:[13715,13848,13849,13851,13852],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"maceSpecialization",location:{rowIdx:4,colIdx:0},spellIds:[13709,13800,13801,13802,13803],maxPoints:5},{fieldName:"bladeFlurry",location:{rowIdx:4,colIdx:1},spellIds:[13877],maxPoints:1},{fieldName:"swordSpecialization",location:{rowIdx:4,colIdx:2},spellIds:[13960,13961,13962,13963,13964],maxPoints:5},{fieldName:"fistWeaponSpecialization",location:{rowIdx:4,colIdx:3},spellIds:[13707,13966,13967,13968,13969],maxPoints:5},{fieldName:"weaponExpertise",location:{rowIdx:5,colIdx:1},spellIds:[30919,30920],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"aggression",location:{rowIdx:5,colIdx:2},spellIds:[18427,18428,18429],maxPoints:3},{fieldName:"adrenalineRush",location:{rowIdx:6,colIdx:1},spellIds:[13750],maxPoints:1}]},{name:"Subtlety",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/183.jpg",talents:[{fieldName:"masterOfDeception",location:{rowIdx:0,colIdx:1},spellIds:[13958,13970,13971,13972,13973],maxPoints:5},{fieldName:"opportunity",location:{rowIdx:0,colIdx:2},spellIds:[14057,14072,14073,14074,14075],maxPoints:5},{fieldName:"sleightOfHand",location:{rowIdx:1,colIdx:0},spellIds:[30892,30893],maxPoints:2},{fieldName:"elusiveness",location:{rowIdx:1,colIdx:1},spellIds:[13981,14066],maxPoints:2},{fieldName:"camouflage",location:{rowIdx:1,colIdx:2},spellIds:[13975,14062,14063,14064,14065],maxPoints:5},{fieldName:"initiative",location:{rowIdx:2,colIdx:0},spellIds:[13976,13979,13980],maxPoints:3},{fieldName:"ghostlyStrike",location:{rowIdx:2,colIdx:1},spellIds:[14278],maxPoints:1},{fieldName:"improvedAmbush",location:{rowIdx:2,colIdx:2},spellIds:[14079,14080,14081],maxPoints:3},{fieldName:"setup",location:{rowIdx:3,colIdx:0},spellIds:[13983,14070,14071],maxPoints:3},{fieldName:"improvedSap",location:{rowIdx:3,colIdx:1},spellIds:[14076,14094],maxPoints:3},{fieldName:"serratedBlades",location:{rowIdx:3,colIdx:2},spellIds:[14171,14172,14173],maxPoints:3,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"heightenedSenses",location:{rowIdx:4,colIdx:0},spellIds:[30894,30895],maxPoints:2},{fieldName:"preparation",location:{rowIdx:4,colIdx:1},spellIds:[14185],maxPoints:1},{fieldName:"dirtyDeeds",location:{rowIdx:4,colIdx:2},spellIds:[14082,14083],maxPoints:2},{fieldName:"hemorrhage",location:{rowIdx:4,colIdx:3},spellIds:[16511],maxPoints:1},{fieldName:"deadliness",location:{rowIdx:5,colIdx:2},spellIds:[30902,30903,30904,30905,30906],maxPoints:5},{fieldName:"premeditation",location:{rowIdx:6,colIdx:1},spellIds:[14183],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),Aa=ka([{name:"Elemental",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/261.jpg",talents:[{fieldName:"convection",location:{rowIdx:0,colIdx:1},spellIds:[16039,16109,16110,16111,16112],maxPoints:5},{fieldName:"concussion",location:{rowIdx:0,colIdx:2},spellIds:[16035,16105,16106,16107,16108],maxPoints:5},{fieldName:"earthsGrasp",location:{rowIdx:1,colIdx:0},spellIds:[16043,16130],maxPoints:2},{fieldName:"elementalWarding",location:{rowIdx:1,colIdx:1},spellIds:[28996,28997,28998],maxPoints:3},{fieldName:"callOfFlame",location:{rowIdx:1,colIdx:2},spellIds:[16038,16160,16161],maxPoints:3},{fieldName:"elementalFocus",location:{rowIdx:2,colIdx:0},spellIds:[16164],maxPoints:1},{fieldName:"reverberation",location:{rowIdx:2,colIdx:1},spellIds:[16040,16113,16114,16115,16116],maxPoints:5},{fieldName:"callOfThunder",location:{rowIdx:2,colIdx:2},spellIds:[16041,16117,16118,16119,16120],maxPoints:5},{fieldName:"improvedFireTotems",location:{rowIdx:3,colIdx:0},spellIds:[16086,16544],maxPoints:2},{fieldName:"eyeOfTheStorm",location:{rowIdx:3,colIdx:1},spellIds:[29062,29064,29065],maxPoints:3},{fieldName:"elementalDevastation",location:{rowIdx:3,colIdx:3},spellIds:[30160,29179,29180],maxPoints:3},{fieldName:"stormReach",location:{rowIdx:4,colIdx:0},spellIds:[28999,29e3],maxPoints:2},{fieldName:"elementalFury",location:{rowIdx:4,colIdx:1},spellIds:[16089],maxPoints:1},{fieldName:"lightningMastery",location:{rowIdx:5,colIdx:2},spellIds:[16578,16579,16580,16581,16582],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"elementalMastery",location:{rowIdx:6,colIdx:1},spellIds:[16166],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Enhancement",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/263.jpg",talents:[{fieldName:"ancestralKnowledge",location:{rowIdx:0,colIdx:1},spellIds:[17485,17486,17487,17488,17489],maxPoints:5},{fieldName:"shieldSpecialization",location:{rowIdx:0,colIdx:2},spellIds:[16253,16298],maxPoints:5},{fieldName:"guardianTotems",location:{rowIdx:1,colIdx:0},spellIds:[16258,16293],maxPoints:2},{fieldName:"thunderingStrikes",location:{rowIdx:1,colIdx:1},spellIds:[16255,16302,16303,16304,16305],maxPoints:5},{fieldName:"improvedGhostWolf",location:{rowIdx:1,colIdx:2},spellIds:[16262,16287],maxPoints:2},{fieldName:"improvedLightningShield",location:{rowIdx:1,colIdx:3},spellIds:[16261,16290],maxPoints:3},{fieldName:"enhancingTotems",location:{rowIdx:2,colIdx:0},spellIds:[16259,16295],maxPoints:2},{fieldName:"twoHandedAxesAndMaces",location:{rowIdx:2,colIdx:2},spellIds:[16269],maxPoints:1},{fieldName:"anticipation",location:{rowIdx:2,colIdx:3},spellIds:[16254,16271,16272,16273,16274],maxPoints:5},{fieldName:"flurry",location:{rowIdx:3,colIdx:1},spellIds:[16256,16281,16282,16283,16284],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"toughness",location:{rowIdx:3,colIdx:2},spellIds:[16252,16306,16307,16308,16309],maxPoints:5},{fieldName:"improvedWeaponTotems",location:{rowIdx:4,colIdx:0},spellIds:[29192,29193],maxPoints:2},{fieldName:"elementalWeapons",location:{rowIdx:4,colIdx:1},spellIds:[16266,29079,29080],maxPoints:3},{fieldName:"parry",location:{rowIdx:4,colIdx:2},spellIds:[16268],maxPoints:1},{fieldName:"weaponMastery",location:{rowIdx:5,colIdx:2},spellIds:[29082,29084,29086,29087,29088],maxPoints:5},{fieldName:"stormstrike",location:{rowIdx:6,colIdx:1},spellIds:[17364],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Restoration",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/262.jpg",talents:[{fieldName:"improvedHealingWave",location:{rowIdx:0,colIdx:1},spellIds:[16182,16226,16227,16228,16229],maxPoints:5},{fieldName:"tidalFocus",location:{rowIdx:0,colIdx:2},spellIds:[16179,16214,16215,16216,16217],maxPoints:5},{fieldName:"improvedReincarnation",location:{rowIdx:1,colIdx:0},spellIds:[16184,16209],maxPoints:2},{fieldName:"ancestralHealing",location:{rowIdx:1,colIdx:1},spellIds:[16176,16235,16240],maxPoints:3},{fieldName:"totemicFocus",location:{rowIdx:1,colIdx:2},spellIds:[16173,16222,16223,16224,16225],maxPoints:5},{fieldName:"naturesGuidance",location:{rowIdx:2,colIdx:0},spellIds:[16180,16196,16198],maxPoints:3},{fieldName:"healingFocus",location:{rowIdx:2,colIdx:1},spellIds:[16181,16230,16232,16233,16234],maxPoints:5},{fieldName:"totemicMastery",location:{rowIdx:2,colIdx:2},spellIds:[16189],maxPoints:1},{fieldName:"healingGrace",location:{rowIdx:2,colIdx:3},spellIds:[29187,29189,29191],maxPoints:3},{fieldName:"restorativeTotems",location:{rowIdx:3,colIdx:1},spellIds:[16187,16205,16206,16207,16208],maxPoints:5},{fieldName:"tidalMastery",location:{rowIdx:3,colIdx:2},spellIds:[16194,16218,16219,16220,16221],maxPoints:5},{fieldName:"healingWay",location:{rowIdx:4,colIdx:0},spellIds:[29206,29202,29205],maxPoints:3},{fieldName:"naturesSwiftness",location:{rowIdx:4,colIdx:2},spellIds:[16188],maxPoints:1},{fieldName:"purification",location:{rowIdx:5,colIdx:2},spellIds:[16178,16210,16211,16212,16213],maxPoints:5},{fieldName:"manaTideTotem",location:{rowIdx:6,colIdx:1},spellIds:[16190],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}}]}]),Da=ka([{name:"Affliction",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/302.jpg",talents:[{fieldName:"suppression",location:{rowIdx:0,colIdx:1},spellIds:[18174,18175,18176,18177,18178],maxPoints:5},{fieldName:"improvedCorruption",location:{rowIdx:0,colIdx:2},spellIds:[17810,17811,17812,17813,17814],maxPoints:5},{fieldName:"improvedCurseOfWeakness",location:{rowIdx:1,colIdx:0},spellIds:[18179,18180,18181],maxPoints:3},{fieldName:"improvedDrainSoul",location:{rowIdx:1,colIdx:1},spellIds:[18213,18372],maxPoints:2},{fieldName:"improvedLifeTap",location:{rowIdx:1,colIdx:2},spellIds:[18182,18183],maxPoints:2},{fieldName:"improvedDrainLife",location:{rowIdx:1,colIdx:3},spellIds:[17804,17805,17806,17807,17808],maxPoints:5},{fieldName:"improvedCurseOfAgony",location:{rowIdx:2,colIdx:0},spellIds:[18827,18829,18830],maxPoints:3},{fieldName:"felConcentration",location:{rowIdx:2,colIdx:1},spellIds:[17783,17784,17785,17786,17787],maxPoints:5},{fieldName:"amplifyCurse",location:{rowIdx:2,colIdx:2},spellIds:[18288],maxPoints:1},{fieldName:"grimReach",location:{rowIdx:3,colIdx:0},spellIds:[18218,18219],maxPoints:2},{fieldName:"nightfall",location:{rowIdx:3,colIdx:1},spellIds:[18094,18095],maxPoints:2},{fieldName:"improvedDrainMana",location:{rowIdx:3,colIdx:3},spellIds:[17864,18393],maxPoints:2},{fieldName:"siphonLife",location:{rowIdx:4,colIdx:1},spellIds:[18265],maxPoints:1},{fieldName:"curseOfExhaustion",location:{rowIdx:4,colIdx:2},spellIds:[18223],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"improvedCurseOfExhaustion",location:{rowIdx:4,colIdx:3},spellIds:[18310,18311,18312,18313],maxPoints:4,prereqLocation:{rowIdx:4,colIdx:2}},{fieldName:"shadowMastery",location:{rowIdx:5,colIdx:1},spellIds:[18271,18272,18273,18274,18275],maxPoints:5,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"darkPact",location:{rowIdx:6,colIdx:1},spellIds:[18220],maxPoints:1}]},{name:"Demonology",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/303.jpg",talents:[{fieldName:"improvedHealthstone",location:{rowIdx:0,colIdx:0},spellIds:[18692,18693],maxPoints:2},{fieldName:"improvedImp",location:{rowIdx:0,colIdx:1},spellIds:[18694,18695,18696],maxPoints:3},{fieldName:"demonicEmbrace",location:{rowIdx:0,colIdx:2},spellIds:[18697,18698,18699,18700,18701],maxPoints:5},{fieldName:"improvedHealthFunnel",location:{rowIdx:1,colIdx:0},spellIds:[18703,18704],maxPoints:2},{fieldName:"improvedVoidwalker",location:{rowIdx:1,colIdx:1},spellIds:[18705,18706,18707],maxPoints:3},{fieldName:"felIntellect",location:{rowIdx:1,colIdx:2},spellIds:[18731,18743,18744,18745,18746],maxPoints:5},{fieldName:"improvedSayaad",location:{rowIdx:2,colIdx:0},spellIds:[18754,18755,18756],maxPoints:3},{fieldName:"felDomination",location:{rowIdx:2,colIdx:1},spellIds:[18708],maxPoints:1},{fieldName:"felStamina",location:{rowIdx:2,colIdx:2},spellIds:[18748],maxPoints:5},{fieldName:"masterSummoner",location:{rowIdx:3,colIdx:1},spellIds:[18709,18710],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"unholyPower",location:{rowIdx:3,colIdx:2},spellIds:[18769,18770,18771,18772,18773],maxPoints:5},{fieldName:"improvedSubjugateDemon",location:{rowIdx:4,colIdx:0},spellIds:[18821,18823,18824,18825],maxPoints:5},{fieldName:"demonicSacrifice",location:{rowIdx:4,colIdx:1},spellIds:[18788],maxPoints:1},{fieldName:"improvedFirestone",location:{rowIdx:4,colIdx:3},spellIds:[18767,18768],maxPoints:2},{fieldName:"masterDemonologist",location:{rowIdx:5,colIdx:2},spellIds:[23785,23822,23823,23824,23825],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"soulLink",location:{rowIdx:6,colIdx:1},spellIds:[19028],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"improvedSpellstone",location:{rowIdx:6,colIdx:2},spellIds:[18774,18775],maxPoints:2}]},{name:"Destruction",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/301.jpg",talents:[{fieldName:"improvedShadowBolt",location:{rowIdx:0,colIdx:1},spellIds:[17793,17796,17801,17802,17803],maxPoints:5},{fieldName:"cataclysm",location:{rowIdx:0,colIdx:2},spellIds:[17778,17779,17780,17781,17782],maxPoints:5},{fieldName:"bane",location:{rowIdx:1,colIdx:1},spellIds:[17788,17789,17790,17791,17792],maxPoints:5},{fieldName:"aftermath",location:{rowIdx:1,colIdx:2},spellIds:[18119,18120,18121,18122,18123],maxPoints:5},{fieldName:"improvedFirebolt",location:{rowIdx:2,colIdx:0},spellIds:[18126,18127],maxPoints:2},{fieldName:"improvedLashOfPain",location:{rowIdx:2,colIdx:1},spellIds:[18128],maxPoints:2},{fieldName:"devastation",location:{rowIdx:2,colIdx:2},spellIds:[18130,18131,18132,18133,18134],maxPoints:5},{fieldName:"shadowburn",location:{rowIdx:2,colIdx:3},spellIds:[17877],maxPoints:1},{fieldName:"intensity",location:{rowIdx:3,colIdx:0},spellIds:[18135,18136],maxPoints:2},{fieldName:"destructiveReach",location:{rowIdx:3,colIdx:1},spellIds:[17917,17918],maxPoints:2},{fieldName:"improvedSearingPain",location:{rowIdx:3,colIdx:3},spellIds:[17927,17929,17930,17931,17932],maxPoints:5},{fieldName:"pyroclasm",location:{rowIdx:4,colIdx:0},spellIds:[18096,18073],maxPoints:2,prereqLocation:{rowIdx:3,colIdx:0}},{fieldName:"improvedImmolate",location:{rowIdx:4,colIdx:1},spellIds:[17815,17833,17834,17835,17836],maxPoints:5},{fieldName:"ruin",location:{rowIdx:4,colIdx:2},spellIds:[17959],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"emberstorm",location:{rowIdx:5,colIdx:2},spellIds:[17954,17955,17956,17957,17958],maxPoints:5},{fieldName:"conflagrate",location:{rowIdx:6,colIdx:1},spellIds:[17962],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),Ma=ka([{name:"Arms",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/161.jpg",talents:[{fieldName:"improvedHeroicStrike",location:{rowIdx:0,colIdx:0},spellIds:[12282,12663,12664],maxPoints:3},{fieldName:"deflection",location:{rowIdx:0,colIdx:1},spellIds:[16462,16463,16464,16465,16466],maxPoints:5},{fieldName:"improvedRend",location:{rowIdx:0,colIdx:2},spellIds:[12286,12658,12659],maxPoints:3},{fieldName:"improvedCharge",location:{rowIdx:1,colIdx:0},spellIds:[12285,12658,12659],maxPoints:2},{fieldName:"tacticalMastery",location:{rowIdx:1,colIdx:1},spellIds:[12295,12676,12677,12678,12679],maxPoints:5},{fieldName:"improvedThunderClap",location:{rowIdx:1,colIdx:3},spellIds:[12287,12665,12666],maxPoints:3},{fieldName:"improvedOverpower",location:{rowIdx:2,colIdx:0},spellIds:[12290,12963],maxPoints:2},{fieldName:"angerManagement",location:{rowIdx:2,colIdx:1},spellIds:[12296],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"deepWounds",location:{rowIdx:2,colIdx:2},spellIds:[12834,12849,12867],maxPoints:3,prereqLocation:{rowIdx:0,colIdx:2}},{fieldName:"twoHandedWeaponSpecialization",location:{rowIdx:3,colIdx:1},spellIds:[12163,12711,12712,12713,12714],maxPoints:5},{fieldName:"impale",location:{rowIdx:3,colIdx:2},spellIds:[16493,16494],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"axeSpecialization",location:{rowIdx:4,colIdx:0},spellIds:[12700,12781,12783,12784,12785],maxPoints:5},{fieldName:"sweepingStrikes",location:{rowIdx:4,colIdx:1},spellIds:[12292],maxPoints:1},{fieldName:"maceSpecialization",location:{rowIdx:4,colIdx:2},spellIds:[12284,12701,12702,12703,12704],maxPoints:5},{fieldName:"swordSpecialization",location:{rowIdx:4,colIdx:3},spellIds:[12281,12812,12813,12814,12815],maxPoints:5},{fieldName:"polearmSpecialization",location:{rowIdx:5,colIdx:0},spellIds:[12165,12830,12831,12832,12833],maxPoints:5},{fieldName:"improvedHamstring",location:{rowIdx:5,colIdx:2},spellIds:[12289,12668,23695],maxPoints:3},{fieldName:"mortalStrike",location:{rowIdx:6,colIdx:1},spellIds:[12294],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Fury",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/164.jpg",talents:[{fieldName:"boomingVoice",location:{rowIdx:0,colIdx:1},spellIds:[12321,12835,12836,12837,12838],maxPoints:5},{fieldName:"cruelty",location:{rowIdx:0,colIdx:2},spellIds:[12320,12852,12853,12855,12856],maxPoints:5},{fieldName:"improvedDemoralizingShout",location:{rowIdx:1,colIdx:1},spellIds:[12324,12876,12877,12878,12879],maxPoints:5},{fieldName:"unbridledWrath",location:{rowIdx:1,colIdx:2},spellIds:[12322,12999,13e3,13001,13002],maxPoints:5},{fieldName:"improvedCleave",location:{rowIdx:2,colIdx:0},spellIds:[12329,12950,20496],maxPoints:3},{fieldName:"piercingHowl",location:{rowIdx:2,colIdx:1},spellIds:[12323],maxPoints:1},{fieldName:"bloodCraze",location:{rowIdx:2,colIdx:2},spellIds:[16487,16489,16492],maxPoints:3},{fieldName:"improvedBattleShout",location:{rowIdx:2,colIdx:3},spellIds:[12318,12857,12858,12860,12861],maxPoints:5},{fieldName:"dualWieldSpecialization",location:{rowIdx:3,colIdx:0},spellIds:[23584,23585,23586,23587,23588],maxPoints:5},{fieldName:"improvedExecute",location:{rowIdx:3,colIdx:1},spellIds:[20502,20503],maxPoints:2},{fieldName:"enrage",location:{rowIdx:3,colIdx:2},spellIds:[12317,13045,13046,13047,13048],maxPoints:5},{fieldName:"improvedSlam",location:{rowIdx:4,colIdx:0},spellIds:[12862,12330,20497,20498,20499],maxPoints:5},{fieldName:"deathWish",location:{rowIdx:4,colIdx:1},spellIds:[12328],maxPoints:1},{fieldName:"improvedIntercept",location:{rowIdx:4,colIdx:3},spellIds:[20504,20505],maxPoints:2},{fieldName:"improvedBerserkerRage",location:{rowIdx:5,colIdx:0},spellIds:[20500,20501],maxPoints:2},{fieldName:"flurry",location:{rowIdx:5,colIdx:2},spellIds:[12319,12971,12972,12973,12974],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"bloodthirst",location:{rowIdx:6,colIdx:1},spellIds:[23881],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Protection",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/163.jpg",talents:[{fieldName:"shieldSpecialization",location:{rowIdx:0,colIdx:1},spellIds:[12298,12724,12725,12726,12727],maxPoints:5},{fieldName:"anticipation",location:{rowIdx:0,colIdx:2},spellIds:[12297,12750,12751,12752,12753],maxPoints:5},{fieldName:"improvedBloodrage",location:{rowIdx:1,colIdx:0},spellIds:[12301,12818],maxPoints:2},{fieldName:"toughness",location:{rowIdx:1,colIdx:2},spellIds:[12299,12761,12762,12763,12764],maxPoints:5},{fieldName:"ironWill",location:{rowIdx:1,colIdx:3},spellIds:[12300,12959,12960,12961,12962],maxPoints:5},{fieldName:"lastStand",location:{rowIdx:2,colIdx:0},spellIds:[12975],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:0}},{fieldName:"improvedShieldBlock",location:{rowIdx:2,colIdx:1},spellIds:[12945,12307,12944],maxPoints:3,prereqLocation:{rowIdx:0,colIdx:1}},{fieldName:"improvedRevenge",location:{rowIdx:2,colIdx:2},spellIds:[12797,12799,12800],maxPoints:3},{fieldName:"defiance",location:{rowIdx:2,colIdx:3},spellIds:[12303,12788,12789,12791,12792],maxPoints:5},{fieldName:"improvedSunderArmor",location:{rowIdx:3,colIdx:0},spellIds:[12308,12810,12811],maxPoints:3},{fieldName:"improvedDisarm",location:{rowIdx:3,colIdx:1},spellIds:[12313,12804,12807],maxPoints:3},{fieldName:"improvedTaunt",location:{rowIdx:3,colIdx:2},spellIds:[12302,12765],maxPoints:2},{fieldName:"improvedShieldWall",location:{rowIdx:4,colIdx:0},spellIds:[12312,12803],maxPoints:2},{fieldName:"concussionBlow",location:{rowIdx:4,colIdx:1},spellIds:[12809],maxPoints:1},{fieldName:"improvedShieldBash",location:{rowIdx:4,colIdx:2},spellIds:[12311,12958],maxPoints:2},{fieldName:"oneHandedWeaponSpecialization",location:{rowIdx:5,colIdx:2},spellIds:[16538,16539,16540,16541,16542],maxPoints:5},{fieldName:"shieldSlam",location:{rowIdx:6,colIdx:1},spellIds:[23922],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),Va={[g.ClassUnknown]:[],[g.ClassDruid]:Ca,[g.ClassShaman]:Aa,[g.ClassHunter]:La,[g.ClassMage]:Ta,[g.ClassRogue]:Ra,[g.ClassPaladin]:_a,[g.ClassPriest]:Na,[g.ClassWarlock]:Da,[g.ClassWarrior]:Ma};function Ua(e,t){return function(e,t,i){return t.split("-").forEach(((t,s)=>{const a=i[s];[...t].forEach(((t,i)=>{const s=a.talents[i],n=parseInt(t);s.fieldName&&(1==s.maxPoints?e[s.fieldName]=1==n:e[s.fieldName]=n)}))})),e}(P[e].talentsCreate(),t,Va[c[e]])}class Fa{constructor(){t(this,"name"),t(this,"auras"),t(this,"spells"),this.name="",this.auras=[],this.spells=[]}getName(){return this.name}getAuras(){return this.auras.slice()}getSpells(){return this.spells.slice()}async update(e){let t=e.spells.map((e=>({data:e,id:y.fromProto(e.id)}))),i=e.auras.map((e=>({data:e,id:y.fromProto(e.id)})));await Promise.all([...t,...i].map((e=>e.id.fill().then((t=>e.id=t))))),t=t.sort(((e,t)=>le(e.id.name,t.id.name))),i=i.sort(((e,t)=>le(e.id.name,t.id.name)));let s=!1;return e.name!=this.name&&(this.name=e.name,s=!0),(t.length!=this.spells.length||t.some(((e,t)=>!e.id.equals(this.spells[t].id))))&&(this.spells=t,s=!0),(i.length!=this.auras.length||i.some(((e,t)=>!e.id.equals(this.auras[t].id))))&&(this.auras=i,s=!0),s}}class Wa{constructor(){t(this,"metadatas"),this.metadatas=[]}async update(e){const t=this.metadatas.length;if(e.length>t)for(let s=t;s<e.length;s++)this.metadatas.push(new Fa);else e.length<t&&(this.metadatas=this.metadatas.slice(0,e.length));const i=await Promise.all(e.map(((e,t)=>this.metadatas[t].update(e))));return t!=this.metadatas.length||i.some((e=>e))}asList(){return this.metadatas.slice()}}const Oa={};function Ha(e){const t=Oa[e];if(!t)throw new Error("No config registered for Spec: "+e);return t}const qa=class{constructor(e,i){t(this,"sim"),t(this,"party"),t(this,"raid"),t(this,"spec"),t(this,"name",""),t(this,"buffs",k.create()),t(this,"consumes",C.create()),t(this,"bonusStats",new ga),t(this,"gear",new L({})),t(this,"enableItemSwap",!1),t(this,"itemSwapGear",new T({})),t(this,"race"),t(this,"level"),t(this,"profession1",0),t(this,"profession2",0),t(this,"aplRotation",_.create()),t(this,"talentsString",""),t(this,"specOptions"),t(this,"reactionTime",0),t(this,"channelClipDelay",0),t(this,"inFrontOfTarget",!1),t(this,"distanceFromTarget",0),t(this,"healingModel",N.create()),t(this,"healingEnabled",!1),t(this,"autoRotationGenerator",null),t(this,"simpleRotationGenerator",null),t(this,"itemEPCache",new Array),t(this,"randomSuffixEPCache",new Map),t(this,"enchantEPCache",new Map),t(this,"talents",null),t(this,"specTypeFunctions"),t(this,"epRatios",new Array(qa.numEpRatios).fill(0)),t(this,"epWeights",new ga),t(this,"currentStats",R.create()),t(this,"metadata",new Fa),t(this,"petMetadatas",new Wa),t(this,"nameChangeEmitter",new m("PlayerName")),t(this,"buffsChangeEmitter",new m("PlayerBuffs")),t(this,"consumesChangeEmitter",new m("PlayerConsumes")),t(this,"bonusStatsChangeEmitter",new m("PlayerBonusStats")),t(this,"gearChangeEmitter",new m("PlayerGear")),t(this,"itemSwapChangeEmitter",new m("PlayerItemSwap")),t(this,"professionChangeEmitter",new m("PlayerProfession")),t(this,"raceChangeEmitter",new m("PlayerRace")),t(this,"levelChangeEmitter",new m("PlayerLevel")),t(this,"rotationChangeEmitter",new m("PlayerRotation")),t(this,"talentsChangeEmitter",new m("PlayerTalents")),t(this,"specOptionsChangeEmitter",new m("PlayerSpecOptions")),t(this,"inFrontOfTargetChangeEmitter",new m("PlayerInFrontOfTarget")),t(this,"distanceFromTargetChangeEmitter",new m("PlayerDistanceFromTarget")),t(this,"healingModelChangeEmitter",new m("PlayerHealingModel")),t(this,"epWeightsChangeEmitter",new m("PlayerEpWeights")),t(this,"miscOptionsChangeEmitter",new m("PlayerMiscOptions")),t(this,"currentStatsEmitter",new m("PlayerCurrentStats")),t(this,"epRatiosChangeEmitter",new m("PlayerEpRatios")),t(this,"epRefStatChangeEmitter",new m("PlayerEpRefStat")),t(this,"changeEmitter"),this.sim=i,this.party=null,this.raid=null,this.spec=e,this.race=A[this.spec][0],this.level=D[wa[this.spec].phase],this.specTypeFunctions=P[this.spec],this.specOptions=this.specTypeFunctions.optionsCreate();const s=Oa[this.spec];if(!s)throw new Error("Could not find spec config for spec: "+this.spec);this.autoRotationGenerator=s.autoRotation,s.simpleRotation?this.simpleRotationGenerator=s.simpleRotation:this.simpleRotationGenerator=null;for(let t=0;t<M.ItemSlotRanged+1;++t)this.itemEPCache[t]=new Map;this.changeEmitter=m.onAny([this.nameChangeEmitter,this.buffsChangeEmitter,this.consumesChangeEmitter,this.bonusStatsChangeEmitter,this.gearChangeEmitter,this.itemSwapChangeEmitter,this.professionChangeEmitter,this.raceChangeEmitter,this.levelChangeEmitter,this.rotationChangeEmitter,this.talentsChangeEmitter,this.specOptionsChangeEmitter,this.miscOptionsChangeEmitter,this.inFrontOfTargetChangeEmitter,this.distanceFromTargetChangeEmitter,this.healingModelChangeEmitter,this.epWeightsChangeEmitter,this.epRatiosChangeEmitter,this.epRefStatChangeEmitter],"PlayerChange")}getSpecIcon(){return V(this.spec,this.getTalentsString())}getClass(){return c[this.spec]}getClassColor(){return U[this.getClass()]}isSpec(e){return this.spec==e}isClass(e){return this.getClass()==e}getParty(){return this.party}getRaid(){return this.raid}getPartyIndex(){if(null==this.party)throw new Error("Can't get party index for player without a party!");return this.party.getPlayers().indexOf(this)}getRaidIndex(){if(null==this.party)throw new Error("Can't get raid index for player without a party!");return 5*this.party.getIndex()+this.getPartyIndex()}setParty(e){null==e?(this.party=null,this.raid=null):(this.party=e,this.raid=e.raid)}getOtherPartyMembers(){return null==this.party?[]:this.party.getPlayers().filter((e=>null!=e&&e!=this))}getItems(e){return this.sim.db.getItems(e).filter((t=>F(this,t,e)))}getRandomSuffixes(e){return e.randomSuffixOptions.map((e=>this.sim.db.getRandomSuffixById(e))).filter((e=>this.computeRandomSuffixEP(e)>0))}getEnchants(e){return this.sim.db.getEnchants(e).filter((e=>W(e,this.spec)))}getRunes(e){return this.sim.db.getRunes(e,this.getClass())}getEpWeights(){return this.epWeights}setEpWeights(e,t){this.epWeights=t,this.epWeightsChangeEmitter.emit(e),this.enchantEPCache=new Map,this.randomSuffixEPCache=new Map;for(let i=0;i<M.ItemSlotRanged+1;++i)this.itemEPCache[i]=new Map}getDefaultEpRatios(e,t){const i=new Array(qa.numEpRatios).fill(0);return t?i[1]=1:e?(i[2]=1,i[3]=1):i[0]=1,i}getEpRatios(){return this.epRatios.slice()}setEpRatios(e,t){this.epRatios=t,this.epRatiosChangeEmitter.emit(e)}async computeStatWeights(e,t,i,s,a){return await this.sim.statWeights(this,t,i,s,a)}getCurrentStats(){return R.clone(this.currentStats)}setCurrentStats(e,t){this.currentStats=t,this.currentStatsEmitter.emit(e)}getMetadata(){return this.metadata}getPetMetadatas(){return this.petMetadatas}async updateMetadata(){const e=this.metadata.update(this.currentStats.metadata),t=this.petMetadatas.update(this.currentStats.pets.map((e=>e.metadata))),i=await e,s=await t;return i||s}getName(){return this.name}setName(e,t){t!=this.name&&(this.name=t,this.nameChangeEmitter.emit(e))}getLabel(){return this.party?`${this.name} (#${this.getRaidIndex()+1})`:this.name}getRace(){return this.race}setRace(e,t){t!=this.race&&(this.race=t,this.raceChangeEmitter.emit(e))}getLevel(){return this.level}setLevel(e,t){t!=this.level&&(this.level=t,this.levelChangeEmitter.emit(e))}getProfession1(){return this.profession1}setProfession1(e,t){t!=this.profession1&&(this.profession1=t,this.professionChangeEmitter.emit(e))}getProfession2(){return this.profession2}setProfession2(e,t){t!=this.profession2&&(this.profession2=t,this.professionChangeEmitter.emit(e))}getProfessions(){return[this.profession1,this.profession2].filter((e=>e!=O.ProfessionUnknown))}setProfessions(e,t){m.freezeAllAndDo((()=>{this.setProfession1(e,t[0]||O.ProfessionUnknown),this.setProfession2(e,t[1]||O.ProfessionUnknown)}))}hasProfession(e){return this.getProfessions().includes(e)}isBlacksmithing(){return this.hasProfession(O.Blacksmithing)}getFaction(){return H[this.getRace()]}getBuffs(){return k.clone(this.buffs)}setBuffs(e,t){k.equals(this.buffs,t)||(this.buffs=k.clone(t),this.buffsChangeEmitter.emit(e))}getConsumes(){return C.clone(this.consumes)}setConsumes(e,t){C.equals(this.consumes,t)||(this.consumes=C.clone(t),this.consumesChangeEmitter.emit(e))}canDualWield2H(){return!1}equipItem(e,t,i){this.setGear(e,this.gear.withEquippedItem(t,i,this.canDualWield2H()))}getEquippedItem(e){return this.gear.getEquippedItem(e)}getGear(){return this.gear}setGear(e,t){t.equals(this.gear)||(this.gear=t,this.gearChangeEmitter.emit(e))}getEnableItemSwap(){return this.enableItemSwap}setEnableItemSwap(e,t){t!=this.enableItemSwap&&(this.enableItemSwap=t,this.itemSwapChangeEmitter.emit(e))}equipItemSwapitem(e,t,i){this.setItemSwapGear(e,this.itemSwapGear.withEquippedItem(t,i,this.canDualWield2H()))}getItemSwapItem(e){return this.itemSwapGear.getEquippedItem(e)}getItemSwapGear(){return this.itemSwapGear}setItemSwapGear(e,t){t.equals(this.itemSwapGear)||(this.itemSwapGear=t,this.itemSwapChangeEmitter.emit(e))}getBonusStats(){return this.bonusStats}setBonusStats(e,t){t.equals(this.bonusStats)||(this.bonusStats=t,this.bonusStatsChangeEmitter.emit(e))}getMeleeCritCapInfo(){const e=(this.currentStats.finalStats?.stats[s.StatMeleeCrit]||0)/q,t=(this.currentStats.finalStats?.stats[s.StatMeleeHit]||0)/B,i=(this.currentStats.finalStats?.stats[s.StatExpertise]||0)/z/4,a=void 0!==this.getGear().getEquippedItem(M.ItemSlotOffHand)?.item.weaponSpeed,n=a&&this.spec!=d.SpecWarrior?27:8,o=this.getInFrontOfTarget()?14:0,l=6.5+o,r=Math.max(n-t,0),c=Math.max(6.5-i,0)+Math.max(o-i,0);let h=0;if(this.spec===d.SpecEnhancementShaman){h=3*this.getTalents().elementalDevastation}this.sim.raid.getDebuffs();const m=80.8-r-c-h;return{meleeCrit:e,meleeHit:t,expertise:i,suppression:4.8,glancing:24,debuffCrit:0,hasOffhandWeapon:a,meleeHitCap:n,expertiseCap:l,remainingMeleeHitCap:r,remainingExpertiseCap:c,baseCritCap:m,specSpecificOffset:h,playerCritCapDelta:e-m+0}}getMeleeCritCap(){return this.getMeleeCritCapInfo().playerCritCapDelta}getSimpleRotation(){const e=this.aplRotation.simple?.specRotationJson||"";if(!e)return this.specTypeFunctions.rotationCreate();try{const t=JSON.parse(e);return this.specTypeFunctions.rotationFromJson(t)}catch(t){return console.warn(`Error parsing rotation spec options: ${t}\n\nSpec options: '${e}'`),this.specTypeFunctions.rotationCreate()}}setSimpleRotation(e,t){this.specTypeFunctions.rotationEquals(t,this.getSimpleRotation())||(this.aplRotation.simple||(this.aplRotation.simple=j.create()),this.aplRotation.simple.specRotationJson=JSON.stringify(this.specTypeFunctions.rotationToJson(t)),this.rotationChangeEmitter.emit(e))}getSimpleCooldowns(){return $.clone(this.aplRotation.simple?.cooldowns||$.create())}setSimpleCooldowns(e,t){$.equals(this.getSimpleCooldowns(),t)||(this.aplRotation.simple||(this.aplRotation.simple=j.create()),this.aplRotation.simple.cooldowns=t,this.rotationChangeEmitter.emit(e))}setAplRotation(e,t){_.equals(t,this.aplRotation)||(this.aplRotation=_.clone(t),this.rotationChangeEmitter.emit(e))}getRotationType(){return this.aplRotation.type==G.TypeUnknown?G.TypeAPL:this.aplRotation.type}hasSimpleRotationGenerator(){return null!=this.simpleRotationGenerator}getResolvedAplRotation(){const e=this.getRotationType();if(e==G.TypeAuto&&this.autoRotationGenerator){const e=_.clone(this.autoRotationGenerator(this));return e.type=G.TypeAuto,e}if(e==G.TypeSimple&&this.simpleRotationGenerator){const e=this.getSimpleRotation(),t=_.clone(this.simpleRotationGenerator(this,e,this.getSimpleCooldowns()));return t.simple=this.aplRotation.simple,t.type=G.TypeSimple,t}return this.aplRotation}getTalents(){return null==this.talents&&(this.talents=Ua(this.spec,this.talentsString)),this.talents}getTalentsString(){return this.talentsString}setTalentsString(e,t){t!=this.talentsString&&(this.talentsString=t,this.talents=null,this.talentsChangeEmitter.emit(e))}getTalentTree(){return K(this.getTalentsString())}getTalentTreePoints(){return J(this.getTalentsString())}getTalentTreeIcon(){return V(this.spec,this.getTalentsString())}getSpecOptions(){return this.specTypeFunctions.optionsCopy(this.specOptions)}setSpecOptions(e,t){this.specTypeFunctions.optionsEquals(t,this.specOptions)||(this.specOptions=this.specTypeFunctions.optionsCopy(t),this.specOptionsChangeEmitter.emit(e))}getReactionTime(){return this.reactionTime}setReactionTime(e,t){t!=this.reactionTime&&(this.reactionTime=t,this.miscOptionsChangeEmitter.emit(e))}getChannelClipDelay(){return this.channelClipDelay}setChannelClipDelay(e,t){t!=this.channelClipDelay&&(this.channelClipDelay=t,this.miscOptionsChangeEmitter.emit(e))}getInFrontOfTarget(){return this.inFrontOfTarget}setInFrontOfTarget(e,t){t!=this.inFrontOfTarget&&(this.inFrontOfTarget=t,this.inFrontOfTargetChangeEmitter.emit(e))}getDistanceFromTarget(){return this.distanceFromTarget}setDistanceFromTarget(e,t){t!=this.distanceFromTarget&&(this.distanceFromTarget=t,this.distanceFromTargetChangeEmitter.emit(e))}setDefaultHealingParams(e){var t=this.sim.encounter.primaryTarget,i=t.dualWield;0==e.cadenceSeconds&&(e.cadenceSeconds=1.5*t.swingSpeed,i&&(e.cadenceSeconds/=2)),0==e.hps&&(e.hps=.175*t.minBaseDamage/t.swingSpeed,i&&(e.hps*=1.5))}enableHealing(){this.healingEnabled=!0;var e=this.getHealingModel();0!=e.cadenceSeconds&&0!=e.hps||(this.setDefaultHealingParams(e),this.setHealingModel(0,e))}getHealingModel(){return N.clone(this.healingModel)}setHealingModel(e,t){N.equals(this.healingModel,t)||(this.healingModel=N.clone(t),this.healingEnabled&&this.setDefaultHealingParams(this.healingModel),this.healingModelChangeEmitter.emit(e))}computeStatsEP(e){return null==e?0:e.computeEP(this.epWeights)}computeEnchantEP(e){if(this.enchantEPCache.has(e.effectId))return this.enchantEPCache.get(e.effectId);let t=this.computeStatsEP(new ga(e.stats));return this.enchantEPCache.set(e.effectId,t),t}computeRandomSuffixEP(e){if(this.randomSuffixEPCache.has(e.id))return this.randomSuffixEPCache.get(e.id);let t=this.computeStatsEP(new ga(e.stats));return this.randomSuffixEPCache.set(e.id,t),t}computeItemEP(e,t){if(null==e)return 0;let i=this.itemEPCache[t].get(e.id);if(void 0!==i)return i;let s=new ga(e.stats);if(e.weaponSpeed>0){const i=Z(e);t==M.ItemSlotMainHand?s=s.withPseudoStat(a.PseudoStatMainHandDps,i):t==M.ItemSlotOffHand?s=s.withPseudoStat(a.PseudoStatOffHandDps,i):t==M.ItemSlotRanged&&(s=s.withPseudoStat(a.PseudoStatRangedDps,i))}let n=0;if(e.randomSuffixOptions.length>0){const t=e.randomSuffixOptions.map((e=>this.computeRandomSuffixEP(this.sim.db.getRandomSuffixById(e))));n=Math.max(...t)}let o=s.computeEP(this.epWeights)+n;return e.unique&&(o-=.01),this.itemEPCache[t].set(e.id,o),o}setWowheadData(e,t){const i=[],s=de(),a=s?s+".":"";i.push(`domain=${a}classic`),null!=e.enchant&&i.push("ench="+e.enchant.effectId),i.push("pcs="+this.gear.asArray().filter((e=>null!=e)).map((e=>e.item.id)).join(":")),t.dataset.wowhead=i.join("&"),t.dataset.whtticon="false"}filterItemData(e,t,i){const s=this.sim.getFilters(),a=(e,i)=>e.filter((e=>i(t(e))));if(s.factionRestriction!=Y.UNSPECIFIED&&(e=a(e,(e=>e.factionRestriction==s.factionRestriction||e.factionRestriction==Y.UNSPECIFIED))),s.sources.includes(Q.SourceCrafting)||(e=a(e,(e=>!e.sources.some((e=>"crafted"==e.source.oneofKind))))),s.sources.includes(Q.SourceQuest)||(e=a(e,(e=>!e.sources.some((e=>"quest"==e.source.oneofKind))))),!s.sources.includes(Q.SourceDungeon))for(const n in X){const t=X[n];"number"==typeof t&&(e=a(e,(e=>!e.sources.some((e=>"drop"==e.source.oneofKind&&e.source.drop.zoneId==t)))))}if(!s.sources.includes(Q.SourceRaid))for(const n in ee){const t=ee[n];"number"==typeof t&&(e=a(e,(e=>!e.sources.some((e=>"drop"==e.source.oneofKind&&e.source.drop.zoneId==t)))))}if(!s.sources.includes(Q.SourceWorldBOE))for(const n in ee){"number"==typeof ee[n]&&(e=a(e,(e=>0==e.randomSuffixOptions.length)))}return qa.ARMOR_SLOTS.includes(i)?e=a(e,(e=>!!s.armorTypes.includes(e.armorType))):qa.WEAPON_SLOTS.includes(i)?e=a(e,(e=>{if(!s.weaponTypes.includes(e.weaponType))return!1;if(!s.oneHandedWeapons&&e.handType!=re.HandTypeTwoHand)return!1;if(!s.twoHandedWeapons&&e.handType==re.HandTypeTwoHand)return!1;const t=i==M.ItemSlotMainHand?s.minMhWeaponSpeed:s.minOhWeaponSpeed,a=i==M.ItemSlotMainHand?s.maxMhWeaponSpeed:s.maxOhWeaponSpeed;return!(t>0&&e.weaponSpeed<t)&&!(a>0&&e.weaponSpeed>a)})):i==M.ItemSlotRanged&&(e=a(e,(e=>{if(!s.rangedWeaponTypes.includes(e.rangedWeaponType))return!1;const t=s.minRangedWeaponSpeed,i=s.maxRangedWeaponSpeed;return!(t>0&&e.weaponSpeed<t)&&!(i>0&&e.weaponSpeed>i)}))),e}filterEnchantData(e,t,i,s){return s?e.filter((e=>{const i=t(e);return!!te(i,s.item)})):e}makeUnitReference(){return null==this.party?ie():se(this.getRaidIndex())}toDatabase(){const e=this.getGear().toDatabase(),t=this.getItemSwapGear().toDatabase();return ae.mergeSimDatabases(e,t)}toProto(e,t,i){const s=e=>!i||0==i.length||i.includes(e),a=this.getGear(),n=t?this.getResolvedAplRotation():this.aplRotation;let o=p.create({class:this.getClass(),database:e?void 0:this.toDatabase()});return s(Za.Gear)&&p.mergePartial(o,{equipment:a.asSpec(),bonusStats:this.getBonusStats().toProto(),enableItemSwap:this.getEnableItemSwap(),itemSwap:this.getItemSwapGear().toProto()}),s(Za.Talents)&&p.mergePartial(o,{talentsString:this.getTalentsString()}),s(Za.Rotation)&&p.mergePartial(o,{cooldowns:$.create({hpPercentForDefensives:this.getSimpleCooldowns().hpPercentForDefensives}),rotation:n}),s(Za.Consumes)&&p.mergePartial(o,{consumes:this.getConsumes()}),s(Za.Miscellaneous)&&(p.mergePartial(o,{name:this.getName(),race:this.getRace(),level:this.getLevel(),profession1:this.getProfession1(),profession2:this.getProfession2(),reactionTimeMs:this.getReactionTime(),channelClipDelayMs:this.getChannelClipDelay(),inFrontOfTarget:this.getInFrontOfTarget(),distanceFromTarget:this.getDistanceFromTarget(),healingModel:this.getHealingModel()}),o=ne(this.spec,o,this.getSpecOptions())),s(Za.External)&&p.mergePartial(o,{buffs:this.getBuffs()}),o}fromProto(e,t,i){const s=e=>!i||0==i.length||i.includes(e);t.rotation?.type==G.TypeLegacy&&(t.rotation.type=G.TypeAuto),m.freezeAllAndDo((()=>{s(Za.Gear)&&(this.setGear(e,t.equipment?this.sim.db.lookupEquipmentSpec(t.equipment):new L({})),this.setEnableItemSwap(e,t.enableItemSwap),this.setItemSwapGear(e,t.itemSwap?this.sim.db.lookupItemSwap(t.itemSwap):new T({})),this.setBonusStats(e,ga.fromProto(t.bonusStats||l.create()))),s(Za.Talents)&&this.setTalentsString(e,t.talentsString),s(Za.Rotation)&&(t.rotation?.type!=G.TypeUnknown&&t.rotation?.type!=G.TypeLegacy||(t.rotation||(t.rotation=_.create()),t.rotation.type=G.TypeAuto),this.setAplRotation(e,t.rotation||_.create())),s(Za.Consumes)&&this.setConsumes(e,t.consumes||C.create()),s(Za.Miscellaneous)&&(this.setSpecOptions(e,this.specTypeFunctions.optionsFromPlayer(t)),this.setName(e,t.name),this.setLevel(e,t.level),this.setRace(e,t.race),this.setProfession1(e,t.profession1),this.setProfession2(e,t.profession2),this.setReactionTime(e,t.reactionTimeMs),this.setChannelClipDelay(e,t.channelClipDelayMs),this.setInFrontOfTarget(e,t.inFrontOfTarget),this.setDistanceFromTarget(e,t.distanceFromTarget),this.setHealingModel(e,t.healingModel||N.create())),s(Za.External)&&this.setBuffs(e,t.buffs||k.create())}))}clone(e){const t=new qa(this.spec,this.sim);return t.fromProto(e,this.toProto()),t}applySharedDefaults(e){m.freezeAllAndDo((()=>{this.setEnableItemSwap(e,!1),this.setItemSwapGear(e,new T({})),this.setReactionTime(e,200),this.setInFrontOfTarget(e,oe(this.spec)),this.setHealingModel(e,N.create({burstWindow:oe(this.spec)?6:0})),this.setSimpleCooldowns(e,$.create({hpPercentForDefensives:oe(this.spec)?.35:0})),this.setBonusStats(e,new ga),this.setAplRotation(e,_.create({type:G.TypeAuto}))}))}getMatchingSpellActionId(e){const t=e.find((e=>(!e.minLevel||e.minLevel<=this.getLevel())&&(!e.maxLevel||e.maxLevel>=this.getLevel())));return t?y.fromSpellId(t.id):null}getMatchingItemActionId(e){const t=e.find((e=>(!e.minLevel||e.minLevel<=this.getLevel())&&(!e.maxLevel||e.maxLevel>=this.getLevel())));return t?y.fromItemId(t.id):null}};let Ba=qa;t(Ba,"numEpRatios",6),t(Ba,"ARMOR_SLOTS",[M.ItemSlotHead,M.ItemSlotShoulder,M.ItemSlotChest,M.ItemSlotWrist,M.ItemSlotHands,M.ItemSlotLegs,M.ItemSlotWaist,M.ItemSlotFeet]),t(Ba,"WEAPON_SLOTS",[M.ItemSlotMainHand,M.ItemSlotOffHand]);class za{constructor(e){t(this,"sim"),t(this,"duration",60),t(this,"durationVariation",5),t(this,"executeProportion20",.2),t(this,"executeProportion25",.25),t(this,"executeProportion35",.35),t(this,"useHealth",!1),t(this,"targets"),t(this,"targetsMetadata"),t(this,"presetTargets"),t(this,"targetsChangeEmitter",new m),t(this,"durationChangeEmitter",new m),t(this,"executeProportionChangeEmitter",new m),t(this,"changeEmitter",new m),this.sim=e,e.waitForInit().then((()=>{this.presetTargets=e.db.getAllPresetTargets(),this.targets=[this.presetTargets[0].target]})),this.targetsMetadata=new Wa,[this.targetsChangeEmitter,this.durationChangeEmitter,this.executeProportionChangeEmitter].forEach((e=>e.on((e=>this.changeEmitter.emit(e)))))}get primaryTarget(){return ce.clone(this.targets[0])}getDurationVariation(){return this.durationVariation}setDurationVariation(e,t){t!=this.durationVariation&&(this.durationVariation=t,this.durationChangeEmitter.emit(e))}getDuration(){return this.duration}setDuration(e,t){t!=this.duration&&(this.duration=t,this.durationChangeEmitter.emit(e))}getExecuteProportion20(){return this.executeProportion20}setExecuteProportion20(e,t){t!=this.executeProportion20&&(this.executeProportion20=t,this.executeProportionChangeEmitter.emit(e))}getExecuteProportion25(){return this.executeProportion25}setExecuteProportion25(e,t){t!=this.executeProportion25&&(this.executeProportion25=t,this.executeProportionChangeEmitter.emit(e))}getExecuteProportion35(){return this.executeProportion35}setExecuteProportion35(e,t){t!=this.executeProportion35&&(this.executeProportion35=t,this.executeProportionChangeEmitter.emit(e))}getUseHealth(){return this.useHealth}setUseHealth(e,t){t!=this.useHealth&&(this.useHealth=t,this.durationChangeEmitter.emit(e),this.executeProportionChangeEmitter.emit(e))}matchesPreset(e){return e.targets.length==this.targets.length&&this.targets.every(((t,i)=>ce.equals(t,e.targets[i].target)))}applyPreset(e,t){this.targets=t.targets.map((e=>e.target||ce.create())),this.targetsChangeEmitter.emit(e)}applyPresetTarget(e,t,i){this.targets[i]=t.target||ce.create(),this.targetsChangeEmitter.emit(e)}toProto(){return he.create({duration:this.duration,durationVariation:this.durationVariation,executeProportion20:this.executeProportion20,executeProportion25:this.executeProportion25,executeProportion35:this.executeProportion35,useHealth:this.useHealth,targets:this.targets})}fromProto(e,t){m.freezeAllAndDo((()=>{this.setDuration(e,t.duration),this.setDurationVariation(e,t.durationVariation),this.setExecuteProportion20(e,t.executeProportion20),this.setExecuteProportion25(e,t.executeProportion25),this.setExecuteProportion35(e,t.executeProportion35),this.setUseHealth(e,t.useHealth),this.targets=t.targets,this.targetsChangeEmitter.emit(e)}))}applyDefaults(e){const t=this.sim.raid.getPlayer(0)?.getLevel()??me,i=this.presetTargets.find((e=>(e.target?.level??0)>=t))??this.presetTargets[0];this.fromProto(e,he.create({duration:60,durationVariation:5,executeProportion20:.2,executeProportion25:.25,executeProportion35:.35,targets:[i.target]}))}static defaultTargetProto(){return ce.create({level:ue,mobType:pe.MobTypeGiant,tankIndex:0,swingSpeed:2,minBaseDamage:65e3,dualWield:!1,dualWieldPenalty:!1,parryHaste:!0,spellSchool:ge.SpellSchoolPhysical,stats:ga.fromMap({[s.StatArmor]:3731,[s.StatAttackPower]:805,[s.StatBlockValue]:76}).asArray(),targetInputs:new Array(0)})}}const ja=8;class $a{constructor(e){t(this,"buffs",fe.create()),t(this,"debuffs",Ie.create()),t(this,"tanks",[]),t(this,"targetDummies",0),t(this,"numActiveParties",5),t(this,"compChangeEmitter",new m),t(this,"buffsChangeEmitter",new m),t(this,"debuffsChangeEmitter",new m),t(this,"tanksChangeEmitter",new m),t(this,"targetDummiesChangeEmitter",new m),t(this,"numActivePartiesChangeEmitter",new m),t(this,"changeEmitter"),t(this,"parties"),t(this,"activePlayers"),t(this,"sim"),this.sim=e,this.parties=[...Array(8).keys()].map((t=>{const i=new xa(this,e);return i.compChangeEmitter.on((e=>this.compChangeEmitter.emit(e))),i.changeEmitter.on((e=>this.changeEmitter.emit(e))),i})),this.activePlayers=[],this.numActivePartiesChangeEmitter.on((e=>this.compChangeEmitter.emit(e))),this.changeEmitter=m.onAny([this.compChangeEmitter,this.buffsChangeEmitter,this.debuffsChangeEmitter,this.tanksChangeEmitter,this.targetDummiesChangeEmitter],"RaidChange"),this.changeEmitter.on((()=>{this.activePlayers=[]}))}size(){return b(this.parties.map((e=>e.size())))}isEmpty(){return 0==this.size()}getParties(){return this.parties.slice()}getParty(e){return this.parties[e]}getPlayers(){return this.parties.map((e=>e.getPlayers())).flat()}getPlayer(e){if(-1===e)return null;return this.parties[Math.floor(e/5)].getPlayer(e%5)}getPlayerFromUnitReference(e,t){return e&&e.type!=we.Unknown?e.type==we.Player?this.getPlayer(e.index):e.type==we.Self&&t||null:null}setPlayer(e,t,i){this.parties[Math.floor(t/5)].setPlayer(e,t%5,i)}getClassCount(e){return this.getPlayers().filter((t=>null!=t&&t.getClass()==e)).length}getBuffs(){return fe.clone(this.buffs)}setBuffs(e,t){fe.equals(this.buffs,t)||(this.buffs=fe.clone(t),this.buffsChangeEmitter.emit(e))}getDebuffs(){return Ie.clone(this.debuffs)}setDebuffs(e,t){Ie.equals(this.debuffs,t)||(this.debuffs=Ie.clone(t),this.debuffsChangeEmitter.emit(e))}getTanks(){return this.tanks.map((e=>be.clone(e)))}setTanks(e,t){this.tanks.length==t.length&&this.tanks.every(((e,i)=>be.equals(e,t[i])))||(this.tanks=t.map((e=>be.clone(e))),this.tanksChangeEmitter.emit(e))}getTargetDummies(){return this.targetDummies}setTargetDummies(e,t){this.targetDummies!=t&&(this.targetDummies=t,this.targetDummiesChangeEmitter.emit(e))}getNumActiveParties(){return this.numActiveParties}setNumActiveParties(e,t){t!=this.numActiveParties&&t>0&&(this.numActiveParties=t,this.numActivePartiesChangeEmitter.emit(e))}getActivePlayers(){if(0==this.activePlayers.length){const e=this.getParties().filter(((e,t)=>t<this.numActiveParties));this.activePlayers=e.map((e=>e.getPlayers())).flat().filter((e=>null!=e))}return this.activePlayers}toProto(e,t){return ve.create({parties:this.parties.map((i=>i.toProto(e,t))),buffs:this.getBuffs(),debuffs:this.getDebuffs(),tanks:this.getTanks(),targetDummies:this.getTargetDummies(),numActiveParties:this.getNumActiveParties()})}fromProto(e,t){m.freezeAllAndDo((()=>{this.setBuffs(e,t.buffs||fe.create()),this.setDebuffs(e,t.debuffs||Ie.create()),this.setTanks(e,t.tanks),this.setTargetDummies(e,t.targetDummies),this.setNumActiveParties(e,t.numActiveParties||5);for(let i=0;i<8;i++)t.parties[i]?this.parties[i].fromProto(e,t.parties[i]):this.parties[i].clear(e)}))}clear(e){m.freezeAllAndDo((()=>{for(let t=0;t<8;t++)this.parties[t].clear(e)}))}}const Ga=`/${_e}/sim_worker.js`;class Ka{constructor(e){t(this,"workers"),this.workers=[];for(let t=0;t<e;t++)this.workers.push(new Ja)}getLeastBusyWorker(){return this.workers.reduce(((e,t)=>e.numTasksRunning<t.numTasksRunning?e:t))}async makeApiCall(e,t){return await this.getLeastBusyWorker().doApiCall(e,t,"")}async computeStats(e){const t=await this.makeApiCall("computeStats",xe.toBinary(e));return Se.fromBinary(t)}async statWeightsAsync(e,t){console.log("Stat weights request: "+Ee.toJsonString(e));const i=this.getLeastBusyWorker(),s=i.makeTaskId();i.addPromiseFunc(s+"progress",this.newProgressHandler(s,i,t),(e=>{}));const a=await i.doApiCall("statWeightsAsync",Ee.toBinary(e),s),n=ye.fromBinary(a);return console.log("Stat weights result: "+Pe.toJsonString(n.finalWeightResult)),n.finalWeightResult}async bulkSimAsync(e,t){console.log("bulk sim request: "+ke.toJsonString(e,{enumAsInteger:!0}));const i=this.getLeastBusyWorker(),s=i.makeTaskId();i.addPromiseFunc(s+"progress",this.newProgressHandler(s,i,t),(e=>{}));const a=await i.doApiCall("bulkSimAsync",ke.toBinary(e),s),n=ye.fromBinary(a),o=Ce.toJson(n.finalBulkResult);return console.log("bulk sim result: "+JSON.stringify(o)),n.finalBulkResult}async raidSimAsync(e,t){console.log("Raid sim request: "+Le.toJsonString(e));const i=this.getLeastBusyWorker(),s=i.makeTaskId();i.addPromiseFunc(s+"progress",this.newProgressHandler(s,i,t),(e=>{}));const a=await i.doApiCall("raidSimAsync",Le.toBinary(e),s),n=ye.fromBinary(a),o=Te.toJson(n.finalRaidResult);return delete o.logs,console.log("Raid sim result: "+JSON.stringify(o)),n.finalRaidResult}newProgressHandler(e,t,i){return s=>{var a=ye.fromBinary(s);i(a),null==a.finalRaidResult&&null==a.finalWeightResult&&t.addPromiseFunc(e+"progress",this.newProgressHandler(e,t,i),(e=>{}))}}}class Ja{constructor(){t(this,"numTasksRunning"),t(this,"taskIdsToPromiseFuncs"),t(this,"worker"),t(this,"onReady"),this.numTasksRunning=0,this.taskIdsToPromiseFuncs={},this.worker=new window.Worker(Ga);let e=null;this.onReady=new Promise(((t,i)=>{e=t})),this.worker.onmessage=t=>{if("ready"==t.data.msg)this.worker.postMessage({msg:"setID",id:"1"}),e();else if("idconfirm"==t.data.msg);else{const e=t.data.id;if(!this.taskIdsToPromiseFuncs[e])return void console.warn("Unrecognized result id: "+e);const i=this.taskIdsToPromiseFuncs[e];delete this.taskIdsToPromiseFuncs[e],this.numTasksRunning--,i[0](t.data.outputData)}}}addPromiseFunc(e,t,i){this.taskIdsToPromiseFuncs[e]=[t,i]}makeTaskId(){let e="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let i=0;i<16;i++)e+=t.charAt(Math.floor(62*Math.random()));return e}async doApiCall(e,t,i){this.numTasksRunning++,await this.onReady;const s=new Promise(((s,a)=>{i||(i=this.makeTaskId()),this.taskIdsToPromiseFuncs[i]=[s,a],this.worker.postMessage({msg:e,id:i,inputData:t})}));return await s}}var Za=(e=>(e[e.Gear=0]="Gear",e[e.Talents=1]="Talents",e[e.Rotation=2]="Rotation",e[e.Consumes=3]="Consumes",e[e.Miscellaneous=4]="Miscellaneous",e[e.External=5]="External",e[e.Encounter=6]="Encounter",e[e.UISettings=7]="UISettings",e))(Za||{});const Ya=class{constructor(){t(this,"workerPool"),t(this,"iterations",3e3),t(this,"phase",Ne),t(this,"faction",Re.Alliance),t(this,"fixedRngSeed",0),t(this,"filters",Ya.defaultFilters()),t(this,"showDamageMetrics",!0),t(this,"showThreatMetrics",!1),t(this,"showHealingMetrics",!1),t(this,"showExperimental",!1),t(this,"showEPValues",!1),t(this,"language",""),t(this,"raid"),t(this,"encounter"),t(this,"db_",null),t(this,"iterationsChangeEmitter",new m),t(this,"phaseChangeEmitter",new m),t(this,"factionChangeEmitter",new m),t(this,"fixedRngSeedChangeEmitter",new m),t(this,"lastUsedRngSeedChangeEmitter",new m),t(this,"filtersChangeEmitter",new m),t(this,"showDamageMetricsChangeEmitter",new m),t(this,"showThreatMetricsChangeEmitter",new m),t(this,"showHealingMetricsChangeEmitter",new m),t(this,"showExperimentalChangeEmitter",new m),t(this,"showEPValuesChangeEmitter",new m),t(this,"languageChangeEmitter",new m),t(this,"crashEmitter",new m),t(this,"settingsChangeEmitter"),t(this,"unitMetadataEmitter",new m("UnitMetadata")),t(this,"changeEmitter"),t(this,"simResultEmitter",new m),t(this,"bulkSimStartEmitter",new m),t(this,"bulkSimResultEmitter",new m),t(this,"_initPromise"),t(this,"lastUsedRngSeed",0),t(this,"modifyRaidProto",(()=>{})),this.workerPool=new Ka(1),this._initPromise=ae.get().then((e=>{this.db_=e})),this.raid=new $a(this),this.encounter=new za(this),this.settingsChangeEmitter=m.onAny([this.iterationsChangeEmitter,this.phaseChangeEmitter,this.fixedRngSeedChangeEmitter,this.filtersChangeEmitter,this.showDamageMetricsChangeEmitter,this.showThreatMetricsChangeEmitter,this.showHealingMetricsChangeEmitter,this.showExperimentalChangeEmitter,this.showEPValuesChangeEmitter,this.languageChangeEmitter]),this.changeEmitter=m.onAny([this.settingsChangeEmitter,this.raid.changeEmitter,this.encounter.changeEmitter]),m.onAny([this.raid.changeEmitter,this.encounter.changeEmitter]).on((e=>this.updateCharacterStats(e)))}waitForInit(){return this._initPromise}get db(){return this.db_}setModifyRaidProto(e){this.modifyRaidProto=e}getModifiedRaidProto(){const e=this.raid.toProto(!1,!0);return this.modifyRaidProto(e),e.parties.forEach((e=>{e.players.forEach((e=>{e.equipment&&this.db.lookupEquipmentSpec(e.equipment)}))})),e}makeRaidSimRequest(e){const t=this.getModifiedRaidProto(),i=this.encounter.toProto();return Le.create({raid:t,encounter:i,simOptions:Ae.create({iterations:e?1:this.getIterations(),randomSeed:BigInt(this.nextRngSeed()),debugFirstIteration:!0})})}async runBulkSim(e,t,i){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const s=ke.create({baseSettings:this.makeRaidSimRequest(!1),bulkSettings:e});if(null!=s.baseSettings&&null!=s.baseSettings.simOptions&&(s.baseSettings.simOptions.debugFirstIteration=!1),!s.baseSettings?.raid||0==s.baseSettings?.raid?.parties.length||0==s.baseSettings?.raid?.parties[0].players.length)throw new Error("Raid must contain exactly 1 player for bulk sim.");const a=s.baseSettings.raid.parties[0].players[0].database;a?.items.push(...t.items),a?.enchants.push(...t.enchants),this.bulkSimStartEmitter.emit(m.nextEventID(),s);var n=await this.workerPool.bulkSimAsync(s,i);if(""!=n.errorResult)throw new Xa(n.errorResult);return this.bulkSimResultEmitter.emit(m.nextEventID(),n),n}async runRaidSim(e,t){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const i=this.makeRaidSimRequest(!1);var s=await this.workerPool.raidSimAsync(i,t);if(""!=s.errorResult)throw new Xa(s.errorResult);const a=await De.makeNew(i,s);return this.simResultEmitter.emit(e,a),a}async runRaidSimWithLogs(e){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const t=this.makeRaidSimRequest(!0),i=await this.workerPool.raidSimAsync(t,(()=>{}));if(""!=i.errorResult)throw new Xa(i.errorResult);const s=await De.makeNew(t,i);return this.simResultEmitter.emit(e,s),s}async updateCharacterStats(e){if(0==e)return;e=m.nextEventID(),await this.waitForInit();const t=this.raid.getPlayers(),i=xe.create({raid:this.getModifiedRaidProto(),encounter:this.encounter.toProto()}),s=await this.workerPool.computeStats(i);""==s.errorResult?m.freezeAllAndDo((async()=>{const i=s.raidStats.parties.map(((i,s)=>i.players.map(((i,a)=>{const n=t[5*s+a];return n?(n.setCurrentStats(e,i),n.updateMetadata()):null})))).flat().filter((e=>null!=e)),a=this.encounter.targetsMetadata.update(s.encounterStats.targets.map((e=>e.metadata)));(await Promise.all(i.concat([a]))).some((e=>e))&&this.unitMetadataEmitter.emit(e)})):this.crashEmitter.emit(e,new Xa(s.errorResult))}async statWeights(e,t,i,s,a){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");if(await this.waitForInit(),null==e.getParty())return console.warn("Trying to get stat weights without a party!"),Pe.create();{const n=this.raid.getTanks().map((e=>e.index)).includes(e.getRaidIndex())?[be.create({type:we.Player,index:0})]:[],o=Ee.create({player:e.toProto(!1,!0),raidBuffs:this.raid.getBuffs(),partyBuffs:e.getParty().getBuffs(),debuffs:this.raid.getDebuffs(),encounter:this.encounter.toProto(),simOptions:Ae.create({iterations:this.getIterations(),randomSeed:BigInt(this.nextRngSeed()),debug:!1}),tanks:n,statsToWeigh:t,pseudoStatsToWeigh:i,epReferenceStat:s});return await this.workerPool.statWeightsAsync(o,a)}}getUnitMetadata(e,t,i){if(!e||e.type==we.Unknown)return this.getUnitMetadata(i,t,i);if(e.type==we.Player)return this.raid.getPlayerFromUnitReference(e)?.getMetadata();if(e.type==we.Target)return this.encounter.targetsMetadata.asList()[e.index];if(e.type==we.Pet){const i=this.raid.getPlayerFromUnitReference(e.owner,t);return i?i.getPetMetadatas().asList()[e.index]:void 0}return e.type==we.Self?t?.getMetadata():e.type==we.CurrentTarget?this.encounter.targetsMetadata.asList()[0]:void 0}getPhase(){return this.phase}setPhase(e,t){t!=this.phase&&t>0&&(this.phase=t,this.phaseChangeEmitter.emit(e))}getFaction(){return this.faction}setFaction(e,t){t!=this.faction&&t&&(this.faction=t,this.factionChangeEmitter.emit(e))}getFixedRngSeed(){return this.fixedRngSeed}setFixedRngSeed(e,t){t!=this.fixedRngSeed&&(this.fixedRngSeed=t,this.fixedRngSeedChangeEmitter.emit(e))}nextRngSeed(){let e=0;return e=this.fixedRngSeed?this.fixedRngSeed:Math.floor(Math.random()*Ya.MAX_RNG_SEED),this.lastUsedRngSeed=e,this.lastUsedRngSeedChangeEmitter.emit(m.nextEventID()),e}getLastUsedRngSeed(){return this.lastUsedRngSeed}getFilters(){return Me.clone(this.filters)}setFilters(e,t){Me.equals(t,this.filters)||(this.filters=Me.clone(t),this.filtersChangeEmitter.emit(e))}getShowDamageMetrics(){return this.showDamageMetrics}setShowDamageMetrics(e,t){t!=this.showDamageMetrics&&(this.showDamageMetrics=t,this.showDamageMetricsChangeEmitter.emit(e))}getShowThreatMetrics(){return this.showThreatMetrics}setShowThreatMetrics(e,t){t!=this.showThreatMetrics&&(this.showThreatMetrics=t,this.showThreatMetricsChangeEmitter.emit(e))}getShowHealingMetrics(){return this.showHealingMetrics}setShowHealingMetrics(e,t){t!=this.showHealingMetrics&&(this.showHealingMetrics=t,this.showHealingMetricsChangeEmitter.emit(e))}getShowExperimental(){return this.showExperimental}setShowExperimental(e,t){t!=this.showExperimental&&(this.showExperimental=t,this.showExperimentalChangeEmitter.emit(e))}getShowEPValues(){return this.showEPValues}setShowEPValues(e,t){t!=this.showEPValues&&(this.showEPValues=t,this.showEPValuesChangeEmitter.emit(e))}getLanguage(){return this.language}setLanguage(e,t){(t=t||Ve())!=this.language&&(this.language=t,Ue(this.language),this.languageChangeEmitter.emit(e))}getIterations(){return this.iterations}setIterations(e,t){t!=this.iterations&&(this.iterations=t,this.iterationsChangeEmitter.emit(e))}toProto(){const e=this.getFilters();return e.armorTypes.length==Ya.ALL_ARMOR_TYPES.length&&(e.armorTypes=[]),e.weaponTypes.length==Ya.ALL_WEAPON_TYPES.length&&(e.weaponTypes=[]),e.rangedWeaponTypes.length==Ya.ALL_RANGED_WEAPON_TYPES.length&&(e.rangedWeaponTypes=[]),e.sources.length==Ya.ALL_SOURCES.length&&(e.sources=[]),e.raids.length==Ya.ALL_RAIDS.length&&(e.raids=[]),Fe.create({iterations:this.getIterations(),phase:this.getPhase(),fixedRngSeed:BigInt(this.getFixedRngSeed()),showDamageMetrics:this.getShowDamageMetrics(),showThreatMetrics:this.getShowThreatMetrics(),showHealingMetrics:this.getShowHealingMetrics(),showExperimental:this.getShowExperimental(),showEpValues:this.getShowEPValues(),language:this.getLanguage(),faction:this.getFaction(),filters:e})}fromProto(e,t){m.freezeAllAndDo((()=>{this.setIterations(e,t.iterations||3e3),this.setPhase(e,t.phase||Ne),this.setFixedRngSeed(e,Number(t.fixedRngSeed)),this.setShowDamageMetrics(e,t.showDamageMetrics),this.setShowThreatMetrics(e,t.showThreatMetrics),this.setShowHealingMetrics(e,t.showHealingMetrics),this.setShowExperimental(e,t.showExperimental),this.setShowEPValues(e,t.showEpValues),this.setLanguage(e,t.language),this.setFaction(e,t.faction||Re.Alliance);const i=t.filters||Ya.defaultFilters();0==i.armorTypes.length&&(i.armorTypes=Ya.ALL_ARMOR_TYPES.slice()),0==i.weaponTypes.length&&(i.weaponTypes=Ya.ALL_WEAPON_TYPES.slice()),0==i.rangedWeaponTypes.length&&(i.rangedWeaponTypes=Ya.ALL_RANGED_WEAPON_TYPES.slice()),0==i.sources.length&&(i.sources=Ya.ALL_SOURCES.slice()),0==i.raids.length&&(i.raids=Ya.ALL_RAIDS.slice()),this.setFilters(e,i)}))}applyDefaults(e,t,i){this.fromProto(e,Fe.create({iterations:3e3,phase:Ne,faction:Re.Alliance,showDamageMetrics:!i,showThreatMetrics:t,showHealingMetrics:i,language:this.getLanguage(),filters:Ya.defaultFilters(),showEpValues:!1}))}static defaultFilters(){return Me.create({oneHandedWeapons:!0,twoHandedWeapons:!0})}};let Qa=Ya;t(Qa,"MAX_RNG_SEED",Math.pow(2,32)-1),t(Qa,"ALL_ARMOR_TYPES",i(We).filter((e=>0!=e))),t(Qa,"ALL_WEAPON_TYPES",i(Oe).filter((e=>0!=e))),t(Qa,"ALL_RANGED_WEAPON_TYPES",i(He).filter((e=>0!=e))),t(Qa,"ALL_SOURCES",i(Q).filter((e=>0!=e))),t(Qa,"ALL_RAIDS",i(ee).filter((e=>0!=e)));class Xa extends Error{constructor(e){super(e),t(this,"errorStr"),this.errorStr=e}}class en extends I{constructor(e,i,s){super(e,"number-picker-root",i,s),t(this,"inputElem"),t(this,"float"),t(this,"positive"),this.float=s.float||!1,this.positive=s.positive||!1,this.inputElem=document.createElement("input"),this.inputElem.type="text",this.inputElem.classList.add("form-control","number-picker-input"),this.positive&&(this.inputElem.onchange=e=>{this.float?this.inputElem.value=Math.abs(parseFloat(this.inputElem.value)).toFixed(2):this.inputElem.value=Math.abs(parseInt(this.inputElem.value)).toString()}),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",(e=>{this.inputChanged(m.nextEventID())})),this.inputElem.addEventListener("input",(e=>{this.updateSize()})),this.updateSize()}getInputElem(){return this.inputElem}getInputValue(){return this.float?parseFloat(this.inputElem.value||"")||0:parseInt(this.inputElem.value||"")||0}setInputValue(e){this.float?this.inputElem.value=e.toFixed(2):this.inputElem.value=String(e)}updateSize(){const e=Math.max(3,this.inputElem.value.length);this.inputElem.size!=e&&(this.inputElem.size=e)}}class tn extends v{constructor(e){super(e,"results-viewer"),t(this,"pendingElem"),t(this,"contentElem"),t(this,"warningElem"),t(this,"warningsLink"),t(this,"warnings",[]),this.rootElem.appendChild(w(S,null,w("div",{className:"results-pending"},w("div",{className:"loader"})),w("div",{className:"results-content"}),w("div",{className:"warning-zone",style:"text-align: center"}))),this.pendingElem=this.rootElem.getElementsByClassName("results-pending")[0],this.contentElem=this.rootElem.getElementsByClassName("results-content")[0],this.warningElem=this.rootElem.getElementsByClassName("warning-zone")[0],this.warningsLink=this.addWarningsLink(),this.updateWarnings(),this.hideAll()}addWarningLink(e){let t=w("div",{className:"sim-toolbar-item"},w("a",{href:e.href?e.href:"javascript:void(0)",target:e.href?"_blank":"_self",className:e.classes},e.icon&&w("i",{className:e.icon}),e.text?e.text:"")),i=t.children[0];e.onclick&&i.addEventListener("click",(()=>{e.onclick&&e.onclick()}));let s={};return e.tooltip&&(s={title:e.tooltip,html:!0,placement:"bottom"},i.setAttribute("data-bs-title",e.tooltip)),new da(i,s),e.parent.appendChild(t),t}addWarningsLink(){return this.addWarningLink({parent:this.warningElem,icon:"fas fa-exclamation-triangle fa-3x",tooltip:"<ul class='text-start ps-3 mb-0'></ul>",classes:"warning link-warning"}).children[0]}addWarning(e){this.warnings.push(e),e.updateOn.on((()=>this.updateWarnings())),this.updateWarnings()}updateWarnings(){const e=this.warnings.map((e=>e.getContent())).flat().filter((e=>""!=e));let t=document.createElement("fragment");t.innerHTML=this.warningsLink.getAttribute("data-bs-title");let i=t.children[0];i.innerHTML="",0==e.length?this.warningsLink.parentElement?.classList?.add("hide"):(this.warningsLink.parentElement?.classList?.remove("hide"),e.forEach((e=>{let t=document.createElement("li");t.innerHTML=e,i.appendChild(t)}))),this.warningsLink.setAttribute("data-bs-title",i.outerHTML),new da(this.warningsLink,{title:i.outerHTML,html:!0,placement:"bottom"})}hideAll(){this.contentElem.style.display="none",this.pendingElem.style.display="none"}setPending(){this.contentElem.style.display="none",this.pendingElem.style.display="block"}setContent(e){this.contentElem.innerHTML=e,this.contentElem.style.display="block",this.pendingElem.style.display="none"}}class sn extends v{constructor(e,i,s={}){super(e,"sim-title-dropdown-root"),t(this,"dropdownMenu"),t(this,"specLabels",{[d.SpecBalanceDruid]:"Balance",[d.SpecFeralDruid]:"Feral DPS",[d.SpecFeralTankDruid]:"Feral Tank",[d.SpecRestorationDruid]:"Restoration",[d.SpecElementalShaman]:"Elemental",[d.SpecEnhancementShaman]:"Enhancement",[d.SpecRestorationShaman]:"Restoration",[d.SpecHunter]:"Hunter",[d.SpecMage]:"Mage",[d.SpecRogue]:"Rogue",[d.SpecHolyPaladin]:"Holy",[d.SpecProtectionPaladin]:"Protection",[d.SpecRetributionPaladin]:"Retribution",[d.SpecHealingPriest]:"Healing",[d.SpecShadowPriest]:"Shadow",[d.SpecWarlock]:"DPS",[d.SpecTankWarlock]:"Tank",[d.SpecWarrior]:"DPS",[d.SpecProtectionWarrior]:"Protection"});let a=null===i?{type:"Raid"}:{type:"Spec",index:i},n=this.buildRootSimLink(a);s.noDropdown?this.rootElem.innerHTML=n.outerHTML:(this.rootElem.innerHTML=`\n      <div class="dropdown sim-link-dropdown">\n        ${n.outerHTML}\n        <ul class="dropdown-menu"></ul>\n      </div>\n    `,this.dropdownMenu=this.rootElem.getElementsByClassName("dropdown-menu")[0],this.buildDropdown(),this.dropdownMenu.addEventListener("click",(e=>{e.target.closest('a:not([href="javascript:void(0)"]')||(e.stopPropagation(),e.preventDefault())})))}buildDropdown(){qe.forEach((e=>{let t=document.createElement("li"),i=ba(e);1==i.length?(t.appendChild(this.buildClassLink(e)),this.dropdownMenu?.appendChild(t)):i.length>1&&(t.appendChild(this.buildClassDropdown(e)),this.dropdownMenu?.appendChild(t))}))}buildClassDropdown(e){let t=ba(e),i=document.createElement("fragment"),s=document.createElement("ul");s.classList.add("dropdown-menu");let a=this.buildClassLink(e);return t.forEach((e=>{let t=document.createElement("li"),i=this.buildSpecLink(e);t.appendChild(i),s.appendChild(t)})),i.innerHTML=`\n      <div class="dropend sim-link-dropdown">\n        ${a.outerHTML}\n        ${s.outerHTML}\n      </div>\n    `,i.children[0]}buildRootSimLink(e){let t,i=this.getSimIconPath(e),s=this.getContextualKlass(e);if("Raid"==e.type)t=Ze;else{let i=c[e.index];t=ba(i).length>1?Be[e.index]:$e[i]}let a=document.createElement("fragment");return a.innerHTML=`\n      <a href="javascript:void(0)" class="sim-link ${s}" role="button" data-bs-toggle="dropdown" aria-expanded="false">\n        <div class="sim-link-content">\n          <img src="${i}" class="sim-link-icon">\n          <div class="d-flex flex-column">\n            <span class="sim-link-label text-white">WoWSims - Season of Discovery</span>\n            <span class="sim-link-title">${t}</span>\n            ${this.launchStatusLabel(e)}\n          </div>\n        </div>\n      </a>\n    `,a.children[0]}buildRaidLink(){let e=this.getContextualKlass({type:"Raid"}),t=this.getSimIconPath({type:"Raid"}),i=Ze,s=document.createElement("fragment");return s.innerHTML=`\n      <a href="${ze}" class="sim-link ${e}">\n        <div class="sim-link-content">\n          <img src="${t}" class="sim-link-icon">\n          <div class="d-flex flex-column">\n            <span class="sim-link-title">${i}</span>\n            ${this.launchStatusLabel({type:"Raid"})}\n          </div>\n        </div>\n      </a>\n    `,s.children[0]}buildClassLink(e){let t=ba(e),i=t.length>1?"javascript:void(0)":je(t[0]),s=this.getContextualKlass({type:"Class",index:e}),a=this.getSimIconPath({type:"Class",index:e}),n=$e[e],o=document.createElement("fragment");return o.innerHTML=`\n      <a href="${i}" class="sim-link ${s}" ${t.length>1?'role="button" data-bs-toggle="dropdown" aria-expanded="false"':""}>\n        <div class="sim-link-content">\n          <img src="${a}" class="sim-link-icon">\n          <div class="d-flex flex-column">\n            <span class="sim-link-title">${n}</span>\n            ${1==t.length?this.launchStatusLabel({type:"Spec",index:t[0]}):""}\n          </div>\n        </div>\n      </a>\n    `,o.children[0]}buildSpecLink(e){let t=je(e),i=this.getContextualKlass({type:"Spec",index:e}),s=this.getSimIconPath({type:"Spec",index:e}),a=$e[c[e]],n=this.specLabels[e],o=document.createElement("fragment");return o.innerHTML=`\n      <a href="${t}" class="sim-link ${i}" role="button">\n        <div class="sim-link-content">\n          <img src="${s}" class="sim-link-icon">\n          <div class="d-flex flex-column">\n            <span class="sim-link-label">${a}</span>\n            <span class="sim-link-title">${n}</span>\n            ${this.launchStatusLabel({type:"Spec",index:e})}\n          </div>\n        </div>\n      </a>\n    `,o.children[0]}launchStatusLabel(e){const t="Raid"==e.type?Ia.status:wa[e.index].status,i="Raid"==e.type?Ia.phase:wa[e.index].phase;let s=document.createElement("span");return s.classList.add("launch-status-label","text-brand"),s.textContent=t==fa.Unlaunched?"Not Yet Supported":`Phase ${i} - ${fa[t]}`,s.outerHTML}getSimIconPath(e){let t;if("Raid"==e.type)t=Ye;else if("Class"==e.type){t=`/sod/assets/img/${$e[e.index].toLowerCase().replace(/\s/g,"_")}_icon.png`}else t=Ge[e.index];return t}getContextualKlass(e){return"Raid"==e.type?"text-white":"Class"==e.type?Ke(e.index):Je(e.index)}}class an extends I{constructor(e,i,s){super(e,"boolean-picker-root",i,s),t(this,"inputElem"),this.rootElem.classList.add("form-check","form-check-reverse"),this.inputElem=document.createElement("input"),this.inputElem.type="checkbox",this.inputElem.classList.add("boolean-picker-input","form-check-input"),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",(()=>{this.inputChanged(m.nextEventID())}))}getInputElem(){return this.inputElem}getInputValue(){return Boolean(this.inputElem.checked)}setInputValue(e){this.inputElem.checked=e}}class nn extends I{constructor(e,i,s){super(e,"enum-picker-root",i,s),t(this,"selectElem"),this.selectElem=document.createElement("select"),this.selectElem.classList.add("enum-picker-selector","form-select"),s.values.forEach((e=>{const t=document.createElement("option");t.value=String(e.value),t.textContent=e.name,this.selectElem.appendChild(t),e.tooltip&&(t.title=e.tooltip)})),this.rootElem.appendChild(this.selectElem),this.init(),this.selectElem.addEventListener("change",(e=>{this.inputChanged(m.nextEventID())}))}getInputElem(){return this.selectElem}getInputValue(){return parseInt(this.selectElem.value)}setInputValue(e){this.selectElem.value=String(e)}}const on={fixed:!1};class ln extends v{constructor(e,i,s={}){super(e,"close-button",document.createElement("a")),t(this,"config"),this.config={...on,...s},this.config.fixed&&this.rootElem.classList.add("position-fixed"),this.rootElem.setAttribute("href","javascript:void(0)"),this.rootElem.setAttribute("role","button"),this.rootElem.addEventListener("click",(()=>i())),this.rootElem.insertAdjacentHTML("beforeend",'<i class="fas fa-times fa-2xl ms-1"></i>')}}const rn={closeButton:{},footer:!1,header:!0,scrollContents:!1,size:"lg",title:null};class dn extends v{constructor(e,i,s={}){super(e,"modal"),t(this,"modalConfig"),t(this,"modal"),t(this,"dialog"),t(this,"header"),t(this,"body"),t(this,"footer"),this.modalConfig={...rn,...s};const a=this.modalConfig.size&&"md"!=this.modalConfig.size?`modal-${this.modalConfig.size}`:"";this.rootElem.classList.add("fade"),this.rootElem.innerHTML=`\n\t\t\t<div class="modal-dialog ${i} ${a}">\n\t\t\t\t<div class="modal-content"></div>\n\t\t\t</div>\n\t\t`,this.dialog=this.rootElem.querySelector(".modal-dialog"),this.modalConfig.scrollContents&&this.dialog.classList.add("modal-overflow-scroll");const n=this.rootElem.querySelector(".modal-content");this.modalConfig.header&&(this.header=document.createElement("div"),this.header.classList.add("modal-header"),n.appendChild(this.header),this.modalConfig.title&&this.header.insertAdjacentHTML("afterbegin",`<h5 class="modal-title">${this.modalConfig.title}</h5>`)),this.body=document.createElement("div"),this.body.classList.add("modal-body"),n.appendChild(this.body),this.addCloseButton(),this.modalConfig.footer&&(this.footer=document.createElement("div"),this.footer.classList.add("modal-footer"),n.appendChild(this.footer)),this.modal=new ca(this.rootElem),this.open(),this.rootElem.addEventListener("hidden.bs.modal",(e=>{this.rootElem.remove(),this.dispose()}))}addCloseButton(){new ln(this.header?this.header:this.body,(()=>this.close()),this.modalConfig.closeButton)}onShow(e){}open(){this.rootElem.addEventListener("show.bs.modal",(async e=>{e.stopImmediatePropagation();const t=await new Promise((e=>{setTimeout((()=>{this.modal._backdrop._element&&e(this.modal._backdrop._element)}),100)}));this.rootElem.insertAdjacentElement("afterend",t),this.onShow(e)})),this.rootElem.addEventListener("hide.bs.modal",(e=>{e.stopImmediatePropagation()})),this.rootElem.addEventListener("hidden.bs.modal",(e=>{e.stopPropagation()})),this.modal.show()}close(){this.modal.hide()}}class cn extends dn{constructor(e,i){super(e,"settings-menu",{title:"Options",footer:!0}),t(this,"simUI"),this.simUI=i,this.body.innerHTML='\n\t\t\t<div class="picker-group">\n\t\t\t\t<div class="fixed-rng-seed-container">\n\t\t\t\t\t<div class="fixed-rng-seed"></div>\n\t\t\t\t\t<div class="form-text">\n\t\t\t\t\t\t<span>Last used RNG seed:</span>&nbsp;<span class="last-used-rng-seed">0</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="language-picker within-raid-sim-hide"></div>\n\t\t\t</div>\n\t\t\t<div class="show-threat-metrics-picker w-50 pe-2"></div>\n\t\t\t<div class="show-experimental-picker w-50 pe-2"></div>\n\t\t',this.footer.innerHTML='\n\t\t\t<button\n\t\t\t\tclass="restore-defaults-button btn btn-primary"\n\t\t\t>Restore Defaults</button>\n\t\t';const s=this.rootElem.getElementsByClassName("restore-defaults-button")[0];da.getOrCreateInstance(s,{title:"Restores all default settings (gear, consumes, buffs, talents, EP weights, etc). Saved settings are preserved."}),s.addEventListener("click",(e=>{this.simUI.applyDefaults(m.nextEventID())}));const a=this.rootElem.getElementsByClassName("fixed-rng-seed")[0];new en(a,this.simUI.sim,{label:"Fixed RNG Seed",labelTooltip:"Seed value for the random number generator used during sims, or 0 to use different randomness each run. Use this to share exact sim results or for debugging.",extraCssClasses:["mb-0"],changedEvent:e=>e.fixedRngSeedChangeEmitter,getValue:e=>e.getFixedRngSeed(),setValue:(e,t,i)=>{t.setFixedRngSeed(e,i)}});const n=this.rootElem.getElementsByClassName("last-used-rng-seed")[0];n.textContent=String(this.simUI.sim.getLastUsedRngSeed()),this.simUI.sim.lastUsedRngSeedChangeEmitter.on((()=>n.textContent=String(this.simUI.sim.getLastUsedRngSeed())));const o=this.rootElem.getElementsByClassName("language-picker")[0],l=Object.keys(Qe),r=l.indexOf("en");new nn(o,this.simUI.sim,{label:"Language",labelTooltip:"Controls the language for Wowhead tooltips.",values:l.map(((e,t)=>({name:Qe[e],value:t}))),changedEvent:e=>e.languageChangeEmitter,getValue:e=>{const t=l.indexOf(e.getLanguage());return-1==t?r:t},setValue:(e,t,i)=>{t.setLanguage(e,l[i]||"en")}}).changeEmitter.on((()=>setTimeout((()=>location.reload()),100)));const d=this.rootElem.getElementsByClassName("show-threat-metrics-picker")[0];new an(d,this.simUI.sim,{label:"Show Threat/Tank Options",labelTooltip:"Shows all options and metrics relevant to tanks, like TPS/DTPS.",inline:!0,changedEvent:e=>e.showThreatMetricsChangeEmitter,getValue:e=>e.getShowThreatMetrics(),setValue:(e,t,i)=>{t.setShowThreatMetrics(e,i)}});const c=this.rootElem.getElementsByClassName("show-experimental-picker")[0];new an(c,this.simUI.sim,{label:"Show Experimental",labelTooltip:"Shows experimental options, if there are any active experiments.",inline:!0,changedEvent:e=>e.showExperimentalChangeEmitter,getValue:e=>e.getShowExperimental(),setValue:(e,t,i)=>{t.setShowExperimental(e,i)}})}}class hn extends v{constructor(e,i){super(e,"sim-header"),t(this,"simUI"),t(this,"simTabsContainer"),t(this,"simToolbar"),t(this,"knownIssuesLink"),t(this,"knownIssuesContent"),this.simUI=i,this.simTabsContainer=this.rootElem.querySelector(".sim-tabs"),this.simToolbar=this.rootElem.querySelector(".sim-toolbar"),this.knownIssuesContent=w("ul",{className:"text-start ps-3 mb-0"}),this.knownIssuesLink=this.addKnownIssuesLink(),this.addBugReportLink(),this.addDownloadBinaryLink(),this.addSimOptionsLink(),this.addSocialLinks(),new IntersectionObserver((([e])=>e.target.classList.toggle("stuck",e.intersectionRatio<1)),{threshold:[1]}).observe(this.rootElem)}activateTab(e){this.simTabsContainer.getElementsByClassName(e)[0].click()}addTab(e,t){const i=0==this.simTabsContainer.children.length;let s=w("li",{className:`${t} nav-item`,attributes:{role:"presentation"}},w("a",{className:`nav-link ${i&&"active"}`,dataset:{bsToggle:"tab",bsTarget:`#${t}`},attributes:{role:"tab","aria-selected":i},type:"button"},e));s.setAttribute("aria-controls",t),this.simTabsContainer.appendChild(s)}addSimTabLink(e){const t=0==this.simTabsContainer.children.length;e.navLink.setAttribute("aria-selected",t.toString()),t&&e.navLink.classList.add("active","show"),this.simTabsContainer.appendChild(e.navItem)}addImportLink(e,t,i){this.addImportExportLink("import-dropdown",e,t,i)}addExportLink(e,t,i){this.addImportExportLink("export-dropdown",e,t,i)}addImportExportLink(e,t,i,s){const a=this.rootElem.getElementsByClassName(e)[0].getElementsByClassName("dropdown-menu")[0],n=w("li",null,w("a",{href:"javascript:void(0)",className:"dropdown-item",attributes:{role:"button"}},t));n.children[0].addEventListener("click",(()=>i(a))),a.appendChild(n)}addToolbarLink(e){let t=w("div",{className:"sim-toolbar-item"},w("a",{href:e.href?e.href:"javascript:void(0)",className:e.classes,target:e.href?"_blank":"_self"},e.icon&&w("i",{className:e.icon}),e.text?` ${e.text} `:"")),i=t.children[0];return e.onclick&&i.addEventListener("click",(()=>{e.onclick&&e.onclick()})),e.tooltip&&new da(i,{placement:"bottom",title:e.tooltip,html:!0}),e.parent.appendChild(t)}addKnownIssuesLink(){return this.addToolbarLink({parent:this.simToolbar,text:"Known Issues",tooltip:this.knownIssuesContent,classes:"known-issues link-danger hide"}).children[0]}addKnownIssue(e){this.knownIssuesContent.appendChild(w("li",null,e)),this.knownIssuesLink.classList.remove("hide"),da.getInstance(this.knownIssuesLink)?.setContent({".tooltip-inner":this.knownIssuesContent})}addBugReportLink(){this.addToolbarLink({href:"https://github.com/wowsims/sod/issues/new/choose",parent:this.simToolbar,icon:"fas fa-bug fa-lg",tooltip:"Report a bug or<br>Request a feature"})}addDownloadBinaryLink(){let e="https://github.com/wowsims/sod/releases",t="fas fa-gauge-high fa-lg",i=this.simToolbar;document.location.href.includes("localhost")?fetch("/version").then((s=>{s.json().then((s=>{2==s.outdated&&this.addToolbarLink({href:e,parent:i,icon:t,tooltip:"Newer version of simulator available for download",classes:"downbin link-danger"})})).catch((e=>{console.warn("No version info found!")}))})):this.addToolbarLink({href:e,parent:i,icon:t,tooltip:"Download simulator for faster simulating",classes:"downbin"})}addSimOptionsLink(){this.addToolbarLink({parent:this.simToolbar,icon:"fas fa-cog fa-lg",tooltip:"Show Sim Options",classes:"sim-options",onclick:()=>new cn(this.simUI.rootElem,this.simUI)})}addSocialLinks(){let e=document.createElement("div");e.classList.add("sim-toolbar-socials"),this.simToolbar.appendChild(e),this.addDiscordLink(e),this.addGitHubLink(e),this.addPatreonLink(e)}addDiscordLink(e){this.addToolbarLink({href:"https://discord.gg/p3DgvmnDCS",parent:e,icon:"fab fa-discord fa-lg",tooltip:"Join us on Discord",classes:"discord-link link-alt"})}addGitHubLink(e){this.addToolbarLink({href:"https://github.com/wowsims/sod",parent:e,icon:"fab fa-github fa-lg",tooltip:"Contribute on GitHub",classes:"github-link link-alt"})}addPatreonLink(e){this.addToolbarLink({href:"https://patreon.com/wowsims",parent:e,text:"Support our devs",icon:"fab fa-patreon fa-lg",classes:"patreon-link link-alt"})}customRootElement(){return w("header",{className:"sim-header"},w("div",{className:"sim-header-container"},w("ul",{className:"sim-tabs nav nav-tabs",attributes:{role:"tablist"}}),w("div",{className:"import-export within-raid-sim-hide"},w("div",{className:"dropdown sim-dropdown-menu import-dropdown"},w("a",{href:"javascript:void(0)",className:"import-link",attributes:{role:"button","aria-expanded":"false"},dataset:{bsToggle:"dropdown",bsDisplay:"dynamic"}},w("i",{className:"fa fa-download"})," Import "),w("ul",{className:"dropdown-menu"})),w("div",{className:"dropdown sim-dropdown-menu export-dropdown"},w("a",{href:"javascript:void(0)",className:"export-link",attributes:{role:"button","aria-expanded":"false"},dataset:{bsToggle:"dropdown",bsDisplay:"dynamic"}},w("i",{className:"fa fa-right-from-bracket"})," Export "),w("ul",{className:"dropdown-menu"}))),w("div",{className:"sim-toolbar"})))}}const mn=[];class un extends v{constructor(e,i,s){super(e,"sim-ui"),t(this,"sim"),t(this,"cssClass"),t(this,"cssScheme"),t(this,"isWithinRaidSim"),t(this,"changeEmitter"),t(this,"resultsViewer"),t(this,"simHeader"),t(this,"simContentContainer"),t(this,"simMain"),t(this,"simActionsContainer"),t(this,"iterationsPicker"),t(this,"simTabContentsContainer"),this.sim=i,this.cssClass=s.cssClass,this.cssScheme=s.cssScheme,this.isWithinRaidSim=null!=this.rootElem.closest(".within-raid-sim"),this.rootElem.innerHTML=`\n\t\t\t<div class="sim-root">\n\t\t\t\t<div class="sim-bg"></div>\n\t\t\t\t${s.noticeText?`<div class="notices-banner alert border-bottom mb-0 text-center">${s.noticeText}</div>`:""}\n\t\t\t\t<div class="sim-container">\n\t\t\t\t\t<aside class="sim-sidebar">\n\t\t\t\t\t\t<div class="sim-title"></div>\n\t\t\t\t\t\t<div class="sim-sidebar-content">\n\t\t\t\t\t\t\t<div class="sim-sidebar-actions within-raid-sim-hide"></div>\n\t\t\t\t\t\t\t<div class="sim-sidebar-results within-raid-sim-hide"></div>\n\t\t\t\t\t\t\t<div class="sim-sidebar-footer"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</aside>\n\t\t\t\t\t<div class="sim-content container-fluid"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,this.simContentContainer=this.rootElem.querySelector(".sim-content"),this.simHeader=new hn(this.simContentContainer,this),this.simMain=document.createElement("main"),this.simMain.classList.add("sim-main","tab-content"),this.simContentContainer.appendChild(this.simMain),this.rootElem.classList.add(this.cssClass),this.isWithinRaidSim||this.rootElem.classList.add("not-within-raid-sim"),this.changeEmitter=m.onAny([this.sim.changeEmitter],"SimUIChange"),this.sim.crashEmitter.on(((e,t)=>this.handleCrash(t)));const a=()=>{this.sim.getShowDamageMetrics()?this.rootElem.classList.remove("hide-damage-metrics"):this.rootElem.classList.add("hide-damage-metrics")};a(),this.sim.showDamageMetricsChangeEmitter.on(a);const n=()=>{this.sim.getShowThreatMetrics()?this.rootElem.classList.remove("hide-threat-metrics"):this.rootElem.classList.add("hide-threat-metrics")};n(),this.sim.showThreatMetricsChangeEmitter.on(n);const o=()=>{this.sim.getShowHealingMetrics()?this.rootElem.classList.remove("hide-healing-metrics"):this.rootElem.classList.add("hide-healing-metrics")};o(),this.sim.showHealingMetricsChangeEmitter.on(o);const l=()=>{this.sim.getShowThreatMetrics()||this.sim.getShowDamageMetrics()&&this.sim.getShowHealingMetrics()?this.rootElem.classList.remove("hide-ep-ratios"):this.rootElem.classList.add("hide-ep-ratios")};l(),this.sim.showDamageMetricsChangeEmitter.on(l),this.sim.showHealingMetricsChangeEmitter.on(l),this.sim.showThreatMetricsChangeEmitter.on(l);const r=()=>{this.sim.getShowExperimental()?this.rootElem.classList.remove("hide-experimental"):this.rootElem.classList.add("hide-experimental")};r(),this.sim.showExperimentalChangeEmitter.on(r),this.addKnownIssues(s);const d=this.rootElem.querySelector(".sim-title");new sn(d,s.spec,{noDropdown:this.isWithinRaidSim});const c=this.rootElem.getElementsByClassName("sim-sidebar-results")[0];this.resultsViewer=new tn(c),this.simActionsContainer=this.rootElem.getElementsByClassName("sim-sidebar-actions")[0],new en(this.simActionsContainer,this.sim,{label:"Iterations",extraCssClasses:["iterations-picker","within-raid-sim-hide"],changedEvent:e=>e.iterationsChangeEmitter,getValue:e=>e.getIterations(),setValue:(e,t,i)=>{t.setIterations(e,i)}}),this.iterationsPicker=this.rootElem.getElementsByClassName("iterations-picker")[0],this.simTabContentsContainer=this.rootElem.querySelector(".sim-main.tab-content"),this.isWithinRaidSim||window.addEventListener("message",(async e=>{"runOnce"==e.data&&this.runSimOnce()}))}addAction(e,t,i){const s=document.createElement("button");s.classList.add("btn","btn-primary","w-100",t),s.textContent=e,s.addEventListener("click",i),this.simActionsContainer.appendChild(s)}addTab(e,t,i){const s=t.replace(/\s+/g,"-")+"-tab",a=0==this.simTabContentsContainer.children.length;this.simHeader.addTab(e,s);const n=document.createElement("fragment");n.innerHTML=`\n\t\t\t<div\n\t\t\t\tid="${s}"\n\t\t\t\tclass="tab-pane fade ${a?"active show":""}"\n\t\t\t>${i}</div>\n\t\t`,this.simTabContentsContainer.appendChild(n.children[0])}addSimTab(e){this.simHeader.addSimTabLink(e)}addWarning(e){this.resultsViewer.addWarning(e)}addKnownIssues(e){let t="";e.simStatus.status==fa.Unlaunched?t="This sim is a WORK IN PROGRESS. It is not fully developed and should not be used for general purposes.":e.simStatus.phase<Ne&&(t=`This sim is supported up to phase ${e.simStatus.phase}. Phase ${Ne} items and abilities may not yet be functional.`),t&&(e.knownIssues=[t].concat(e.knownIssues||[])),e.knownIssues&&e.knownIssues.length&&e.knownIssues.forEach((e=>this.simHeader.addKnownIssue(e))),mn.forEach((e=>this.simHeader.addKnownIssue(e)))}getSettingsStorageKey(){return this.getStorageKey("__currentSettings__")}getSavedEncounterStorageKey(){return"sharedData__savedEncounter__"}isIndividualSim(){return this.rootElem.classList.contains("individual-sim-ui")}async runSim(e){this.resultsViewer.setPending();try{await this.sim.runRaidSim(m.nextEventID(),e)}catch(t){this.resultsViewer.hideAll(),this.handleCrash(t)}}async runSimOnce(){this.resultsViewer.setPending();try{await this.sim.runRaidSimWithLogs(m.nextEventID())}catch(e){this.resultsViewer.hideAll(),this.handleCrash(e)}}async handleCrash(e){if(!(e instanceof Xa))return void alert(e);const t=e.errorStr;if(t.startsWith("[USER_ERROR] ")){let e=t.substring(13);return e=await y.replaceAllInString(e),void alert(e)}if(window.confirm("Simulation Failure:\n"+t+"\nPress Ok to file crash report")){const e=this.hashCode(t),i=this.toLink(),s=this.sim.getLastUsedRngSeed();fetch("https://api.github.com/search/issues?q=is:issue+is:open+repo:wowsims/sod+"+e).then((a=>{a.json().then((a=>{if(a.total_count>0)window.open(a.items[0].html_url,"_blank");else{const a=`${"https://github.com/wowsims/sod/issues/new?assignees=&labels=&title=Crash%20Report%20"}${e}&body=`,n=2048-a.length;let o=encodeURIComponent(`Link:\n${i}\n\nRNG Seed: ${s}\n\n${t}`);i.includes("/raid/")&&(o=encodeURIComponent(`${t}\nRNG Seed: ${s}\nLink:\n${i}`));let l=!1;for(;o.length>n-(l?3:0);)o=o.slice(0,o.lastIndexOf("%")),l=!0;l&&(o+="...",new pn(this.rootElem,i)),window.open(a+o,"_blank")}}))})).catch((e=>{alert("Failed to file report... try again another time:"+e)}))}}hashCode(e){let t=0;for(let i=0,s=e.length;i<s;i++){t=(t<<5)-t+e.charCodeAt(i),t|=0}return t}}class pn extends dn{constructor(e,t){super(e,"crash",{title:"Extra Crash Information"}),this.body.innerHTML='\n\t\t\t<div class="sim-crash-report">\n\t\t\t\t<h3 class="sim-crash-report-header">Please append the following complete link to the issue you just created. This will simplify debugging the issue.</h3>\n\t\t\t\t<textarea class="sim-crash-report-text form-control"></textarea>\n\t\t\t</div>\n\t\t';let i=document.createTextNode(t);this.body.querySelector("textarea")?.appendChild(i)}}class gn extends v{constructor(e,i,s,a){super(e,"character-stats-root"),t(this,"stats"),t(this,"valueElems"),t(this,"meleeCritCapValueElem"),t(this,"player"),t(this,"modifyDisplayStats"),this.stats=Xe.filter((e=>s.includes(e))),this.player=i,this.modifyDisplayStats=a;const o=document.createElement("label");o.classList.add("character-stats-label"),o.textContent="Stats",this.rootElem.appendChild(o);const l=document.createElement("table");if(l.classList.add("character-stats-table"),this.rootElem.appendChild(l),this.valueElems=[],this.stats.forEach((e=>{let t=n(e,i.getClass());const s=w("tr",{className:"character-stats-table-row"},w("td",{className:"character-stats-table-label"},t),w("td",{className:"character-stats-table-value"},this.bonusStatsLink(e)));l.appendChild(s);const a=s.getElementsByClassName("character-stats-table-value")[0];this.valueElems.push(a)})),this.shouldShowMeleeCritCap(i)){const e=w("tr",{className:"character-stats-table-row"},w("td",{className:"character-stats-table-label"},"Melee Crit Cap"),w("td",{className:"character-stats-table-value"}));l.appendChild(e),this.meleeCritCapValueElem=e.getElementsByClassName("character-stats-table-value")[0]}else this.meleeCritCapValueElem=void 0;this.updateStats(i),m.onAny([i.currentStatsEmitter,i.sim.changeEmitter,i.talentsChangeEmitter]).on((()=>{this.updateStats(i)}))}updateStats(e){const t=e.getCurrentStats(),i=this.modifyDisplayStats?this.modifyDisplayStats(this.player):{talents:new ga},s=ga.fromProto(t.baseStats),a=ga.fromProto(t.gearStats),n=ga.fromProto(t.talentsStats),o=ga.fromProto(t.buffsStats),l=ga.fromProto(t.consumesStats),r=this.getDebuffStats(),d=e.getBonusStats(),c=s,h=a.subtract(s).subtract(d),m=n.subtract(a).add(i.talents),u=o.subtract(n),p=l.subtract(o),g=ga.fromProto(t.finalStats).add(i.talents).add(r);if(this.stats.forEach(((e,t)=>{let i=w("a",{href:"javascript:void(0)",className:"stat-value-link",attributes:{role:"button"}},`${this.statDisplayString(g,g,e)} `);this.valueElems[t].querySelector(".stat-value-link")?.remove(),this.valueElems[t].prepend(i);let f=d.getStat(e);0==f?i.classList.add("text-white"):f>0?i.classList.add("text-success"):f<0&&i.classList.add("text-danger");let I=w("div",null,w("div",{className:"character-stats-tooltip-row"},w("span",null,"Base:"),w("span",null,this.statDisplayString(s,c,e))),w("div",{className:"character-stats-tooltip-row"},w("span",null,"Gear:"),w("span",null,this.statDisplayString(a,h,e))),w("div",{className:"character-stats-tooltip-row"},w("span",null,"Talents:"),w("span",null,this.statDisplayString(n,m,e))),w("div",{className:"character-stats-tooltip-row"},w("span",null,"Buffs:"),w("span",null,this.statDisplayString(o,u,e))),w("div",{className:"character-stats-tooltip-row"},w("span",null,"Consumes:"),w("span",null,this.statDisplayString(l,p,e))),0!=r.getStat(e)&&w("div",{className:"character-stats-tooltip-row"},w("span",null,"Debuffs:"),w("span",null,this.statDisplayString(r,r,e))),0!=f&&w("div",{className:"character-stats-tooltip-row"},w("span",null,"Bonus:"),w("span",null,this.statDisplayString(d,d,e))),w("div",{className:"character-stats-tooltip-row"},w("span",null,"Total:"),w("span",null,this.statDisplayString(g,g,e))));da.getOrCreateInstance(i,{title:I,html:!0})})),this.meleeCritCapValueElem){const t=e.getMeleeCritCapInfo(),i=w("a",{href:"javascript:void(0)",className:"stat-value-link",attributes:{role:"button"}},`${this.meleeCritCapDisplayString(e,g)} `),s=t.playerCritCapDelta;0==s?i.classList.add("text-white"):s>0?i.classList.add("text-danger"):s<0&&i.classList.add("text-success"),this.meleeCritCapValueElem.querySelector(".stat-value-link")?.remove(),this.meleeCritCapValueElem.prepend(i);const a=w("div",null,w("div",{className:"character-stats-tooltip-row"},w("span",null,"Glancing:"),w("span",null,`${t.glancing.toFixed(2)}%`)),w("div",{className:"character-stats-tooltip-row"},w("span",null,"Suppression:"),w("span",null,`${t.suppression.toFixed(2)}%`)),w("div",{className:"character-stats-tooltip-row"},w("span",null,"To Hit Cap:"),w("span",null,`${t.remainingMeleeHitCap.toFixed(2)}%`)),w("div",{className:"character-stats-tooltip-row"},w("span",null,"To Exp Cap:"),w("span",null,`${t.remainingExpertiseCap.toFixed(2)}%`)),w("div",{className:"character-stats-tooltip-row"},w("span",null,"Debuffs:"),w("span",null,`${t.debuffCrit.toFixed(2)}%`)),0!=t.specSpecificOffset&&w("div",{className:"character-stats-tooltip-row"},w("span",null,"Spec Offsets:"),w("span",null,`${t.specSpecificOffset.toFixed(2)}%`)),w("div",{className:"character-stats-tooltip-row"},w("span",null,"Final Crit Cap:"),w("span",null,`${t.baseCritCap.toFixed(2)}%`)),w("hr",null),w("div",{className:"character-stats-tooltip-row"},w("span",null,"Can Raise By:"),w("span",null,`${(t.remainingExpertiseCap+t.remainingMeleeHitCap).toFixed(2)}%`)));da.getOrCreateInstance(i,{title:a,html:!0})}}statDisplayString(e,t,i){let n=t.getStat(i);i==s.StatBlockValue&&(n*=e.getPseudoStat(a.PseudoStatBlockValueMultiplier)||1);let o=String(Math.round(n));if(i==s.StatMeleeHit)o=`${(n/B).toFixed(2)}%`;else if(i==s.StatSpellHit)o=`${(n/et).toFixed(2)}%`;else if(i==s.StatSpellDamage){const e=Math.round(n);o=Math.round(t.getStat(s.StatSpellPower))+e+` (+${e})`}else if(i==s.StatArcanePower||i==s.StatFirePower||i==s.StatFrostPower||i==s.StatHolyPower||i==s.StatNaturePower||i==s.StatShadowPower){const e=Math.round(n);o=Math.round(t.getStat(s.StatSpellPower)+t.getStat(s.StatSpellDamage))+e+` (+${e})`}else i==s.StatMeleeCrit||i==s.StatSpellCrit?o=`${(n/tt).toFixed(2)}%`:i==s.StatMeleeHaste?[g.ClassDruid,g.ClassShaman,g.ClassPaladin].includes(this.player.getClass())?o+=` (${(n/it).toFixed(2)}%)`:o+=` (${(n/st).toFixed(2)}%)`:i==s.StatSpellHaste?o=`${(n/st).toFixed(2)}%`:i==s.StatArmorPenetration?o+=` (${(n/at).toFixed(2)}%)`:i==s.StatExpertise?o+=` (${(n/z/4).toFixed(2)}%)`:i==s.StatDefense?o+=` (${(5*nt+Math.floor(n/ot)).toFixed(0)})`:i==s.StatBlock?o+=` (${(n/lt+rt*Math.floor(e.getStat(s.StatDefense)/ot)+5).toFixed(2)}%)`:i==s.StatDodge?o+=` (${(100*e.getPseudoStat(a.PseudoStatDodge)).toFixed(2)}%)`:i==s.StatParry?o+=` (${(100*e.getPseudoStat(a.PseudoStatParry)).toFixed(2)}%)`:i==s.StatResilience&&(o+=` (${(n/dt).toFixed(2)}%)`);return o}getDebuffStats(){return new ga}bonusStatsLink(e){let t=n(e,this.player.getClass()),i=w("a",{href:"javascript:void(0)",className:"add-bonus-stats text-white ms-2",dataset:{bsToggle:"popover"},attributes:{role:"button"}},w("i",{className:"fas fa-plus-minus"})),s=null,a=new en(null,this.player,{label:`Bonus ${t}`,extraCssClasses:["mb-0"],changedEvent:e=>e.bonusStatsChangeEmitter,getValue:t=>t.getBonusStats().getStat(e),setValue:(t,i,a)=>{const n=i.getBonusStats().withStat(e,a);i.setBonusStats(t,n),s?.hide()}});return s=new ha(i,{customClass:"bonus-stats-popover",placement:"right",fallbackPlacement:["left"],sanitize:!1,html:!0,content:a.rootElem}),i}shouldShowMeleeCritCap(e){return[d.SpecEnhancementShaman,d.SpecRetributionPaladin,d.SpecRogue,d.SpecWarrior].includes(e.spec)}meleeCritCapDisplayString(e,t){const i=e.getMeleeCritCap();if(0===i)return"Exact";return`${i>0?"Over by ":"Under by "} ${Math.abs(i).toFixed(2)}%`}}const fn=class extends dn{constructor(e,i,s,a){super(e.rootElem,"ep-weights-menu",function(e){const t={footer:!0,scrollContents:!0};return e.sim.getShowThreatMetrics()&&e.sim.getShowExperimental()?{size:"xl",...t}:t}(e)),t(this,"simUI"),t(this,"container"),t(this,"table"),t(this,"tableBody"),t(this,"resultsViewer"),t(this,"statsType"),t(this,"epStats"),t(this,"epPseudoStats"),t(this,"epReferenceStat"),t(this,"showAllStats",!1),this.simUI=e,this.statsType="ep",this.epStats=i,this.epPseudoStats=s,this.epReferenceStat=a,this.header?.insertAdjacentHTML("afterbegin",'<h5 class="modal-title">Calculate Stat Weights</h5>'),this.body.innerHTML='\n\t\t\t<div class="ep-weights-options row">\n\t\t\t\t<div class="col col-sm-3">\n\t\t\t\t\t<select class="ep-type-select form-select">\n\t\t\t\t\t\t<option value="ep">EP</option>\n\t\t\t\t\t\t<option value="weight">Weights</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="show-all-stats-container col col-sm-3"></div>\n\t\t\t</div>\n\t\t\t<div class="ep-reference-options row experimental">\n\t\t\t\t<div class="col col-sm-4 damage-metrics">\n\t\t\t\t\t<span>DPS/TPS reference:</span>\n\t\t\t\t\t<select class="ref-stat-select form-select damage-metrics">\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="col col-sm-4 healing-metrics">\n\t\t\t\t\t<span>Healing reference:</span>\n\t\t\t\t\t<select class="ref-stat-select form-select healing-metrics">\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="col col-sm-4 threat-metrics">\n\t\t\t\t\t<span>Mitigation reference:</span>\n\t\t\t\t\t<select class="ref-stat-select form-select threat-metrics">\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<p>The above stat selectors control which reference stat is used for EP normalisation for the different EP columns.</p>\n\t\t\t</div>\n\t\t\t<p>The \'Current EP\' column displays the values currently used by the item pickers to sort items.</br>\n\t\t\tUse the <a href=\'javascript:void(0)\' class="fa fa-copy"></a> icon above the EPs to use newly calculated EPs.</p>\n\t\t\t<div class="results-ep-table-container modal-scroll-table">\n\t\t\t\t<div class="results-pending-overlay"></div>\n\t\t\t\t<table class="results-ep-table">\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<th>Stat</th>\n\t\t\t\t\t\t\t<th class="damage-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>DPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="damage-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>DPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="healing-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>HPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="healing-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>HPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>TPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>TPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>DTPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>DTPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight experimental">\n\t\t\t\t\t\t\t\t<span>TMI Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep experimental">\n\t\t\t\t\t\t\t\t<span>TMI EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight experimental">\n\t\t\t\t\t\t\t\t<span>Death Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep experimental">\n\t\t\t\t\t\t\t\t<span>Death EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th style="text-align: center">\n\t\t\t\t\t\t\t\t<span>Current EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fas fa-arrows-rotate"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr class="ep-ratios">\n\t\t\t\t\t\t\t<td>EP Ratio</td>\n\t\t\t\t\t\t\t<td class="damage-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="damage-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="healing-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="healing-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight experimental">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep experimental">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight experimental">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep experimental">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td style="text-align: center; vertical-align: middle;">\n\t\t\t\t\t\t\t\t<button class="btn btn-primary compute-ep">\n\t\t\t\t\t\t\t\t\t<i class="fas fa-calculator"></i>\n\t\t\t\t\t\t\t\t\t<span class="not-tiny">Update </span>EP\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t',this.footer.innerHTML='\n\t\t\t<button class="btn btn-primary calc-weights">\n\t\t\t\t<i class="fas fa-calculator"></i>\n\t\t\t\tCalculate\n\t\t\t</button>\n\t\t',this.container=this.rootElem.querySelector(".results-ep-table-container"),this.table=this.rootElem.querySelector(".results-ep-table"),this.tableBody=this.rootElem.querySelector(".results-ep-table tbody");const o=this.rootElem.querySelector(".results-pending-overlay");this.resultsViewer=new tn(o);const l=()=>{"ep"==this.statsType?(this.table.classList.remove("stats-type-weight"),this.table.classList.add("stats-type-ep")):(this.table.classList.add("stats-type-weight"),this.table.classList.remove("stats-type-ep"))},r=this.rootElem.getElementsByClassName("ep-type-select")[0];r.addEventListener("input",(e=>{this.statsType=r.value,l()})),r.value=this.statsType,l();const d=e=>void 0!==e?n(e,this.simUI.player.getClass()):"??",c=e=>{for(let t of this.epStats)if(d(t)==e)return t},h=()=>{this.simUI.player.epRefStatChangeEmitter.emit(m.nextEventID()),this.simUI.prevEpSimResult=this.calculateEp(this.getPrevSimResult()),this.updateTable()};this.rootElem.querySelectorAll(".ref-stat-select").forEach(((e,t)=>{this.epStats.forEach((t=>{e.options[e.options.length]=new Option(d(t))})),e.classList.contains("damage-metrics")?(e.addEventListener("input",(t=>{this.simUI.dpsRefStat=c(e.value),h()})),e.value=d(this.getDpsEpRefStat())):e.classList.contains("healing-metrics")?(e.addEventListener("input",(t=>{this.simUI.healRefStat=c(e.value),h()})),e.value=d(this.getHealEpRefStat())):e.classList.contains("threat-metrics")&&(e.addEventListener("input",(t=>{this.simUI.tankRefStat=c(e.value),h()})),e.value=d(this.getTankEpRefStat()))}));const u=this.rootElem.getElementsByClassName("calc-weights")[0];u.addEventListener("click",(async e=>{const t=u.innerHTML;u.classList.add("disabled"),u.style.width=`${u.getBoundingClientRect().width.toFixed(3)}px`,u.innerHTML='<i class="fa fa-spinner fa-spin"></i>&nbsp;Running',this.container.scrollTo({top:0}),this.container.classList.add("pending"),this.resultsViewer.setPending();const i=this.simUI.sim.getIterations(),s=await this.simUI.player.computeStatWeights(m.nextEventID(),this.epStats,this.epPseudoStats,this.epReferenceStat,(e=>{this.setSimProgress(e)}));this.container.classList.remove("pending"),this.resultsViewer.hideAll(),u.innerHTML=t,u.classList.remove("disabled"),this.simUI.prevEpIterations=i,this.simUI.prevEpSimResult=this.calculateEp(s),this.updateTable()}));const p=Array.from(this.rootElem.getElementsByClassName("col-action")),g=(e,t,i,s,a)=>{const n=e.previousElementSibling;new da(n,{toggle:"tooltip",html:!0,title:()=>{if(!a)return t;const e=d(a());return t+` Normalized by ${e}.`}}),da.getOrCreateInstance(e,{title:i,html:!0}),e.addEventListener("click",(e=>{this.simUI.player.setEpWeights(m.nextEventID(),ga.fromProto(s())),this.updateTable()}))};g(p[0],"Per-point increase in DPS (Damage Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dps.weights)),g(p[1],"EP (Equivalency Points) for DPS (Damage Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dps.epValues),(()=>this.getDpsEpRefStat())),g(p[2],"Per-point increase in HPS (Healing Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().hps.weights)),g(p[3],"EP (Equivalency Points) for HPS (Healing Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().hps.epValues),(()=>this.getHealEpRefStat())),g(p[4],"Per-point increase in TPS (Threat Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tps.weights)),g(p[5],"EP (Equivalency Points) for TPS (Threat Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tps.epValues),(()=>this.getDpsEpRefStat())),g(p[6],"Per-point increase in DTPS (Damage Taken Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dtps.weights)),g(p[7],"EP (Equivalency Points) for DTPS (Damage Taken Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dtps.epValues),(()=>this.getTankEpRefStat())),g(p[8],"Per-point decrease in TMI (Theck-Meloree Index) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tmi.weights)),g(p[9],"EP (Equivalency Points) for TMI (Theck-Meloree Index) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tmi.epValues),(()=>this.getTankEpRefStat())),g(p[10],"Per-point decrease in p(death) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().pDeath.weights)),g(p[11],"EP (Equivalency Points) for p(death) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().pDeath.epValues),(()=>this.getTankEpRefStat())),g(p[12],"Current EP Weights. Used to sort the gear selector menus.","Restore Default EP",(()=>this.simUI.individualConfig.defaults.epWeights.toProto()));const f=this.rootElem.getElementsByClassName("show-all-stats-container")[0];new an(f,this,{label:"Show All Stats",inline:!0,changedEvent:()=>new m,getValue:()=>this.showAllStats,setValue:(e,t,i)=>{this.showAllStats=i,this.updateTable()}}),this.updateTable();const I=(e,t)=>{new en(e,this.simUI.player,{float:!0,changedEvent:e=>e.epRatiosChangeEmitter,getValue:e=>this.simUI.player.getEpRatios()[t],setValue:(e,i,s)=>{const a=i.getEpRatios();a[t]=s,i.setEpRatios(e,a)}})};this.body.querySelectorAll(".type-ratio.type-ep").forEach(I),this.simUI.player.epRatiosChangeEmitter.on((e=>this.updateTable()));this.body.querySelectorAll(".type-ratio.type-weight").forEach(I);const w=this.rootElem.getElementsByClassName("compute-ep")[0];da.getOrCreateInstance(w,{title:"Compute Weighted EP"}),w.addEventListener("click",(e=>{const t=this.getPrevSimResult(),i=this.simUI.player.getEpRatios();if("ep"==this.statsType){const e=ga.fromProto(t.dps.epValues).scale(i[0]),s=ga.fromProto(t.hps.epValues).scale(i[1]),a=ga.fromProto(t.tps.epValues).scale(i[2]),n=ga.fromProto(t.dtps.epValues).scale(i[3]),o=ga.fromProto(t.tmi.epValues).scale(i[4]),l=ga.fromProto(t.pDeath.epValues).scale(i[5]),r=e.add(s).add(a).add(n).add(o).add(l);this.simUI.player.setEpWeights(m.nextEventID(),r)}else{const e=ga.fromProto(t.dps.weights).scale(i[0]),s=ga.fromProto(t.hps.weights).scale(i[1]),a=ga.fromProto(t.tps.weights).scale(i[2]),n=ga.fromProto(t.dtps.weights).scale(i[3]),o=ga.fromProto(t.tmi.weights).scale(i[4]),l=ga.fromProto(t.pDeath.weights).scale(i[5]),r=e.add(s).add(a).add(n).add(o).add(l);this.simUI.player.setEpWeights(m.nextEventID(),r)}this.updateTable()}))}setSimProgress(e){this.resultsViewer.setContent(`\n\t\t\t<div class="results-sim">\n\t\t\t\t<div class=""> ${e.completedSims} / ${e.totalSims}<br>simulations complete</div>\n\t\t\t\t<div class="">\n\t\t\t\t\t${e.completedIterations} / ${e.totalIterations}<br>iterations complete\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`)}updateTable(){this.tableBody.innerHTML="",fn.epUnitStats.forEach((e=>{if(!this.showAllStats&&e.isStat()&&!this.epStats.includes(e.getStat())||e.isPseudoStat()&&!this.epPseudoStats.includes(e.getPseudoStat()))return;const t=this.makeTableRow(e);this.tableBody.appendChild(t)}))}makeTableRow(e){const t=document.createElement("tr"),i=this.simUI.prevEpSimResult,s=this.simUI.player.getEpRatios(),a=function(e,t,i){return i?t[0]*e.getProtoValue(i.dps?.epValues)+t[1]*e.getProtoValue(i.hps?.epValues)+t[2]*e.getProtoValue(i.tps?.epValues)+t[3]*e.getProtoValue(i.dtps?.epValues)+t[4]*e.getProtoValue(i.tmi?.epValues)+t[5]*e.getProtoValue(i.pDeath?.epValues):0}(e,s,i);t.innerHTML=`\n\t\t\t<td>${e.getName(this.simUI.player.getClass())}</td>\n\t\t\t${this.makeTableRowCells(e,i?.dps,"damage-metrics",a,s[0])}\n\t\t\t${this.makeTableRowCells(e,i?.hps,"healing-metrics",a,s[1])}\n\t\t\t${this.makeTableRowCells(e,i?.tps,"threat-metrics",a,s[2])}\n\t\t\t${this.makeTableRowCells(e,i?.dtps,"threat-metrics",a,s[3])}\n\t\t\t${this.makeTableRowCells(e,i?.tmi,"threat-metrics experimental",a,s[4])}\n\t\t\t${this.makeTableRowCells(e,i?.pDeath,"threat-metrics experimental",a,s[5])}\n\t\t\t<td class="current-ep"></td>\n\t\t`;const n=t.querySelector(".current-ep");return new en(n,this.simUI.player,{float:!0,changedEvent:e=>e.epWeightsChangeEmitter,getValue:t=>this.simUI.player.getEpWeights().getUnitStat(e),setValue:(t,i,s)=>{const a=i.getEpWeights().withUnitStat(e,s);i.setEpWeights(t,a)}}),t}makeTableRowCells(e,t,i,s,a){var n,o;if(t){const i=e.getProtoValue(t.weights),s=e.getProtoValue(t.weightsStdev);n=this.makeTableCellContents(i,s);const a=e.getProtoValue(t.epValues),l=e.getProtoValue(t.epValuesStdev);o=this.makeTableCellContents(a,l)}else o=n='<span class="results-avg notapplicable">N/A</span>';let l=document.createElement("template");if(l.innerHTML=`\n\t\t\t<td class="stdev-cell ${i} type-weight">\n\t\t\t\t${n}\n\t\t\t</td>\n\t\t\t<td class="stdev-cell ${i} type-ep">\n\t\t\t\t${o}\n\t\t\t</td>\n\t\t`,!t)return l.innerHTML;if(0==a){return l.content.querySelectorAll(".stdev-cell").forEach((e=>e.classList.add("unused-ep"))),l.innerHTML}const r=s-this.simUI.player.getEpWeights().getUnitStat(e),d=l.content.querySelector(".type-ep .results-avg");return"0.00"==r.toFixed(2)||(r>0?d.classList.add("positive"):r<0&&d.classList.add("negative")),l.innerHTML}makeTableCellContents(e,t){const i=this.simUI.prevEpIterations||1;return`\n\t\t\t<span class="results-avg">${e.toFixed(2)}</span>\n\t\t\t<span class="results-stdev">\n\t\t\t\t(<i class="fas fa-plus-minus fa-xs"></i>${ct(t,i).toFixed(2)})\n\t\t\t</span>\n\t\t`}calculateEp(e){var t=Pe.clone(e);const i=(e,t)=>{const i=pa.fromStat(e),s=i.getProtoValue(t.weights),a=i.getProtoValue(t.weightsStdev);fn.epUnitStats.forEach((e=>{const i=e.getProtoValue(t.weights);e.setProtoValue(t.epValues,0==s?0:i/s);const n=e.getProtoValue(t.weightsStdev);e.setProtoValue(t.epValuesStdev,0==a?0:n/a)}))};return void 0!==this.simUI.dpsRefStat&&(i(this.simUI.dpsRefStat,t.dps),i(this.simUI.dpsRefStat,t.tps)),void 0!==this.simUI.healRefStat&&i(this.simUI.healRefStat,t.hps),void 0!==this.simUI.tankRefStat&&(i(this.simUI.tankRefStat,t.dtps),i(this.simUI.tankRefStat,t.tmi),i(this.simUI.tankRefStat,t.pDeath)),t}getDpsEpRefStat(){return void 0!==this.simUI.dpsRefStat?this.simUI.dpsRefStat:this.epReferenceStat}getHealEpRefStat(){return void 0!==this.simUI.healRefStat?this.simUI.healRefStat:this.epReferenceStat}getTankEpRefStat(){return void 0!==this.simUI.tankRefStat?this.simUI.tankRefStat:s.StatArmor}getPrevSimResult(){return this.simUI.prevEpSimResult||Pe.create({dps:{weights:(new ga).toProto(),weightsStdev:(new ga).toProto(),epValues:(new ga).toProto(),epValuesStdev:(new ga).toProto()},hps:{weights:(new ga).toProto(),weightsStdev:(new ga).toProto(),epValues:(new ga).toProto(),epValuesStdev:(new ga).toProto()},tps:{weights:(new ga).toProto(),weightsStdev:(new ga).toProto(),epValues:(new ga).toProto(),epValuesStdev:(new ga).toProto()},dtps:{weights:(new ga).toProto(),weightsStdev:(new ga).toProto(),epValues:(new ga).toProto(),epValuesStdev:(new ga).toProto()},tmi:{weights:(new ga).toProto(),weightsStdev:(new ga).toProto(),epValues:(new ga).toProto(),epValuesStdev:(new ga).toProto()},pDeath:{weights:(new ga).toProto(),weightsStdev:(new ga).toProto(),epValues:(new ga).toProto(),epValuesStdev:(new ga).toProto()}})}};let In=fn;t(In,"epUnitStats",pa.getAll().filter((e=>!!e.isStat()||[a.PseudoStatMainHandDps,a.PseudoStatOffHandDps,a.PseudoStatRangedDps].includes(e.getPseudoStat()))));class wn extends v{constructor(e,i,s){super(e,"content-block",s.rootElem),t(this,"headerElement"),t(this,"bodyElement"),t(this,"config"),this.config=s,this.rootElem.classList.add(i),s.extraCssClasses&&this.rootElem.classList.add(...s.extraCssClasses),this.headerElement=this.buildHeader(),this.bodyElement=this.buildBody(),s.bodyClasses?.forEach((e=>{this.bodyElement.classList.add(e)}))}buildHeader(){if(this.config.header&&Object.keys(this.config.header).length){let e=this.config.header.titleTag||"h6",t=w("div",{className:"content-block-header"},w(e,{className:"content-block-title"},this.config.header.title));return this.config.header.extraCssClasses&&t.classList.add(...this.config.header.extraCssClasses),this.config.header.tooltip&&da.getOrCreateInstance(t.querySelector(".content-block-title"),{html:!0,title:this.config.header.tooltip}),this.rootElem.appendChild(t),t}return null}buildBody(){let e=document.createElement("div");return e.classList.add("content-block-body"),this.rootElem.appendChild(e),e}}var bn={};!function(e){var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var s=t.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(var a in s)i(s,a)&&(e[a]=s[a])}}return e},e.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var s={arraySet:function(e,t,i,s,a){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+s),a);else for(var n=0;n<s;n++)e[a+n]=t[i+n]},flattenChunks:function(e){var t,i,s,a,n,o;for(s=0,t=0,i=e.length;t<i;t++)s+=e[t].length;for(o=new Uint8Array(s),a=0,t=0,i=e.length;t<i;t++)n=e[t],o.set(n,a),a+=n.length;return o}},a={arraySet:function(e,t,i,s,a){for(var n=0;n<s;n++)e[a+n]=t[i+n]},flattenChunks:function(e){return[].concat.apply([],e)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,s)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,a))},e.setTyped(t)}(bn);var vn={},xn={},Sn={},En=bn,yn=0,Pn=1;function kn(e){for(var t=e.length;--t>=0;)e[t]=0}var Cn=0,Ln=29,Tn=256,_n=Tn+1+Ln,Nn=30,Rn=19,An=2*_n+1,Dn=15,Mn=16,Vn=7,Un=256,Fn=16,Wn=17,On=18,Hn=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],qn=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Bn=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],zn=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],jn=new Array(2*(_n+2));kn(jn);var $n=new Array(2*Nn);kn($n);var Gn=new Array(512);kn(Gn);var Kn=new Array(256);kn(Kn);var Jn=new Array(Ln);kn(Jn);var Zn,Yn,Qn,Xn=new Array(Nn);function eo(e,t,i,s,a){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=s,this.max_length=a,this.has_stree=e&&e.length}function to(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function io(e){return e<256?Gn[e]:Gn[256+(e>>>7)]}function so(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function ao(e,t,i){e.bi_valid>Mn-i?(e.bi_buf|=t<<e.bi_valid&65535,so(e,e.bi_buf),e.bi_buf=t>>Mn-e.bi_valid,e.bi_valid+=i-Mn):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function no(e,t,i){ao(e,i[2*t],i[2*t+1])}function oo(e,t){var i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1}function lo(e,t,i){var s,a,n=new Array(Dn+1),o=0;for(s=1;s<=Dn;s++)n[s]=o=o+i[s-1]<<1;for(a=0;a<=t;a++){var l=e[2*a+1];0!==l&&(e[2*a]=oo(n[l]++,l))}}function ro(e){var t;for(t=0;t<_n;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Nn;t++)e.dyn_dtree[2*t]=0;for(t=0;t<Rn;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*Un]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function co(e){e.bi_valid>8?so(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function ho(e,t,i,s){var a=2*t,n=2*i;return e[a]<e[n]||e[a]===e[n]&&s[t]<=s[i]}function mo(e,t,i){for(var s=e.heap[i],a=i<<1;a<=e.heap_len&&(a<e.heap_len&&ho(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!ho(t,s,e.heap[a],e.depth));)e.heap[i]=e.heap[a],i=a,a<<=1;e.heap[i]=s}function uo(e,t,i){var s,a,n,o,l=0;if(0!==e.last_lit)do{s=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],a=e.pending_buf[e.l_buf+l],l++,0===s?no(e,a,t):(no(e,(n=Kn[a])+Tn+1,t),0!==(o=Hn[n])&&ao(e,a-=Jn[n],o),no(e,n=io(--s),i),0!==(o=qn[n])&&ao(e,s-=Xn[n],o))}while(l<e.last_lit);no(e,Un,t)}function po(e,t){var i,s,a,n=t.dyn_tree,o=t.stat_desc.static_tree,l=t.stat_desc.has_stree,r=t.stat_desc.elems,d=-1;for(e.heap_len=0,e.heap_max=An,i=0;i<r;i++)0!==n[2*i]?(e.heap[++e.heap_len]=d=i,e.depth[i]=0):n[2*i+1]=0;for(;e.heap_len<2;)n[2*(a=e.heap[++e.heap_len]=d<2?++d:0)]=1,e.depth[a]=0,e.opt_len--,l&&(e.static_len-=o[2*a+1]);for(t.max_code=d,i=e.heap_len>>1;i>=1;i--)mo(e,n,i);a=r;do{i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],mo(e,n,1),s=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=s,n[2*a]=n[2*i]+n[2*s],e.depth[a]=(e.depth[i]>=e.depth[s]?e.depth[i]:e.depth[s])+1,n[2*i+1]=n[2*s+1]=a,e.heap[1]=a++,mo(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var i,s,a,n,o,l,r=t.dyn_tree,d=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,m=t.stat_desc.extra_bits,u=t.stat_desc.extra_base,p=t.stat_desc.max_length,g=0;for(n=0;n<=Dn;n++)e.bl_count[n]=0;for(r[2*e.heap[e.heap_max]+1]=0,i=e.heap_max+1;i<An;i++)(n=r[2*r[2*(s=e.heap[i])+1]+1]+1)>p&&(n=p,g++),r[2*s+1]=n,s>d||(e.bl_count[n]++,o=0,s>=u&&(o=m[s-u]),l=r[2*s],e.opt_len+=l*(n+o),h&&(e.static_len+=l*(c[2*s+1]+o)));if(0!==g){do{for(n=p-1;0===e.bl_count[n];)n--;e.bl_count[n]--,e.bl_count[n+1]+=2,e.bl_count[p]--,g-=2}while(g>0);for(n=p;0!==n;n--)for(s=e.bl_count[n];0!==s;)(a=e.heap[--i])>d||(r[2*a+1]!==n&&(e.opt_len+=(n-r[2*a+1])*r[2*a],r[2*a+1]=n),s--)}}(e,t),lo(n,d,e.bl_count)}function go(e,t,i){var s,a,n=-1,o=t[1],l=0,r=7,d=4;for(0===o&&(r=138,d=3),t[2*(i+1)+1]=65535,s=0;s<=i;s++)a=o,o=t[2*(s+1)+1],++l<r&&a===o||(l<d?e.bl_tree[2*a]+=l:0!==a?(a!==n&&e.bl_tree[2*a]++,e.bl_tree[2*Fn]++):l<=10?e.bl_tree[2*Wn]++:e.bl_tree[2*On]++,l=0,n=a,0===o?(r=138,d=3):a===o?(r=6,d=3):(r=7,d=4))}function fo(e,t,i){var s,a,n=-1,o=t[1],l=0,r=7,d=4;for(0===o&&(r=138,d=3),s=0;s<=i;s++)if(a=o,o=t[2*(s+1)+1],!(++l<r&&a===o)){if(l<d)do{no(e,a,e.bl_tree)}while(0!=--l);else 0!==a?(a!==n&&(no(e,a,e.bl_tree),l--),no(e,Fn,e.bl_tree),ao(e,l-3,2)):l<=10?(no(e,Wn,e.bl_tree),ao(e,l-3,3)):(no(e,On,e.bl_tree),ao(e,l-11,7));l=0,n=a,0===o?(r=138,d=3):a===o?(r=6,d=3):(r=7,d=4)}}kn(Xn);var Io=!1;function wo(e,t,i,s){ao(e,(Cn<<1)+(s?1:0),3),function(e,t,i,s){co(e),s&&(so(e,i),so(e,~i)),En.arraySet(e.pending_buf,e.window,t,i,e.pending),e.pending+=i}(e,t,i,!0)}Sn._tr_init=function(e){Io||(!function(){var e,t,i,s,a,n=new Array(Dn+1);for(i=0,s=0;s<Ln-1;s++)for(Jn[s]=i,e=0;e<1<<Hn[s];e++)Kn[i++]=s;for(Kn[i-1]=s,a=0,s=0;s<16;s++)for(Xn[s]=a,e=0;e<1<<qn[s];e++)Gn[a++]=s;for(a>>=7;s<Nn;s++)for(Xn[s]=a<<7,e=0;e<1<<qn[s]-7;e++)Gn[256+a++]=s;for(t=0;t<=Dn;t++)n[t]=0;for(e=0;e<=143;)jn[2*e+1]=8,e++,n[8]++;for(;e<=255;)jn[2*e+1]=9,e++,n[9]++;for(;e<=279;)jn[2*e+1]=7,e++,n[7]++;for(;e<=287;)jn[2*e+1]=8,e++,n[8]++;for(lo(jn,_n+1,n),e=0;e<Nn;e++)$n[2*e+1]=5,$n[2*e]=oo(e,5);Zn=new eo(jn,Hn,Tn+1,_n,Dn),Yn=new eo($n,qn,0,Nn,Dn),Qn=new eo(new Array(0),Bn,0,Rn,Vn)}(),Io=!0),e.l_desc=new to(e.dyn_ltree,Zn),e.d_desc=new to(e.dyn_dtree,Yn),e.bl_desc=new to(e.bl_tree,Qn),e.bi_buf=0,e.bi_valid=0,ro(e)},Sn._tr_stored_block=wo,Sn._tr_flush_block=function(e,t,i,s){var a,n,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return yn;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return Pn;for(t=32;t<Tn;t++)if(0!==e.dyn_ltree[2*t])return Pn;return yn}(e)),po(e,e.l_desc),po(e,e.d_desc),o=function(e){var t;for(go(e,e.dyn_ltree,e.l_desc.max_code),go(e,e.dyn_dtree,e.d_desc.max_code),po(e,e.bl_desc),t=Rn-1;t>=3&&0===e.bl_tree[2*zn[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),a=e.opt_len+3+7>>>3,(n=e.static_len+3+7>>>3)<=a&&(a=n)):a=n=i+5,i+4<=a&&-1!==t?wo(e,t,i,s):4===e.strategy||n===a?(ao(e,2+(s?1:0),3),uo(e,jn,$n)):(ao(e,4+(s?1:0),3),function(e,t,i,s){var a;for(ao(e,t-257,5),ao(e,i-1,5),ao(e,s-4,4),a=0;a<s;a++)ao(e,e.bl_tree[2*zn[a]+1],3);fo(e,e.dyn_ltree,t-1),fo(e,e.dyn_dtree,i-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),uo(e,e.dyn_ltree,e.dyn_dtree)),ro(e),s&&co(e)},Sn._tr_tally=function(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(Kn[i]+Tn+1)]++,e.dyn_dtree[2*io(t)]++),e.last_lit===e.lit_bufsize-1},Sn._tr_align=function(e){ao(e,2,3),no(e,Un,jn),function(e){16===e.bi_valid?(so(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)};var bo=function(e,t,i,s){for(var a=65535&e|0,n=e>>>16&65535|0,o=0;0!==i;){i-=o=i>2e3?2e3:i;do{n=n+(a=a+t[s++]|0)|0}while(--o);a%=65521,n%=65521}return a|n<<16|0};var vo=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}();var xo,So=function(e,t,i,s){var a=vo,n=s+i;e^=-1;for(var o=s;o<n;o++)e=e>>>8^a[255&(e^t[o])];return-1^e},Eo={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},yo=bn,Po=Sn,ko=bo,Co=So,Lo=Eo,To=0,_o=4,No=0,Ro=-2,Ao=-1,Do=4,Mo=2,Vo=8,Uo=9,Fo=286,Wo=30,Oo=19,Ho=2*Fo+1,qo=15,Bo=3,zo=258,jo=zo+Bo+1,$o=42,Go=103,Ko=113,Jo=666,Zo=1,Yo=2,Qo=3,Xo=4;function el(e,t){return e.msg=Lo[t],t}function tl(e){return(e<<1)-(e>4?9:0)}function il(e){for(var t=e.length;--t>=0;)e[t]=0}function sl(e){var t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(yo.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))}function al(e,t){Po._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,sl(e.strm)}function nl(e,t){e.pending_buf[e.pending++]=t}function ol(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function ll(e,t){var i,s,a=e.max_chain_length,n=e.strstart,o=e.prev_length,l=e.nice_match,r=e.strstart>e.w_size-jo?e.strstart-(e.w_size-jo):0,d=e.window,c=e.w_mask,h=e.prev,m=e.strstart+zo,u=d[n+o-1],p=d[n+o];e.prev_length>=e.good_match&&(a>>=2),l>e.lookahead&&(l=e.lookahead);do{if(d[(i=t)+o]===p&&d[i+o-1]===u&&d[i]===d[n]&&d[++i]===d[n+1]){n+=2,i++;do{}while(d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&n<m);if(s=zo-(m-n),n=m-zo,s>o){if(e.match_start=t,o=s,s>=l)break;u=d[n+o-1],p=d[n+o]}}}while((t=h[t&c])>r&&0!=--a);return o<=e.lookahead?o:e.lookahead}function rl(e){var t,i,s,a,n,o,l,r,d,c,h=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=h+(h-jo)){yo.arraySet(e.window,e.window,h,h,0),e.match_start-=h,e.strstart-=h,e.block_start-=h,t=i=e.hash_size;do{s=e.head[--t],e.head[t]=s>=h?s-h:0}while(--i);t=i=h;do{s=e.prev[--t],e.prev[t]=s>=h?s-h:0}while(--i);a+=h}if(0===e.strm.avail_in)break;if(o=e.strm,l=e.window,r=e.strstart+e.lookahead,d=a,c=void 0,(c=o.avail_in)>d&&(c=d),i=0===c?0:(o.avail_in-=c,yo.arraySet(l,o.input,o.next_in,c,r),1===o.state.wrap?o.adler=ko(o.adler,l,c,r):2===o.state.wrap&&(o.adler=Co(o.adler,l,c,r)),o.next_in+=c,o.total_in+=c,c),e.lookahead+=i,e.lookahead+e.insert>=Bo)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=(e.ins_h<<e.hash_shift^e.window[n+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[n+Bo-1])&e.hash_mask,e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<Bo)););}while(e.lookahead<jo&&0!==e.strm.avail_in)}function dl(e,t){for(var i,s;;){if(e.lookahead<jo){if(rl(e),e.lookahead<jo&&t===To)return Zo;if(0===e.lookahead)break}if(i=0,e.lookahead>=Bo&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+Bo-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-jo&&(e.match_length=ll(e,i)),e.match_length>=Bo)if(s=Po._tr_tally(e,e.strstart-e.match_start,e.match_length-Bo),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=Bo){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+Bo-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else s=Po._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(al(e,!1),0===e.strm.avail_out))return Zo}return e.insert=e.strstart<Bo-1?e.strstart:Bo-1,t===_o?(al(e,!0),0===e.strm.avail_out?Qo:Xo):e.last_lit&&(al(e,!1),0===e.strm.avail_out)?Zo:Yo}function cl(e,t){for(var i,s,a;;){if(e.lookahead<jo){if(rl(e),e.lookahead<jo&&t===To)return Zo;if(0===e.lookahead)break}if(i=0,e.lookahead>=Bo&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+Bo-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=Bo-1,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-jo&&(e.match_length=ll(e,i),e.match_length<=5&&(1===e.strategy||e.match_length===Bo&&e.strstart-e.match_start>4096)&&(e.match_length=Bo-1)),e.prev_length>=Bo&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-Bo,s=Po._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-Bo),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+Bo-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=Bo-1,e.strstart++,s&&(al(e,!1),0===e.strm.avail_out))return Zo}else if(e.match_available){if((s=Po._tr_tally(e,0,e.window[e.strstart-1]))&&al(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return Zo}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=Po._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<Bo-1?e.strstart:Bo-1,t===_o?(al(e,!0),0===e.strm.avail_out?Qo:Xo):e.last_lit&&(al(e,!1),0===e.strm.avail_out)?Zo:Yo}function hl(e,t,i,s,a){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=s,this.func=a}function ml(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Vo,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new yo.Buf16(2*Ho),this.dyn_dtree=new yo.Buf16(2*(2*Wo+1)),this.bl_tree=new yo.Buf16(2*(2*Oo+1)),il(this.dyn_ltree),il(this.dyn_dtree),il(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new yo.Buf16(qo+1),this.heap=new yo.Buf16(2*Fo+1),il(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new yo.Buf16(2*Fo+1),il(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ul(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=Mo,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?$o:Ko,e.adler=2===t.wrap?0:1,t.last_flush=To,Po._tr_init(t),No):el(e,Ro)}function pl(e){var t,i=ul(e);return i===No&&((t=e.state).window_size=2*t.w_size,il(t.head),t.max_lazy_match=xo[t.level].max_lazy,t.good_match=xo[t.level].good_length,t.nice_match=xo[t.level].nice_length,t.max_chain_length=xo[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=Bo-1,t.match_available=0,t.ins_h=0),i}function gl(e,t,i,s,a,n){if(!e)return Ro;var o=1;if(t===Ao&&(t=6),s<0?(o=0,s=-s):s>15&&(o=2,s-=16),a<1||a>Uo||i!==Vo||s<8||s>15||t<0||t>9||n<0||n>Do)return el(e,Ro);8===s&&(s=9);var l=new ml;return e.state=l,l.strm=e,l.wrap=o,l.gzhead=null,l.w_bits=s,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+Bo-1)/Bo),l.window=new yo.Buf8(2*l.w_size),l.head=new yo.Buf16(l.hash_size),l.prev=new yo.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new yo.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=n,l.method=i,pl(e)}xo=[new hl(0,0,0,0,(function(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(rl(e),0===e.lookahead&&t===To)return Zo;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var s=e.block_start+i;if((0===e.strstart||e.strstart>=s)&&(e.lookahead=e.strstart-s,e.strstart=s,al(e,!1),0===e.strm.avail_out))return Zo;if(e.strstart-e.block_start>=e.w_size-jo&&(al(e,!1),0===e.strm.avail_out))return Zo}return e.insert=0,t===_o?(al(e,!0),0===e.strm.avail_out?Qo:Xo):(e.strstart>e.block_start&&(al(e,!1),e.strm.avail_out),Zo)})),new hl(4,4,8,4,dl),new hl(4,5,16,8,dl),new hl(4,6,32,32,dl),new hl(4,4,16,16,cl),new hl(8,16,32,32,cl),new hl(8,16,128,128,cl),new hl(8,32,128,256,cl),new hl(32,128,258,1024,cl),new hl(32,258,258,4096,cl)],xn.deflateInit=function(e,t){return gl(e,t,Vo,15,8,0)},xn.deflateInit2=gl,xn.deflateReset=pl,xn.deflateResetKeep=ul,xn.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?Ro:(e.state.gzhead=t,No):Ro},xn.deflate=function(e,t){var i,s,a,n;if(!e||!e.state||t>5||t<0)return e?el(e,Ro):Ro;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||s.status===Jo&&t!==_o)return el(e,0===e.avail_out?-5:Ro);if(s.strm=e,i=s.last_flush,s.last_flush=t,s.status===$o)if(2===s.wrap)e.adler=0,nl(s,31),nl(s,139),nl(s,8),s.gzhead?(nl(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),nl(s,255&s.gzhead.time),nl(s,s.gzhead.time>>8&255),nl(s,s.gzhead.time>>16&255),nl(s,s.gzhead.time>>24&255),nl(s,9===s.level?2:s.strategy>=2||s.level<2?4:0),nl(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(nl(s,255&s.gzhead.extra.length),nl(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=Co(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69):(nl(s,0),nl(s,0),nl(s,0),nl(s,0),nl(s,0),nl(s,9===s.level?2:s.strategy>=2||s.level<2?4:0),nl(s,3),s.status=Ko);else{var o=Vo+(s.w_bits-8<<4)<<8;o|=(s.strategy>=2||s.level<2?0:s.level<6?1:6===s.level?2:3)<<6,0!==s.strstart&&(o|=32),o+=31-o%31,s.status=Ko,ol(s,o),0!==s.strstart&&(ol(s,e.adler>>>16),ol(s,65535&e.adler)),e.adler=1}if(69===s.status)if(s.gzhead.extra){for(a=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>a&&(e.adler=Co(e.adler,s.pending_buf,s.pending-a,a)),sl(e),a=s.pending,s.pending!==s.pending_buf_size));)nl(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>a&&(e.adler=Co(e.adler,s.pending_buf,s.pending-a,a)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=73)}else s.status=73;if(73===s.status)if(s.gzhead.name){a=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>a&&(e.adler=Co(e.adler,s.pending_buf,s.pending-a,a)),sl(e),a=s.pending,s.pending===s.pending_buf_size)){n=1;break}n=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,nl(s,n)}while(0!==n);s.gzhead.hcrc&&s.pending>a&&(e.adler=Co(e.adler,s.pending_buf,s.pending-a,a)),0===n&&(s.gzindex=0,s.status=91)}else s.status=91;if(91===s.status)if(s.gzhead.comment){a=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>a&&(e.adler=Co(e.adler,s.pending_buf,s.pending-a,a)),sl(e),a=s.pending,s.pending===s.pending_buf_size)){n=1;break}n=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,nl(s,n)}while(0!==n);s.gzhead.hcrc&&s.pending>a&&(e.adler=Co(e.adler,s.pending_buf,s.pending-a,a)),0===n&&(s.status=Go)}else s.status=Go;if(s.status===Go&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&sl(e),s.pending+2<=s.pending_buf_size&&(nl(s,255&e.adler),nl(s,e.adler>>8&255),e.adler=0,s.status=Ko)):s.status=Ko),0!==s.pending){if(sl(e),0===e.avail_out)return s.last_flush=-1,No}else if(0===e.avail_in&&tl(t)<=tl(i)&&t!==_o)return el(e,-5);if(s.status===Jo&&0!==e.avail_in)return el(e,-5);if(0!==e.avail_in||0!==s.lookahead||t!==To&&s.status!==Jo){var l=2===s.strategy?function(e,t){for(var i;;){if(0===e.lookahead&&(rl(e),0===e.lookahead)){if(t===To)return Zo;break}if(e.match_length=0,i=Po._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(al(e,!1),0===e.strm.avail_out))return Zo}return e.insert=0,t===_o?(al(e,!0),0===e.strm.avail_out?Qo:Xo):e.last_lit&&(al(e,!1),0===e.strm.avail_out)?Zo:Yo}(s,t):3===s.strategy?function(e,t){for(var i,s,a,n,o=e.window;;){if(e.lookahead<=zo){if(rl(e),e.lookahead<=zo&&t===To)return Zo;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=Bo&&e.strstart>0&&(s=o[a=e.strstart-1])===o[++a]&&s===o[++a]&&s===o[++a]){n=e.strstart+zo;do{}while(s===o[++a]&&s===o[++a]&&s===o[++a]&&s===o[++a]&&s===o[++a]&&s===o[++a]&&s===o[++a]&&s===o[++a]&&a<n);e.match_length=zo-(n-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=Bo?(i=Po._tr_tally(e,1,e.match_length-Bo),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=Po._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(al(e,!1),0===e.strm.avail_out))return Zo}return e.insert=0,t===_o?(al(e,!0),0===e.strm.avail_out?Qo:Xo):e.last_lit&&(al(e,!1),0===e.strm.avail_out)?Zo:Yo}(s,t):xo[s.level].func(s,t);if(l!==Qo&&l!==Xo||(s.status=Jo),l===Zo||l===Qo)return 0===e.avail_out&&(s.last_flush=-1),No;if(l===Yo&&(1===t?Po._tr_align(s):5!==t&&(Po._tr_stored_block(s,0,0,!1),3===t&&(il(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),sl(e),0===e.avail_out))return s.last_flush=-1,No}return t!==_o?No:s.wrap<=0?1:(2===s.wrap?(nl(s,255&e.adler),nl(s,e.adler>>8&255),nl(s,e.adler>>16&255),nl(s,e.adler>>24&255),nl(s,255&e.total_in),nl(s,e.total_in>>8&255),nl(s,e.total_in>>16&255),nl(s,e.total_in>>24&255)):(ol(s,e.adler>>>16),ol(s,65535&e.adler)),sl(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?No:1)},xn.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==$o&&69!==t&&73!==t&&91!==t&&t!==Go&&t!==Ko&&t!==Jo?el(e,Ro):(e.state=null,t===Ko?el(e,-3):No):Ro},xn.deflateSetDictionary=function(e,t){var i,s,a,n,o,l,r,d,c=t.length;if(!e||!e.state)return Ro;if(2===(n=(i=e.state).wrap)||1===n&&i.status!==$o||i.lookahead)return Ro;for(1===n&&(e.adler=ko(e.adler,t,c,0)),i.wrap=0,c>=i.w_size&&(0===n&&(il(i.head),i.strstart=0,i.block_start=0,i.insert=0),d=new yo.Buf8(i.w_size),yo.arraySet(d,t,c-i.w_size,i.w_size,0),t=d,c=i.w_size),o=e.avail_in,l=e.next_in,r=e.input,e.avail_in=c,e.next_in=0,e.input=t,rl(i);i.lookahead>=Bo;){s=i.strstart,a=i.lookahead-(Bo-1);do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[s+Bo-1])&i.hash_mask,i.prev[s&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=s,s++}while(--a);i.strstart=s,i.lookahead=Bo-1,rl(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=Bo-1,i.match_available=0,e.next_in=l,e.input=r,e.avail_in=o,i.wrap=n,No},xn.deflateInfo="pako deflate (from Nodeca project)";var fl={},Il=bn,wl=!0,bl=!0;try{String.fromCharCode.apply(null,[0])}catch(Xu){wl=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Xu){bl=!1}for(var vl=new Il.Buf8(256),xl=0;xl<256;xl++)vl[xl]=xl>=252?6:xl>=248?5:xl>=240?4:xl>=224?3:xl>=192?2:1;function Sl(e,t){if(t<65534&&(e.subarray&&bl||!e.subarray&&wl))return String.fromCharCode.apply(null,Il.shrinkBuf(e,t));for(var i="",s=0;s<t;s++)i+=String.fromCharCode(e[s]);return i}vl[254]=vl[254]=1,fl.string2buf=function(e){var t,i,s,a,n,o=e.length,l=0;for(a=0;a<o;a++)55296==(64512&(i=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(s=e.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(s-56320),a++),l+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Il.Buf8(l),n=0,a=0;n<l;a++)55296==(64512&(i=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(s=e.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(s-56320),a++),i<128?t[n++]=i:i<2048?(t[n++]=192|i>>>6,t[n++]=128|63&i):i<65536?(t[n++]=224|i>>>12,t[n++]=128|i>>>6&63,t[n++]=128|63&i):(t[n++]=240|i>>>18,t[n++]=128|i>>>12&63,t[n++]=128|i>>>6&63,t[n++]=128|63&i);return t},fl.buf2binstring=function(e){return Sl(e,e.length)},fl.binstring2buf=function(e){for(var t=new Il.Buf8(e.length),i=0,s=t.length;i<s;i++)t[i]=e.charCodeAt(i);return t},fl.buf2string=function(e,t){var i,s,a,n,o=t||e.length,l=new Array(2*o);for(s=0,i=0;i<o;)if((a=e[i++])<128)l[s++]=a;else if((n=vl[a])>4)l[s++]=65533,i+=n-1;else{for(a&=2===n?31:3===n?15:7;n>1&&i<o;)a=a<<6|63&e[i++],n--;n>1?l[s++]=65533:a<65536?l[s++]=a:(a-=65536,l[s++]=55296|a>>10&1023,l[s++]=56320|1023&a)}return Sl(l,s)},fl.utf8border=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+vl[e[i]]>t?i:t};var El=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},yl=xn,Pl=bn,kl=fl,Cl=Eo,Ll=El,Tl=Object.prototype.toString,_l=0,Nl=-1,Rl=0,Al=8;function Dl(e){if(!(this instanceof Dl))return new Dl(e);this.options=Pl.assign({level:Nl,method:Al,chunkSize:16384,windowBits:15,memLevel:8,strategy:Rl,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ll,this.strm.avail_out=0;var i=yl.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==_l)throw new Error(Cl[i]);if(t.header&&yl.deflateSetHeader(this.strm,t.header),t.dictionary){var s;if(s="string"==typeof t.dictionary?kl.string2buf(t.dictionary):"[object ArrayBuffer]"===Tl.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(i=yl.deflateSetDictionary(this.strm,s))!==_l)throw new Error(Cl[i]);this._dict_set=!0}}function Ml(e,t){var i=new Dl(t);if(i.push(e,!0),i.err)throw i.msg||Cl[i.err];return i.result}Dl.prototype.push=function(e,t){var i,s,a=this.strm,n=this.options.chunkSize;if(this.ended)return!1;s=t===~~t?t:!0===t?4:0,"string"==typeof e?a.input=kl.string2buf(e):"[object ArrayBuffer]"===Tl.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new Pl.Buf8(n),a.next_out=0,a.avail_out=n),1!==(i=yl.deflate(a,s))&&i!==_l)return this.onEnd(i),this.ended=!0,!1;0!==a.avail_out&&(0!==a.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(kl.buf2binstring(Pl.shrinkBuf(a.output,a.next_out))):this.onData(Pl.shrinkBuf(a.output,a.next_out)))}while((a.avail_in>0||0===a.avail_out)&&1!==i);return 4===s?(i=yl.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===_l):2!==s||(this.onEnd(_l),a.avail_out=0,!0)},Dl.prototype.onData=function(e){this.chunks.push(e)},Dl.prototype.onEnd=function(e){e===_l&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Pl.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},vn.Deflate=Dl,vn.deflate=Ml,vn.deflateRaw=function(e,t){return(t=t||{}).raw=!0,Ml(e,t)},vn.gzip=function(e,t){return(t=t||{}).gzip=!0,Ml(e,t)};var Vl={},Ul={},Fl=bn,Wl=15,Ol=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Hl=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],ql=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Bl=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],zl=bn,jl=bo,$l=So,Gl=function(e,t){var i,s,a,n,o,l,r,d,c,h,m,u,p,g,f,I,w,b,v,x,S,E,y,P,k;i=e.state,s=e.next_in,P=e.input,a=s+(e.avail_in-5),n=e.next_out,k=e.output,o=n-(t-e.avail_out),l=n+(e.avail_out-257),r=i.dmax,d=i.wsize,c=i.whave,h=i.wnext,m=i.window,u=i.hold,p=i.bits,g=i.lencode,f=i.distcode,I=(1<<i.lenbits)-1,w=(1<<i.distbits)-1;e:do{p<15&&(u+=P[s++]<<p,p+=8,u+=P[s++]<<p,p+=8),b=g[u&I];t:for(;;){if(u>>>=v=b>>>24,p-=v,0===(v=b>>>16&255))k[n++]=65535&b;else{if(!(16&v)){if(0==(64&v)){b=g[(65535&b)+(u&(1<<v)-1)];continue t}if(32&v){i.mode=12;break e}e.msg="invalid literal/length code",i.mode=30;break e}x=65535&b,(v&=15)&&(p<v&&(u+=P[s++]<<p,p+=8),x+=u&(1<<v)-1,u>>>=v,p-=v),p<15&&(u+=P[s++]<<p,p+=8,u+=P[s++]<<p,p+=8),b=f[u&w];i:for(;;){if(u>>>=v=b>>>24,p-=v,!(16&(v=b>>>16&255))){if(0==(64&v)){b=f[(65535&b)+(u&(1<<v)-1)];continue i}e.msg="invalid distance code",i.mode=30;break e}if(S=65535&b,p<(v&=15)&&(u+=P[s++]<<p,(p+=8)<v&&(u+=P[s++]<<p,p+=8)),(S+=u&(1<<v)-1)>r){e.msg="invalid distance too far back",i.mode=30;break e}if(u>>>=v,p-=v,S>(v=n-o)){if((v=S-v)>c&&i.sane){e.msg="invalid distance too far back",i.mode=30;break e}if(E=0,y=m,0===h){if(E+=d-v,v<x){x-=v;do{k[n++]=m[E++]}while(--v);E=n-S,y=k}}else if(h<v){if(E+=d+h-v,(v-=h)<x){x-=v;do{k[n++]=m[E++]}while(--v);if(E=0,h<x){x-=v=h;do{k[n++]=m[E++]}while(--v);E=n-S,y=k}}}else if(E+=h-v,v<x){x-=v;do{k[n++]=m[E++]}while(--v);E=n-S,y=k}for(;x>2;)k[n++]=y[E++],k[n++]=y[E++],k[n++]=y[E++],x-=3;x&&(k[n++]=y[E++],x>1&&(k[n++]=y[E++]))}else{E=n-S;do{k[n++]=k[E++],k[n++]=k[E++],k[n++]=k[E++],x-=3}while(x>2);x&&(k[n++]=k[E++],x>1&&(k[n++]=k[E++]))}break}}break}}while(s<a&&n<l);s-=x=p>>3,u&=(1<<(p-=x<<3))-1,e.next_in=s,e.next_out=n,e.avail_in=s<a?a-s+5:5-(s-a),e.avail_out=n<l?l-n+257:257-(n-l),i.hold=u,i.bits=p},Kl=function(e,t,i,s,a,n,o,l){var r,d,c,h,m,u,p,g,f,I=l.bits,w=0,b=0,v=0,x=0,S=0,E=0,y=0,P=0,k=0,C=0,L=null,T=0,_=new Fl.Buf16(16),N=new Fl.Buf16(16),R=null,A=0;for(w=0;w<=Wl;w++)_[w]=0;for(b=0;b<s;b++)_[t[i+b]]++;for(S=I,x=Wl;x>=1&&0===_[x];x--);if(S>x&&(S=x),0===x)return a[n++]=20971520,a[n++]=20971520,l.bits=1,0;for(v=1;v<x&&0===_[v];v++);for(S<v&&(S=v),P=1,w=1;w<=Wl;w++)if(P<<=1,(P-=_[w])<0)return-1;if(P>0&&(0===e||1!==x))return-1;for(N[1]=0,w=1;w<Wl;w++)N[w+1]=N[w]+_[w];for(b=0;b<s;b++)0!==t[i+b]&&(o[N[t[i+b]]++]=b);if(0===e?(L=R=o,u=19):1===e?(L=Ol,T-=257,R=Hl,A-=257,u=256):(L=ql,R=Bl,u=-1),C=0,b=0,w=v,m=n,E=S,y=0,c=-1,h=(k=1<<S)-1,1===e&&k>852||2===e&&k>592)return 1;for(;;){p=w-y,o[b]<u?(g=0,f=o[b]):o[b]>u?(g=R[A+o[b]],f=L[T+o[b]]):(g=96,f=0),r=1<<w-y,v=d=1<<E;do{a[m+(C>>y)+(d-=r)]=p<<24|g<<16|f|0}while(0!==d);for(r=1<<w-1;C&r;)r>>=1;if(0!==r?(C&=r-1,C+=r):C=0,b++,0==--_[w]){if(w===x)break;w=t[i+o[b]]}if(w>S&&(C&h)!==c){for(0===y&&(y=S),m+=v,P=1<<(E=w-y);E+y<x&&!((P-=_[E+y])<=0);)E++,P<<=1;if(k+=1<<E,1===e&&k>852||2===e&&k>592)return 1;a[c=C&h]=S<<24|E<<16|m-n|0}}return 0!==C&&(a[m+C]=w-y<<24|64<<16|0),l.bits=S,0},Jl=1,Zl=2,Yl=0,Ql=-2,Xl=1,er=12,tr=30,ir=852,sr=592;function ar(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function nr(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new zl.Buf16(320),this.work=new zl.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function or(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Xl,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new zl.Buf32(ir),t.distcode=t.distdyn=new zl.Buf32(sr),t.sane=1,t.back=-1,Yl):Ql}function lr(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,or(e)):Ql}function rr(e,t){var i,s;return e&&e.state?(s=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Ql:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=i,s.wbits=t,lr(e))):Ql}function dr(e,t){var i,s;return e?(s=new nr,e.state=s,s.window=null,(i=rr(e,t))!==Yl&&(e.state=null),i):Ql}var cr,hr,mr=!0;function ur(e){if(mr){var t;for(cr=new zl.Buf32(512),hr=new zl.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Kl(Jl,e.lens,0,288,cr,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Kl(Zl,e.lens,0,32,hr,0,e.work,{bits:5}),mr=!1}e.lencode=cr,e.lenbits=9,e.distcode=hr,e.distbits=5}function pr(e,t,i,s){var a,n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new zl.Buf8(n.wsize)),s>=n.wsize?(zl.arraySet(n.window,t,i-n.wsize,n.wsize,0),n.wnext=0,n.whave=n.wsize):((a=n.wsize-n.wnext)>s&&(a=s),zl.arraySet(n.window,t,i-s,a,n.wnext),(s-=a)?(zl.arraySet(n.window,t,i-s,s,0),n.wnext=s,n.whave=n.wsize):(n.wnext+=a,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=a))),0}Ul.inflateReset=lr,Ul.inflateReset2=rr,Ul.inflateResetKeep=or,Ul.inflateInit=function(e){return dr(e,15)},Ul.inflateInit2=dr,Ul.inflate=function(e,t){var i,s,a,n,o,l,r,d,c,h,m,u,p,g,f,I,w,b,v,x,S,E,y,P,k=0,C=new zl.Buf8(4),L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return Ql;(i=e.state).mode===er&&(i.mode=13),o=e.next_out,a=e.output,r=e.avail_out,n=e.next_in,s=e.input,l=e.avail_in,d=i.hold,c=i.bits,h=l,m=r,E=Yl;e:for(;;)switch(i.mode){case Xl:if(0===i.wrap){i.mode=13;break}for(;c<16;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}if(2&i.wrap&&35615===d){i.check=0,C[0]=255&d,C[1]=d>>>8&255,i.check=$l(i.check,C,2,0),d=0,c=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",i.mode=tr;break}if(8!=(15&d)){e.msg="unknown compression method",i.mode=tr;break}if(c-=4,S=8+(15&(d>>>=4)),0===i.wbits)i.wbits=S;else if(S>i.wbits){e.msg="invalid window size",i.mode=tr;break}i.dmax=1<<S,e.adler=i.check=1,i.mode=512&d?10:er,d=0,c=0;break;case 2:for(;c<16;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}if(i.flags=d,8!=(255&i.flags)){e.msg="unknown compression method",i.mode=tr;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=tr;break}i.head&&(i.head.text=d>>8&1),512&i.flags&&(C[0]=255&d,C[1]=d>>>8&255,i.check=$l(i.check,C,2,0)),d=0,c=0,i.mode=3;case 3:for(;c<32;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}i.head&&(i.head.time=d),512&i.flags&&(C[0]=255&d,C[1]=d>>>8&255,C[2]=d>>>16&255,C[3]=d>>>24&255,i.check=$l(i.check,C,4,0)),d=0,c=0,i.mode=4;case 4:for(;c<16;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}i.head&&(i.head.xflags=255&d,i.head.os=d>>8),512&i.flags&&(C[0]=255&d,C[1]=d>>>8&255,i.check=$l(i.check,C,2,0)),d=0,c=0,i.mode=5;case 5:if(1024&i.flags){for(;c<16;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}i.length=d,i.head&&(i.head.extra_len=d),512&i.flags&&(C[0]=255&d,C[1]=d>>>8&255,i.check=$l(i.check,C,2,0)),d=0,c=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&((u=i.length)>l&&(u=l),u&&(i.head&&(S=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),zl.arraySet(i.head.extra,s,n,u,S)),512&i.flags&&(i.check=$l(i.check,s,u,n)),l-=u,n+=u,i.length-=u),i.length))break e;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===l)break e;u=0;do{S=s[n+u++],i.head&&S&&i.length<65536&&(i.head.name+=String.fromCharCode(S))}while(S&&u<l);if(512&i.flags&&(i.check=$l(i.check,s,u,n)),l-=u,n+=u,S)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===l)break e;u=0;do{S=s[n+u++],i.head&&S&&i.length<65536&&(i.head.comment+=String.fromCharCode(S))}while(S&&u<l);if(512&i.flags&&(i.check=$l(i.check,s,u,n)),l-=u,n+=u,S)break e}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;c<16;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}if(d!==(65535&i.check)){e.msg="header crc mismatch",i.mode=tr;break}d=0,c=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=er;break;case 10:for(;c<32;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}e.adler=i.check=ar(d),d=0,c=0,i.mode=11;case 11:if(0===i.havedict)return e.next_out=o,e.avail_out=r,e.next_in=n,e.avail_in=l,i.hold=d,i.bits=c,2;e.adler=i.check=1,i.mode=er;case er:if(5===t||6===t)break e;case 13:if(i.last){d>>>=7&c,c-=7&c,i.mode=27;break}for(;c<3;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}switch(i.last=1&d,c-=1,3&(d>>>=1)){case 0:i.mode=14;break;case 1:if(ur(i),i.mode=20,6===t){d>>>=2,c-=2;break e}break;case 2:i.mode=17;break;case 3:e.msg="invalid block type",i.mode=tr}d>>>=2,c-=2;break;case 14:for(d>>>=7&c,c-=7&c;c<32;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}if((65535&d)!=(d>>>16^65535)){e.msg="invalid stored block lengths",i.mode=tr;break}if(i.length=65535&d,d=0,c=0,i.mode=15,6===t)break e;case 15:i.mode=16;case 16:if(u=i.length){if(u>l&&(u=l),u>r&&(u=r),0===u)break e;zl.arraySet(a,s,n,u,o),l-=u,n+=u,r-=u,o+=u,i.length-=u;break}i.mode=er;break;case 17:for(;c<14;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}if(i.nlen=257+(31&d),d>>>=5,c-=5,i.ndist=1+(31&d),d>>>=5,c-=5,i.ncode=4+(15&d),d>>>=4,c-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=tr;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;c<3;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}i.lens[L[i.have++]]=7&d,d>>>=3,c-=3}for(;i.have<19;)i.lens[L[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,y={bits:i.lenbits},E=Kl(0,i.lens,0,19,i.lencode,0,i.work,y),i.lenbits=y.bits,E){e.msg="invalid code lengths set",i.mode=tr;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;I=(k=i.lencode[d&(1<<i.lenbits)-1])>>>16&255,w=65535&k,!((f=k>>>24)<=c);){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}if(w<16)d>>>=f,c-=f,i.lens[i.have++]=w;else{if(16===w){for(P=f+2;c<P;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}if(d>>>=f,c-=f,0===i.have){e.msg="invalid bit length repeat",i.mode=tr;break}S=i.lens[i.have-1],u=3+(3&d),d>>>=2,c-=2}else if(17===w){for(P=f+3;c<P;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}c-=f,S=0,u=3+(7&(d>>>=f)),d>>>=3,c-=3}else{for(P=f+7;c<P;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}c-=f,S=0,u=11+(127&(d>>>=f)),d>>>=7,c-=7}if(i.have+u>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=tr;break}for(;u--;)i.lens[i.have++]=S}}if(i.mode===tr)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=tr;break}if(i.lenbits=9,y={bits:i.lenbits},E=Kl(Jl,i.lens,0,i.nlen,i.lencode,0,i.work,y),i.lenbits=y.bits,E){e.msg="invalid literal/lengths set",i.mode=tr;break}if(i.distbits=6,i.distcode=i.distdyn,y={bits:i.distbits},E=Kl(Zl,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,y),i.distbits=y.bits,E){e.msg="invalid distances set",i.mode=tr;break}if(i.mode=20,6===t)break e;case 20:i.mode=21;case 21:if(l>=6&&r>=258){e.next_out=o,e.avail_out=r,e.next_in=n,e.avail_in=l,i.hold=d,i.bits=c,Gl(e,m),o=e.next_out,a=e.output,r=e.avail_out,n=e.next_in,s=e.input,l=e.avail_in,d=i.hold,c=i.bits,i.mode===er&&(i.back=-1);break}for(i.back=0;I=(k=i.lencode[d&(1<<i.lenbits)-1])>>>16&255,w=65535&k,!((f=k>>>24)<=c);){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}if(I&&0==(240&I)){for(b=f,v=I,x=w;I=(k=i.lencode[x+((d&(1<<b+v)-1)>>b)])>>>16&255,w=65535&k,!(b+(f=k>>>24)<=c);){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}d>>>=b,c-=b,i.back+=b}if(d>>>=f,c-=f,i.back+=f,i.length=w,0===I){i.mode=26;break}if(32&I){i.back=-1,i.mode=er;break}if(64&I){e.msg="invalid literal/length code",i.mode=tr;break}i.extra=15&I,i.mode=22;case 22:if(i.extra){for(P=i.extra;c<P;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}i.length+=d&(1<<i.extra)-1,d>>>=i.extra,c-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;I=(k=i.distcode[d&(1<<i.distbits)-1])>>>16&255,w=65535&k,!((f=k>>>24)<=c);){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}if(0==(240&I)){for(b=f,v=I,x=w;I=(k=i.distcode[x+((d&(1<<b+v)-1)>>b)])>>>16&255,w=65535&k,!(b+(f=k>>>24)<=c);){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}d>>>=b,c-=b,i.back+=b}if(d>>>=f,c-=f,i.back+=f,64&I){e.msg="invalid distance code",i.mode=tr;break}i.offset=w,i.extra=15&I,i.mode=24;case 24:if(i.extra){for(P=i.extra;c<P;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}i.offset+=d&(1<<i.extra)-1,d>>>=i.extra,c-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=tr;break}i.mode=25;case 25:if(0===r)break e;if(u=m-r,i.offset>u){if((u=i.offset-u)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=tr;break}u>i.wnext?(u-=i.wnext,p=i.wsize-u):p=i.wnext-u,u>i.length&&(u=i.length),g=i.window}else g=a,p=o-i.offset,u=i.length;u>r&&(u=r),r-=u,i.length-=u;do{a[o++]=g[p++]}while(--u);0===i.length&&(i.mode=21);break;case 26:if(0===r)break e;a[o++]=i.length,r--,i.mode=21;break;case 27:if(i.wrap){for(;c<32;){if(0===l)break e;l--,d|=s[n++]<<c,c+=8}if(m-=r,e.total_out+=m,i.total+=m,m&&(e.adler=i.check=i.flags?$l(i.check,a,m,o-m):jl(i.check,a,m,o-m)),m=r,(i.flags?d:ar(d))!==i.check){e.msg="incorrect data check",i.mode=tr;break}d=0,c=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;c<32;){if(0===l)break e;l--,d+=s[n++]<<c,c+=8}if(d!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=tr;break}d=0,c=0}i.mode=29;case 29:E=1;break e;case tr:E=-3;break e;case 31:return-4;default:return Ql}return e.next_out=o,e.avail_out=r,e.next_in=n,e.avail_in=l,i.hold=d,i.bits=c,(i.wsize||m!==e.avail_out&&i.mode<tr&&(i.mode<27||4!==t))&&pr(e,e.output,e.next_out,m-e.avail_out),h-=e.avail_in,m-=e.avail_out,e.total_in+=h,e.total_out+=m,i.total+=m,i.wrap&&m&&(e.adler=i.check=i.flags?$l(i.check,a,m,e.next_out-m):jl(i.check,a,m,e.next_out-m)),e.data_type=i.bits+(i.last?64:0)+(i.mode===er?128:0)+(20===i.mode||15===i.mode?256:0),(0===h&&0===m||4===t)&&E===Yl&&(E=-5),E},Ul.inflateEnd=function(e){if(!e||!e.state)return Ql;var t=e.state;return t.window&&(t.window=null),e.state=null,Yl},Ul.inflateGetHeader=function(e,t){var i;return e&&e.state?0==(2&(i=e.state).wrap)?Ql:(i.head=t,t.done=!1,Yl):Ql},Ul.inflateSetDictionary=function(e,t){var i,s=t.length;return e&&e.state?0!==(i=e.state).wrap&&11!==i.mode?Ql:11===i.mode&&jl(1,t,s,0)!==i.check?-3:pr(e,t,s,s)?(i.mode=31,-4):(i.havedict=1,Yl):Ql},Ul.inflateInfo="pako inflate (from Nodeca project)";var gr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};var fr=Ul,Ir=bn,wr=fl,br=gr,vr=Eo,xr=El,Sr=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Er=Object.prototype.toString;function yr(e){if(!(this instanceof yr))return new yr(e);this.options=Ir.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new xr,this.strm.avail_out=0;var i=fr.inflateInit2(this.strm,t.windowBits);if(i!==br.Z_OK)throw new Error(vr[i]);if(this.header=new Sr,fr.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=wr.string2buf(t.dictionary):"[object ArrayBuffer]"===Er.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=fr.inflateSetDictionary(this.strm,t.dictionary))!==br.Z_OK))throw new Error(vr[i])}function Pr(e,t){var i=new yr(t);if(i.push(e,!0),i.err)throw i.msg||vr[i.err];return i.result}yr.prototype.push=function(e,t){var i,s,a,n,o,l=this.strm,r=this.options.chunkSize,d=this.options.dictionary,c=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?br.Z_FINISH:br.Z_NO_FLUSH,"string"==typeof e?l.input=wr.binstring2buf(e):"[object ArrayBuffer]"===Er.call(e)?l.input=new Uint8Array(e):l.input=e,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new Ir.Buf8(r),l.next_out=0,l.avail_out=r),(i=fr.inflate(l,br.Z_NO_FLUSH))===br.Z_NEED_DICT&&d&&(i=fr.inflateSetDictionary(this.strm,d)),i===br.Z_BUF_ERROR&&!0===c&&(i=br.Z_OK,c=!1),i!==br.Z_STREAM_END&&i!==br.Z_OK)return this.onEnd(i),this.ended=!0,!1;l.next_out&&(0!==l.avail_out&&i!==br.Z_STREAM_END&&(0!==l.avail_in||s!==br.Z_FINISH&&s!==br.Z_SYNC_FLUSH)||("string"===this.options.to?(a=wr.utf8border(l.output,l.next_out),n=l.next_out-a,o=wr.buf2string(l.output,a),l.next_out=n,l.avail_out=r-n,n&&Ir.arraySet(l.output,l.output,a,n,0),this.onData(o)):this.onData(Ir.shrinkBuf(l.output,l.next_out)))),0===l.avail_in&&0===l.avail_out&&(c=!0)}while((l.avail_in>0||0===l.avail_out)&&i!==br.Z_STREAM_END);return i===br.Z_STREAM_END&&(s=br.Z_FINISH),s===br.Z_FINISH?(i=fr.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===br.Z_OK):s!==br.Z_SYNC_FLUSH||(this.onEnd(br.Z_OK),l.avail_out=0,!0)},yr.prototype.onData=function(e){this.chunks.push(e)},yr.prototype.onEnd=function(e){e===br.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ir.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},Vl.Inflate=yr,Vl.inflate=Pr,Vl.inflateRaw=function(e,t){return(t=t||{}).raw=!0,Pr(e,t)},Vl.ungzip=Pr;var kr={};(0,bn.assign)(kr,vn,Vl,gr);var Cr=kr;class Lr extends dn{constructor(e,i,s,a){super(e,"importer",{title:s,footer:!0}),t(this,"textElem"),t(this,"descriptionElem"),t(this,"importButton"),t(this,"includeFile"),this.includeFile=a;const n="upload-input-"+s.toLowerCase().replaceAll(" ","-");if(this.body.innerHTML='\n\t\t\t<div class="import-description"></div>\n\t\t\t<textarea spellCheck="false" class="importer-textarea form-control"></textarea>\n\t\t',this.footer.innerHTML=`\n\t\t\t${this.includeFile?`\n\t\t\t\t<label for="${n}" class="importer-button btn btn-primary upload-button me-2">\n\t\t\t\t\t<i class="fas fa-file-arrow-up"></i>\n\t\t\t\t\tUpload File\n\t\t\t\t</label>\n\t\t\t\t<input type="file" id="${n}" class="importer-upload-input d-none" hidden>\n\t\t\t`:""}\n\t\t\t<button class="importer-button btn btn-primary import-button">\n\t\t\t\t<i class="fa fa-download"></i>\n\t\t\t\tImport\n\t\t\t</button>\n\t\t`,this.textElem=this.rootElem.getElementsByClassName("importer-textarea")[0],this.descriptionElem=this.rootElem.getElementsByClassName("import-description")[0],this.includeFile){this.rootElem.getElementsByClassName("importer-upload-input")[0].addEventListener("change",(async e=>{const t=await e.target.files[0].text();this.textElem.textContent=t}))}this.importButton=this.rootElem.getElementsByClassName("import-button")[0],this.importButton.addEventListener("click",(()=>{try{this.onImport(this.textElem.value||"")}catch(e){alert("Import error: "+e)}}))}async finishIndividualImport(e,t,i,s,a,n){const o=e.player.getClass();if(t!=o)throw new Error(`Wrong Class! Expected ${wt.get(o)} but found ${wt.get(t)}!`);await ae.loadLeftoversIfNecessary(s);const l=e.sim.db.lookupEquipmentSpec(s),r=s.items.map((e=>e.enchant)),d=l.asSpec().items.map((e=>e.enchant)),c=r.filter((e=>0!=e&&!d.includes(e))),h=s.items.map((e=>e.id)),u=l.asSpec().items.map((e=>e.id)),p=h.filter((e=>!u.includes(e))),g=m.nextEventID();m.freezeAllAndDo((()=>{e.player.setRace(g,i),e.player.setGear(g,l),a&&"--"!=a&&e.player.setTalentsString(g,a),n.length>0&&e.player.setProfessions(g,n)})),this.close(),0==p.length&&0==c.length?alert("Import successful!"):alert("Import successful, but the following IDs were not found in the sim database:"+(0==p.length?"":"\n\nItems: "+p.join(", "))+(0==c.length?"":"\n\nEnchants: "+c.join(", ")))}}const Tr=class{static tryParseUrlLocation(e){let t=e.hash;if(t.length<=1)return null;t=t.substring(1);const i=atob(t),s=new Uint8Array(i.length);for(let r=0;r<s.length;r++)s[r]=i.charCodeAt(r);const a=Cr.inflate(s),n=ht.fromBinary(a);let o=Tr.DEFAULT_CATEGORIES;const l=new URLSearchParams(window.location.search);if(l.has(Tr.CATEGORY_PARAM)){o=l.get(Tr.CATEGORY_PARAM).split("").map((e=>[...Tr.CATEGORY_KEYS.entries()].find((t=>t[1]==e)))).filter((e=>e)).map((e=>e[0]))}return{settings:n,categories:o}}};let _r=Tr;t(_r,"DEFAULT_CATEGORIES",i(Za).filter((e=>e!=Za.UISettings))),t(_r,"CATEGORY_PARAM","i"),t(_r,"CATEGORY_KEYS",(()=>{const e=new Map;return e.set(Za.Gear,"g"),e.set(Za.Talents,"t"),e.set(Za.Rotation,"r"),e.set(Za.Consumes,"c"),e.set(Za.Miscellaneous,"m"),e.set(Za.External,"x"),e.set(Za.Encounter,"e"),e.set(Za.UISettings,"u"),e})());class Nr extends Lr{constructor(e,i){super(e,i,"JSON Import",!0),t(this,"simUI"),this.simUI=i,this.descriptionElem.innerHTML="\n\t\t\t<p>Import settings from a JSON file, which can be created using the JSON Export feature.</p>\n\t\t\t<p>To import, upload the file or paste the text below, then click, 'Import'.</p>\n\t\t"}async onImport(e){const t=ht.fromJsonString(e,{ignoreUnknownFields:!0});t.player?.equipment&&await ae.loadLeftoversIfNecessary(t.player.equipment),this.simUI.isWithinRaidSim?t.player&&this.simUI.player.fromProto(m.nextEventID(),t.player):this.simUI.fromProto(m.nextEventID(),t),this.close()}}const Rr=class extends Lr{constructor(e,i){super(e,i,"Wowhead Import",!0),t(this,"simUI"),this.simUI=i,this.descriptionElem.innerHTML='\n\t\t\t<p>\n\t\t\t\tImport settings from <a href="https://www.wowhead.com/classic/gear-planner" target="_blank">Wowhead Gear Planner</a>.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tThis feature imports gear, race, and (optionally) talents. It does NOT import buffs, debuffs, consumes, rotation, or custom stats.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the gear planner link below and click, \'Import\'.\n\t\t\t</p>\n\t\t'}onImport(e){const t=e.match(/www\.wowhead\.com\/classic\/gear-planner\/([a-z\-]+)\/([a-z\-]+)\/([a-zA-Z0-9_\-]+)/);if(!t)throw new Error(`Invalid WCL URL ${e}, must look like "https://www.wowhead.com/classic/gear-planner/CLASS/RACE/XXXX"`);const i=mt(t[1].replaceAll("-",""));if(i==g.ClassUnknown)throw new Error("Could not parse Class: "+t[1]);const s=ut(t[2].replaceAll("-",""));if(s==pt.RaceUnknown)throw new Error("Could not parse Race: "+t[2]);const a=t[3].replaceAll("_","/").replaceAll("-","+"),n=Uint8Array.from(atob(a),(e=>e.charCodeAt(0))),o=n[3],l=n.subarray(4,4+o),r=gt(l).split("f").slice(0,3).join("-"),d=n.subarray(o),c=ft.create();let h=0;for(;h<d.length;){const e=It.create(),t=63&d[h],i=Boolean(128&d[h]);h++;const s=31&d[h];if(h++,e.id=(s<<16)+(d[h]<<8)+d[h+1],h+=2,i){const t=(d[h]<<16)+(d[h+1]<<8)+d[h+2];e.enchant=this.simUI.sim.db.enchantSpellIdToEffectId(t),h+=3}null!=Object.entries(Rr.slotIDs).find((e=>e[1]==t))&&c.items.push(e)}this.simUI.sim.db.lookupEquipmentSpec(c),this.finishIndividualImport(this.simUI,i,s,c,r,[])}};t(Rr,"slotIDs",{[M.ItemSlotHead]:1,[M.ItemSlotNeck]:2,[M.ItemSlotShoulder]:3,[M.ItemSlotBack]:15,[M.ItemSlotChest]:5,[M.ItemSlotWrist]:9,[M.ItemSlotHands]:10,[M.ItemSlotWaist]:6,[M.ItemSlotLegs]:7,[M.ItemSlotFeet]:8,[M.ItemSlotFinger1]:11,[M.ItemSlotFinger2]:12,[M.ItemSlotTrinket1]:13,[M.ItemSlotTrinket2]:14,[M.ItemSlotMainHand]:16,[M.ItemSlotOffHand]:17,[M.ItemSlotRanged]:18});class Ar extends Lr{constructor(e,i){super(e,i,"Addon Import",!0),t(this,"simUI"),this.simUI=i,this.descriptionElem.innerHTML='\n\t\t\t<p>\n\t\t\t\tImport settings from the <a href="https://www.curseforge.com/wow/addons/wowsimsexporter" target="_blank">WoWSims Importer In-Game Addon</a>.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tThis feature imports gear, race, talents, and professions. It does NOT import buffs, debuffs, consumes, rotation, or custom stats.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the output from the addon below and click, \'Import\'.\n\t\t\t</p>\n\t\t'}async onImport(e){const t=JSON.parse(e),i=mt(t.class||"");if(i==g.ClassUnknown)throw new Error("Could not parse Class!");const s=ut(t.race||"");if(s==pt.RaceUnknown)throw new Error("Could not parse Race!");const a=t.professions.map((e=>bt(e.name)));a.forEach(((e,i)=>{if(e==O.ProfessionUnknown)throw new Error(`Could not parse profession '${t.professions[i]}'`)}));const n=t.talents||"",o=t.gear;o.items=o.items.filter((e=>null!=e));const l=ft.fromJson(o);this.finishIndividualImport(this.simUI,i,s,l,n,a)}}const Dr={[Y.UNSPECIFIED]:"None",[Y.ALLIANCE_ONLY]:"Alliance only",[Y.HORDE_ONLY]:"Horde only"};class Mr extends dn{constructor(e,t,s){super(e,"filters-menu",{size:"md",title:"Filters"});let a=this.newSection("Factions");new nn(a,t.sim,{extraCssClasses:["w-50"],values:[Y.UNSPECIFIED,Y.ALLIANCE_ONLY,Y.HORDE_ONLY].map((e=>({name:Dr[e],value:e}))),changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().factionRestriction,setValue:(e,t,i)=>{const s=t.getFilters();s.factionRestriction=i,t.setFilters(e,s)}}),a=this.newSection("Source"),a.classList.add("filters-menu-section-bool-list");if(Qa.ALL_SOURCES.filter((e=>e!=Q.SourceUnknown)).forEach((e=>{new an(a,t.sim,{label:vt.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().sources.includes(e),setValue:(t,i,s)=>{const a=i.getFilters();s?a.sources.push(e):a.sources=a.sources.filter((t=>t!=e)),i.setFilters(t,a)}})})),Ba.ARMOR_SLOTS.includes(s)){const e=xt[t.getClass()];if(e>=We.ArmorTypeLeather){const s=this.newSection("Armor Type");s.classList.add("filters-menu-section-bool-list");i(We).filter((e=>e!=We.ArmorTypeUnknown)).filter((t=>t<=e)).forEach((e=>{new an(s,t.sim,{label:St.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().armorTypes.includes(e),setValue:(t,i,s)=>{const a=i.getFilters();s?a.armorTypes.push(e):a.armorTypes=a.armorTypes.filter((t=>t!=e)),i.setFilters(t,a)}})}))}}else if(Ba.WEAPON_SLOTS.includes(s)){const e=this.newSection("Weapon Type");e.classList.add("filters-menu-section-bool-list");Et[t.getClass()].map((e=>e.weaponType)).forEach((i=>{new an(e,t.sim,{label:yt.get(i),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().weaponTypes.includes(i),setValue:(e,t,s)=>{const a=t.getFilters();s?a.weaponTypes.push(i):a.weaponTypes=a.weaponTypes.filter((e=>e!=i)),t.setFilters(e,a)}})}));const i=this.newSection("Weapon Speed");i.classList.add("filters-menu-section-number-list"),new en(i,t.sim,{label:"Min MH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minMhWeaponSpeed,setValue:(e,t,i)=>{const s=t.getFilters();s.minMhWeaponSpeed=i,t.setFilters(e,s)}}),new en(i,t.sim,{label:"Max MH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxMhWeaponSpeed,setValue:(e,t,i)=>{const s=t.getFilters();s.maxMhWeaponSpeed=i,t.setFilters(e,s)}}),Pt(t)&&(new en(i,t.sim,{label:"Min OH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minOhWeaponSpeed,setValue:(e,t,i)=>{const s=t.getFilters();s.minOhWeaponSpeed=i,t.setFilters(e,s)}}),new en(i,t.sim,{label:"Max OH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxOhWeaponSpeed,setValue:(e,t,i)=>{const s=t.getFilters();s.maxOhWeaponSpeed=i,t.setFilters(e,s)}}))}else if(s==M.ItemSlotRanged){const e=kt[t.getClass()];if(e.length<=1)return;const i=this.newSection("Ranged Weapon Type");i.classList.add("filters-menu-section-bool-list"),e.forEach((e=>{new an(i,t.sim,{label:Ct.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().rangedWeaponTypes.includes(e),setValue:(t,i,s)=>{const a=i.getFilters();s?a.rangedWeaponTypes.push(e):a.rangedWeaponTypes=a.rangedWeaponTypes.filter((t=>t!=e)),i.setFilters(t,a)}})}));const s=this.newSection("Ranged Weapon Speed");s.classList.add("filters-menu-section-number-list"),new en(s,t.sim,{label:"Min Ranged Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minRangedWeaponSpeed,setValue:(e,t,i)=>{const s=t.getFilters();s.minRangedWeaponSpeed=i,t.setFilters(e,s)}}),new en(s,t.sim,{label:"Max Ranged Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxRangedWeaponSpeed,setValue:(e,t,i)=>{const s=t.getFilters();s.maxRangedWeaponSpeed=i,t.setFilters(e,s)}})}}newSection(e){const t=document.createElement("div");return t.classList.add("menu-section"),this.body.appendChild(t),t.innerHTML=`\n\t\t\t<div class="menu-section-header">\n\t\t\t\t<h6 class="menu-section-title">${e}</h6>\n\t\t\t</div>\n\t\t\t<div class="menu-section-content"></div>\n\t\t`,t.getElementsByClassName("menu-section-content")[0]}}const Vr={type:"number",label:"Reaction Time",labelTooltip:"Reaction time of the player, in milliseconds. Used with certain APL values (such as 'Aura Is Active With Reaction Time').",changedEvent:e=>e.miscOptionsChangeEmitter,getValue:e=>e.getReactionTime(),setValue:(e,t,i)=>{t.setReactionTime(e,i)}},Ur={type:"number",label:"Channel Clip Delay",labelTooltip:"Clip delay following channeled spells, in milliseconds. This delay occurs following any full or partial channel ending after the GCD becomes available, due to the player not being able to queue the next spell.",changedEvent:e=>e.miscOptionsChangeEmitter,getValue:e=>e.getChannelClipDelay(),setValue:(e,t,i)=>{t.setChannelClipDelay(e,i)}},Fr={type:"boolean",label:"In Front of Target",labelTooltip:"Stand in front of the target, causing Blocks and Parries to be included in the attack table.",changedEvent:e=>e.inFrontOfTargetChangeEmitter,getValue:e=>e.getInFrontOfTarget(),setValue:(e,t,i)=>{t.setInFrontOfTarget(e,i)}},Wr={type:"number",label:"Distance From Target",labelTooltip:"Distance from targets, in yards. Used to calculate travel time for certain spells.",changedEvent:e=>e.distanceFromTargetChangeEmitter,getValue:e=>e.getDistanceFromTarget(),setValue:(e,t,i)=>{t.setDistanceFromTarget(e,i)}},Or={type:"enum",extraCssClasses:["tank-selector","threat-metrics","within-raid-sim-hide"],label:"Tank Assignment",labelTooltip:"Determines which mobs will be tanked. Most mobs default to targeting the Main Tank, but in preset multi-target encounters this is not always true.",values:[{name:"None",value:-1},{name:"Main Tank",value:0},{name:"Tank 2",value:1},{name:"Tank 3",value:2},{name:"Tank 4",value:3}],changedEvent:e=>e.getRaid().tanksChangeEmitter,getValue:e=>(e.getRaid()?.getTanks()||[]).findIndex((t=>be.equals(t,e.makeUnitReference()))),setValue:(e,t,i)=>{const s=[];if(-1!=i){for(let e=0;e<i;e++)s.push(ie());s.push(t.makeUnitReference())}t.getRaid().setTanks(e,s)}},Hr={type:"number",label:"Incoming HPS",labelTooltip:"\n\t\t<p>Average amount of healing received per second. Used for calculating chance of death.</p>\n\t\t<p>If set to 0, defaults to 17.5% of the primary target's base DPS.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().hps,setValue:(e,t,i)=>{const s=t.getHealingModel();s.hps=i,t.setHealingModel(e,s)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>be.equals(t,e.makeUnitReference())))},qr={type:"number",float:!0,label:"Healing Cadence",labelTooltip:"\n\t\t<p>How often the incoming heal 'ticks', in seconds. Generally, longer durations favor Effective Hit Points (EHP) for minimizing Chance of Death, while shorter durations favor avoidance.</p>\n\t\t<p>Example: if Incoming HPS is set to 1000 and this is set to 1s, then every 1s a heal will be received for 1000. If this is instead set to 2s, then every 2s a heal will be recieved for 2000.</p>\n\t\t<p>If set to 0, defaults to 1.5 times the primary target's base swing timer, and half that for dual wielding targets.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().cadenceSeconds,setValue:(e,t,i)=>{const s=t.getHealingModel();s.cadenceSeconds=i,t.setHealingModel(e,s)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>be.equals(t,e.makeUnitReference())))},Br={type:"number",float:!0,label:"Cadence +/-",labelTooltip:"\n\t\t<p>Magnitude of random variation in healing intervals, in seconds.</p>\n\t\t<p>Example: if Healing Cadence is set to 1s with 0.5s variation, then the interval between successive heals will vary uniformly between 0.5 and 1.5s. If the variation is instead set to 2s, then 50% of healing intervals will fall between 0s and 1s, and the other 50% will fall between 1s and 3s.</p>\n\t\t<p>The amount of healing per 'tick' is automatically scaled up or down based on the randomized time since the last tick, so as to keep HPS constant.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().cadenceVariation,setValue:(e,t,i)=>{const s=t.getHealingModel();s.cadenceVariation=i,t.setHealingModel(e,s)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>be.equals(t,e.makeUnitReference())))},zr={type:"number",float:!1,label:"TMI Burst Window",labelTooltip:"\n\t\t<p>Size in whole seconds of the burst window for calculating TMI. It is important to use a consistent setting when comparing this metric.</p>\n\t\t<p>Default is 6 seconds. If set to 0, TMI calculations are disabled.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().burstWindow,setValue:(e,t,i)=>{const s=t.getHealingModel();s.burstWindow=i,t.setHealingModel(e,s)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>be.equals(t,e.makeUnitReference())))},jr={type:"number",float:!0,label:"HP % for Defensive CDs",labelTooltip:"\n\t\t<p>% of Maximum Health, below which defensive cooldowns are allowed to be used.</p>\n\t\t<p>If set to 0, this restriction is disabled.</p>\n\t",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>100*e.getSimpleCooldowns().hpPercentForDefensives,setValue:(e,t,i)=>{const s=t.getSimpleCooldowns();s.hpPercentForDefensives=i/100,t.setSimpleCooldowns(e,s)}},$r={type:"number",float:!0,label:"Inspiration % Uptime",labelTooltip:"\n\t\t<p>% average of Encounter Duration, during which you have the Inspiration buff.</p>\n\t\t<p>If set to 0, the buff isn't applied.</p>\n\t",changedEvent:e=>e.healingModelChangeEmitter,getValue:e=>100*e.getHealingModel().inspirationUptime,setValue:(e,t,i)=>{const s=t.getHealingModel();s.inspirationUptime=i/100,t.setHealingModel(e,s)}},Gr={[Lt.ItemQualityJunk]:"item-quality-junk",[Lt.ItemQualityCommon]:"item-quality-common",[Lt.ItemQualityUncommon]:"item-quality-uncommon",[Lt.ItemQualityRare]:"item-quality-rare",[Lt.ItemQualityEpic]:"item-quality-epic",[Lt.ItemQualityLegendary]:"item-quality-legendary",[Lt.ItemQualityArtifact]:"item-quality-artifact",[Lt.ItemQualityHeirloom]:"item-quality-heirloom"};function Kr(e,t){Object.values(Gr).forEach((t=>e.classList.remove(t))),t&&e.classList.add(Gr[t])}let Jr=null;async function Zr(e){return(await(null==Jr&&(Jr=fetch("/sod/assets/enchants/descriptions.json").then((e=>e.json())).then((e=>{const t={};for(let i in e)t[parseInt(i)]=e[i];return t}))),Jr))[e.effectId]||e.name}function Yr(e){return e.effectId+"-"+e.type}let Qr={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};function Xr(e,t){return window.getComputedStyle(t)[e]}class ed{constructor(e,i){t(this,"options"),t(this,"scroll_elem"),t(this,"content_elem"),t(this,"displayedRows"),t(this,"last_cluster",0),t(this,"scroll_debounce",0),t(this,"pointer_events_set",!1),t(this,"resize_debounce",0),t(this,"ds"),t(this,"cache",{}),this.options={rows_in_block:void 0!==i.rows_in_block?i.rows_in_block:Qr.rows_in_block,blocks_in_cluster:void 0!==i.blocks_in_cluster?i.blocks_in_cluster:Qr.blocks_in_cluster,show_no_data_row:void 0!==i.show_no_data_row?i.show_no_data_row:Qr.show_no_data_row,no_data_class:void 0!==i.no_data_class?i.no_data_class:Qr.no_data_class,no_data_text:void 0!==i.no_data_text?i.no_data_text:Qr.no_data_text,keep_parity:void 0!==i.keep_parity?i.keep_parity:Qr.keep_parity,tag:void 0!==i.tag?i.tag:Qr.tag,callbacks:void 0!==i.callbacks?i.callbacks:Qr.callbacks,cluster_height:0,item_height:void 0!==i.item_height?i.item_height:0,content_tag:"",block_height:0,scroll_top:0,rows_in_cluster:0},this.ds=e,this.displayedRows=i.rows,this.scroll_elem=i.scroll_elem,this.content_elem=i.content_elem,this.content_elem.hasAttribute("tabindex")||this.content_elem.setAttribute("tabindex","0");let s=this.scroll_elem.scrollTop;this.getRowsHeight(i.rows),this.insertToDom(i.rows,this.cache),this.scroll_elem.scrollTop=s,this.scroll_elem.addEventListener("scroll",this.scrollEv.bind(this)),window.addEventListener("resize",this.resizeEv.bind(this))}destroy(e){this.scroll_elem.removeEventListener("scroll",this.scrollEv.bind(this)),window.removeEventListener("resize",this.resizeEv.bind(this)),e&&this.setContentElemRows(this.generateEmptyRow())}dispose(){this.destroy()}refresh(e){(this.getRowsHeight(this.displayedRows)||e)&&this.update()}update(){let e=this.scroll_elem.scrollTop;this.ds.getNumberOfRows()*this.options.item_height<e&&(this.scroll_elem.scrollTop=0,this.last_cluster=0),this.insertToDom(this.displayedRows,this.cache),this.scroll_elem.scrollTop=e}elementUpdate(e){for(let t of this.displayedRows)e(t)}getScrollProgress(){return this.options.scroll_top/(this.ds.getNumberOfRows()*this.options.item_height)*100||0}scrollEv(){navigator.platform.toLowerCase().indexOf("mac")+1&&(this.pointer_events_set||(this.content_elem.style.pointerEvents="none"),this.pointer_events_set=!0,clearTimeout(this.scroll_debounce),this.scroll_debounce=window.setTimeout((()=>{this.content_elem.style.pointerEvents="auto",this.pointer_events_set=!1}),50)),this.last_cluster!=(this.last_cluster=this.getClusterNum(this.ds.getNumberOfRows()))&&this.insertToDom(this.displayedRows,this.cache),this.options.callbacks.scrollingProgress&&this.options.callbacks.scrollingProgress(this.getScrollProgress())}resizeEv(){clearTimeout(this.resize_debounce),this.resize_debounce=window.setTimeout(this.refresh.bind(this),100)}insertToDom(e,t){this.options.cluster_height||this.exploreEnvironment(e,t);let i=this.generate(),s=i.rows;this.displayedRows=i.rows;let a=this.checkChanges("data",s,t),n=this.checkChanges("top",i.top_offset,t),o=this.checkChanges("bottom",i.bottom_offset,t),l=this.options.callbacks,r=[];if(a||n){if(i.top_offset){if(this.options.keep_parity){let e=this.renderExtraTag("keep-parity");e.hidden=!0,r.push(e)}r.push(this.renderExtraTag("top-space",i.top_offset))}r.push(...s),i.bottom_offset&&r.push(this.renderExtraTag("bottom-space",i.bottom_offset)),l.clusterWillChange&&l.clusterWillChange(),this.setContentElemRows(r),"ol"==this.options.content_tag&&this.content_elem.setAttribute("start",i.rows_above.toString()),this.content_elem.style.counterIncrement="clusterize-counter "+(i.rows_above-1),l.clusterChanged&&l.clusterChanged()}else o&&(this.content_elem.lastChild.style.height=i.bottom_offset+"px")}exploreEnvironment(e,t){let i=this.options;i.content_tag=this.content_elem.tagName.toLowerCase(),e.length&&(this.content_elem.children.length<=1&&this.setContentElemRows([e[0],e[0],e[0]]),i.tag||(i.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(e))}setContentElemRows(e){this.content_elem.innerHTML="",this.content_elem.append(...e)}getRowsHeight(e){let t=this.options,i=t.item_height;t.cluster_height=0;let s=this.content_elem.children;if(e.length&&s.length){let e=s[Math.floor(s.length/2)];if(t.item_height=e.offsetHeight,"tr"==t.tag&&"collapse"!=Xr("borderCollapse",this.content_elem)&&(t.item_height+=parseInt(Xr("borderSpacing",this.content_elem),10)||0),"tr"!=t.tag){let i=parseInt(Xr("marginTop",e),10)||0,s=parseInt(Xr("marginBottom",e),10)||0;t.item_height+=Math.max(i,s)}}return t.block_height=t.item_height*t.rows_in_block,t.rows_in_cluster=t.blocks_in_cluster*t.rows_in_block,t.cluster_height=t.blocks_in_cluster*t.block_height,i!=t.item_height}generate(){let e=this.options,t=this.ds.getNumberOfRows();if(t<e.rows_in_block){let e=this.ds.generateRows(0,t);return{top_offset:0,bottom_offset:0,rows_above:0,rows:t?e:this.generateEmptyRow()}}let i=Math.max((e.rows_in_cluster-e.rows_in_block)*this.getClusterNum(t),0),s=i+e.rows_in_cluster,a=Math.max(i*e.item_height,0),n=Math.max((t-s)*e.item_height,0),o=[],l=i;return a<1&&l++,o=this.ds.generateRows(i,s),{top_offset:a,bottom_offset:n,rows_above:l,rows:o}}generateEmptyRow(){let e=this.options;if(!e.tag||!e.show_no_data_row)return[];let t,i=document.createElement(e.tag),s=document.createTextNode(e.no_data_text);return i.className=e.no_data_class,"tr"==e.tag&&(t=document.createElement("td"),t.colSpan=100,t.appendChild(s)),i.appendChild(t||s),[i]}getClusterNum(e){let t=this.options;t.scroll_top=this.scroll_elem.scrollTop;let i=Math.max(t.cluster_height-t.block_height,1),s=Math.floor(t.scroll_top/i),a=Math.floor(e*t.item_height/i);return Math.min(s,a)}renderExtraTag(e,t){let i=document.createElement(this.options.tag),s="clusterize-";return i.className=[s+"extra-row",s+e].join(" "),i.style.marginTop="0",i.style.marginBottom="0",t&&(i.style.height=t+"px"),i}checkChanges(e,t,i){var s=t!=i[e];return i[e]=t,s}}class td extends v{constructor(e,i,s){super(e,"gear-picker-root"),t(this,"itemPickers");const a=document.createElement("div");a.classList.add("gear-picker-left","tab-panel-col"),this.rootElem.appendChild(a);const n=document.createElement("div");n.classList.add("gear-picker-right","tab-panel-col"),this.rootElem.appendChild(n);const o=[M.ItemSlotHead,M.ItemSlotNeck,M.ItemSlotShoulder,M.ItemSlotBack,M.ItemSlotChest,M.ItemSlotWrist,M.ItemSlotMainHand,M.ItemSlotOffHand,M.ItemSlotRanged].map((e=>new sd(a,i,s,e))),l=[M.ItemSlotHands,M.ItemSlotWaist,M.ItemSlotLegs,M.ItemSlotFeet,M.ItemSlotFinger1,M.ItemSlotFinger2,M.ItemSlotTrinket1,M.ItemSlotTrinket2].map((e=>new sd(n,i,s,e)));this.itemPickers=o.concat(l).sort(((e,t)=>e.slot-t.slot))}}class id extends v{constructor(e,i){super(e,"item-picker-root"),t(this,"player"),t(this,"iconElem"),t(this,"nameElem"),t(this,"enchantElem"),t(this,"runeElem"),t(this,"createRuneContainer",(e=>{const t=Ft();let i=w("div",{className:"item-picker-rune-container"},w("img",{ref:t,className:"item-picker-rune-icon"}));return e?y.fromSpellId(e.id).fill().then((e=>t.value.src=e.iconUrl)):t.value.src="https://wow.zamimg.com/images/wow/icons/medium/inventoryslot_empty.jpg",i})),this.player=i;let s=Ft(),a=Ft(),n=Ft(),o=Ft();this.rootElem.appendChild(w(S,null,w("a",{ref:s,className:"item-picker-icon",href:"javascript:void(0)",attributes:{role:"button"}}),w("div",{className:"item-picker-labels-container"},w("a",{ref:a,className:"item-picker-name",href:"javascript:void(0)",attributes:{role:"button"}}),w("a",{ref:n,className:"item-picker-enchant",href:"javascript:void(0)",attributes:{role:"button"}}),w("a",{ref:o,className:"item-picker-rune",href:"javascript:void(0)",attributes:{role:"button"}})))),this.iconElem=s.value,this.nameElem=a.value,this.enchantElem=n.value,this.runeElem=o.value}clear(){this.nameElem.removeAttribute("data-wowhead"),this.nameElem.removeAttribute("href"),this.iconElem.removeAttribute("data-wowhead"),this.iconElem.removeAttribute("href"),this.enchantElem.removeAttribute("data-wowhead"),this.enchantElem.removeAttribute("href"),this.iconElem.removeAttribute("href"),this.iconElem.style.backgroundImage="",this.enchantElem.innerText="",this.runeElem.innerText="",this.nameElem.textContent=""}update(e){this.nameElem.textContent=e.item.name,e.randomSuffix&&(this.nameElem.textContent+=" "+e.randomSuffix.name),Kr(this.nameElem,e.item.quality),this.player.setWowheadData(e,this.iconElem),this.player.setWowheadData(e,this.nameElem),e.asActionId().fill().then((e=>{e.setBackgroundAndHref(this.iconElem),e.setWowheadHref(this.nameElem)})),e.enchant&&(Zr(e.enchant).then((e=>{this.enchantElem.textContent=e})),e.enchant.spellId?(this.enchantElem.href=y.makeSpellUrl(e.enchant.spellId),this.enchantElem.dataset.wowhead=`domain=classic&spell=${e.enchant.spellId}`):(this.enchantElem.href=y.makeItemUrl(e.enchant.itemId),this.enchantElem.dataset.wowhead=`domain=classic&item=${e.enchant.itemId}`),this.enchantElem.dataset.whtticon="false");const t=Ut[e._item.type]?.some((e=>this.player.sim.db.hasRuneBySlot(e,this.player.getClass())));t&&(this.iconElem.appendChild(this.createRuneContainer(e.rune)),e.rune&&(this.runeElem.textContent=e.rune.name,this.runeElem.href=y.makeSpellUrl(e.rune.id),this.enchantElem.dataset.wowhead=`domain=classic&spell=${e.rune.id}`))}}class sd extends v{constructor(e,i,s,a){super(e,"item-picker-root"),t(this,"slot"),t(this,"simUI"),t(this,"player"),t(this,"itemElem"),t(this,"_items",[]),t(this,"_enchants",[]),t(this,"_runes",[]),t(this,"_equippedItem",null),this.slot=a,this.simUI=i,this.player=s,this.itemElem=new id(this.rootElem,s),this.item=s.getEquippedItem(a);const n=()=>this._items=this.player.getItems(this.slot);s.sim.waitForInit().then((()=>{this._enchants=this.player.getEnchants(this.slot),this._runes=this.player.getRunes(this.slot),n();const e={equipItem:(e,t)=>{this.player.equipItem(e,this.slot,t)},getEquippedItem:()=>this.player.getEquippedItem(this.slot),changeEvent:s.gearChangeEmitter},t=t=>{t.preventDefault(),this.openSelectorModal(nd.Items,e)};this.itemElem.iconElem.addEventListener("click",t),this.itemElem.nameElem.addEventListener("click",t),this.itemElem.enchantElem.addEventListener("click",(t=>{t.preventDefault(),this.openSelectorModal(nd.Enchants,e)}))})),s.levelChangeEmitter.on(n),s.gearChangeEmitter.on((()=>this.item=s.getEquippedItem(a))),s.professionChangeEmitter.on((()=>{null!=this._equippedItem&&this.player.setWowheadData(this._equippedItem,this.itemElem.iconElem)}))}set item(e){this.itemElem.clear(),this.itemElem.nameElem.textContent=Tt.get(this.slot)??"",Kr(this.itemElem.nameElem,null),null!=e?this.itemElem.update(e):this.itemElem.iconElem.style.backgroundImage=`url('${rd(this.slot)}')`,this._equippedItem=e}openSelectorModal(e,t){new od(this.simUI.rootElem,this.simUI,this.player,{selectedTab:e,slot:this.slot,equippedItem:this._equippedItem,eligibleItems:this._items,eligibleEnchants:this._enchants,eligibleRunes:this._runes,gearData:t})}}class ad extends v{constructor(e,i,s,a){super(e,"icon-picker-root"),t(this,"iconAnchor"),t(this,"socketsContainerElem"),t(this,"player"),t(this,"slot"),t(this,"_items",[]),t(this,"_enchants",[]),t(this,"_runes",[]),this.rootElem.classList.add("icon-picker"),this.player=s,this.slot=a,this.iconAnchor=document.createElement("a"),this.iconAnchor.classList.add("icon-picker-button"),this.iconAnchor.target="_blank",this.rootElem.prepend(this.iconAnchor),this.socketsContainerElem=document.createElement("div"),this.socketsContainerElem.classList.add("item-picker-sockets-container"),this.iconAnchor.appendChild(this.socketsContainerElem),s.sim.waitForInit().then((()=>{this._items=this.player.getItems(a),this._enchants=this.player.getEnchants(a),this._runes=this.player.getRunes(a);const e={equipItem:(e,t)=>{this.player.equipItemSwapitem(e,this.slot,t)},getEquippedItem:()=>this.player.getItemSwapItem(this.slot),changeEvent:s.itemSwapChangeEmitter};this.iconAnchor.addEventListener("click",(t=>{t.preventDefault(),new od(i.rootElem,i,this.player,{selectedTab:nd.Items,slot:this.slot,equippedItem:this.player.getItemSwapGear().getEquippedItem(a),eligibleItems:this._items,eligibleEnchants:this._enchants,eligibleRunes:this._runes,gearData:e})}))})),s.itemSwapChangeEmitter.on((()=>{this.update(s.getItemSwapGear().getEquippedItem(a))}))}update(e){this.iconAnchor.style.backgroundImage=`url('${rd(this.slot)}')`,this.iconAnchor.removeAttribute("data-wowhead"),this.iconAnchor.href="#",this.socketsContainerElem.innerText="",e?(this.iconAnchor.classList.add("active"),this.player.setWowheadData(e,this.iconAnchor),e.asActionId().fill().then((e=>e.setBackgroundAndHref(this.iconAnchor)))):this.iconAnchor.classList.remove("active")}}var nd=(e=>(e.Items="Items",e.Enchants="Enchants",e.Rune="Rune",e))(nd||{});class od extends dn{constructor(e,i,s,a){super(e,"selector-modal"),t(this,"simUI"),t(this,"player"),t(this,"config"),t(this,"ilists"),t(this,"tabsElem"),t(this,"contentElem"),this.simUI=i,this.player=s,this.config=a,this.ilists=[],window.scrollTo({top:0}),this.header.insertAdjacentElement("afterbegin",w("ul",{className:"nav nav-tabs selector-modal-tabs"})),this.body.appendChild(w("div",{className:"tab-content selector-modal-tab-content"})),this.tabsElem=this.rootElem.querySelector(".selector-modal-tabs"),this.contentElem=this.rootElem.querySelector(".selector-modal-tab-content"),this.setData()}openTabName(e){Array.from(this.tabsElem.getElementsByClassName("selector-modal-item-tab")).forEach((t=>{t.getAttribute("data-content-id")==e+"-tab"&&t.click()}))}openTab(e){this.tabsElem.getElementsByClassName("selector-modal-item-tab")[e].click()}setData(){this.tabsElem.innerText="",this.contentElem.innerText="";const{slot:e,equippedItem:t,eligibleItems:i,eligibleEnchants:s,eligibleRunes:a,gearData:n}=this.config;this.addTab("Items",i.map((t=>({item:t,id:t.id,actionId:y.fromItem(t),name:t.name,quality:t.quality,phase:t.phase,baseEP:this.player.computeItemEP(t,e),ignoreEPFilter:!1,onEquip:(e,t)=>{const i=n.getEquippedItem();i?n.equipItem(e,i.withItem(t)):n.equipItem(e,new _t({item:t}))}}))),(t=>this.player.computeItemEP(t,e)),(e=>e?.item),(e=>{n.equipItem(e,null),this.removeTabs("Random Suffixes")})),this.addTab("Enchants",s.map((e=>({item:e,id:e.effectId,actionId:e.itemId?y.fromItemId(e.itemId):y.fromSpellId(e.spellId),name:e.name,quality:e.quality,phase:e.phase||1,baseEP:this.player.computeStatsEP(new ga(e.stats)),ignoreEPFilter:!0,onEquip:(e,t)=>{const i=n.getEquippedItem();i&&n.equipItem(e,i.withEnchant(t))}}))),(e=>this.player.computeEnchantEP(e)),(e=>e?.enchant),(e=>{const t=n.getEquippedItem();t&&n.equipItem(e,t.withEnchant(null))})),this.addTab("Rune",a.map((e=>({item:e,id:e.id,actionId:y.fromSpellId(e.id),name:e.name,quality:Lt.ItemQualityCommon,phase:1,baseEP:1,ignoreEPFilter:!0,onEquip:(e,t)=>{const i=n.getEquippedItem();i&&n.equipItem(e,i.withRune(t))}}))),(()=>1),(e=>e?.rune),(e=>{const t=n.getEquippedItem();t&&n.equipItem(e,t.withRune(null))})),this.addRandomSuffixTab(t,n)}onShow(e){let t=e.target.querySelector(".active").dataset.contentId;t.includes("Item")?this.ilists[0].sizeRefresh():t.includes("Enchant")&&this.ilists[1].sizeRefresh()}addRandomSuffixTab(e,t){if(null==e||0==e.item.randomSuffixOptions.length)return;const i=e.item;this.addTab("Random Suffixes",this.player.getRandomSuffixes(i).map((e=>({item:e,id:e.id,actionId:y.fromRandomSuffix(i,e),name:e.name,quality:i.quality,phase:i.phase,baseEP:this.player.computeRandomSuffixEP(e),ignoreEPFilter:!0,onEquip:(e,i)=>{const s=t.getEquippedItem();s&&t.equipItem(e,s.withRandomSuffix(i))}}))),(e=>this.player.computeRandomSuffixEP(e)),(e=>e?.randomSuffix),(e=>{const i=t.getEquippedItem();i&&t.equipItem(e,i.withRandomSuffix(null))}))}addTab(e,t,i,s,a,n){if(0==t.length)return;const{gearData:o}=this.config,l=(e+"-tab").split(" ").join(""),r=e===this.config.selectedTab,d=Ft();this.tabsElem.appendChild(w("li",{className:"nav-item"},w("a",{ref:d,className:"nav-link selector-modal-item-tab "+(r?"active":""),dataset:{label:e,contentId:l,bsToggle:"tab",bsTarget:`#${l}`},attributes:{role:"tab","aria-selected":r},type:"button"}))),n?n(d.value):d.value.textContent=e;let c=new dd(this.contentElem,this.simUI,this.config,this.player,e,t,i,s,a,(e=>{const t=e.item;e.onEquip(m.nextEventID(),t),Nt.is(t)&&(this.removeTabs("Random Suffixes"),this.addRandomSuffixTab(o.getEquippedItem(),o))})),h=()=>{c.updateSelected()},u=()=>{c.applyFilters()},p=()=>{c.hideOrShowEPValues()};o.changeEvent.on(h),this.player.sim.phaseChangeEmitter.on(u),this.player.sim.filtersChangeEmitter.on(u),this.player.sim.showEPValuesChangeEmitter.on(p),this.addOnDisposeCallback((()=>{o.changeEvent.off(h),this.player.sim.phaseChangeEmitter.off(u),this.player.sim.filtersChangeEmitter.off(u),this.player.sim.showEPValuesChangeEmitter.off(p),c.dispose()})),d.value.addEventListener("shown.bs.tab",(e=>{c.sizeRefresh()})),this.ilists.push(c)}removeTabs(e){const t=Array.prototype.slice.call(this.tabsElem.getElementsByClassName("selector-modal-item-tab")).filter((t=>t.dataset.label.includes(e))),i=t.map((e=>document.getElementById(e.dataset.contentId))).filter((e=>Boolean(e)));t.forEach((e=>e.parentElement.remove())),i.forEach((e=>e.remove()))}}const ld={[M.ItemSlotHead]:"/sod/assets/item_slots/head.jpg",[M.ItemSlotNeck]:"/sod/assets/item_slots/neck.jpg",[M.ItemSlotShoulder]:"/sod/assets/item_slots/shoulders.jpg",[M.ItemSlotBack]:"/sod/assets/item_slots/shirt.jpg",[M.ItemSlotChest]:"/sod/assets/item_slots/chest.jpg",[M.ItemSlotWrist]:"/sod/assets/item_slots/wrists.jpg",[M.ItemSlotHands]:"/sod/assets/item_slots/hands.jpg",[M.ItemSlotWaist]:"/sod/assets/item_slots/waist.jpg",[M.ItemSlotLegs]:"/sod/assets/item_slots/legs.jpg",[M.ItemSlotFeet]:"/sod/assets/item_slots/feet.jpg",[M.ItemSlotFinger1]:"/sod/assets/item_slots/finger.jpg",[M.ItemSlotFinger2]:"/sod/assets/item_slots/finger.jpg",[M.ItemSlotTrinket1]:"/sod/assets/item_slots/trinket.jpg",[M.ItemSlotTrinket2]:"/sod/assets/item_slots/trinket.jpg",[M.ItemSlotMainHand]:"/sod/assets/item_slots/mainhand.jpg",[M.ItemSlotOffHand]:"/sod/assets/item_slots/offhand.jpg",[M.ItemSlotRanged]:"/sod/assets/item_slots/ranged.jpg"};function rd(e){return ld[e]}class dd{constructor(e,i,s,a,n,o,l,r,d,c){t(this,"listElem"),t(this,"player"),t(this,"label"),t(this,"slot"),t(this,"itemData"),t(this,"itemsToDisplay"),t(this,"currentFilters"),t(this,"searchInput"),t(this,"computeEP"),t(this,"equippedToItemFn"),t(this,"gearData"),t(this,"tabContent"),t(this,"onItemClick"),t(this,"scroller"),this.label=n,this.player=a,this.itemData=o,this.computeEP=l,this.equippedToItemFn=r,this.onItemClick=c;const{slot:h,gearData:u}=s;this.slot=h,this.gearData=u,this.currentFilters=this.player.sim.getFilters();const p=(n+"-tab").split(" ").join(""),f=n===s.selectedTab,I=Ft();if(this.tabContent=w("div",{id:p,className:"selector-modal-tab-pane tab-pane fade "+(f?"active show":"")},w("div",{className:"selector-modal-filters"},w("input",{className:"selector-modal-search form-control",type:"text",placeholder:"Search..."}),"Items"==n&&w("button",{className:"selector-modal-filters-button btn btn-primary"},"Filters"),w("div",{className:"sim-input selector-modal-boolean-option selector-modal-show-1h-weapons"}),w("div",{className:"sim-input selector-modal-boolean-option selector-modal-show-2h-weapons"}),w("div",{className:"sim-input selector-modal-boolean-option selector-modal-show-ep-values"}),w("button",{className:"selector-modal-simall-button btn btn-warning"},"Add to Batch Sim"),w("button",{className:"selector-modal-remove-button btn btn-danger"},"Unequip Item")),w("div",{className:"selector-modal-list-labels"},w("label",{className:"item-label"},w("small",null,"Item")),w("label",{className:"source-label"},w("small",null,"Source")),w("label",{className:"ep-label"},w("small",null,"EP"),w("i",{className:"fa-solid fa-plus-minus fa-2xs"}),w("button",{ref:I,className:"btn btn-link p-0 ms-1"},w("i",{className:"far fa-question-circle fa-lg"}))),w("label",{className:"favorite-label"})),w("ul",{className:"selector-modal-list"})),e.appendChild(this.tabContent),new da(I.value,{title:"\n\tEP (Equivalence Points) is way of comparing items by multiplying the raw stats of an item with your current stat weights.\n\tMore EP does not necessarily mean more DPS, as EP doesn't take into account stat caps and non-linear stat calculations.\n"}),function(e,t){new an(e,t,{extraCssClasses:["show-1h-weapons-selector","mb-0"],label:"1H",inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().oneHandedWeapons,setValue:(e,t,i)=>{const s=t.getFilters();s.oneHandedWeapons=i,t.setFilters(e,s)}})}(this.tabContent.getElementsByClassName("selector-modal-show-1h-weapons")[0],a.sim),function(e,t){new an(e,t,{extraCssClasses:["show-2h-weapons-selector","mb-0"],label:"2H",inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().twoHandedWeapons,setValue:(e,t,i)=>{const s=t.getFilters();s.twoHandedWeapons=i,t.setFilters(e,s)}})}(this.tabContent.getElementsByClassName("selector-modal-show-2h-weapons")[0],a.sim),"Items"==n&&(h==M.ItemSlotMainHand||h==M.ItemSlotOffHand&&a.getClass()==g.ClassWarrior)||(this.tabContent.getElementsByClassName("selector-modal-show-1h-weapons")[0].style.display="none",this.tabContent.getElementsByClassName("selector-modal-show-2h-weapons")[0].style.display="none"),function(e,t){new an(e,t,{extraCssClasses:["show-ep-values-selector","input-inline","mb-0"],label:"Show EP",inline:!0,changedEvent:e=>e.showEPValuesChangeEmitter,getValue:e=>e.getShowEPValues(),setValue:(e,t,i)=>{t.setShowEPValues(e,i)}})}(this.tabContent.getElementsByClassName("selector-modal-show-ep-values")[0],a.sim),"Items"==n){this.tabContent.getElementsByClassName("selector-modal-filters-button")[0].addEventListener("click",(()=>new Mr(e,a,h)))}this.listElem=this.tabContent.getElementsByClassName("selector-modal-list")[0],this.itemsToDisplay=[],this.scroller=new ed({getNumberOfRows:()=>this.itemsToDisplay.length,generateRows:(e,t)=>{let i=[];for(let s=e;s<t&&!(s>=this.itemsToDisplay.length);++s)i.push(this.createItemElem({idx:this.itemsToDisplay[s],data:this.itemData[this.itemsToDisplay[s]]}));return i}},{rows:[],scroll_elem:this.listElem,content_elem:this.listElem,item_height:56,show_no_data_row:!1,no_data_text:"",tag:"li",rows_in_block:16,blocks_in_cluster:2});const b=this.tabContent.getElementsByClassName("selector-modal-remove-button")[0];b.addEventListener("click",(e=>d(m.nextEventID()))),n.startsWith("Enchants")?b.textContent="Remove Enchant":n.startsWith("Rune")&&(b.textContent="Remove Rune"),this.updateSelected(),this.searchInput=this.tabContent.getElementsByClassName("selector-modal-search")[0],this.searchInput.addEventListener("input",(()=>this.applyFilters()));const v=this.tabContent.getElementsByClassName("selector-modal-simall-button")[0];"Items"==n?(v.hidden=!a.sim.getShowExperimental(),a.sim.showExperimentalChangeEmitter.on((()=>{v.hidden=!a.sim.getShowExperimental()})),v.addEventListener("click",(e=>{if(i instanceof Ku){let e=Array();const t=this.slot==M.ItemSlotRanged||this.slot==M.ItemSlotTrinket1||this.slot==M.ItemSlotTrinket2,s=this.equippedToItemFn(this.player.getEquippedItem(this.slot));let a=0;null!=s&&(a=this.computeEP(s));for(let i of this.itemsToDisplay){const s=this.itemData[i];!t&&a>0&&s.baseEP<a/2||(s.baseEP>0||t)&&e.push(It.create({id:s.id}))}i.bt.addItems(e)}}))):v.hidden=!0}sizeRefresh(){this.scroller.refresh(!0),this.applyFilters()}dispose(){this.scroller.dispose()}updateSelected(){const e=this.gearData.getEquippedItem(),t=this.equippedToItemFn(e),i=t?"Enchants"==this.label?t.effectId:t.id:0,s=t?this.computeEP(t):0;this.scroller.elementUpdate((e=>{let t=e.dataset.idx;const a=this.itemData[parseFloat(t)];a.id==i?e.classList.add("active"):e.classList.remove("active");const n=e.getElementsByClassName("selector-modal-list-item-ep-delta")[0];if(n&&(n.textContent="",a.item)){const e=this.computeEP(a.item);s!=e&&Rt(n,s,e,0)}}))}applyFilters(){this.currentFilters=this.player.sim.getFilters();let e=new Array(this.itemData.length);for(let s=0;s<this.itemData.length;++s)e[s]=s;const t=this.player.getEquippedItem(this.slot);let i;"Items"==this.label?e=this.player.filterItemData(e,(e=>this.itemData[e].item),this.slot):"Enchants"==this.label&&(e=this.player.filterEnchantData(e,(e=>this.itemData[e].item),this.slot,t)),e=e.filter((e=>{const t=this.itemData[e];if(t.phase>this.player.sim.getPhase())return!1;if(this.searchInput.value.length>0){const e=this.searchInput.value.toLowerCase().replaceAll(/[^a-zA-Z0-9\s]/g,"").split(" "),s=t.name.toLowerCase().replaceAll(/[^a-zA-Z0-9\s]/g,"");var i=!0;if(e.forEach((e=>{s.includes(e)||(i=!1)})),!i)return!1}return!0})),i=this.slot==M.ItemSlotTrinket1||this.slot==M.ItemSlotTrinket2?(e,t)=>t.ilvl-e.ilvl:(e,t)=>{const i=this.computeEP(t)-this.computeEP(e);return Math.abs(i)<.01?t.ilvl&&e.ilvl?t.ilvl-e.ilvl:t.name<e.name?1:-1:i},e=e.sort(((e,t)=>{const s=this.itemData[e],a=this.itemData[t];return this.isItemFavorited(s)&&!this.isItemFavorited(a)?-1:this.isItemFavorited(a)&&!this.isItemFavorited(s)?1:i(s.item,a.item)})),this.itemsToDisplay=e,this.scroller.update(),this.hideOrShowEPValues()}hideOrShowEPValues(){const e=this.tabContent.getElementsByClassName("ep-label"),t=this.tabContent.getElementsByClassName("selector-modal-list"),i=this.player.sim.getShowEPValues(),s=i?"":"none";for(let a of e)a.style.display=s;for(let a of t)i?a.classList.remove("hide-ep"):a.classList.add("hide-ep")}createItemElem(e){const t=e.data,i=this.computeEP(t.item),s=this.equippedToItemFn(this.gearData.getEquippedItem()),a=s?"Enchants"==this.label?s.effectId:s.id:0,n=s?this.computeEP(s):0,o=Ft(),l=Ft(),r=Ft(),d=w("li",{className:"selector-modal-list-item "+(a==t.id?"active":""),dataset:{idx:e.idx.toString()}},w("div",{className:"selector-modal-list-label-cell"},w("a",{className:"selector-modal-list-item-link",ref:l,dataset:{whtticon:"false"}},w("img",{className:"selector-modal-list-item-icon",ref:r}),w("label",{className:"selector-modal-list-item-name",ref:o},t.name))));"Items"==this.label&&d.appendChild(w("div",{className:"selector-modal-list-item-source-container"},this.getSourceInfo(t.item,this.player.sim))),this.slot!=M.ItemSlotTrinket1&&this.slot!=M.ItemSlotTrinket2&&d.appendChild(w("div",{className:"selector-modal-list-item-ep"},w("span",{className:"selector-modal-list-item-ep-value"},i<9.95?i.toFixed(1).toString():Math.round(i).toString()),w("span",{className:"selector-modal-list-item-ep-delta",ref:e=>t.item&&n!=i&&Rt(e,n,i,0)})));let c=Ft();d.appendChild(w("div",null,w("button",{className:"selector-modal-list-item-favorite btn btn-link p-0",ref:c,onclick:()=>h("false"==d.dataset.fav)},w("i",{className:"fa-star fa-xl"})))),l.value.addEventListener("click",(e=>{if(e.preventDefault(),e.target===c.value)return!1;this.onItemClick(t)})),t.actionId.fill().then((e=>{e.setWowheadHref(l.value),r.value.src=e.iconUrl})),Kr(o.value,t.quality),new da(c.value,{title:"Add to favorites"});const h=e=>{const i=this.player.sim.getFilters();if("Items"==this.label){const s=t.id;if(e)i.favoriteItems.push(s);else{const e=i.favoriteItems.indexOf(s);-1!=e&&i.favoriteItems.splice(e,1)}}else if("Enchants"==this.label){const s=Yr(t.item);if(e)i.favoriteEnchants.push(s);else{const e=i.favoriteEnchants.indexOf(s);-1!=e&&i.favoriteEnchants.splice(e,1)}}c.value.children[0].classList.toggle("fas"),c.value.children[0].classList.toggle("far"),d.dataset.fav=e.toString(),this.player.sim.setFilters(m.nextEventID(),i)};return this.isItemFavorited(t)?(c.value.children[0].classList.add("fas"),d.dataset.fav="true"):(c.value.children[0].classList.add("far"),d.dataset.fav="false"),d}isItemFavorited(e){return"Items"==this.label?this.currentFilters.favoriteItems.includes(e.id):"Enchants"==this.label&&this.currentFilters.favoriteEnchants.includes(Yr(e.item))}getSourceInfo(e,t){const i=(e,t)=>w("a",{href:e,target:"_blank"},w("small",null,t));if(!e.sources||0==e.sources.length)return e.randomSuffixOptions.length?i(`${y.makeItemUrl(e.id)}#dropped-by`,"World Drop"):w(S,null);let s=e.sources[0];if("crafted"==s.source.oneofKind){const t=s.source.crafted;return t.spellId?i(y.makeSpellUrl(t.spellId),At.get(t.profession)??"Unknown"):i(y.makeItemUrl(e.id),At.get(t.profession)??"Unknown")}if("drop"==s.source.oneofKind){const a=s.source.drop,n=t.db.getZone(a.zoneId),o=t.db.getNpc(a.npcId);if(!n)throw new Error("No zone found for item: "+e);const l=a.category?` - ${a.category}`:"";return o?i(y.makeNpcUrl(o.id),w("span",null,n.name,w("br",null),o.name+l)):a.otherName?i(y.makeZoneUrl(n.id),w("span",null,n.name,w("br",null),a.otherName)):i(y.makeZoneUrl(n.id),n.name)}if("quest"==s.source.oneofKind&&s.source.quest.name){const e=s.source.quest;return i(y.makeQuestUrl(e.id),w("span",null,"Quest",w("br",null),e.name))}if("rep"==(s=e.sources.find((e=>"rep"==e.source.oneofKind))??s).source.oneofKind){const t=e.sources.filter((e=>"rep"==e.source.oneofKind)).map((e=>"rep"==e.source.oneofKind?Dt[e.source.rep.repFactionId]:Dt[Mt.RepFactionUnknown])),a=s.source.rep;return i(y.makeItemUrl(e.id),w(S,null,t.map((e=>w("span",null,e,w("br",null)))),w("span",null,Vt[a.repLevel])))}if("soldBy"==s.source.oneofKind){const e=s.source.soldBy;return i(y.makeNpcUrl(e.npcId),w("span",null,"Sold by",w("br",null),e.npcName))}return w(S,null)}}class cd extends v{constructor(e,i,s){super(e,"sim-tab"),t(this,"simUI"),t(this,"config"),t(this,"navItem"),t(this,"navLink"),t(this,"contentContainer"),this.rootElem.classList.add(s.identifier),this.simUI=i,this.config=s,this.rootElem.id=this.config.identifier,this.rootElem.classList.add("tab-pane","fade"),0==e.childNodes.length&&this.rootElem.classList.add("active","show"),this.navItem=this.buildNavItem(),this.navLink=this.navItem.children[0],this.contentContainer=document.createElement("div"),this.contentContainer.classList.add("tab-pane-content-container"),this.rootElem.appendChild(this.contentContainer),this.simUI.simHeader.addSimTabLink(this)}buildNavItem(){const e=document.createElement("fragment");return e.innerHTML=`\n\t\t\t<li class="${this.config.identifier} nav-item" role="presentation">\n\t\t\t\t<a\n\t\t\t\t\tclass="nav-link"\n\t\t\t\t\tdata-bs-toggle="tab"\n\t\t\t\t\tdata-bs-target="#${this.config.identifier}"\n\t\t\t\t\ttype="button"\n\t\t\t\t\trole="tab"\n\t\t\t\t\taria-controls="${this.config.identifier}"\n\t\t\t\t>${this.config.title}</a>\n\t\t\t</li>\n\t\t`,e.children[0]}buildColumn(e,t){let i=document.createElement("div");return i.classList.add("tab-panel-col",`${t}-${e}`),i}}class hd extends Lr{constructor(e,i,s){super(e,i,"Bag Item Import",!0),t(this,"simUI"),t(this,"bulkUI"),this.simUI=i,this.bulkUI=s,this.descriptionElem.innerHTML="\n      <p>Import bag items from a JSON file, which can be created by the WowSimsExporter in-game AddOn.</p>\n      <p>To import, upload the file or paste the text below, then click, 'Import'.</p>\n    "}async onImport(e){try{const t=ft.fromJsonString(e,{ignoreUnknownFields:!0});if(t?.items?.length>0){const e=await ae.loadLeftoversIfNecessary(t),i=t.items.filter((t=>t.id>0&&e.lookupItemSpec(t)));i.length>0&&this.bulkUI.addItems(i)}this.close()}catch(t){alert(t.toString())}}}class md{constructor(e,t,i,s){const a=document.createElement("div");a.classList.add("results-sim");const n=document.createElement("div");n.classList.add("bulk-result-body-dps","bulk-items-text-line","results-sim-dps","damage-metrics"),a.appendChild(n);const o=document.createElement("span");o.textContent=this.formatDps(i.unitMetrics?.dps?.avg),o.classList.add("topline-result-avg"),n.appendChild(o);const l=i.unitMetrics?.dps?.avg-s.unitMetrics?.dps?.avg,r=document.createElement("span");r.textContent=`${this.formatDpsDelta(l)}`,r.classList.add(l>=0?"bulk-result-header-positive":"bulk-result-header-negative"),n.appendChild(r);const d=document.createElement("div");if(d.classList.add("bulk-gear-combo"),e.bodyElement.appendChild(d),e.bodyElement.appendChild(a),i.itemsAdded&&i.itemsAdded.length>0){const s=document.createElement("button");s.textContent="Equip",s.classList.add("btn","btn-primary","bulk-equipit"),s.onclick=()=>{i.itemsAdded.forEach((e=>{const i=t.sim.db.lookupItemSpec(e.item);t.player.equipItem(m.nextEventID(),e.slot,i),t.simHeader.activateTab("gear-tab")}))},e.bodyElement.appendChild(s);for(const e of i.itemsAdded){const i=t.sim.db.lookupItemSpec(e.item),s=new id(d,t.player);s.update(i);const a=document.createElement("a");a.classList.add("bulk-result-item-slot"),a.textContent=this.itemSlotName(e),s.nameElem.appendChild(a)}}else{const t=document.createElement("p");t.textContent="No changes - this is your currently equipped gear!",e.bodyElement.appendChild(t),r.textContent=""}}formatDps(e){return(Math.round(100*e)/100).toFixed(2)}formatDpsDelta(e){return(e>=0?"+":"")+this.formatDps(e)}itemSlotName(e){return JSON.parse(zt.toJsonString(e,{emitDefaultValues:!0})).slot.replace("ItemSlot","")}}class ud extends v{constructor(e,i,s,a,n){super(e,"bulk-item-picker"),t(this,"itemElem"),t(this,"simUI"),t(this,"bulkUI"),t(this,"index"),t(this,"item"),this.simUI=i,this.bulkUI=s,this.index=n,this.item=a,this.itemElem=new id(this.rootElem,i.player),this.simUI.sim.waitForInit().then((()=>{this.setItem(a);const e=jt(this.item.item)[0],t=this.simUI.sim.db.getEnchants(e),i=i=>{i.preventDefault();const a=new m,n=new od(this.bulkUI.rootElem,this.simUI,this.simUI.player,{selectedTab:nd.Enchants,slot:e,equippedItem:this.item,eligibleItems:new Array,eligibleEnchants:t,eligibleRunes:[],gearData:{equipItem:(e,t)=>{if(t){const e=this.bulkUI.getItems();e[this.index]=t.asSpec(),this.item=t,this.bulkUI.setItems(e),a.emit(m.nextEventID())}},getEquippedItem:()=>this.item,changeEvent:a}});t.length>0&&n.openTabName("Enchants");const o=document.createElement("button");o.textContent="Remove from Batch",o.classList.add("btn","btn-danger"),o.onclick=()=>{s.setItems(s.getItems().filter(((e,t)=>t!=this.index))),n.close()};const l=n.header?.querySelector(".close-button");null!=l&&n.header?.insertBefore(o,l)};this.itemElem.iconElem.addEventListener("click",i),this.itemElem.nameElem.addEventListener("click",i),this.itemElem.enchantElem.addEventListener("click",i)}))}setItem(e){this.itemElem.clear(),null!=e?(this.itemElem.update(e),this.item=e):(this.itemElem.rootElem.style.opacity="30%",this.itemElem.iconElem.style.backgroundImage="url('/sod/assets/item_slots/empty.jpg')",this.itemElem.nameElem.textContent="Add new item (not implemented)",this.itemElem.rootElem.style.alignItems="center")}}class pd extends cd{constructor(e,i){super(e,i,{identifier:"bulk-tab",title:"Batch"}),t(this,"simUI"),t(this,"itemsChangedEmitter",new m),t(this,"leftPanel"),t(this,"rightPanel"),t(this,"column1",this.buildColumn(1,"raid-settings-col")),t(this,"items",new Array),t(this,"pendingResults"),t(this,"pendingDiv"),t(this,"doCombos"),t(this,"fastMode"),t(this,"autoEnchant"),t(this,"gemIconElements"),this.simUI=i,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("bulk-tab-left","tab-panel-left"),this.leftPanel.appendChild(this.column1),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("bulk-tab-right","tab-panel-right"),this.pendingDiv=document.createElement("div"),this.pendingDiv.classList.add("results-pending-overlay"),this.pendingResults=new tn(this.pendingDiv),this.pendingResults.hideAll(),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.contentContainer.appendChild(this.pendingDiv),this.doCombos=!0,this.fastMode=!0,this.autoEnchant=!0,this.gemIconElements=[],this.buildTabContent(),this.simUI.sim.waitForInit().then((()=>{this.loadSettings()}))}getSettingsKey(){return this.simUI.getStorageKey("bulk-settings.v1")}loadSettings(){const e=window.localStorage.getItem(this.getSettingsKey());if(null!=e){let t=Wt.fromJsonString(e,{ignoreUnknownFields:!0});this.doCombos=t.combinations,this.fastMode=t.fastMode,this.autoEnchant=t.autoEnchant}}storeSettings(){const e=this.createBulkSettings(),t=Wt.toJsonString(e,{enumAsInteger:!0});window.localStorage.setItem(this.getSettingsKey().replace("wotlk","sod"),t),window.localStorage.setItem(this.getSettingsKey(),t)}createBulkSettings(){return Wt.create({items:this.items,combinations:this.doCombos,fastMode:this.fastMode,autoEnchant:this.autoEnchant,iterationsPerCombo:this.simUI.sim.getIterations()})}createBulkItemsDatabase(){const e=Ot.create();for(const t of this.items){const i=this.simUI.sim.db.lookupItemSpec(t);if(!i)throw new Error(`item with ID ${t.id} not found in database`);e.items.push(Ht.fromJson(Nt.toJson(i.item),{ignoreUnknownFields:!0})),i.enchant&&e.enchants.push(qt.fromJson(Bt.toJson(i.enchant),{ignoreUnknownFields:!0}))}return e}addItems(e){0==this.items.length?this.items=e:this.items=this.items.concat(e),this.itemsChangedEmitter.emit(m.nextEventID())}setItems(e){this.items=e,this.itemsChangedEmitter.emit(m.nextEventID())}clearItems(){this.items=new Array,this.itemsChangedEmitter.emit(m.nextEventID())}getItems(){const e=new Array;return this.items.forEach((t=>{e.push(It.clone(t))})),e}setCombinations(e){this.doCombos=e,this.itemsChangedEmitter.emit(m.nextEventID())}setFastMode(e){this.fastMode=e,this.itemsChangedEmitter.emit(m.nextEventID())}async runBulkSim(e){this.pendingResults.setPending();try{await this.simUI.sim.runBulkSim(this.createBulkSettings(),this.createBulkItemsDatabase(),e)}catch(t){this.simUI.handleCrash(t)}}buildTabContent(){const e=new wn(this.column1,"bulk-items",{header:{title:"Items"}});e.bodyElement.classList.add("gear-picker-root");const t=document.createElement("div");t.classList.add("bulk-items-text-line"),e.bodyElement.appendChild(t),t.innerHTML="<i>Notice: This is under very early but active development and experimental. You may also need to update your WoW AddOn if you want to import your bags.</i>";const i=document.createElement("div");i.classList.add("bulk-items-text-line"),e.bodyElement.appendChild(i);const s=document.createElement("div");s.classList.add("tab-panel-col","bulk-gear-combo"),e.bodyElement.appendChild(s),this.itemsChangedEmitter.on((()=>{if(s.innerHTML="",this.items.length>0){i.textContent="The following items will be simmed together with your equipped gear.";for(let e=0;e<this.items.length;++e){const t=this.items[e],i=this.simUI.sim.db.lookupItemSpec(t);new ud(s,this.simUI,this,i,e)}}})),this.clearItems();let a=new wn(this.column1,"bulk-results",{header:{title:"Results",extraCssClasses:["bulk-results-header"]}});a.rootElem.hidden=!0,a.bodyElement.classList.add("gear-picker-root","tab-panel-col"),this.simUI.sim.bulkSimStartEmitter.on((()=>{a.rootElem.hidden=!0})),this.simUI.sim.bulkSimResultEmitter.on(((e,t)=>{a.rootElem.hidden=0==t.results.length,a.bodyElement.innerHTML="";for(const i of t.results){const e=new wn(a.bodyElement,"bulk-result",{header:{title:""},bodyClasses:["bulk-results-body"]});new md(e,this.simUI,i,t.equippedGearResult)}}));const n=new wn(this.rightPanel,"bulk-settings",{header:{title:"Setup"}}),o=document.createElement("button");o.classList.add("btn","btn-primary","w-100","bulk-settings-button"),o.textContent="Simulate Batch",o.addEventListener("click",(()=>{this.pendingDiv.style.display="flex",this.leftPanel.classList.add("blurred"),this.rightPanel.classList.add("blurred");const e=o.innerHTML;o.disabled=!0,o.classList.add(".disabled"),o.innerHTML='<i class="fa fa-spinner fa-spin"></i>&nbsp;Running';let t=(new Date).getTime(),i=0,s=0,a=0,n=0;this.runBulkSim((l=>{console.log(l);const r=(new Date).getTime()-t,d=l.completedIterations/(r/1e3);0==n&&(n=l.totalSims),this.fastMode&&(0==s&&l.totalSims>0&&(s=Math.ceil(Math.log(l.totalSims/20)/Math.log(2))+1,a=1),l.totalSims<i&&(a+=1,t=(new Date).getTime())),this.setSimProgress(l,d,a,s,n),i=l.totalSims,null!=l.finalBulkResult&&(this.pendingDiv.style.display="none",this.leftPanel.classList.remove("blurred"),this.rightPanel.classList.remove("blurred"),this.pendingResults.hideAll(),o.disabled=!1,o.classList.remove(".disabled"),o.innerHTML=e)}))})),n.bodyElement.appendChild(o);const l=document.createElement("button");l.classList.add("btn","btn-secondary","w-100","bulk-settings-button"),l.innerHTML='<i class="fa fa-download"></i> Import From Bags',l.addEventListener("click",(()=>new hd(this.simUI.rootElem,this.simUI,this))),n.bodyElement.appendChild(l);const r=document.createElement("button");r.classList.add("btn","btn-secondary","w-100","bulk-settings-button"),r.innerHTML='<i class="fa fa-download"></i> Import Favorites',r.addEventListener("click",(()=>{const e=this.simUI.player.sim.getFilters().favoriteItems.map((e=>It.create({id:e})));this.addItems(e)})),n.bodyElement.appendChild(r);const d=document.createElement("button");let c=document.createElement("input");c.type="text",c.placeholder="search...",c.style.display="none";const h=document.createElement("ul");h.classList.add("batch-search-results");let m=Array();c.addEventListener("keyup",(e=>{if("Enter"==e.key){let e=Array();h.childNodes.forEach((t=>{const i=t.getAttribute("data-item-id");null!=i&&e.push(It.create({id:Number.parseInt(i)}))})),this.addItems(e)}})),c.addEventListener("input",(()=>{const e=c.value;if(h.innerHTML="",0==e.length)return;var t=e.split(" ");let i=0;m.every((e=>{let s=!0;const a=e.name.toLowerCase(),n=e.setName.toLowerCase();if(t.forEach((e=>{var t=e.toLowerCase();return!(!a.includes(t)&&!n.includes(t))||(s=!1,!1)})),s){let t=document.createElement("li");if(t.innerHTML=`<span>${e.name}</span>`,t.setAttribute("data-item-id",e.id.toString()),t.addEventListener("click",(()=>{this.addItems(Array(It.create({id:e.id})))})),e.heroic){let e=document.createElement("span");e.style.color="green",e.innerText="[H]",t.appendChild(e)}if(e.factionRestriction==Y.HORDE_ONLY){let e=document.createElement("span");e.style.color="red",e.innerText="(H)",t.appendChild(e)}if(e.factionRestriction==Y.ALLIANCE_ONLY){let e=document.createElement("span");e.style.color="blue",e.innerText="(A)",t.appendChild(e)}h.append(t),i++}return i<10}))})),d.classList.add("btn","btn-secondary","w-100","bulk-settings-button");const u='<i class="fa fa-search"></i> Add Item';d.innerHTML=u,d.addEventListener("click",(()=>{"none"==c.style.display?(d.innerHTML="Close Search Results",m=this.simUI.sim.db.getAllItems().filter((e=>F(this.simUI.player,e,void 0))),c.style.display="block",c.focus()):(d.innerHTML=u,c.style.display="none",h.innerHTML="")})),n.bodyElement.appendChild(d),n.bodyElement.appendChild(c),n.bodyElement.appendChild(h);const p=document.createElement("button");p.classList.add("btn","btn-secondary","w-100","bulk-settings-button"),p.textContent="Clear All",p.addEventListener("click",(()=>{this.clearItems(),a.rootElem.hidden=!0,a.bodyElement.innerHTML=""})),n.bodyElement.appendChild(p),new an(n.bodyElement,this,{label:"Fast Mode",labelTooltip:"Fast mode reduces accuracy but will run faster.",changedEvent:e=>this.itemsChangedEmitter,getValue:e=>this.fastMode,setValue:(e,t,i)=>{t.fastMode=i}}),new an(n.bodyElement,this,{label:"Combinations",labelTooltip:"When checked bulk simulator will create all possible combinations of the items. When disabled trinkets and rings will still run all combinations becausee they have two slots to fill each.",changedEvent:e=>this.itemsChangedEmitter,getValue:e=>this.doCombos,setValue:(e,t,i)=>{t.doCombos=i}}),new an(n.bodyElement,this,{label:"Auto Enchant",labelTooltip:"When checked bulk simulator apply the current enchant for a slot to each replacement item it can.",changedEvent:e=>this.itemsChangedEmitter,getValue:e=>this.autoEnchant,setValue:(e,t,i)=>{t.autoEnchant=i}})}setSimProgress(e,t,i,s,a){const n=((e.totalIterations-e.completedIterations)/t).toFixed();let o="";s>0&&(o=`${i} / ${s} refining rounds`),this.pendingResults.setContent(`\n      <div class="results-sim">\n        <div class="">${a} total combinations.</div>\n        <div class="">${o}</div>\n        <div class=""> ${e.completedSims} / ${e.totalSims}<br>simulations complete</div>\n        <div class="">\n          ${e.completedIterations} / ${e.totalIterations}<br>iterations complete\n        </div>\n        <div class="">\n          ${n} seconds remaining.\n        </div>\n      </div>\n    `)}}class gd extends v{constructor(e,i,s){super(e,"saved-data-manager-root"),t(this,"modObject"),t(this,"config"),t(this,"userData"),t(this,"presets"),t(this,"savedDataDiv"),t(this,"presetDataDiv"),t(this,"customDataDiv"),t(this,"saveInput"),t(this,"frozen"),this.modObject=i,this.config=s,this.userData=[],this.presets=[],this.frozen=!1;let a=new wn(this.rootElem,"saved-data",{header:s.header});a.bodyElement.innerHTML='\n\t\t\t<div class="saved-data-container hide">\n\t\t\t\t<div class="saved-data-presets"></div>\n\t\t\t\t<div class="saved-data-custom"></div>\n\t\t\t</div>\n\t\t',this.savedDataDiv=a.bodyElement.querySelector(".saved-data-container"),this.presetDataDiv=a.bodyElement.querySelector(".saved-data-presets"),this.customDataDiv=a.bodyElement.querySelector(".saved-data-custom"),s.presetsOnly||(a.bodyElement.appendChild(this.buildCreateContainer()),this.saveInput=a.bodyElement.querySelector(".saved-data-save-input"))}addSavedData(e){this.savedDataDiv.classList.remove("hide");const t=this.makeSavedData(e),i=e.isPreset?this.presets:this.userData,s=i.findIndex((t=>t.name==e.name));-1==s?(e.isPreset?this.presetDataDiv.appendChild(t.elem):this.customDataDiv.appendChild(t.elem),i.push(t)):(i[s].elem.replaceWith(t.elem),i[s]=t)}makeSavedData(e){const t=document.createElement("fragment");t.innerHTML=`\n\t\t\t<div class="saved-data-set-chip badge rounded-pill">\n\t\t\t\t<a href="javascript:void(0)" class="saved-data-set-name" role="button">${e.name}</a>\n\t\t\t</div>\n\t\t`;const i=t.children[0];if(i.addEventListener("click",(t=>{this.config.setData(m.nextEventID(),this.modObject,e.data),this.saveInput&&(this.saveInput.value=e.name)})),!e.isPreset){let t=document.createElement("fragment");t.innerHTML='\n\t\t\t\t<a\n\t\t\t\t\thref="javascript:void(0)"\n\t\t\t\t\tclass="saved-data-set-delete"\n\t\t\t\t\trole="button"\n\t\t\t\t>\n\t\t\t\t\t<i class="fa fa-times fa-lg"></i>\n\t\t\t\t</a>\n\t\t\t';const s=t.children[0];i.appendChild(s);const a=da.getOrCreateInstance(s,{title:`Delete saved ${this.config.label}`});s.addEventListener("click",(t=>{t.stopPropagation();if(!confirm(`Delete saved ${this.config.label} '${e.name}'?`))return;a.dispose();const i=this.userData.findIndex((t=>t.name==e.name));this.userData[i].elem.remove(),this.userData.splice(i,1),this.saveUserData()}))}e.tooltip&&da.getOrCreateInstance(i,{title:e.tooltip,placement:"bottom",html:!0});const s=()=>{this.config.equals(e.data,this.config.getData(this.modObject))?i.classList.add("active"):i.classList.remove("active"),e.enableWhen&&!e.enableWhen(this.modObject)?i.classList.add("disabled"):i.classList.remove("disabled")};return s(),this.config.changeEmitters.forEach((e=>e.on(s))),{name:e.name,data:e.data,elem:i,enableWhen:e.enableWhen}}saveUserData(){const e={};this.userData.forEach((t=>{e[t.name]=this.config.toJson(t.data)})),0==this.userData.length&&0==this.presets.length&&this.savedDataDiv.classList.add("hide"),window.localStorage.setItem(this.config.storageKey.replace("wotlk","sod"),JSON.stringify(e)),window.localStorage.setItem(this.config.storageKey,JSON.stringify(e))}loadUserData(){const e=window.localStorage.getItem(this.config.storageKey);if(!e)return;let t;try{t=JSON.parse(e)}catch(i){console.warn("Invalid json for local storage value: "+e)}for(let s in t)try{this.addSavedData({name:s,data:this.config.fromJson(t[s])})}catch(i){console.warn("Failed parsing saved data: "+t[s])}}freeze(){this.frozen=!0,this.rootElem.classList.add("frozen")}buildCreateContainer(){let e=document.createElement("fragment");e.innerHTML=`\n\t\t\t<div class="saved-data-create-container">\n\t\t\t\t<label class="form-label">${this.config.label} Name</label>\n\t\t\t\t<input class="saved-data-save-input form-control" type="text" placeholder="Name">\n\t\t\t\t<button class="saved-data-save-button btn btn-primary">Save ${this.config.label}</button>\n\t\t\t</div>\n\t\t`;return e.querySelector(".saved-data-save-button").addEventListener("click",(e=>{if(this.frozen)return;const t=this.saveInput?.value;t?t in this.presets?alert(`${this.config.label} with name ${t} already exists.`):(this.addSavedData({name:t,data:this.config.getData(this.modObject)}),this.saveUserData()):alert(`Choose a label for your saved ${this.config.label}!`)})),e.children[0]}}class fd extends cd{constructor(e,i){super(e,i,{identifier:"gear-tab",title:"Gear"}),t(this,"simUI"),t(this,"leftPanel"),t(this,"rightPanel"),this.simUI=i,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("gear-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("gear-tab-right","tab-panel-right"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.buildGearPickers(),this.buildSavedGearsetPicker()}buildGearPickers(){new td(this.leftPanel,this.simUI,this.simUI.player)}buildSavedGearsetPicker(){const e=new gd(this.rightPanel,this.simUI.player,{header:{title:"Gear Sets"},label:"Gear Set",storageKey:this.simUI.getSavedGearStorageKey(),getData:e=>$t.create({gear:e.getGear().asSpec(),bonusStatsStats:e.getBonusStats().toProto()}),setData:(e,t,i)=>{m.freezeAllAndDo((()=>{t.setGear(e,this.simUI.sim.db.lookupEquipmentSpec(i.gear||ft.create())),t.setBonusStats(e,ga.fromProto(i.bonusStatsStats||l.create()))}))},changeEmitters:[this.simUI.player.changeEmitter],equals:(e,t)=>$t.equals(e,t),toJson:e=>$t.toJson(e),fromJson:e=>$t.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),this.simUI.individualConfig.presets.gear.forEach((t=>{e.addSavedData({name:t.name,tooltip:t.tooltip,isPreset:!0,data:$t.create({gear:this.simUI.sim.db.lookupEquipmentSpec(t.gear).asSpec(),bonusStatsStats:(new ga).toProto()}),enableWhen:t.enableWhen})}))}))}}const Id={actions:{create:{useIcon:!1}}};var wd=null;class bd extends I{constructor(e,i,s){if(super(e,"list-picker-root",i,s),t(this,"config"),t(this,"itemsDiv"),t(this,"itemPickerPairs"),this.config={...Id,...s},this.itemPickerPairs=[],this.rootElem.appendChild(w(S,null,s.title&&w("label",{className:"list-picker-title form-label"},s.title),w("div",{className:"list-picker-items"}))),this.config.hideUi&&this.rootElem.classList.add("d-none"),this.config.horizontalLayout&&(this.config.inlineMenuBar=!0,this.rootElem.classList.add("horizontal")),this.config.titleTooltip){let e={title:this.config.titleTooltip};da.getOrCreateInstance(this.rootElem.querySelector(".list-picker-title"),e)}if(this.itemsDiv=this.rootElem.getElementsByClassName("list-picker-items")[0],this.actionEnabled("create")){let e=null,t=null;this.config.actions?.create?.useIcon?(e=bd.makeActionElem("link-success","fa-plus"),t=da.getOrCreateInstance(e,{title:`New ${s.itemLabel}`})):(e=document.createElement("button"),e.classList.add("btn","btn-primary"),e.textContent=`New ${s.itemLabel}`),e.classList.add("list-picker-new-button"),e.addEventListener("click",(e=>{const i=this.config.newItem(),s=this.config.getValue(this.modObject).concat([i]);this.config.setValue(m.nextEventID(),this.modObject,s),t&&t.hide()})),this.rootElem.appendChild(e)}this.init()}getInputElem(){return this.rootElem}getInputValue(){return this.itemPickerPairs.map((e=>e.picker.getInputValue()))}setInputValue(e){if(e.length<this.itemPickerPairs.length)this.itemPickerPairs.slice(e.length).forEach((e=>e.elem.remove())),this.itemPickerPairs=this.itemPickerPairs.slice(0,e.length);else if(e.length>this.itemPickerPairs.length){const t=e.length-this.itemPickerPairs.length;for(let e=0;e<t;e++)this.addNewPicker()}e.forEach(((e,t)=>this.itemPickerPairs[t].picker.setInputValue(e)))}actionEnabled(e){return!this.config.allowedActions||this.config.allowedActions.includes(e)}addNewPicker(){const e=this.itemPickerPairs.length,t=document.createElement("div");t.classList.add("list-picker-item-container"),this.config.inlineMenuBar&&t.classList.add("inline"),this.itemsDiv.appendChild(t);const i=document.createElement("div");i.classList.add("list-picker-item");const s=document.createElement("div");if(s.classList.add("list-picker-item-header"),this.config.inlineMenuBar)t.appendChild(i),t.appendChild(s);else if(t.appendChild(s),t.appendChild(i),this.config.itemLabel){const e=document.createElement("h6");e.classList.add("list-picker-item-title"),e.textContent=`${this.config.itemLabel} ${this.itemPickerPairs.length+1}`,s.appendChild(e)}const a=this.config.newItemPicker(i,this,e,{changedEvent:this.config.changedEvent,getValue:t=>this.getSourceValue()[e],setValue:(t,i,s)=>{const a=this.getSourceValue();a[e]=s,this.config.setValue(t,i,a)}}),n={elem:t,picker:a,idx:e};if(this.actionEnabled("move")){const i=bd.makeActionElem("list-picker-item-move","fa-arrows-up-down");s.appendChild(i);const a=da.getOrCreateInstance(i,{title:"Move (Drag+Drop)"});i.addEventListener("click",(e=>{a.hide()})),i.draggable=!0,i.ondragstart=e=>{e.target==i&&(e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move",t.classList.add("dragfrom"),wd={listPicker:this,item:n})};let o=0;t.ondragenter=e=>{wd&&wd.listPicker==this&&(e.preventDefault(),o++,t.classList.add("dragto"))},t.ondragleave=e=>{wd&&wd.listPicker==this&&(e.preventDefault(),o--,o<=0&&t.classList.remove("dragto"))},t.ondragover=e=>{wd&&wd.listPicker==this&&e.preventDefault()},t.ondrop=i=>{if(!wd||wd.listPicker!=this)return;i.preventDefault(),o=0,t.classList.remove("dragto"),wd.item.elem.classList.remove("dragfrom");const s=wd.item.idx,a=e,n=this.config.getValue(this.modObject),l=n[s];n.splice(s,1),n.splice(a,0,l),this.config.setValue(m.nextEventID(),this.modObject,n),wd=null}}if(this.actionEnabled("copy")){const t=bd.makeActionElem("list-picker-item-copy","fa-copy");s.appendChild(t);const i=da.getOrCreateInstance(t,{title:`Copy to New ${this.config.itemLabel}`});t.addEventListener("click",(t=>{const s=this.config.getValue(this.modObject).slice();s.splice(e,0,this.config.copyItem(s[e])),this.config.setValue(m.nextEventID(),this.modObject,s),i.hide()}))}if(this.actionEnabled("delete")){const t=bd.makeActionElem("list-picker-item-delete","fa-times");t.classList.add("link-danger"),s.appendChild(t);const i=da.getOrCreateInstance(t,{title:`Delete ${this.config.itemLabel}`});t.addEventListener("click",(t=>{const s=this.config.getValue(this.modObject);s.splice(e,1),this.config.setValue(m.nextEventID(),this.modObject,s),i.hide()}))}this.itemPickerPairs.push(n)}static makeActionElem(e,t){const i=document.createElement("a");i.classList.add("list-picker-item-action",e),i.href="javascript:void(0)",i.setAttribute("role","button");const s=document.createElement("i");return s.classList.add("fa","fa-xl",t),i.appendChild(s),i}static getItemHeaderElem(e){const t=e.rootElem.parentElement,i=t.nextElementSibling||t.previousElementSibling;if(!i?.classList.contains("list-picker-item-header"))throw new Error("Could not find list item header");return i}}class vd extends v{constructor(e,t,i,s){super(e,"encounter-picker-root"),yd(this.rootElem,t,i.showExecuteProportion),t.sim.waitForInit().then((()=>{const e=t.sim.db.getAllPresetTargets();new nn(this.rootElem,t,{extraCssClasses:["damage-metrics","npc-picker"],label:"NPC",labelTooltip:"Selects a preset NPC configuration.",values:[{name:"Custom",value:-1}].concat(e.map(((e,t)=>({name:e.path,value:t})))),changedEvent:e=>e.changeEmitter,getValue:t=>e.findIndex((e=>kd(t.primaryTarget,e.target))),setValue:(t,i,s)=>{-1!=s&&i.applyPresetTarget(t,e[s],0)}}),s.isIndividualSim()&&Gt(s.player.spec)&&new en(this.rootElem,s.sim.raid,{label:"Num Allies",labelTooltip:"Number of allied players in the raid.",changedEvent:e=>e.targetDummiesChangeEmitter,getValue:e=>e.getTargetDummies(),setValue:(e,t,i)=>{t.setTargetDummies(e,i)}}),s.isIndividualSim()&&oe(s.player.spec)&&new en(this.rootElem,t,{label:"Min Base Damage",labelTooltip:"Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.",changedEvent:e=>e.changeEmitter,getValue:e=>e.primaryTarget.minBaseDamage,setValue:(e,t,i)=>{t.primaryTarget.minBaseDamage=i,t.targetsChangeEmitter.emit(e)}});let i=e.findIndex((e=>t.primaryTarget.id==e.target?.id)),a=e[i]?.target?.targetInputs||[];(a.length!=t.primaryTarget.targetInputs.length||t.primaryTarget.targetInputs.some(((e,t)=>e.label!=a[t].label)))&&(t.primaryTarget.targetInputs=a,t.targetsChangeEmitter.emit(m.nextEventID())),Pd(this.rootElem,t,0);const n=document.createElement("button");n.classList.add("advanced-button","btn","btn-primary"),n.textContent="Advanced",n.addEventListener("click",(()=>new xd(s.rootElem,s,t))),this.rootElem.appendChild(n)}))}}class xd extends dn{constructor(e,i,s){super(e,"advanced-encounter-picker-modal"),t(this,"encounter"),this.encounter=s,this.addHeader(),this.body.innerHTML='\n\t\t\t<div class="encounter-header"></div>\n\t\t\t<div class="encounter-targets"></div>\n\t\t';const a=this.rootElem.getElementsByClassName("encounter-header")[0],n=this.rootElem.getElementsByClassName("encounter-targets")[0];yd(a,this.encounter,!0),i.isIndividualSim()||new an(a,s,{label:"Use Health",labelTooltip:"Uses a damage limit in place of a duration limit. Damage limit is equal to sum of all targets health.",changedEvent:e=>e.changeEmitter,getValue:e=>e.getUseHealth(),setValue:(e,t,i)=>{t.setUseHealth(e,i)}}),new bd(n,this.encounter,{extraCssClasses:["targets-picker","mb-0"],itemLabel:"Target",changedEvent:e=>e.targetsChangeEmitter,getValue:e=>e.targets,setValue:(e,t,i)=>{t.targets=i,t.targetsChangeEmitter.emit(e)},newItem:()=>za.defaultTargetProto(),copyItem:e=>ce.clone(e),newItemPicker:(e,t,i,a)=>new Sd(e,s,i,a)})}addHeader(){const e=this.encounter.sim.db.getAllPresetEncounters();new nn(this.header,this.encounter,{label:"Encounter",extraCssClasses:["encounter-picker","mb-0","pe-2"],values:[{name:"Custom",value:-1}].concat(e.map(((e,t)=>({name:e.path,value:t})))),changedEvent:e=>e.changeEmitter,getValue:t=>e.findIndex((e=>t.matchesPreset(e))),setValue:(t,i,s)=>{-1!=s&&i.applyPreset(t,e[s])}})}}class Sd extends I{constructor(e,i,s,a){super(e,"target-picker-root",i,a),t(this,"encounter"),t(this,"targetIndex"),t(this,"aiPicker"),t(this,"levelPicker"),t(this,"mobTypePicker"),t(this,"tankIndexPicker"),t(this,"statPickers"),t(this,"swingSpeedPicker"),t(this,"minBaseDamagePicker"),t(this,"dualWieldPicker"),t(this,"dwMissPenaltyPicker"),t(this,"parryHastePicker"),t(this,"spellSchoolPicker"),t(this,"damageSpreadPicker"),t(this,"targetInputPickers"),this.encounter=i,this.targetIndex=s,this.rootElem.innerHTML='\n\t\t\t<div class="target-picker-section target-picker-section1"></div>\n\t\t\t<div class="target-picker-section target-picker-section2"></div>\n\t\t\t<div class="target-picker-section target-picker-section3 threat-metrics"></div>\n\t\t';const n=this.rootElem.getElementsByClassName("target-picker-section1")[0],o=this.rootElem.getElementsByClassName("target-picker-section2")[0],l=this.rootElem.getElementsByClassName("target-picker-section3")[0],r=i.sim.db.getAllPresetTargets();new nn(n,null,{extraCssClasses:["npc-picker"],label:"NPC",labelTooltip:"Selects a preset NPC configuration.",values:[{name:"Custom",value:-1}].concat(r.map(((e,t)=>({name:e.path,value:t})))),changedEvent:()=>i.targetsChangeEmitter,getValue:()=>r.findIndex((e=>kd(this.getTarget(),e.target))),setValue:(e,t,s)=>{-1!=s&&(i.applyPresetTarget(e,r[s],this.targetIndex),i.targetsChangeEmitter.emit(e))}}),this.aiPicker=new nn(n,null,{extraCssClasses:["ai-picker"],label:"AI",labelTooltip:"\n\t\t\t\t<p>Determines the target's ability rotation.</p>\n\t\t\t\t<p>Note that most rotations are not yet implemented.</p>\n\t\t\t",values:[{name:"None",value:0}].concat(r.map((e=>({name:e.path,value:e.target.id})))),changedEvent:()=>i.targetsChangeEmitter,getValue:()=>this.getTarget().id,setValue:(e,t,s)=>{const a=this.getTarget();a.id=s,a.targetInputs=(r.find((e=>a.id==e.target?.id))?.target?.targetInputs||[]).map((e=>Kt.clone(e))),i.targetsChangeEmitter.emit(e)}}),this.levelPicker=new nn(n,null,{label:"Level",values:[{name:"63",value:63},{name:"62",value:62},{name:"61",value:61},{name:"60",value:60},{name:"53",value:53},{name:"52",value:52},{name:"51",value:51},{name:"50",value:50},{name:"43",value:43},{name:"42",value:42},{name:"41",value:41},{name:"40",value:40},{name:"28",value:28},{name:"27",value:27},{name:"26",value:26},{name:"25",value:25}],changedEvent:()=>i.targetsChangeEmitter,getValue:()=>this.getTarget().level,setValue:(e,t,s)=>{this.getTarget().level=s,i.targetsChangeEmitter.emit(e)}}),this.mobTypePicker=new nn(n,null,{label:"Mob Type",values:Ld,changedEvent:()=>i.targetsChangeEmitter,getValue:()=>this.getTarget().mobType,setValue:(e,t,s)=>{this.getTarget().mobType=s,i.targetsChangeEmitter.emit(e)}}),this.tankIndexPicker=new nn(n,null,{extraCssClasses:["threat-metrics"],label:"Tanked By",labelTooltip:"Determines which player in the raid this enemy will attack. If no player is assigned to the specified tank slot, this enemy will not attack.",values:[{name:"None",value:-1},{name:"Main Tank",value:0},{name:"Tank 2",value:1},{name:"Tank 3",value:2},{name:"Tank 4",value:3}],changedEvent:()=>i.targetsChangeEmitter,getValue:()=>this.getTarget().tankIndex,setValue:(e,t,s)=>{this.getTarget().tankIndex=s,i.targetsChangeEmitter.emit(e)}}),this.targetInputPickers=Pd(n,i,this.targetIndex),this.statPickers=Cd.map((e=>{const t=e.stat;return new en(o,null,{inline:!0,extraCssClasses:e.extraCssClasses,label:Jt.get(t),labelTooltip:e.tooltip,changedEvent:()=>i.targetsChangeEmitter,getValue:()=>this.getTarget().stats[t],setValue:(e,s,a)=>{this.getTarget().stats[t]=a,i.targetsChangeEmitter.emit(e)}})})),this.swingSpeedPicker=new en(l,null,{label:"Swing Speed",labelTooltip:"Time in seconds between auto attacks. Set to 0 to disable auto attacks.",float:!0,changedEvent:()=>i.targetsChangeEmitter,getValue:()=>this.getTarget().swingSpeed,setValue:(e,t,s)=>{this.getTarget().swingSpeed=s,i.targetsChangeEmitter.emit(e)}}),this.minBaseDamagePicker=new en(l,null,{label:"Min Base Damage",labelTooltip:"Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.",changedEvent:()=>i.targetsChangeEmitter,getValue:()=>this.getTarget().minBaseDamage,setValue:(e,t,s)=>{this.getTarget().minBaseDamage=s,i.targetsChangeEmitter.emit(e)}}),this.damageSpreadPicker=new en(l,null,{label:"Damage Spread",labelTooltip:"Fractional spread between the minimum and maximum auto-attack damage from this enemy at 0 Attack Power.",float:!0,changedEvent:()=>i.targetsChangeEmitter,getValue:()=>this.getTarget().damageSpread,setValue:(e,t,s)=>{this.getTarget().damageSpread=s,i.targetsChangeEmitter.emit(e)}}),this.dualWieldPicker=new an(l,null,{label:"Dual Wield",labelTooltip:"Uses 2 separate weapons to attack.",inline:!0,changedEvent:()=>i.targetsChangeEmitter,getValue:()=>this.getTarget().dualWield,setValue:(e,t,s)=>{this.getTarget().dualWield=s,i.targetsChangeEmitter.emit(e)}}),this.dwMissPenaltyPicker=new an(l,null,{label:"DW Miss Penalty",labelTooltip:"Enables the Dual Wield Miss Penalty (+19% chance to miss) if dual wielding. Bosses in Hyjal/BT/SWP usually have this disabled to stop tanks from avoidance stacking.",inline:!0,changedEvent:()=>i.targetsChangeEmitter,getValue:()=>this.getTarget().dualWieldPenalty,setValue:(e,t,s)=>{this.getTarget().dualWieldPenalty=s,i.targetsChangeEmitter.emit(e)},enableWhen:()=>this.getTarget().dualWield}),this.parryHastePicker=new an(l,null,{label:"Parry Haste",labelTooltip:"Whether this enemy will gain parry haste when parrying attacks.",inline:!0,changedEvent:()=>i.targetsChangeEmitter,getValue:()=>this.getTarget().parryHaste,setValue:(e,t,s)=>{this.getTarget().parryHaste=s,i.targetsChangeEmitter.emit(e)}}),this.spellSchoolPicker=new nn(l,null,{label:"Spell School",labelTooltip:"Type of damage caused by auto attacks. This is usually Physical, but some enemies have elemental attacks.",values:[{name:"Physical",value:ge.SpellSchoolPhysical},{name:"Arcane",value:ge.SpellSchoolArcane},{name:"Fire",value:ge.SpellSchoolFire},{name:"Frost",value:ge.SpellSchoolFrost},{name:"Holy",value:ge.SpellSchoolHoly},{name:"Nature",value:ge.SpellSchoolNature},{name:"Shadow",value:ge.SpellSchoolShadow}],changedEvent:()=>i.targetsChangeEmitter,getValue:()=>this.getTarget().spellSchool,setValue:(e,t,s)=>{this.getTarget().spellSchool=s,i.targetsChangeEmitter.emit(e)}}),this.init()}getTarget(){return this.encounter.targets[this.targetIndex]||ce.create()}getInputElem(){return null}getInputValue(){return ce.create({id:this.aiPicker.getInputValue(),level:this.levelPicker.getInputValue(),mobType:this.mobTypePicker.getInputValue(),tankIndex:this.tankIndexPicker.getInputValue(),swingSpeed:this.swingSpeedPicker.getInputValue(),minBaseDamage:this.minBaseDamagePicker.getInputValue(),dualWield:this.dualWieldPicker.getInputValue(),dualWieldPenalty:this.dwMissPenaltyPicker.getInputValue(),parryHaste:this.parryHastePicker.getInputValue(),spellSchool:this.spellSchoolPicker.getInputValue(),damageSpread:this.damageSpreadPicker.getInputValue(),stats:this.statPickers.map((e=>e.getInputValue())).map(((e,t)=>(new ga).withStat(Cd[t].stat,e))).reduce(((e,t)=>e.add(t))).asArray(),targetInputs:this.targetInputPickers.getInputValue()})}setInputValue(e){e&&(this.aiPicker.setInputValue(e.id),this.levelPicker.setInputValue(e.level),this.mobTypePicker.setInputValue(e.mobType),this.tankIndexPicker.setInputValue(e.tankIndex),this.swingSpeedPicker.setInputValue(e.swingSpeed),this.minBaseDamagePicker.setInputValue(e.minBaseDamage),this.dualWieldPicker.setInputValue(e.dualWield),this.dwMissPenaltyPicker.setInputValue(e.dualWieldPenalty),this.parryHastePicker.setInputValue(e.parryHaste),this.spellSchoolPicker.setInputValue(e.spellSchool),this.damageSpreadPicker.setInputValue(e.damageSpread),Cd.forEach(((t,i)=>this.statPickers[i].setInputValue(e.stats[t.stat]))),this.targetInputPickers.setInputValue(e.targetInputs))}}class Ed extends I{constructor(e,i,s,a,n){super(e,"target-input-picker-root",i,n),t(this,"encounter"),t(this,"targetIndex"),t(this,"targetInputIndex"),t(this,"boolPicker"),t(this,"numberPicker"),this.encounter=i,this.targetIndex=s,this.targetInputIndex=a,this.boolPicker=null,this.numberPicker=null,this.init()}getTargetInput(){return this.encounter.targets[this.targetIndex].targetInputs[this.targetInputIndex]||Kt.create()}getInputElem(){return this.rootElem}getInputValue(){return Kt.create({boolValue:this.boolPicker?this.boolPicker.getInputValue():void 0,numberValue:this.numberPicker?this.numberPicker.getInputValue():void 0})}setInputValue(e){e&&(e.inputType!=Zt.Number||this.numberPicker?e.inputType!=Zt.Bool||this.boolPicker||(this.numberPicker&&(this.numberPicker.rootElem.remove(),this.numberPicker=null),this.boolPicker=new an(this.rootElem,null,{label:e.label,labelTooltip:e.tooltip,changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().boolValue,setValue:(e,t,i)=>{this.getTargetInput().boolValue=i,this.encounter.targetsChangeEmitter.emit(e)}})):(this.boolPicker&&(this.boolPicker.rootElem.remove(),this.boolPicker=null),this.numberPicker=new en(this.rootElem,null,{label:e.label,labelTooltip:e.tooltip,changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().numberValue,setValue:(e,t,i)=>{this.getTargetInput().numberValue=i,this.encounter.targetsChangeEmitter.emit(e)}})))}}function yd(e,t,i){let s=I.newGroupContainer();if(e.appendChild(s),new en(s,t,{label:"Duration",labelTooltip:"The fight length for each sim iteration, in seconds.",changedEvent:e=>e.changeEmitter,getValue:e=>e.getDuration(),setValue:(e,t,i)=>{t.setDuration(e,i)},enableWhen:e=>!t.getUseHealth()}),new en(s,t,{label:"Duration +/-",labelTooltip:"Adds a random amount of time, in seconds, between [value, -1 * value] to each sim iteration. For example, setting Duration to 180 and Duration +/- to 10 will result in random durations between 170s and 190s.",changedEvent:e=>e.changeEmitter,getValue:e=>e.getDurationVariation(),setValue:(e,t,i)=>{t.setDurationVariation(e,i)},enableWhen:e=>!t.getUseHealth()}),i){let i=I.newGroupContainer();i.classList.add("execute-group"),e.appendChild(i),new en(i,t,{label:"Execute Duration 20 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 20% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion20(),setValue:(e,t,i)=>{t.setExecuteProportion20(e,i/100)},enableWhen:e=>!t.getUseHealth()}),new en(i,t,{label:"Execute Duration 25 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 25% HP) for the purpose of effects like Warlock's Drain Soul.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion25(),setValue:(e,t,i)=>{t.setExecuteProportion25(e,i/100)},enableWhen:e=>!t.getUseHealth()}),new en(i,t,{label:"Execute Duration 35 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 35% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion35(),setValue:(e,t,i)=>{t.setExecuteProportion35(e,i/100)},enableWhen:e=>!t.getUseHealth()})}}function Pd(e,t,i){return new bd(e,t,{itemLabel:"Target Input",changedEvent:e=>e.targetsChangeEmitter,getValue:e=>e.targets[i].targetInputs,setValue:(e,t,s)=>{t.targets[i].targetInputs=s,t.targetsChangeEmitter.emit(e)},newItem:()=>Kt.create(),copyItem:e=>Kt.clone(e),newItemPicker:(e,s,a,n)=>new Ed(e,t,i,a,n),hideUi:!0})}function kd(e,t){if(null==e!=(null==t))return!1;if(null==e)return!0;const i=ce.clone(t);return i.targetInputs=e.targetInputs,ce.equals(e,i)}const Cd=[{stat:s.StatHealth,tooltip:"",extraCssClasses:[]},{stat:s.StatArmor,tooltip:"",extraCssClasses:[]},{stat:s.StatArcaneResistance,tooltip:"",extraCssClasses:[]},{stat:s.StatFireResistance,tooltip:"",extraCssClasses:[]},{stat:s.StatFrostResistance,tooltip:"",extraCssClasses:[]},{stat:s.StatNatureResistance,tooltip:"",extraCssClasses:[]},{stat:s.StatShadowResistance,tooltip:"",extraCssClasses:[]},{stat:s.StatAttackPower,tooltip:"",extraCssClasses:["threat-metrics"]},{stat:s.StatBlockValue,tooltip:"",extraCssClasses:["threat-metrics"]}],Ld=[{name:"None",value:pe.MobTypeUnknown},{name:"Beast",value:pe.MobTypeBeast},{name:"Demon",value:pe.MobTypeDemon},{name:"Dragonkin",value:pe.MobTypeDragonkin},{name:"Elemental",value:pe.MobTypeElemental},{name:"Giant",value:pe.MobTypeGiant},{name:"Humanoid",value:pe.MobTypeHumanoid},{name:"Mechanical",value:pe.MobTypeMechanical},{name:"Undead",value:pe.MobTypeUndead}];var Td=(e=>(e.Vertical="vertical",e.Horizontal="Horizontal",e))(Td||{});class _d extends I{constructor(e,i,s){super(e,"icon-enum-picker-root",i,s),t(this,"config"),t(this,"currentValue"),t(this,"storedValue"),t(this,"buttonElem"),t(this,"buttonText"),this.rootElem.classList.add("icon-picker","vertical"===(s.direction??"vertical")?"dropdown":"dropend"),this.config=s,this.currentValue=this.config.zeroValue,this.config.changedEvent(this.modObject).on((e=>{this.showWhen()?(this.restoreValue(),this.rootElem.classList.remove("hide")):(this.storeValue(),this.rootElem.classList.add("hide"))})),s.tooltip&&da.getOrCreateInstance(this.rootElem,{html:!0,title:s.tooltip}),this.rootElem.appendChild(w(S,null,w("a",{href:"javascript:void(0)",className:"icon-picker-button",attributes:{"aria-expanded":"false",role:"button"},dataset:{bsToggle:"dropdown",whtticon:"false",disableWowheadTouchTooltip:"true"}}),w("ul",{className:"dropdown-menu"}),w("label",{className:"form-label"}))),this.buttonElem=this.rootElem.querySelector(".icon-picker-button"),this.buttonText=this.rootElem.querySelector("label");const a=this.rootElem.querySelector(".dropdown-menu");this.config.numColumns&&(a.style.gridTemplateColumns=`repeat(${this.config.numColumns}, 1fr)`),"Horizontal"==this.config.direction&&(a.style.gridAutoFlow="column"),this.config.values.forEach(((e,t)=>{const i=document.createElement("li");i.classList.add("icon-dropdown-option","dropdown-option"),a.appendChild(i);const s=document.createElement("a");s.classList.add("icon-picker-button"),s.dataset.disableWowheadTouchTooltip="true",i.appendChild(s);const n=()=>{this.setImage(s,e),this.showValueWhen(e)?i.classList.remove("hide"):(i.classList.add("hide"),this.currentValue==e.value&&(this.setInputValue(this.config.zeroValue),this.inputChanged(m.nextEventID())))};this.config.changedEvent(this.modObject).on(n),n(),s.addEventListener("click",(t=>{t.preventDefault(),this.currentValue=e.value,this.storedValue=void 0,this.inputChanged(m.nextEventID())})),e.tooltip&&da.getOrCreateInstance(s,{html:!0,title:e.tooltip})})),this.init()}storeValue(){void 0===this.storedValue&&(this.storedValue=this.getInputValue(),this.setInputValue(this.config.zeroValue),this.inputChanged(m.nextEventID()))}restoreValue(){void 0!==this.storedValue&&(this.setInputValue(this.storedValue),this.inputChanged(m.nextEventID()),this.storedValue=void 0)}setActionImage(e,t){t.fillAndSet(e,!0,!0)}setImage(e,t){if(t.showWhen&&!t.showWhen(this.modObject))return void e.removeAttribute("href");const i=t.actionId?.(this.modObject);i?(this.setActionImage(e,i),e.style.filter=""):t.iconUrl?(e.style.backgroundImage=`url(${t.iconUrl})`,e.style.filter="grayscale(1)"):(e.style.backgroundImage="",e.style.filter="",e.style.backgroundColor=t.color)}update(){super.update(),this.setActive(this.enabled&&!this.config.equals(this.currentValue,this.config.zeroValue))}getInputElem(){return this.buttonElem}getInputValue(){return this.currentValue}setInputValue(e){this.currentValue=e,this.setActive(this.enabled&&!this.config.equals(this.currentValue,this.config.zeroValue)),this.buttonText.textContent="",this.buttonText.style.display="none";const t=this.config.values.find((e=>this.config.equals(e.value,this.currentValue)));if(t)this.setImage(this.buttonElem,t),null!=t.text&&(this.buttonText.style.display="block",this.buttonText.textContent=t.text);else if(this.config.backupIconUrl){const e=this.config.backupIconUrl(this.currentValue);this.setActionImage(this.buttonElem,e),this.setActive(!1)}}setActive(e){e?this.buttonElem.classList.add("active"):this.buttonElem.classList.remove("active")}showWhen(){return(!this.config.showWhen||this.config.showWhen(this.modObject))&&!!this.config.values.find((e=>e.actionId&&null!=e.actionId(this.modObject)&&(!e.showWhen||e.showWhen(this.modObject))))}showValueWhen(e){return(!e.actionId||null!=e.actionId?.(this.modObject))&&(!e.showWhen||e.showWhen(this.modObject))}}function Nd(e,t){return e.filter((e=>!t.individualConfig.excludeBuffDebuffInputs.includes(e.config)&&(0==e.stats.length||e.stats.some((e=>t.individualConfig.epStats.includes(e)))||t.individualConfig.includeBuffDebuffInputs.includes(e.config))))}class Rd extends v{constructor(e,i,s,a){super(e,"item-swap-picker-root"),t(this,"itemSlots"),t(this,"enableItemSwapPicker"),this.itemSlots=a.itemSlots,this.enableItemSwapPicker=new an(this.rootElem,s,{label:"Enable Item Swapping",labelTooltip:"Allows configuring an Item Swap Set which is used with the <b>Item Swap</b> APL action.",extraCssClasses:["input-inline"],getValue:e=>e.getEnableItemSwap(),setValue(e,t,i){t.setEnableItemSwap(e,i)},changedEvent:e=>e.itemSwapChangeEmitter});const n=document.createElement("div");let o;n.classList.add("input-root","input-inline"),this.rootElem.appendChild(n),a.note&&(o=this.rootElem.appendChild(w("p",{className:"form-text"},a.note)));const l=()=>{s.getEnableItemSwap()?(n.classList.remove("hide"),o?.classList.remove("hide")):(n.classList.add("hide"),o?.classList.add("hide"))};s.itemSwapChangeEmitter.on(l),l();const r=document.createElement("label");r.classList.add("form-label"),r.textContent="Item Swap",n.appendChild(r);let d=I.newGroupContainer();d.classList.add("icon-group"),n.appendChild(d);let c=document.createElement("fragment");c.innerHTML='\n\t\t\t<a\n\t\t\t\thref="javascript:void(0)"\n\t\t\t\tclass="gear-swap-icon"\n\t\t\t\trole="button"\n\t\t\t\tdata-bs-title="Swap with equipped items"\n\t\t\t>\n\t\t\t\t<i class="fas fa-arrows-rotate me-1"></i>\n\t\t\t</a>\n\t\t';const h=c.children[0];d.appendChild(h),h.addEventListener("click",(e=>this.swapWithGear(m.nextEventID(),s))),da.getOrCreateInstance(h),this.itemSlots.forEach((e=>{new ad(d,i,s,e)}))}swapWithGear(e,t){let i=t.getGear(),s=t.getItemSwapGear();this.itemSlots.forEach((e=>{const a=t.getGear().getEquippedItem(e),n=t.getItemSwapGear().getEquippedItem(e);i=i.withEquippedItem(e,n,t.canDualWield2H()),s=s.withEquippedItem(e,a,t.canDualWield2H())})),m.freezeAllAndDo((()=>{t.setGear(e,i),t.setItemSwapGear(e,s)}))}}class Ad extends I{constructor(e,i,s){super(e,"icon-picker-root",i,s),t(this,"active"),t(this,"config"),t(this,"rootAnchor"),t(this,"improvedAnchor"),t(this,"improvedAnchor2"),t(this,"counterElem"),t(this,"currentValue"),t(this,"storedValue"),t(this,"handleLeftClick",(e=>{0==this.config.states||this.currentValue+1<this.config.states?(this.currentValue++,this.inputChanged(m.nextEventID())):this.currentValue>0&&(this.currentValue=0,this.inputChanged(m.nextEventID())),e.preventDefault()})),t(this,"handleRightClick",(e=>{this.currentValue>0?this.currentValue--:0===this.config.states?this.currentValue=1:this.currentValue=this.config.states-1,this.inputChanged(m.nextEventID())})),this.rootElem.classList.add("icon-picker"),this.active=!1,this.config=s,this.currentValue=0,this.rootAnchor=document.createElement("a"),this.rootAnchor.classList.add("icon-picker-button"),this.rootAnchor.dataset.whtticon="false",this.rootAnchor.dataset.disableWowheadTouchTooltip="true",this.rootAnchor.target="_blank",this.rootElem.prepend(this.rootAnchor);const a=Boolean(this.config.improvedId);a&&this.rootAnchor.classList.add("use-improved-icons"),this.config.improvedId2&&this.rootAnchor.classList.add("use-improved-icons2"),!a&&this.config.states>2&&this.rootAnchor.classList.add("use-counter");let n=Ft(),o=Ft(),l=Ft();this.rootAnchor.appendChild(w("div",{className:"icon-input-level-container"},w("a",{ref:n,className:"icon-picker-button icon-input-improved icon-input-improved1",dataset:{disableWowheadTouchTooltip:"true"}}),w("a",{ref:o,className:"icon-picker-button icon-input-improved icon-input-improved2",dataset:{disableWowheadTouchTooltip:"true"}}),w("span",{ref:l,className:"icon-picker-label "+(this.config.states>2?"":"hide")}))),this.improvedAnchor=n.value,this.improvedAnchor2=o.value,this.counterElem=l.value,this.config.states>=3&&this.config.improvedId&&this.config.improvedId.fillAndSet(this.improvedAnchor,!0,!0),this.config.states>=4&&this.config.improvedId2&&this.config.improvedId2.fillAndSet(this.improvedAnchor2,!0,!0),this.config.changedEvent(this.modObject).on((e=>{this.config.actionId(this.modObject)?.fillAndSet(this.rootAnchor,!0,!0),this.showWhen()?(this.rootElem.classList.remove("hide"),this.restoreValue()):(this.storeValue(),this.rootElem.classList.add("hide"))})),this.init(),this.rootAnchor.addEventListener("click",(e=>{this.handleLeftClick(e)})),this.rootAnchor.addEventListener("contextmenu",(e=>{e.preventDefault()})),this.rootAnchor.addEventListener("mousedown",(e=>{E(e)&&(this.handleRightClick(e),e.preventDefault())}))}getInputElem(){return this.rootAnchor}getInputValue(){return 2==this.config.states?Boolean(this.currentValue):this.currentValue}getActionId(){const e=Number(this.config.getValue(this.modObject));return 0==e?null:1==e?this.config.actionId(this.modObject):2==e&&this.config.improvedId?this.config.improvedId:3==e&&this.config.improvedId2?this.config.improvedId2:this.config.actionId(this.modObject)}setInputValue(e){this.currentValue=Number(e),this.currentValue>0?(this.active=!0,this.rootAnchor.classList.add("active"),this.counterElem.classList.add("active")):(this.active=!1,this.rootAnchor.classList.remove("active"),this.counterElem.classList.remove("active")),this.config.states>=3&&this.config.improvedId&&(this.currentValue>1?this.improvedAnchor.classList.add("active"):this.improvedAnchor.classList.remove("active")),this.config.states>=4&&this.config.improvedId2&&(this.currentValue>2?(this.improvedAnchor2.classList.add("active"),this.improvedAnchor.hidden=!0,this.improvedAnchor2.hidden=!1):(this.improvedAnchor2.classList.remove("active"),this.improvedAnchor.hidden=!1,this.improvedAnchor2.hidden=!0)),!this.config.improvedId&&(this.config.states>3||0==this.config.states)&&(this.counterElem.textContent=String(this.currentValue))}storeValue(){void 0===this.storedValue&&(this.storedValue=this.getInputValue(),this.setInputValue(0),this.inputChanged(m.nextEventID()))}restoreValue(){void 0!==this.storedValue&&(this.setInputValue(this.storedValue),this.inputChanged(m.nextEventID()),this.storedValue=void 0)}showWhen(){return null!=this.config.actionId(this.modObject)&&(!this.config.showWhen||this.config.showWhen(this.modObject))}}class Dd extends v{constructor(e,i,s,a){super(e,"multi-icon-picker-root"),t(this,"config"),t(this,"currentValue"),t(this,"buttonElem"),t(this,"dropdownMenu"),t(this,"pickers"),this.rootElem.classList.add("icon-picker"),this.config=s,this.currentValue=null,this.rootElem.innerHTML='\n\t\t\t<div class="dropend">\n\t\t\t\t<a\n\t\t\t\t\tclass="icon-picker-button"\n\t\t\t\t\trole="button"\n\t\t\t\t\tdata-bs-toggle="dropdown"\n\t\t\t\t\taria-expanded="false"\n\t\t\t\t\tdata-disable-wowhead-touch-tooltip=\'true\'\n\t\t\t\t\tdata-whtticon=\'false\'\n\t\t\t\t></a>\n\t\t\t\t<ul class="dropdown-menu"></ul>\n\t\t\t</div>\n\t\t\t<label class="multi-icon-picker-label form-label"></label>\n    ';const n=this.rootElem.querySelector(".multi-icon-picker-label");s.label?n.textContent=s.label:n.remove(),this.buttonElem=this.rootElem.querySelector(".icon-picker-button"),this.dropdownMenu=this.rootElem.querySelector(".dropdown-menu"),this.buttonElem.addEventListener("hide.bs.dropdown",(e=>{e.hasOwnProperty("clickEvent")&&e.preventDefault()})),this.buttonElem.addEventListener("contextmenu",(e=>{e.preventDefault()})),this.buttonElem.addEventListener("mousedown",(e=>{E(e)&&this.clearPicker()})),this.buildBlankOption(),this.pickers=this.config.inputs.map(((e,t)=>{const s=document.createElement("li");return s.classList.add("icon-picker-option","dropdown-option"),this.dropdownMenu.appendChild(s),new Ad(s,i,e)})),a.sim.waitForInit().then((()=>this.updateButtonImage())),a.changeEmitter.on((()=>{this.updateButtonImage();!this.config.showWhen||this.config.showWhen(a.sim.raid.getPlayer(0))&&!!this.pickers.find((e=>e.showWhen()))?this.rootElem.classList.remove("hide"):this.rootElem.classList.add("hide")}))}buildBlankOption(){const e=document.createElement("li");this.dropdownMenu.appendChild(e);const t=document.createElement("a");t.classList.add("icon-dropdown-option","dropdown-option"),e.appendChild(t),t.addEventListener("click",(()=>this.clearPicker()))}clearPicker(){m.freezeAllAndDo((()=>{this.pickers.forEach((e=>{e.setInputValue(null),e.inputChanged(m.nextEventID())})),this.updateButtonImage()}))}updateButtonImage(){this.currentValue=this.getMaxValue(),this.currentValue?(this.buttonElem.classList.add("active"),null!=this.config.categoryId?this.config.categoryId.fillAndSet(this.buttonElem,!1,!0):this.currentValue.fillAndSet(this.buttonElem,!1,!0)):(this.buttonElem.classList.remove("active"),null!=this.config.categoryId?this.config.categoryId.fillAndSet(this.buttonElem,!1,!0):this.buttonElem.style.backgroundImage="",this.buttonElem.removeAttribute("href"))}getMaxValue(){return this.pickers.map((e=>e.getActionId())).filter((e=>null!=e))[0]||null}}function Md(e,t){return{inputs:e,label:t,showWhen:t=>e.filter((e=>!e.showWhen||e.showWhen(t))).length>0}}function Vd(e){const t=e.getModObject;return{type:"boolean",label:e.label,labelTooltip:e.labelTooltip,changedEvent:i=>e.changedEvent(t(i)),getValue:i=>e.getValue(t(i)),setValue:(i,s,a)=>e.setValue(i,t(s),a),enableWhen:e.enableWhen?i=>e.enableWhen(t(i)):void 0,showWhen:e.showWhen?i=>e.showWhen(t(i)):void 0,extraCssClasses:e.extraCssClasses}}function Ud(e){return Vd({label:e.label,labelTooltip:e.labelTooltip,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,i,s)=>{const a=i.getSpecOptions();a[e.fieldName]=s,i.setSpecOptions(t,a)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses})}function Fd(e){return Vd({label:e.label,labelTooltip:e.labelTooltip,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,i,s)=>{const a=i.getSimpleRotation();a[e.fieldName]=s,i.setSimpleRotation(t,a)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses})}function Wd(e){const t=e.getModObject;return{type:"number",label:e.label,labelTooltip:e.labelTooltip,float:e.float,positive:e.positive,changedEvent:i=>e.changedEvent(t(i)),getValue:i=>e.getValue(t(i)),setValue:(i,s,a)=>e.setValue(i,t(s),a),enableWhen:e.enableWhen?i=>e.enableWhen(t(i)):void 0,showWhen:e.showWhen?i=>e.showWhen(t(i)):void 0,extraCssClasses:e.extraCssClasses}}function Od(e){const t={label:e.label,labelTooltip:e.labelTooltip,float:e.float,positive:e.positive,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,i,s)=>{const a=i.getSpecOptions();a[e.fieldName]=s,i.setSpecOptions(t,a)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses};if(e.percent){const e=t.getValue;t.getValue=t=>100*e(t);const i=t.setValue;t.setValue=(e,t,s)=>i(e,t,s/100)}return Wd(t)}function Hd(e){const t={label:e.label,labelTooltip:e.labelTooltip,float:e.float,positive:e.positive,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,i,s)=>{const a=i.getSimpleRotation();a[e.fieldName]=s,i.setSimpleRotation(t,a)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses};if(e.percent){const e=t.getValue;t.getValue=t=>100*e(t);const i=t.setValue;t.setValue=(e,t,s)=>i(e,t,s/100)}return Wd(t)}function qd(e){const t=e.getModObject;return{type:"enum",label:e.label,labelTooltip:e.labelTooltip,values:e.values,changedEvent:i=>e.changedEvent(t(i)),getValue:i=>e.getValue(t(i)),setValue:(i,s,a)=>e.setValue(i,t(s),a),enableWhen:e.enableWhen?i=>e.enableWhen(t(i)):void 0,showWhen:e.showWhen?i=>e.showWhen(t(i)):void 0}}function Bd(e){return qd({label:e.label,labelTooltip:e.labelTooltip,values:e.values,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,i,s)=>{const a=i.getSpecOptions();a[e.fieldName]=s,i.setSpecOptions(t,a)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen})}function zd(e){return qd({label:e.label,labelTooltip:e.labelTooltip,values:e.values,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,i,s)=>{const a=i.getSimpleRotation();a[e.fieldName]=s,i.setSimpleRotation(t,a)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen})}function jd(e){const t=e.getModObject;return{type:"icon",actionId:i=>e.actionId(t(i)),states:e.states,showWhen:e.showWhen,changedEvent:i=>e.changedEvent(t(i)),getValue:i=>e.getValue(t(i)),setValue:(i,s,a)=>e.setValue(i,t(s),a),extraCssClasses:e.extraCssClasses}}function $d(e,t,i,s){return jd({getModObject:e.getModObject,actionId:t,states:2,changedEvent:e.changeEmitter,showWhen:e.showWhen,getValue:e.getFieldValue||(t=>s?e.getValue(t)[i]==s:e.getValue(t)[i]),setValue:e.setFieldValue||((t,a,n)=>{const o=e.getValue(a);s?n?o[i]=s:o[i]==s&&(o[i]=0):o[i]=n,e.setValue(t,a,o)}),extraCssClasses:e.extraCssClasses})}function Gd(e){return $d({getModObject:e=>e,getValue:e=>e.getSpecOptions(),setValue:(e,t,i)=>t.setSpecOptions(e,i),changeEmitter:e.changeEmitter||(e=>e.specOptionsChangeEmitter),extraCssClasses:e.extraCssClasses,getFieldValue:e.getValue,setFieldValue:e.setValue},e.actionId,e.fieldName,e.value)}function Kd(e,t,i,s){return jd({getModObject:e.getModObject,actionId:t,states:0,changedEvent:e.changeEmitter,showWhen:e.showWhen,getValue:t=>e.getValue(t)[i],setValue:(t,a,n)=>{const o=e.getValue(a);if(s){const e=n-o[i];n+=(s-1)*e}n<0&&(n=0),o[i]=n,e.setValue(t,a,o)}})}function Jd(e,t,i,s){const a=Kd(e,t,s);return a.states=3,a.improvedId=i,a}function Zd(e,t,i,s,a){const n=Kd(e,t,s,a);return n.states=i,n}function Yd(e,t,i,s,a){return function(e){const t=e.getModObject;return{type:"iconEnum",numColumns:e.numColumns,direction:e.direction,values:e.values.map((e=>{if(e.showWhen){const i=e.showWhen;e.showWhen=e=>i(t(e))}return e})),equals:e.equals,showWhen:i=>!e.showWhen||e.showWhen(t(i)),zeroValue:e.zeroValue,changedEvent:i=>e.changedEvent(t(i)),getValue:i=>e.getValue(t(i)),setValue:(i,s,a)=>e.setValue(i,t(s),a),extraCssClasses:e.extraCssClasses}}({direction:a||Td.Vertical,numColumns:s,values:i,zeroValue:0,equals:(e,t)=>e==t,getModObject:e.getModObject,changedEvent:e.changeEmitter,showWhen:e.showWhen,getValue:i=>e.getValue(i)[t],setValue:(i,s,a)=>{const n=e.getValue(s);n[t]=a,e.setValue(i,s,n)}})}function Qd(e){return Yd({showWhen:e.showWhen,getModObject:e=>e,getValue:e=>e.getSpecOptions(),setValue:(e,t,i)=>t.setSpecOptions(e,i),getFieldValue:e.getValue,setFieldValue:e.setValue,changeEmitter:e.changeEmitter||(e=>e.specOptionsChangeEmitter),extraCssClasses:e.extraCssClasses},e.fieldName,e.values,e.numColumns)}const Xd=(e,t,i)=>"icon"==i.type?new Ad(e,t,i):new _d(e,t,i);function ec(e,t){return e.label=t,e}function tc(e){return $d({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getRaid().getBuffs(),setValue:(e,t,i)=>t.getRaid().setBuffs(e,i),changeEmitter:e=>m.onAny([e.getRaid().buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.fieldName,e.value)}function ic(e){return $d({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getBuffs(),setValue:(e,t,i)=>t.setBuffs(e,i),changeEmitter:e=>m.onAny([e.buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.fieldName,e.value)}function sc(e){return $d({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getConsumes(),setValue:(e,t,i)=>t.setConsumes(e,i),changeEmitter:e=>m.onAny([e.consumesChangeEmitter,e.levelChangeEmitter])},e.actionId,e.fieldName,e.value)}function ac(e){return $d({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getRaid().getDebuffs(),setValue:(e,t,i)=>t.getRaid().setDebuffs(e,i),changeEmitter:e=>m.onAny([e.getRaid().debuffsChangeEmitter,e.levelChangeEmitter])},e.actionId,e.fieldName,e.value)}function nc(e){return Jd({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getRaid().getBuffs(),setValue:(e,t,i)=>t.getRaid().setBuffs(e,i),changeEmitter:e=>m.onAny([e.getRaid().buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.impId,e.fieldName)}function oc(e){return Jd({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getBuffs(),setValue:(e,t,i)=>t.setBuffs(e,i),changeEmitter:e=>m.onAny([e.buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.impId,e.fieldName)}function lc(e){return Jd({getModObject:e=>e,getValue:e=>e.getRaid().getDebuffs(),setValue:(e,t,i)=>t.getRaid().setDebuffs(e,i),changeEmitter:e=>m.onAny([e.getRaid().debuffsChangeEmitter,e.levelChangeEmitter])},e.actionId,e.impId,e.fieldName)}function rc(e){return Zd({getModObject:e=>e,showWhen:t=>!e.faction||e.faction==t.getFaction(),getValue:e=>e.getBuffs(),setValue:(e,t,i)=>t.setBuffs(e,i),changeEmitter:e=>m.onAny([e.buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.numStates,e.fieldName,e.multiplier)}function dc(e){return Zd({getModObject:e=>e.getRaid(),getValue:e=>e.getDebuffs(),setValue:(e,t,i)=>t.setDebuffs(e,i),changeEmitter:e=>e.debuffsChangeEmitter},e.actionId,e.numStates,e.fieldName,e.multiplier)}const cc={actionId:e=>e.getMatchingSpellActionId([{id:8017,minLevel:1,maxLevel:7},{id:8018,minLevel:8,maxLevel:15},{id:8019,minLevel:16,maxLevel:23},{id:10399,minLevel:24,maxLevel:33},{id:16314,minLevel:34,maxLevel:43},{id:16315,minLevel:44,maxLevel:53},{id:16316,minLevel:54}]),value:Yt.RockbiterWeapon,showWhen:e=>e.getClass()==g.ClassShaman},hc={actionId:e=>e.getMatchingSpellActionId([{id:8024,minLevel:10,maxLevel:17},{id:8027,minLevel:18,maxLevel:25},{id:8030,minLevel:26,maxLevel:35},{id:16339,minLevel:36,maxLevel:45},{id:16341,minLevel:46,maxLevel:55},{id:16342,minLevel:56}]),value:Yt.FlametongueWeapon,showWhen:e=>e.getClass()==g.ClassShaman},mc={actionId:e=>e.getMatchingSpellActionId([{id:8033,minLevel:20,maxLevel:27},{id:8038,minLevel:28,maxLevel:37},{id:10456,minLevel:38,maxLevel:47},{id:16355,minLevel:48,maxLevel:57},{id:16356,minLevel:58}]),value:Yt.FrostbrandWeapon,showWhen:e=>e.getClass()==g.ClassShaman},uc={actionId:e=>e.getMatchingSpellActionId([{id:8232,minLevel:30,maxLevel:39},{id:8235,minLevel:40,maxLevel:49},{id:10486,minLevel:50,maxLevel:59},{id:16362,minLevel:60}]),value:Yt.WindfuryWeapon,showWhen:e=>e.getClass()==g.ClassShaman};function pc(e){return(t,i)=>({type:"iconEnum",tooltip:i,numColumns:t.length>11?4:t.length>8?3:t.length>5?2:1,values:[{value:0}].concat(t.map((e=>({actionId:e.config.actionId,value:e.config.value,showWhen:t=>!e.config.showWhen||e.config.showWhen(t)})))),equals:(e,t)=>e==t,zeroValue:0,changedEvent:e=>m.onAny([e.consumesChangeEmitter,e.levelChangeEmitter,e.gearChangeEmitter,e.professionChangeEmitter]),showWhen:t=>!e.showWhen||e.showWhen(t),getValue:t=>t.getConsumes()[e.consumesFieldName],setValue:(t,i,s)=>{const a=i.getConsumes();a[e.consumesFieldName]!==s&&(a[e.consumesFieldName]=s,m.freezeAllAndDo((()=>{i.setConsumes(t,a),e.onSet&&e.onSet(t,i,s)})))}})}const gc={actionId:()=>y.fromItemId(4381),value:Qt.ConjuredMinorRecombobulator,showWhen:e=>e.getGear().hasTrinket(4381)},fc={actionId:e=>e.getMatchingItemActionId([{id:12662,minLevel:40}]),value:Qt.ConjuredDemonicRune},Ic=[{config:gc,stats:[s.StatIntellect]},{config:fc,stats:[s.StatIntellect]}],wc=pc({consumesFieldName:"defaultConjured"}),bc=[{config:{actionId:e=>e.getMatchingItemActionId([{id:217308,minLevel:40}]),value:Xt.InnovationSigil},stats:[]}],vc=pc({consumesFieldName:"enchantedSigil",showWhen:e=>e.hasProfession(O.Enchanting)}),xc={actionId:e=>e.getMatchingItemActionId([{id:10507,minLevel:40}]),showWhen:e=>e.hasProfession(O.Engineering),value:ei.ExplosiveSolidDynamite},Sc={actionId:e=>e.getMatchingItemActionId([{id:18641,minLevel:50}]),showWhen:e=>e.hasProfession(O.Engineering),value:ei.ExplosiveDenseDynamite},Ec={actionId:e=>e.getMatchingItemActionId([{id:15993,minLevel:50}]),showWhen:e=>e.hasProfession(O.Engineering),value:ei.ExplosiveThoriumGrenade},yc=[{config:{actionId:e=>e.getMatchingItemActionId([{id:215168,minLevel:40}]),value:ei.ExplosiveEzThroRadiationBomb},stats:[]},{config:{actionId:e=>e.getMatchingItemActionId([{id:215127,minLevel:40}]),showWhen:e=>e.hasProfession(O.Engineering),value:ei.ExplosiveHighYieldRadiationBomb},stats:[]},{config:xc,stats:[]},{config:Sc,stats:[]},{config:Ec,stats:[]}],Pc=pc({consumesFieldName:"fillerExplosive"}),kc=sc({actionId:e=>e.getMatchingItemActionId([{id:10646,minLevel:50}]),fieldName:"sapper",showWhen:e=>e.hasProfession(O.Engineering)}),Cc={actionId:e=>e.getMatchingItemActionId([{id:13510,minLevel:50}]),value:ti.FlaskOfTheTitans},Lc={actionId:e=>e.getMatchingItemActionId([{id:13511,minLevel:50}]),value:ti.FlaskOfDistilledWisdom},Tc={actionId:e=>e.getMatchingItemActionId([{id:13512,minLevel:50}]),value:ti.FlaskOfSupremePower},_c={actionId:e=>e.getMatchingItemActionId([{id:13513,minLevel:50}]),value:ti.FlaskOfChromaticResistance},Nc=[{config:Cc,stats:[s.StatStamina]},{config:Lc,stats:[s.StatMP5,s.StatSpellPower]},{config:Tc,stats:[s.StatMP5,s.StatSpellPower]},{config:_c,stats:[s.StatStamina]}],Rc=pc({consumesFieldName:"flask"}),Ac={actionId:e=>e.getMatchingItemActionId([{id:21023,minLevel:55}]),value:ii.FoodDirgesKickChimaerokChops},Dc={actionId:e=>e.getMatchingItemActionId([{id:13928,minLevel:50}]),value:ii.FoodGrilledSquid},Mc={actionId:e=>e.getMatchingItemActionId([{id:20452,minLevel:45}]),value:ii.FoodSmokedDesertDumpling},Vc={actionId:e=>e.getMatchingItemActionId([{id:18254,minLevel:45}]),value:ii.FoodRunnTumTuberSurprise},Uc={actionId:e=>e.getMatchingItemActionId([{id:13810,minLevel:45}]),value:ii.FoodBlessSunfruit},Fc={actionId:e=>e.getMatchingItemActionId([{id:13813,minLevel:45}]),value:ii.FoodBlessedSunfruitJuice};ii.FoodNightfinSoup;const Wc={actionId:e=>e.getMatchingItemActionId([{id:18045,minLevel:40}]),value:ii.FoodTenderWolfSteak},Oc={actionId:e=>e.getMatchingItemActionId([{id:12217,minLevel:35}]),value:ii.FoodDragonbreathChili},Hc={actionId:e=>e.getMatchingItemActionId([{id:13851,minLevel:25}]),value:ii.FoodHotWolfRibs},qc={actionId:e=>e.getMatchingItemActionId([{id:21072,minLevel:10}]),value:ii.FoodSmokedSagefish},Bc={actionId:e=>e.getMatchingItemActionId([{id:21217,minLevel:30}]),value:ii.FoodSagefishDelight},zc=[{config:Uc,stats:[s.StatStrength]},{config:Fc,stats:[s.StatSpirit]},{config:Ac,stats:[s.StatStamina]},{config:Oc,stats:[]},{config:Dc,stats:[s.StatAgility]},{config:Hc,stats:[s.StatSpirit]},{config:Vc,stats:[s.StatIntellect]},{config:Bc,stats:[s.StatMP5]},{config:Mc,stats:[s.StatStrength]},{config:qc,stats:[s.StatMP5]},{config:Wc,stats:[s.StatStamina,s.StatSpirit]}],jc=pc({consumesFieldName:"food"}),$c={actionId:e=>e.getMatchingItemActionId([{id:13452,minLevel:46}]),value:si.ElixirOfTheMongoose},Gc={actionId:e=>e.getMatchingItemActionId([{id:9187,minLevel:41}]),value:si.ElixirOfGreaterAgility},Kc={actionId:e=>e.getMatchingItemActionId([{id:8949,minLevel:27}]),value:si.ElixirOfAgility},Jc={actionId:e=>e.getMatchingItemActionId([{id:3390,minLevel:18}]),value:si.ElixirOfLesserAgility},Zc={actionId:e=>e.getMatchingItemActionId([{id:3012,minLevel:10,maxLevel:24},{id:1477,minLevel:25,maxLevel:39},{id:4425,minLevel:40,maxLevel:54},{id:10309,minLevel:55}]),value:si.ScrollOfAgility},Yc=[{config:$c,stats:[s.StatAgility]},{config:Gc,stats:[s.StatAgility]},{config:Kc,stats:[s.StatAgility]},{config:Jc,stats:[s.StatAgility]},{config:Zc,stats:[s.StatAgility]}],Qc=pc({consumesFieldName:"agilityElixir"}),Xc={actionId:e=>e.getMatchingItemActionId([{id:12451,minLevel:46}]),value:ai.JujuPower},eh={actionId:e=>e.getMatchingItemActionId([{id:9206,minLevel:46}]),value:ai.ElixirOfGiants},th={actionId:e=>e.getMatchingItemActionId([{id:3391,minLevel:20}]),value:ai.ElixirOfOgresStrength},ih={actionId:e=>e.getMatchingItemActionId([{id:954,minLevel:10,maxLevel:24},{id:2289,minLevel:25,maxLevel:39},{id:4426,minLevel:40,maxLevel:54},{id:10310,minLevel:55}]),value:ai.ScrollOfStrength},sh=[{config:Xc,stats:[s.StatStrength]},{config:eh,stats:[s.StatStrength]},{config:th,stats:[s.StatStrength]},{config:ih,stats:[s.StatStrength]}],ah=pc({consumesFieldName:"strengthBuff"}),nh=sc({actionId:()=>y.fromItemId(5206),fieldName:"boglingRoot"}),oh={actionId:()=>y.fromItemId(3385),value:ni.LesserManaPotion},lh={actionId:e=>e.getMatchingItemActionId([{id:3827,minLevel:22}]),value:ni.ManaPotion},rh={actionId:e=>e.getMatchingItemActionId([{id:6149,minLevel:31}]),value:ni.GreaterManaPotion},dh=[{config:{actionId:e=>e.getMatchingItemActionId([{id:215162,minLevel:35}]),value:ni.MildlyIrradiatedRejuvPotion,showWhen:e=>e.hasProfession(O.Alchemy)},stats:[]},{config:rh,stats:[s.StatIntellect]},{config:lh,stats:[s.StatIntellect]},{config:oh,stats:[s.StatIntellect]}],ch=pc({consumesFieldName:"defaultPotion"}),hh={actionId:e=>e.getMatchingItemActionId([{id:13454,minLevel:46}]),value:oi.GreaterArcaneElixir},mh={actionId:e=>e.getMatchingItemActionId([{id:9155,minLevel:41}]),value:oi.ArcaneElixir},uh={actionId:e=>e.getMatchingItemActionId([{id:217398,minLevel:28}]),value:oi.LesserArcaneElixir},ph=[{config:hh,stats:[s.StatSpellPower]},{config:mh,stats:[s.StatSpellPower]},{config:uh,stats:[s.StatSpellPower]}],gh=pc({consumesFieldName:"spellPowerBuff"}),fh={actionId:e=>e.getMatchingItemActionId([{id:21546,minLevel:41}]),value:li.ElixirOfGreaterFirepower},Ih={actionId:e=>e.getMatchingItemActionId([{id:6373,minLevel:18}]),value:li.ElixirOfFirepower},wh=[{config:fh,stats:[s.StatFirePower]},{config:Ih,stats:[s.StatFirePower]}],bh=pc({consumesFieldName:"firePowerBuff"}),vh=[{config:{actionId:e=>e.getMatchingItemActionId([{id:17708,minLevel:40}]),value:ri.ElixirOfFrostPower},stats:[s.StatFrostPower]}],xh=pc({consumesFieldName:"frostPowerBuff"}),Sh=[{config:{actionId:e=>e.getMatchingItemActionId([{id:9264,minLevel:40}]),value:di.ElixirOfShadowPower},stats:[s.StatShadowPower]}],Eh=pc({consumesFieldName:"shadowPowerBuff"}),yh={actionId:e=>e.getMatchingSpellActionId([{id:8516,minLevel:32,maxLevel:41},{id:10608,minLevel:42,maxLevel:51},{id:10610,minLevel:52}]),value:Yt.Windfury},Ph={actionId:()=>y.fromSpellId(407975),value:Yt.WildStrikes},kh={actionId:e=>e.getMatchingItemActionId([{id:20744,minLevel:5}]),value:Yt.MinorWizardOil},Ch={actionId:e=>e.getMatchingItemActionId([{id:20746,minLevel:30}]),value:Yt.LesserWizardOil},Lh={actionId:e=>e.getMatchingItemActionId([{id:20750,minLevel:41}]),value:Yt.WizardOil},Th={actionId:e=>e.getMatchingItemActionId([{id:20749,minLevel:45}]),value:Yt.BrillianWizardOil},_h={actionId:e=>e.getMatchingItemActionId([{id:20745,minLevel:20}]),value:Yt.MinorManaOil},Nh={actionId:e=>e.getMatchingItemActionId([{id:20747,minLevel:41}]),value:Yt.LesserManaOil},Rh={actionId:e=>e.getMatchingItemActionId([{id:20748,minLevel:45}]),value:Yt.BrilliantManaOil},Ah={actionId:e=>e.getMatchingItemActionId([{id:211848,minLevel:25}]),value:Yt.BlackfathomManaOil},Dh=e=>({actionId:e=>e.getMatchingItemActionId([{id:7964,minLevel:35}]),value:Yt.SolidSharpeningStone,showWhen:t=>ci(t.getEquippedItem(e)?.item.weaponType??Oe.WeaponTypeUnknown)}),Mh=e=>({actionId:e=>e.getMatchingItemActionId([{id:12404,minLevel:41}]),value:Yt.DenseSharpeningStone,showWhen:t=>ci(t.getEquippedItem(e)?.item.weaponType??Oe.WeaponTypeUnknown)}),Vh=e=>({actionId:e=>e.getMatchingItemActionId([{id:18262,minLevel:50}]),value:Yt.ElementalSharpeningStone,showWhen:t=>ci(t.getEquippedItem(e)?.item.weaponType??Oe.WeaponTypeUnknown)}),Uh=e=>({actionId:()=>y.fromItemId(211845),value:Yt.BlackfathomSharpeningStone,showWhen:t=>ci(t.getEquippedItem(e)?.item.weaponType??Oe.WeaponTypeUnknown)}),Fh=e=>({actionId:e=>e.getMatchingItemActionId([{id:7965,minLevel:35}]),value:Yt.SolidWeightstone,showWhen:t=>hi(t.getEquippedItem(e)?.item.weaponType??Oe.WeaponTypeUnknown)}),Wh=e=>({actionId:e=>e.getMatchingItemActionId([{id:12643,minLevel:41}]),value:Yt.DenseWeightstone,showWhen:t=>hi(t.getEquippedItem(e)?.item.weaponType??Oe.WeaponTypeUnknown)}),Oh=[{config:cc,stats:[]},{config:hc,stats:[]},{config:mc,stats:[]},{config:uc,stats:[]}],Hh=e=>[{config:kh,stats:[s.StatSpellPower]},{config:Ch,stats:[s.StatSpellPower]},{config:Lh,stats:[s.StatSpellPower]},{config:Th,stats:[s.StatSpellPower]},{config:_h,stats:[s.StatHealing,s.StatSpellPower]},{config:Nh,stats:[s.StatHealing,s.StatSpellPower]},{config:Rh,stats:[s.StatHealing,s.StatSpellPower]},{config:Ah,stats:[s.StatSpellPower,s.StatMP5]},{config:Dh(e),stats:[s.StatAttackPower]},{config:Mh(e),stats:[s.StatAttackPower]},{config:Vh(e),stats:[s.StatAttackPower]},{config:Uh(e),stats:[s.StatMeleeHit]},{config:Fh(e),stats:[s.StatAttackPower]},{config:Wh(e),stats:[s.StatAttackPower]}],qh=[...Oh,...Hh(M.ItemSlotOffHand)],Bh=[...Oh,{config:yh,stats:[s.StatMeleeHit]},{config:Ph,stats:[s.StatMeleeHit]},...Hh(M.ItemSlotMainHand)],zh=pc({consumesFieldName:"mainHandImbue",showWhen:e=>!!e.getGear().getEquippedItem(M.ItemSlotMainHand)}),jh=pc({consumesFieldName:"offHandImbue",showWhen:e=>![Oe.WeaponTypeUnknown,Oe.WeaponTypeOffHand,Oe.WeaponTypeShield].includes(e.getGear().getEquippedItem(M.ItemSlotOffHand)?.item.weaponType??Oe.WeaponTypeUnknown)});class $h extends v{constructor(e,i){super(e,"consumes-picker-root"),t(this,"simUI"),this.simUI=i,this.buildPotionsPicker(),this.buildFlaskPicker(),this.buildWeaponImbuePicker(),this.buildFoodPicker(),this.buildPhysicalBuffPicker(),this.buildSpellPowerBuffPicker(),this.buildEngPicker(),this.buildEnchPicker(),this.buildPetPicker()}buildPotionsPicker(){let e=document.createElement("fragment");e.innerHTML='\n      <div class="consumes-row input-root input-inline">\n        <label class="form-label">Potions</label>\n        <div class="consumes-row-inputs consumes-potions"></div>\n      </div>\n    ',this.rootElem.appendChild(e.children[0]);const t=this.rootElem.querySelector(".consumes-potions"),i=ch(Nd(dh,this.simUI),"Combat Potion");Xd(t,this.simUI.player,i);const s=wc(Nd(Ic,this.simUI));Xd(t,this.simUI.player,s)}buildFlaskPicker(){let e=document.createElement("fragment");e.innerHTML='\n      <div class="consumes-row input-root input-inline">\n        <label class="form-label">Elixirs</label>\n        <div class="consumes-row-inputs consumes-flasks"></div>\n      </div>\n    ';const t=this.rootElem.appendChild(e.children[0]),i=this.rootElem.querySelector(".consumes-flasks"),s=Rc(Nd(Nc,this.simUI)),a=Xd(i,this.simUI.player,s);m.onAny([this.simUI.player.levelChangeEmitter]).on((()=>this.updateRow(t,[a]))),this.updateRow(t,[a])}buildWeaponImbuePicker(){let e=document.createElement("fragment");e.innerHTML='\n    \t<div class="consumes-row input-root input-inline">\n        <label class="form-label">Weapon Imbues</label>\n        <div class="consumes-row-inputs consumes-weapon-imbues"></div>\n    \t</div>\n    ';const t=this.rootElem.appendChild(e.children[0]),i=this.rootElem.querySelector(".consumes-weapon-imbues"),s=zh(Nd(Bh,this.simUI),"Main-Hand"),a=Xd(i,this.simUI.player,s),n=jh(Nd(qh,this.simUI),"Off-Hand"),o=Xd(i,this.simUI.player,n);m.onAny([this.simUI.player.gearChangeEmitter]).on((()=>this.updateRow(t,[a,o]))),this.updateRow(t,[a,o])}buildFoodPicker(){let e=document.createElement("fragment");e.innerHTML='\n      <div class="consumes-row input-root input-inline">\n        <label class="form-label">Food</label>\n        <div class="consumes-row-inputs consumes-food"></div>\n      </div>\n    ';const t=this.rootElem.appendChild(e.children[0]),i=this.rootElem.querySelector(".consumes-food"),s=jc(Nd(zc,this.simUI)),a=Xd(i,this.simUI.player,s);m.onAny([this.simUI.player.levelChangeEmitter]).on((()=>this.updateRow(t,[a]))),this.updateRow(t,[a])}buildPhysicalBuffPicker(){const e=this.simUI.individualConfig.epStats.includes(s.StatAgility),t=this.simUI.individualConfig.epStats.includes(s.StatStrength);if(!e&&!t)return;let i=document.createElement("fragment");i.innerHTML='\n      <div class="consumes-row input-root input-inline">\n        <label class="form-label">Physical</label>\n        <div class="consumes-row-inputs consumes-physical"></div>\n      </div>\n    ';const a=this.rootElem.appendChild(i.children[0]),n=this.rootElem.querySelector(".consumes-physical"),o=Qc(Nd(Yc,this.simUI),"Agility"),l=Xd(n,this.simUI.player,o),r=ah(Nd(sh,this.simUI),"Strength"),d=Xd(n,this.simUI.player,r);Xd(n,this.simUI.player,nh),m.onAny([this.simUI.player.levelChangeEmitter]).on((()=>this.updateRow(a,[d,l]))),this.updateRow(a,[d,l])}buildSpellPowerBuffPicker(){let e=document.createElement("fragment");e.innerHTML='\n      <div class="consumes-row input-root input-inline">\n        <label class="form-label">Spells</label>\n        <div class="consumes-row-inputs consumes-spells"></div>\n      </div>\n    ';const t=this.rootElem.appendChild(e.children[0]),i=this.rootElem.querySelector(".consumes-spells"),s=gh(Nd(ph,this.simUI),"Arcane"),a=Xd(i,this.simUI.player,s),n=bh(Nd(wh,this.simUI),"Fire"),o=Xd(i,this.simUI.player,n),l=xh(Nd(vh,this.simUI),"Frost"),r=Xd(i,this.simUI.player,l),d=Eh(Nd(Sh,this.simUI),"Shadow"),c=Xd(i,this.simUI.player,d);m.onAny([this.simUI.player.levelChangeEmitter]).on((()=>this.updateRow(t,[a,o,r,c]))),this.updateRow(t,[a,o,r,c])}buildEngPicker(){let e=document.createElement("fragment");e.innerHTML='\n      <div class="consumes-row input-root input-inline">\n        <label class="form-label">Engineering</label>\n        <div class="consumes-row-inputs consumes-engi">\n\t\t\t\t</div>\n      </div>\n    ';const t=this.rootElem.appendChild(e.children[0]),i=this.rootElem.querySelector(".consumes-engi"),s=Xd(i,this.simUI.player,kc),a=Pc(Nd(yc,this.simUI),"Explosives"),n=Xd(i,this.simUI.player,a);m.onAny([this.simUI.player.levelChangeEmitter,this.simUI.player.professionChangeEmitter]).on((()=>this.updateRow(t,[s,n]))),this.updateRow(t,[s,n])}buildEnchPicker(){let e=document.createElement("fragment");e.innerHTML='\n      <div class="consumes-row input-root input-inline">\n        <label class="form-label">Enchanting</label>\n        <div class="consumes-row-inputs consumes-ench">\n\t\t\t\t</div>\n      </div>\n    ';const t=this.rootElem.appendChild(e.children[0]),i=this.rootElem.querySelector(".consumes-ench"),s=vc(Nd(bc,this.simUI),"Enchanted Sigils"),a=Xd(i,this.simUI.player,s);m.onAny([this.simUI.player.levelChangeEmitter,this.simUI.player.professionChangeEmitter]).on((()=>this.updateRow(t,[a]))),this.updateRow(t,[a])}buildPetPicker(){if(!this.simUI.individualConfig.petConsumeInputs?.length)return;let e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Pet</label>\n\t\t\t\t<div class="consumes-row-inputs consumes-pet"></div>\n\t\t\t</div>\n\t\t',this.rootElem.appendChild(e.children[0]);const t=this.rootElem.querySelector(".consumes-pet");this.simUI.individualConfig.petConsumeInputs.map((e=>Xd(t,this.simUI.player,e)))}updateRow(e,t){t.find((e=>e?.showWhen()))?e.classList.remove("hide"):e.classList.add("hide")}}const Gh="Specify Paladin Blessings for each role, in order of priority. Blessings in the 1st column will be used if there is at least 1 Paladin in the raid, 2nd column if at least 2, etc.",Kh="<p>Preset gear lists are intended as rough approximations of BIS, and will often not be the absolute highest-DPS setup for you. Your optimal gear setup will depend on many factors; that's why we have a sim!</p><p>Items may also be omitted from the presets if they are highly contested and clearly better utilized on other classes, to encourage equitable gearing for the raid as a whole.</p>",Jh=ec(nc({actionId:e=>e.getMatchingSpellActionId([{id:1126,maxLevel:9},{id:5232,minLevel:10,maxLevel:19},{id:6756,minLevel:20,maxLevel:29},{id:5234,minLevel:30,maxLevel:39},{id:8907,minLevel:40,maxLevel:49},{id:9884,minLevel:50,maxLevel:59},{id:9885,minLevel:60}]),impId:y.fromSpellId(17055),fieldName:"giftOfTheWild"}),"Mark of the Wild"),Zh=Md([ic({actionId:()=>y.fromSpellId(20217),fieldName:"blessingOfKings",showWhen:e=>e.getFaction()==Re.Alliance}),tc({actionId:()=>y.fromSpellId(409580),fieldName:"aspectOfTheLion"})],"Stats %"),Yh=Md([nc({actionId:e=>e.getMatchingSpellActionId([{id:465,maxLevel:9},{id:10290,minLevel:10,maxLevel:19},{id:643,minLevel:20,maxLevel:29},{id:10291,minLevel:30,maxLevel:39},{id:1032,minLevel:40,maxLevel:49},{id:10292,minLevel:50,maxLevel:59},{id:10293,minLevel:60}]),impId:y.fromSpellId(20142),fieldName:"devotionAura"}),tc({actionId:e=>e.getMatchingItemActionId([{id:3013,maxLevel:14},{id:1478,minLevel:15,maxLevel:29},{id:4421,minLevel:30,maxLevel:44},{id:10305,minLevel:45}]),fieldName:"scrollOfProtection"})],"Armor"),Qh=Md([nc({actionId:e=>e.getMatchingSpellActionId([{id:1243,maxLevel:11},{id:1244,minLevel:12,maxLevel:23},{id:1245,minLevel:24,maxLevel:35},{id:2791,minLevel:36,maxLevel:47},{id:10937,minLevel:48,maxLevel:60},{id:10938,minLevel:60}]),impId:y.fromSpellId(14767),fieldName:"powerWordFortitude"}),tc({actionId:e=>e.getMatchingItemActionId([{id:1180,minLevel:5,maxLevel:19},{id:1711,minLevel:20,maxLevel:34},{id:4422,minLevel:35,maxLevel:49},{id:10307,minLevel:50}]),fieldName:"scrollOfStamina"})],"Stamina"),Xh=ec(nc({actionId:e=>e.getMatchingSpellActionId([{id:6307,minLevel:4,maxLevel:13},{id:7804,minLevel:14,maxLevel:25},{id:7805,minLevel:26,maxLevel:37},{id:11766,minLevel:38,maxLevel:49},{id:11767,minLevel:50}]),impId:y.fromSpellId(18696),fieldName:"bloodPact"}),"BloodPact"),em=Md([oc({actionId:e=>e.getMatchingSpellActionId([{id:19740,minLevel:4,maxLevel:11},{id:19834,minLevel:12,maxLevel:21},{id:19835,minLevel:22,maxLevel:31},{id:19836,minLevel:32,maxLevel:41},{id:19837,minLevel:42,maxLevel:51},{id:19838,minLevel:52,maxLevel:59},{id:25291,minLevel:60}]),impId:y.fromSpellId(20048),fieldName:"blessingOfMight",showWhen:e=>e.getFaction()==Re.Alliance}),tc({actionId:()=>y.fromSpellId(425600),fieldName:"hornOfLordaeron",showWhen:e=>e.getFaction()==Re.Alliance})],"Paladin Physical"),tm=ec(nc({actionId:e=>e.getMatchingSpellActionId([{id:8075,minLevel:10,maxLevel:23},{id:8160,minLevel:24,maxLevel:37},{id:8161,minLevel:38,maxLevel:51},{id:10442,minLevel:52,maxLevel:59},{id:25361,minLevel:60}]),impId:y.fromSpellId(16295),fieldName:"strengthOfEarthTotem",showWhen:e=>e.getFaction()==Re.Horde}),"Strength"),im=ec(nc({actionId:e=>e.getMatchingSpellActionId([{id:8835,minLevel:42,maxLevel:55},{id:10627,minLevel:56,maxLevel:59},{id:25359,minLevel:60}]),impId:y.fromSpellId(16295),fieldName:"graceOfAirTotem",showWhen:e=>e.getFaction()==Re.Horde}),"Agility"),sm=Md([tc({actionId:e=>e.getMatchingSpellActionId([{id:1459,maxLevel:13},{id:1460,minLevel:14,maxLevel:27},{id:1461,minLevel:28,maxLevel:41},{id:10156,minLevel:42,maxLevel:55},{id:10157,minLevel:56}]),fieldName:"arcaneBrilliance"}),tc({actionId:e=>e.getMatchingItemActionId([{id:955,minLevel:5,maxLevel:19},{id:2290,minLevel:20,maxLevel:34},{id:4419,minLevel:35,maxLevel:49},{id:10308,minLevel:50}]),fieldName:"scrollOfIntellect"})],"Intellect"),am=Md([tc({actionId:e=>e.getMatchingSpellActionId([{id:14752,minLevel:30,maxLevel:39},{id:14818,minLevel:40,maxLevel:49},{id:14819,minLevel:50,maxLevel:59},{id:27841,minLevel:60}]),fieldName:"divineSpirit"}),tc({actionId:e=>e.getMatchingItemActionId([{id:1181,maxLevel:14},{id:1712,minLevel:15,maxLevel:29},{id:4424,minLevel:30,maxLevel:44},{id:10306,minLevel:45}]),fieldName:"scrollOfSpirit"})],"Spirit"),nm=ec(nc({actionId:e=>e.getMatchingSpellActionId([{id:6673,maxLevel:11},{id:5242,minLevel:12,maxLevel:21},{id:6192,minLevel:22,maxLevel:31},{id:11549,minLevel:32,maxLevel:41},{id:11550,minLevel:42,maxLevel:51},{id:11551,minLevel:52,maxLevel:59},{id:25289,minLevel:60}]),impId:y.fromSpellId(12861),fieldName:"battleShout"}),"Battle Shout"),om=ec(tc({actionId:e=>e.getMatchingSpellActionId([{id:19506,minLevel:40}]),fieldName:"trueshotAura"}),"Trueshot Aura"),lm=ec(ic({actionId:e=>e.getMatchingSpellActionId([{id:20911,minLevel:30,maxLevel:39},{id:20912,minLevel:40,maxLevel:49},{id:20913,minLevel:50,maxLevel:59},{id:20914,minLevel:60}]),fieldName:"blessingOfSanctuary"}),"Blessing of Sanctuary"),rm=Md([tc({actionId:e=>e.getMatchingSpellActionId([{id:976,minLevel:30,maxLevel:41},{id:10957,minLevel:42,maxLevel:55},{id:10958,minLevel:56}]),fieldName:"shadowProtection"}),tc({actionId:e=>e.getMatchingSpellActionId([{id:10595,minLevel:30,maxLevel:43},{id:10600,minLevel:44,maxLevel:59},{id:10601,minLevel:60}]),fieldName:"natureResistanceTotem",showWhen:e=>e.getFaction()==Re.Horde}),tc({actionId:e=>e.getMatchingSpellActionId([{id:20043,minLevel:46,maxLevel:55},{id:20190,minLevel:56}]),fieldName:"aspectOfTheWild"}),tc({actionId:e=>e.getMatchingSpellActionId([{id:19891,minLevel:36,maxLevel:47},{id:19899,minLevel:48,maxLevel:59},{id:19900,minLevel:60}]),fieldName:"fireResistanceAura",showWhen:e=>e.getFaction()==Re.Alliance}),tc({actionId:e=>e.getMatchingSpellActionId([{id:8184,minLevel:28,maxLevel:41},{id:10537,minLevel:42,maxLevel:57},{id:10538,minLevel:58}]),fieldName:"fireResistanceTotem",showWhen:e=>e.getFaction()==Re.Horde}),tc({actionId:e=>e.getMatchingSpellActionId([{id:19888,minLevel:32,maxLevel:43},{id:19897,minLevel:44,maxLevel:55},{id:19898,minLevel:56}]),fieldName:"frostResistanceAura",showWhen:e=>e.getFaction()==Re.Alliance}),tc({actionId:e=>e.getMatchingSpellActionId([{id:8181,minLevel:24,maxLevel:37},{id:10478,minLevel:38,maxLevel:53},{id:10479,minLevel:54}]),fieldName:"frostResistanceTotem",showWhen:e=>e.getFaction()==Re.Horde})],"Resistances"),dm=ec(oc({actionId:e=>e.getMatchingSpellActionId([{id:19742,minLevel:14,maxLevel:23},{id:19850,minLevel:24,maxLevel:33},{id:19852,minLevel:34,maxLevel:43},{id:19853,minLevel:44,maxLevel:53},{id:19854,minLevel:54,maxLevel:59},{id:25290,minLevel:60}]),impId:y.fromSpellId(20245),fieldName:"blessingOfWisdom",showWhen:e=>e.getFaction()==Re.Alliance}),"Blessing of Wisdom"),cm=ec(nc({actionId:e=>e.getMatchingSpellActionId([{id:5675,minLevel:26,maxLevel:35},{id:10495,minLevel:36,maxLevel:45},{id:10496,minLevel:46,maxLevel:55},{id:10497,minLevel:56}]),impId:y.fromSpellId(16208),fieldName:"manaSpringTotem",showWhen:e=>e.getFaction()==Re.Horde}),"Mana Spring Totem"),hm=ec(tc({actionId:e=>e.getMatchingSpellActionId([{id:17007,minLevel:40}]),fieldName:"leaderOfThePack"}),"Leader of the Pack"),mm=ec(tc({actionId:e=>e.getMatchingSpellActionId([{id:24907,minLevel:40}]),fieldName:"moonkinAura"}),"Moonkin Aura"),um=ec(Zd({getModObject:e=>e,showWhen:e=>!pm.faction||pm.faction==e.getFaction(),getValue:e=>e.getRaid().getBuffs(),setValue:(e,t,i)=>t.getRaid().setBuffs(e,i),changeEmitter:e=>m.onAny([e.getRaid().buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},(pm={actionId:()=>y.fromSpellId(425464),numStates:200,fieldName:"demonicPact",multiplier:10}).actionId,pm.numStates,pm.fieldName,pm.multiplier),"Demonic Pact");var pm;const gm=ec(nc({actionId:e=>e.getMatchingSpellActionId([{id:7294,minLevel:16,maxLevel:25},{id:10298,minLevel:26,maxLevel:35},{id:10299,minLevel:36,maxLevel:45},{id:10300,minLevel:46,maxLevel:55},{id:10301,minLevel:56}]),impId:y.fromSpellId(20092),fieldName:"retributionAura",showWhen:e=>e.getFaction()==Re.Alliance}),"Retribution Aura"),fm=ec(nc({actionId:e=>e.getMatchingSpellActionId([{id:467,minLevel:6,maxLevel:13},{id:782,minLevel:14,maxLevel:23},{id:1075,minLevel:24,maxLevel:33},{id:8914,minLevel:34,maxLevel:43},{id:9756,minLevel:44,maxLevel:53},{id:9910,minLevel:54}]),impId:y.fromSpellId(16840),fieldName:"thorns"}),"Thorns"),Im=ec(rc({actionId:e=>e.getMatchingSpellActionId([{id:29166,minLevel:40}]),numStates:11,fieldName:"innervates"}),"Innervate"),wm=ec(rc({actionId:e=>e.getMatchingSpellActionId([{id:10060,minLevel:40}]),numStates:11,fieldName:"powerInfusions"}),"Power Infusion"),bm=ec(ic({actionId:e=>e.getMatchingSpellActionId([{id:22888,minLevel:51}]),fieldName:"rallyingCryOfTheDragonslayer"}),"Rallying Cry of the Dragonslayer"),vm=ec(ic({actionId:e=>e.getMatchingSpellActionId([{id:24425,minLevel:51}]),fieldName:"spiritOfZandalar"}),"Spirit of Zandalar"),xm=ec(ic({actionId:e=>e.getMatchingSpellActionId([{id:15366,minLevel:50}]),fieldName:"songflowerSerenade"}),"Songflower Serenade"),Sm=ec(ic({actionId:e=>e.getMatchingSpellActionId([{id:16609,minLevel:51}]),fieldName:"warchiefsBlessing"}),"Warchief's Blessing"),Em=e=>function(e){return Yd({getModObject:e=>e,showWhen:t=>!e.faction||e.faction==t.getFaction(),getValue:e=>e.getBuffs(),setValue:(e,t,i)=>t.setBuffs(e,i),changeEmitter:e=>m.onAny([e.buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.fieldName,e.values,e.numColumns,e.direction||Td.Vertical)}({direction:Td.Horizontal,values:[{iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_orb_02.jpg",value:mi.SaygesUnknown,text:"Sayge's Dark Fortune"},...e.map((e=>e.config))],fieldName:"saygesFortune"}),ym={actionId:()=>y.fromSpellId(23768),value:mi.SaygesDamage,text:"Sayge's Damage"},Pm={actionId:()=>y.fromSpellId(23736),value:mi.SaygesAgility,text:"Sayge's Agility"},km={actionId:()=>y.fromSpellId(23766),value:mi.SaygesIntellect,text:"Sayge's Intellect"},Cm={actionId:()=>y.fromSpellId(23738),value:mi.SaygesSpirit,text:"Sayge's Spirit"},Lm={actionId:()=>y.fromSpellId(23737),value:mi.SaygesStamina,text:"Sayge's Stamina"},Tm=ec(ic({actionId:e=>e.getMatchingSpellActionId([{id:22817,minLevel:51}]),fieldName:"fengusFerocity"}),"Fengus' Ferocity"),_m=ec(ic({actionId:e=>e.getMatchingSpellActionId([{id:22818,minLevel:51}]),fieldName:"moldarsMoxie"}),"Moldar's Moxie");ec(ic({actionId:e=>e.getMatchingSpellActionId([{id:22820,minLevel:51}]),fieldName:"slipkiksSavvy"}),"Slip'kik's Savvy");const Nm=ec(ic({actionId:e=>e.getMatchingSpellActionId([{id:430947,maxLevel:39}]),fieldName:"boonOfBlackfathom"}),"Boon of Blackfathom"),Rm=ec(ic({actionId:e=>e.getMatchingSpellActionId([{id:430352,maxLevel:39}]),fieldName:"ashenvalePvpBuff"}),"Ashenvale PvP Buff"),Am=ec(ic({actionId:()=>y.fromSpellId(438536),fieldName:"sparkOfInspiration"}),"Spark of Inspiration"),Dm=Md([ac({actionId:e=>e.getMatchingSpellActionId([{id:7386,minLevel:10,maxLevel:21},{id:7405,minLevel:22,maxLevel:33},{id:8380,minLevel:34,maxLevel:45},{id:11596,minLevel:46,maxLevel:57},{id:11597,minLevel:58}]),fieldName:"sunderArmor"}),lc({actionId:e=>e.getMatchingSpellActionId([{id:8647,minLevel:14,maxLevel:25},{id:8649,minLevel:26,maxLevel:35},{id:8650,minLevel:36,maxLevel:45},{id:11197,minLevel:46,maxLevel:55},{id:11198,minLevel:56}]),impId:y.fromSpellId(14169),fieldName:"exposeArmor"}),dc({actionId:()=>y.fromSpellId(402818),numStates:101,multiplier:10,fieldName:"homunculi"})],"Major Armor Penetration"),Mm=ec(ac({actionId:e=>e.getMatchingSpellActionId([{id:704,minLevel:14,maxLevel:27},{id:7658,minLevel:28,maxLevel:41},{id:7659,minLevel:42,maxLevel:55},{id:11717,minLevel:56}]),fieldName:"curseOfRecklessness"}),"Curse of Recklessness"),Vm=ec(ac({actionId:e=>e.getMatchingSpellActionId([{id:770,minLevel:18,maxLevel:29},{id:778,minLevel:30,maxLevel:41},{id:9749,minLevel:42,maxLevel:53},{id:9907,minLevel:54}]),fieldName:"faerieFire"}),"Faerie Fire"),Um=Md([lc({actionId:e=>e.getMatchingSpellActionId([{id:1160,minLevel:14,maxLevel:23},{id:6190,minLevel:24,maxLevel:33},{id:11554,minLevel:34,maxLevel:43},{id:11555,minLevel:44,maxLevel:53},{id:11556,minLevel:54}]),impId:y.fromSpellId(12879),fieldName:"demoralizingShout"}),lc({actionId:e=>e.getMatchingSpellActionId([{id:99,minLevel:10,maxLevel:19},{id:1735,minLevel:20,maxLevel:31},{id:9490,minLevel:32,maxLevel:41},{id:9747,minLevel:42,maxLevel:51},{id:9898,minLevel:52}]),impId:y.fromSpellId(16862),fieldName:"demoralizingRoar"})],"Attack Power"),Fm=ec(ac({actionId:()=>y.fromSpellId(409828),fieldName:"mangle"}),"Bleed"),Wm=ec(lc({actionId:()=>y.fromSpellId(6343),impId:y.fromSpellId(12666),fieldName:"thunderClap"}),"Thunder Clap"),Om=ec(ac({actionId:e=>e.getMatchingSpellActionId([{id:5570,minLevel:20,maxLevel:29},{id:24974,minLevel:30,maxLevel:39},{id:24975,minLevel:40,maxLevel:49},{id:24976,minLevel:50,maxLevel:59},{id:24977,minLevel:60}]),fieldName:"insectSwarm"}),"Insect Swarm"),Hm=ec(ac({actionId:e=>e.getMatchingSpellActionId([{id:17803,minLevel:10}]),fieldName:"improvedShadowBolt"}),"Improved Shadow Bolt"),qm=ec(ac({actionId:e=>e.getMatchingSpellActionId([{id:12873,minLevel:40}]),fieldName:"improvedScorch"}),"Fire Damage"),Bm=ec(ac({actionId:e=>e.getMatchingSpellActionId([{id:28595,minLevel:40}]),fieldName:"wintersChill"}),"Frost Damage"),zm=Md([ac({actionId:e=>e.getMatchingSpellActionId([{id:17364,minLevel:40}]),fieldName:"stormstrike"}),ac({actionId:()=>y.fromSpellId(408258),fieldName:"dreamstate"})],"Nature Damage"),jm=ec(ac({actionId:e=>e.getMatchingSpellActionId([{id:15334,minLevel:40}]),fieldName:"shadowWeaving"}),"Shadow Weaving"),$m=ec(ac({actionId:e=>e.getMatchingSpellActionId([{id:1490,minLevel:32,maxLevel:45},{id:11721,minLevel:46,maxLevel:59},{id:11722,minLevel:60}]),fieldName:"curseOfElements"}),"Curse of Elements"),Gm=ec(ac({actionId:e=>e.getMatchingSpellActionId([{id:17862,minLevel:44,maxLevel:59},{id:17937,minLevel:60}]),fieldName:"curseOfShadow"}),"Curse of Shadow"),Km=ec(lc({actionId:e=>e.getMatchingSpellActionId([{id:1130,minLevel:6,maxLevel:21},{id:14323,minLevel:22,maxLevel:39},{id:14324,minLevel:40,maxLevel:57},{id:14325,minLevel:58}]),impId:y.fromSpellId(19425),fieldName:"huntersMark"}),"Hunter's Mark"),Jm=ec(ac({actionId:e=>e.getMatchingSpellActionId([{id:20186,minLevel:38,maxLevel:57},{id:20355,minLevel:58}]),fieldName:"judgementOfWisdom",showWhen:e=>e.getFaction()==Re.Alliance}),"Judgement of Wisdom"),Zm=ac({actionId:e=>e.getMatchingSpellActionId([{id:20185,minLevel:30,maxLevel:39},{id:20344,minLevel:40,maxLevel:49},{id:20345,minLevel:50,maxLevel:59},{id:20346,minLevel:60}]),fieldName:"judgementOfLight",showWhen:e=>e.getFaction()==Re.Alliance}),Ym=ac({actionId:e=>e.getMatchingSpellActionId([{id:427143,minLevel:25}]),fieldName:"curseOfVulnerability"}),Qm=ac({actionId:e=>e.getMatchingSpellActionId([{id:11374,minLevel:38}]),fieldName:"giftOfArthas"}),Xm=ac({actionId:e=>e.getMatchingSpellActionId([{id:15235,minLevel:47}]),fieldName:"crystalYield"}),eu=dc({actionId:()=>y.fromSpellId(422996),numStates:101,multiplier:10,fieldName:"ancientCorrosivePoison"}),tu=[{config:Jh,picker:Ad,stats:[]},{config:Zh,picker:Dd,stats:[]},{config:Yh,picker:Dd,stats:[s.StatArmor]},{config:Qh,picker:Dd,stats:[s.StatStamina]},{config:Xh,picker:Ad,stats:[s.StatStamina]},{config:em,picker:Dd,stats:[s.StatStrength,s.StatAgility,s.StatAttackPower]},{config:tm,picker:Ad,stats:[s.StatStrength]},{config:im,picker:Ad,stats:[s.StatAgility]},{config:sm,picker:Dd,stats:[s.StatIntellect]},{config:am,picker:Dd,stats:[s.StatSpirit]},{config:nm,picker:Ad,stats:[s.StatAttackPower]},{config:om,picker:Ad,stats:[s.StatAttackPower,s.StatRangedAttackPower]},{config:hm,picker:Ad,stats:[s.StatMeleeCrit]},{config:um,picker:Ad,stats:[s.StatSpellPower]},{config:mm,picker:Ad,stats:[s.StatSpellCrit]},{config:lm,picker:Ad,stats:[s.StatArmor]},{config:rm,picker:Dd,stats:[s.StatNatureResistance,s.StatShadowResistance,s.StatFireResistance,s.StatFrostResistance]},{config:dm,picker:Ad,stats:[s.StatMP5]},{config:cm,picker:Ad,stats:[s.StatMP5]},{config:fm,picker:Ad,stats:[s.StatArmor]},{config:gm,picker:Ad,stats:[s.StatArmor],faction:Re.Alliance},{config:Im,picker:Ad,stats:[s.StatMP5]},{config:wm,picker:Ad,stats:[s.StatMP5,s.StatSpellPower]}],iu=[{config:Am,picker:Ad,stats:[s.StatSpellPower,s.StatMeleeHaste,s.StatRangedAttackPower]},{config:Nm,picker:Ad,stats:[s.StatMeleeCrit,s.StatSpellCrit,s.StatAttackPower]},{config:Rm,picker:Ad,stats:[s.StatAttackPower,s.StatSpellPower]},{config:Tm,picker:Ad,stats:[s.StatAttackPower]},{config:_m,picker:Ad,stats:[s.StatStamina]},{config:bm,picker:Ad,stats:[s.StatMeleeCrit,s.StatSpellCrit,s.StatAttackPower]},{config:xm,picker:Ad,stats:[]},{config:vm,picker:Ad,stats:[]},{config:Sm,picker:Ad,stats:[s.StatHealth,s.StatMeleeHaste,s.StatMP5]}],su=[{config:ym,stats:[]},{config:Pm,stats:[s.StatAgility]},{config:km,stats:[s.StatIntellect]},{config:Cm,stats:[s.StatSpirit,s.StatMP5]},{config:Lm,stats:[s.StatStamina]}],au=[{config:Dm,stats:[s.StatAttackPower],picker:Dd},{config:Mm,picker:Ad,stats:[s.StatAttackPower]},{config:Vm,picker:Ad,stats:[s.StatAttackPower]},{config:Fm,picker:Ad,stats:[s.StatAttackPower,s.StatRangedAttackPower]},{config:Hm,picker:Ad,stats:[s.StatShadowPower]},{config:qm,picker:Ad,stats:[s.StatFirePower]},{config:Bm,picker:Ad,stats:[s.StatFrostPower]},{config:zm,picker:Dd,stats:[s.StatNaturePower]},{config:jm,picker:Ad,stats:[s.StatShadowPower]},{config:$m,picker:Ad,stats:[s.StatFirePower,s.StatFrostPower]},{config:Gm,picker:Ad,stats:[s.StatShadowPower,s.StatArcanePower]},{config:Um,picker:Dd,stats:[s.StatArmor]},{config:Wm,picker:Ad,stats:[s.StatArmor]},{config:Om,picker:Ad,stats:[s.StatDodge]},{config:Km,picker:Ad,stats:[s.StatRangedAttackPower]},{config:Jm,picker:Ad,stats:[s.StatMP5,s.StatIntellect],faction:Re.Alliance}],nu=[{config:Zm,picker:Ad,stats:[s.StatStamina]},{config:Ym,picker:Ad,stats:[s.StatAttackPower,s.StatRangedAttackPower]},{config:Qm,picker:Ad,stats:[s.StatAttackPower,s.StatRangedAttackPower]},{config:Xm,picker:Ad,stats:[s.StatAttackPower,s.StatRangedAttackPower]},{config:eu,picker:Ad,stats:[s.StatAttackPower,s.StatRangedAttackPower]}];class ou extends cd{constructor(e,i){super(e,i,{identifier:"settings-tab",title:"Settings"}),t(this,"simUI"),t(this,"leftPanel"),t(this,"rightPanel"),t(this,"column1",this.buildColumn(1,"settings-left-col")),t(this,"column2",this.buildColumn(2,"settings-left-col")),t(this,"column3",this.buildColumn(3,"settings-left-col")),t(this,"column4"),this.simUI=i,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("settings-tab-left","tab-panel-left"),this.leftPanel.appendChild(this.column1),this.leftPanel.appendChild(this.column2),this.leftPanel.appendChild(this.column3),this.simUI.isWithinRaidSim&&(this.column4=this.buildColumn(4,"settings-left-col"),this.leftPanel.appendChild(this.column4)),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("settings-tab-right","tab-panel-right","within-raid-sim-hide"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.simUI.isWithinRaidSim||this.buildEncounterSettings(),this.buildPlayerSettings(),this.buildCustomSettingsSections(),this.buildConsumesSection(),this.buildOtherSettings(),this.simUI.isWithinRaidSim||(this.buildBuffsSettings(),this.buildWorldBuffsSettings(),this.buildDebuffsSettings(),this.buildSavedDataPickers()),this.simUI.player.buffsChangeEmitter.emit(m.nextEventID())}buildEncounterSettings(){const e=new wn(this.column1,"encounter-settings",{header:{title:"Encounter"}});new vd(e.bodyElement,this.simUI.sim.encounter,this.simUI.individualConfig.encounterPicker,this.simUI)}buildPlayerSettings(){const e=new wn(this.column1,"player-settings",{header:{title:"Player"}}),t=I.newGroupContainer();t.classList.add("player-icon-group","icon-group"),e.bodyElement.appendChild(t),this.configureIconSection(t,this.simUI.individualConfig.playerIconInputs.map((e=>Xd(t,this.simUI.player,e))),!0);const s=[25,40,50,60].filter(((e,t)=>t<wa[this.simUI.player.spec].phase));new nn(e.bodyElement,this.simUI.player,{label:"Level",values:s.map((e=>({name:`Level ${e}`,value:e}))),changedEvent:e=>e.levelChangeEmitter,getValue:e=>e.getLevel(),setValue:(e,t,i)=>t.setLevel(e,i)});const a=A[this.simUI.player.spec];new nn(e.bodyElement,this.simUI.player,{label:"Race",values:a.map((e=>({name:ui.get(e),value:e}))),changedEvent:e=>e.raceChangeEmitter,getValue:e=>e.getRace(),setValue:(e,t,i)=>t.setRace(e,i)}),this.simUI.individualConfig.playerInputs?.inputs.length&&this.configureInputSection(e.bodyElement,this.simUI.individualConfig.playerInputs);let n=I.newGroupContainer();e.bodyElement.appendChild(n);const o=i(O);new nn(n,this.simUI.player,{label:"Profession 1",values:o.map((e=>({name:At.get(e),value:e}))),changedEvent:e=>e.professionChangeEmitter,getValue:e=>e.getProfession1(),setValue:(e,t,i)=>t.setProfession1(e,i)}),new nn(n,this.simUI.player,{label:"Profession 2",values:o.map((e=>({name:At.get(e),value:e}))),changedEvent:e=>e.professionChangeEmitter,getValue:e=>e.getProfession2(),setValue:(e,t,i)=>t.setProfession2(e,i)})}buildCustomSettingsSections(){(this.simUI.individualConfig.customSections||[]).forEach((e=>{e(this.column2,this.simUI).rootElem.classList.add("custom-section")}))}buildConsumesSection(){const e=this.simUI.isWithinRaidSim?this.column3:this.column2,t=new wn(e,"consumes-settings",{header:{title:"Consumables"}});new $h(t.bodyElement,this.simUI)}buildOtherSettings(){const e=this.simUI.individualConfig.otherInputs?.inputs.filter((e=>!e.extraCssClasses||!e.extraCssClasses?.includes("within-raid-sim-hide"))),t=this.simUI.individualConfig.itemSwapConfig;if(e.length||t?.itemSlots.length){const i=new wn(this.column2,"other-settings",{header:{title:"Other"}});e.length&&(this.configureInputSection(i.bodyElement,this.simUI.individualConfig.otherInputs),i.bodyElement.querySelectorAll(".input-root").forEach((e=>{e.classList.add("input-inline")}))),t?.itemSlots.length&&new Rd(i.bodyElement,this.simUI,this.simUI.player,t)}}buildBuffsSettings(){const e=Nd(tu,this.simUI),t=new wn(this.column3,"buffs-settings",{header:{title:"Raid Buffs",tooltip:"Buffs provided by other party/raid members. Note only the highest available buff rank will be applied, if possible, based on level selected"}});this.configureIconSection(t.bodyElement,e.map((e=>e.picker&&new e.picker(t.bodyElement,this.simUI.player,e.config,this.simUI))))}buildWorldBuffsSettings(){const e=new wn(this.column3,"world-buffs-settings",{header:{title:"World Buffs",tooltip:"World Buffs obtained from various sources across Azeroth."}}),t=Nd(su,this.simUI);new _d(e.bodyElement,this.simUI.player,Em(t));const i=Nd(iu,this.simUI);this.configureIconSection(e.bodyElement,i.map((t=>t.picker&&new t.picker(e.bodyElement,this.simUI.player,t.config,this.simUI))))}buildDebuffsSettings(){const e=Nd(au,this.simUI),t=Nd(nu,this.simUI);if(!e.length&&!t.length)return;const i=new wn(this.column3,"debuffs-settings",{header:{title:"Debuffs",tooltip:"Debuffs applied by other raid members."}});this.configureIconSection(i.bodyElement,e.map((e=>e.picker&&new e.picker(i.bodyElement,this.simUI.player,e.config,this.simUI)))),t.length&&new Dd(i.bodyElement,this.simUI.player,{inputs:t.map((e=>e.config)),label:"Misc Debuffs"},this.simUI)}buildSavedDataPickers(){const e=new gd(this.rightPanel,this.simUI.sim.encounter,{label:"Encounter",header:{title:"Saved Encounters"},storageKey:this.simUI.getSavedEncounterStorageKey(),getData:e=>pi.create({encounter:e.toProto()}),setData:(e,t,i)=>t.fromProto(e,i.encounter),changeEmitters:[this.simUI.sim.encounter.changeEmitter],equals:(e,t)=>pi.equals(e,t),toJson:e=>pi.toJson(e),fromJson:e=>pi.fromJson(e)}),t=new gd(this.rightPanel,this.simUI,{label:"Settings",header:{title:"Saved Settings"},storageKey:this.simUI.getSavedSettingsStorageKey(),getData:e=>{const t=e.player;return gi.create({raidBuffs:e.sim.raid.getBuffs(),partyBuffs:t.getParty()?.getBuffs()||h.create(),playerBuffs:t.getBuffs(),debuffs:e.sim.raid.getDebuffs(),consumes:t.getConsumes(),race:t.getRace(),level:t.getLevel(),professions:t.getProfessions(),enableItemSwap:t.getEnableItemSwap(),itemSwap:t.getItemSwapGear().toProto(),reactionTimeMs:t.getReactionTime(),channelClipDelayMs:t.getChannelClipDelay(),inFrontOfTarget:t.getInFrontOfTarget(),distanceFromTarget:t.getDistanceFromTarget(),healingModel:t.getHealingModel()})},setData:(e,t,i)=>{m.freezeAllAndDo((()=>{t.player.setLevel(e,i.level),t.sim.raid.setBuffs(e,i.raidBuffs||fe.create()),t.sim.raid.setDebuffs(e,i.debuffs||Ie.create());const s=t.player.getParty();s&&s.setBuffs(e,i.partyBuffs||h.create()),t.player.setBuffs(e,i.playerBuffs||k.create()),t.player.setConsumes(e,i.consumes||C.create()),t.player.setRace(e,i.race),t.player.setProfessions(e,i.professions),t.player.setEnableItemSwap(e,i.enableItemSwap),t.player.setItemSwapGear(e,t.sim.db.lookupItemSwap(i.itemSwap||fi.create())),t.player.setReactionTime(e,i.reactionTimeMs),t.player.setChannelClipDelay(e,i.channelClipDelayMs),t.player.setInFrontOfTarget(e,i.inFrontOfTarget),t.player.setDistanceFromTarget(e,i.distanceFromTarget),t.player.setHealingModel(e,i.healingModel||N.create())}))},changeEmitters:[this.simUI.sim.raid.buffsChangeEmitter,this.simUI.sim.raid.debuffsChangeEmitter,this.simUI.player.getParty().buffsChangeEmitter,this.simUI.player.buffsChangeEmitter,this.simUI.player.consumesChangeEmitter,this.simUI.player.raceChangeEmitter,this.simUI.player.professionChangeEmitter,this.simUI.player.itemSwapChangeEmitter,this.simUI.player.miscOptionsChangeEmitter,this.simUI.player.inFrontOfTargetChangeEmitter,this.simUI.player.distanceFromTargetChangeEmitter,this.simUI.player.healingModelChangeEmitter],equals:(e,t)=>gi.equals(e,t),toJson:e=>gi.toJson(e),fromJson:e=>gi.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),t.loadUserData()}))}configureInputSection(e,t){t.inputs.forEach((t=>{"number"==t.type?new en(e,this.simUI.player,t):"boolean"==t.type?new an(e,this.simUI.player,{...t,cssScheme:this.simUI.cssScheme}):"enum"==t.type&&new nn(e,this.simUI.player,t)}))}configureIconSection(e,t,i){0==t.length?e.classList.add("hide"):i&&(t.length<=4?e.style.gridTemplateColumns=`repeat(${t.length}, 1fr)`:t.length>4&&t.length<8&&(e.style.gridTemplateColumns=`repeat(${Math.ceil(t.length/2)}, 1fr)`))}}class lu extends I{constructor(e,i,s){super(e,"number-list-picker-root",i,s),t(this,"inputElem"),this.inputElem=document.createElement("input"),this.inputElem.type="text",this.inputElem.placeholder=s.placeholder||"",this.inputElem.classList.add("number-list-picker-input","form-control"),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",(e=>{this.inputChanged(m.nextEventID())}))}getInputElem(){return this.inputElem}getInputValue(){const e=this.inputElem.value;return e?e.split(",").map(parseFloat).filter((e=>!isNaN(e))):[]}setInputValue(e){Ii(this.getInputValue(),e)||(this.inputElem.value=e.map((e=>String(e))).join(","))}}class ru extends v{constructor(e,i){super(e,"cooldowns-picker-root"),t(this,"player"),t(this,"cooldownPickers"),this.player=i,this.cooldownPickers=[],m.onAny([this.player.rotationChangeEmitter,this.player.sim.unitMetadataEmitter]).on((e=>{this.update()})),this.update()}update(){this.rootElem.innerHTML="";const e=this.player.getSimpleCooldowns().cooldowns;this.cooldownPickers=[];for(let t=0;t<e.length+1;t++){const i=e[t],s=document.createElement("div");s.classList.add("cooldown-picker"),t==e.length&&s.classList.add("add-cooldown-picker"),this.rootElem.appendChild(s),this.makeActionPicker(s,t);const a=document.createElement("label");a.classList.add("cooldown-picker-label","form-label"),i&&i.id&&y.fromProto(i.id).fill(this.player.getRaidIndex()).then((e=>a.textContent=e.name)),s.appendChild(a),this.makeTimingsPicker(s,t);let n=document.createElement("fragment");n.innerHTML='\n\t\t\t\t<a\n\t\t\t\t\thref="javascript:void(0)"\n\t\t\t\t\tclass="delete-cooldown link-danger"\n\t\t\t\t\trole="button"\n\t\t\t\t>\n\t\t\t\t\t<i class="fa fa-times fa-xl"></i>\n\t\t\t\t</a>\n\t\t\t';const o=n.children[0],l=da.getOrCreateInstance(o,{title:"Delete Cooldown"});o.addEventListener("click",(e=>{const i=this.player.getSimpleCooldowns();i.cooldowns.splice(t,1),this.player.setSimpleCooldowns(m.nextEventID(),i),l.hide()})),s.appendChild(o),this.cooldownPickers.push(s)}}makeActionPicker(e,t){const i=this.player.getMetadata().getSpells().filter((e=>e.data.isMajorCooldown)).map((e=>e.id));return new _d(e,this.player,{extraCssClasses:["cooldown-action-picker"],numColumns:3,values:[{color:"#grey",value:wi.create()}].concat(i.map((e=>({actionId:()=>e,value:e.toProto()})))),equals:(e,t)=>wi.equals(e,t),zeroValue:wi.create(),backupIconUrl:e=>y.fromProto(e),changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getSimpleCooldowns().cooldowns[t]?.id||wi.create(),setValue:(e,i,s)=>{const a=i.getSimpleCooldowns();for(;a.cooldowns.length<t;)a.cooldowns.push(bi.create());a.cooldowns[t]=bi.create({id:s,timings:[]}),i.setSimpleCooldowns(e,a)}})}makeTimingsPicker(e,t){return new lu(e,this.player,{extraCssClasses:["cooldown-timings-picker"],placeholder:"20, 40, ...",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getSimpleCooldowns().cooldowns[t]?.timings||[],setValue:(e,i,s)=>{const a=i.getSimpleCooldowns();a.cooldowns[t].timings=s,i.setSimpleCooldowns(e,a)},enableWhen:e=>{const i=e.getSimpleCooldowns().cooldowns[t];return i&&!wi.equals(i.id,wi.create())}})}}class du extends I{constructor(e,i,s){super(e,"adaptive-string-picker-root",i,s),t(this,"inputElem"),this.inputElem=document.createElement("input"),this.inputElem.type="text",this.inputElem.classList.add("form-control"),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",(e=>{this.inputChanged(m.nextEventID())})),this.inputElem.addEventListener("input",(e=>{this.updateSize()})),this.updateSize()}getInputElem(){return this.inputElem}getInputValue(){return this.inputElem.value}setInputValue(e){this.inputElem.value=e,this.updateSize()}updateSize(){const e=Math.max(3,this.inputElem.value.length);this.inputElem.size!=e&&(this.inputElem.size=e)}}const cu={auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().map((t=>{const i=e.getAuras().filter((e=>e.id.name.startsWith(t.id.name.replace(/ \(Rank \d+\)/g,"")))).length>1;return{value:t.id,submenu:i?[t.id.name.replace(/ \(Rank \d+\)/g,"")]:[]}}))},stackable_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter((e=>e.data.maxStacks>0)).map((t=>{const i=e.getAuras().filter((e=>e.id.name.startsWith(t.id.name.replace(/ \(Rank \d+\)/g,"")))).length>1;return{value:t.id,submenu:i?[t.id.name.replace(/ \(Rank \d+\)/g,"")]:[]}}))},icd_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter((e=>e.data.hasIcd)).map((t=>{const i=e.getAuras().filter((e=>e.id.name.startsWith(t.id.name.replace(/ \(Rank \d+\)/g,"")))).length>1;return{value:t.id,submenu:i?[t.id.name.replace(/ \(Rank \d+\)/g,"")]:[]}}))},exclusive_effect_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter((e=>e.data.hasExclusiveEffect)).map((t=>{const i=e.getAuras().filter((e=>e.id.name.startsWith(t.id.name.replace(/ \(Rank \d+\)/g,"")))).length>1;return{value:t.id,submenu:i?[t.id.name.replace(/ \(Rank \d+\)/g,"")]:[]}}))},castable_spells:{defaultLabel:"Spell",getActionIDs:async e=>{const t=e.getSpells().filter((e=>e.data.isCastable)),{spells:i,cooldowns:s}=Ei(t,(e=>e.data.isMajorCooldown?"cooldowns":"spells")),a=[y.fromOtherId(yi.OtherActionPotion)];return[[{value:y.fromEmpty(),headerText:"Spells",submenu:["Spells"]}],(i||[]).map((e=>{const t=i.filter((t=>t.id.name.startsWith(e.id.name.replace(/ \(Rank \d+\)/g,"")))).length>1;return{value:e.id,submenu:t?["Spells",e.id.name.replace(/ \(Rank \d+\)/g,"")]:["Spells"],extraCssClasses:e.data.prepullOnly?["apl-prepull-actions-only"]:e.data.encounterOnly?["apl-priority-list-only"]:[]}})),[{value:y.fromEmpty(),headerText:"Cooldowns",submenu:["Cooldowns"]}],(s||[]).map((e=>{const t=s.filter((t=>t.id.name.startsWith(e.id.name.replace(/ \(Rank \d+\)/g,"")))).length>1;return{value:e.id,submenu:t?["Cooldowns",e.id.name.replace(/ \(Rank \d+\)/g,"")]:["Cooldowns"],extraCssClasses:e.data.prepullOnly?["apl-prepull-actions-only"]:e.data.encounterOnly?["apl-priority-list-only"]:[]}})),[{value:y.fromEmpty(),headerText:"Placeholders",submenu:["Placeholders"]}],a.map((e=>({value:e,submenu:["Placeholders"],tooltip:"The Prepull Potion if CurrentTime < 0, or the Combat Potion if combat has started."})))].flat()}},channel_spells:{defaultLabel:"Channeled Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.isCastable&&e.data.isChanneled)).map((t=>{const i=e.getSpells().filter((e=>e.id.name.startsWith(t.id.name.replace(/ \(Rank \d+\)/g,"")))).length>1;return{value:t.id,submenu:i?[t.id.name.replace(/ \(Rank \d+\)/g,"")]:[]}}))},dot_spells:{defaultLabel:"DoT Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.hasDot)).map((t=>{const i=e.getSpells().filter((e=>e.id.name.startsWith(t.id.name.replace(/ \(Rank \d+\)/g,"")))).length>1;return{value:t.id,submenu:i?[t.id.name.replace(/ \(Rank \d+\)/g,"")]:[]}}))},shield_spells:{defaultLabel:"Shield Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.hasShield)).map((t=>{const i=e.getSpells().filter((e=>e.id.name.startsWith(t.id.name.replace(/ \(Rank \d+\)/g,"")))).length>1;return{value:t.id,submenu:i?[t.id.name.replace(/ \(Rank \d+\)/g,"")]:[]}}))}};class hu extends vi{constructor(e,t,i){const s=cu[i.actionIdSet];super(e,t,{...i,sourceToValue:e=>e?y.fromProto(e):y.fromEmpty(),valueToSource:e=>e.toProto(),defaultLabel:s.defaultLabel,equals:(e,t)=>null==e==(null==t)&&(!e||e.equals(t)),setOptionContent:(e,t)=>{const i=t.value,s=document.createElement("a");s.classList.add("apl-actionid-item-icon"),i.setBackgroundAndHref(s),e.appendChild(s);const a=document.createTextNode(i.name);e.appendChild(a)},createMissingValue:e=>e.fill().then((e=>({value:e}))),values:[]});const a=i.getUnitRef,n="self"==i.defaultUnitRef?be.create({type:we.Self}):be.create({type:we.CurrentTarget}),o=s.getActionIDs,l=async()=>{const e=a(t),i=t.sim.getUnitMetadata(e,t,n);if(i){const e=await o(i);this.setOptions(e)}};l(),m.onAny([t.sim.unitMetadataEmitter,t.rotationChangeEmitter]).on(l)}}const mu={aura_sources:{getUnits:e=>[void 0,e.getPetMetadatas().asList().map(((e,t)=>be.create({type:we.Pet,index:t,owner:be.create({type:we.Self})}))),be.create({type:we.CurrentTarget}),e.sim.encounter.targetsMetadata.asList().map(((e,t)=>be.create({type:we.Target,index:t})))].flat()},aura_sources_targets_first:{targetUI:!0,getUnits:e=>[void 0,e.sim.encounter.targetsMetadata.asList().map(((e,t)=>be.create({type:we.Target,index:t}))),be.create({type:we.Self}),e.getPetMetadatas().asList().map(((e,t)=>be.create({type:we.Pet,index:t,owner:be.create({type:we.Self})})))].flat()},targets:{targetUI:!0,getUnits:e=>[void 0,e.sim.encounter.targetsMetadata.asList().map(((e,t)=>be.create({type:we.Target,index:t})))].flat()}};class uu extends xi{constructor(e,i,s){const a=!!mu[s.unitSet].targetUI;super(e,i,{...s,sourceToValue:e=>uu.refToValue(e,i,a),valueToSource:e=>e.value,values:[],hideLabelWhenDefaultSelected:!0}),t(this,"unitSet"),this.unitSet=s.unitSet,this.rootElem.classList.add("apl-unit-picker"),this.updateValues(),i.sim.unitMetadataEmitter.on((()=>this.updateValues()))}static refToValue(e,t,i){if(!e||e.type==we.Unknown)return{value:e,iconUrl:i?"fa-bullseye":"fa-user",text:i?"Current Target":"Self"};if(e.type==we.Self)return{value:e,iconUrl:"fa-user",text:"Self"};if(e.type==we.CurrentTarget)return{value:e,iconUrl:"fa-bullseye",text:"Current Target"};if(e.type==we.Player){const i=t.sim.raid.getPlayer(e.index);if(i)return{value:e,iconUrl:i.getSpecIcon(),text:`Player ${e.index+1}`}}else if(e.type==we.Target){if(t.sim.encounter.targetsMetadata.asList()[e.index])return{value:e,iconUrl:Si,text:`Target ${e.index+1}`}}else if(e.type==we.Pet){const i=t.sim.getUnitMetadata(e,t,be.create({type:we.Self}));let s=`Pet ${e.index+1}`,a="fa-paw";if(i){const e=i.getName();if(e){const t=e.indexOf(" - ");s=e.substring(t+3),a=Pi(s)||a}}return{value:e,iconUrl:a,text:s}}return{value:e}}updateValues(){const e=mu[this.unitSet],t=e.getUnits(this.modObject);this.setOptions(t.map((t=>{const i={value:uu.refToValue(t,this.modObject,e.targetUI)};return t&&t.type==we.Pet&&(e.targetUI?i.submenu=[uu.refToValue(t.owner,this.modObject,e.targetUI)]:i.submenu=[uu.refToValue(void 0,this.modObject,e.targetUI)]),i})))}}class pu extends I{constructor(e,i,s){super(e,"apl-picker-builder-root",i,s),t(this,"config"),t(this,"fieldPickers"),this.config=s,this.fieldPickers=s.fields.map((e=>pu.makeFieldPicker(this,e))),this.init()}static makeFieldPicker(e,t){const i=t.field,s=t.factory(e.rootElem,e.modObject,{label:t.label,labelTooltip:t.labelTooltip,changedEvent:e=>e.rotationChangeEmitter,getValue:()=>{const s=e.getSourceValue();return s[i]||(s[i]=t.newValue()),s[i]},setValue:(t,s,a)=>{e.getSourceValue()[i]=a,s.rotationChangeEmitter.emit(t)}},(()=>e.getSourceValue()));return"vals"!==i&&"actions"!==i||s.rootElem.classList.add("apl-picker-builder-multi"),{...t,picker:s}}getInputElem(){return this.rootElem}getInputValue(){const e=this.config.newValue();return this.fieldPickers.forEach((t=>{e[t.field]=t.picker.getInputValue()})),e}setInputValue(e){this.fieldPickers.forEach((t=>{t.picker.setInputValue(e[t.field])}))}}function gu(e,t,i,s,a){return{field:e,newValue:()=>wi.create(),factory:(e,a,n,o)=>new hu(e,a,{...n,actionIdSet:t,getUnitRef:()=>i?o()[i]:be.create(),defaultUnitRef:s||"self"}),...a||{}}}function fu(e,t,i){return{field:e,newValue:()=>{},factory:(e,i,s)=>new uu(e,i,{...s,unitSet:t}),...i||{}}}function Iu(e,t,i){return{field:e,newValue:()=>!1,factory:(e,t,i)=>(i.extraCssClasses=["input-inline"].concat(i.extraCssClasses||[]),new an(e,t,i)),...i||{},label:t}}function wu(e,t,i){return{field:e,newValue:()=>0,factory:(e,i,s)=>{const a=s;return a.float=t,a.extraCssClasses=["input-inline"].concat(s.extraCssClasses||[]),new en(e,i,a)},...i||{}}}function bu(e,t){return{field:e,newValue:()=>"",factory:(e,t,i)=>(i.extraCssClasses=["input-inline"].concat(i.extraCssClasses||[]),new du(e,t,i)),...t||{}}}function vu(e,t){return(i,s,a)=>new pu(i,s,{...a,newValue:e,fields:t})}class xu extends I{constructor(e,i,s){super(e,"apl-value-picker-root",i,s),t(this,"kindPicker"),t(this,"currentKind"),t(this,"valuePicker");const a=null!=this.rootElem.closest(".apl-prepull-action-picker"),n=Object.keys(Pu).filter((e=>Pu[e].includeIf?.(i,a)??!0));this.kindPicker=new Ps(this.rootElem,i,{defaultLabel:"No Condition",values:[{value:void 0,label:"<None>"}].concat(n.map((e=>{const t=Pu[e];return{value:e,label:t.label,submenu:t.submenu,tooltip:t.fullDescription?`<p>${t.shortDescription}</p> ${t.fullDescription}`:t.shortDescription}}))),equals:(e,t)=>e==t,changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.value.oneofKind,setValue:(e,t,i)=>{const s=this.getSourceValue(),a=s?.value.oneofKind;if(a!=i){if(i){const t=Pu[i];let n=this.makeAPLValue(i,t.newValue());s&&a&&this.valuePicker&&("not"==i?n.value.not.val=this.makeAPLValue(a,this.valuePicker.getInputValue()):"not"==s.value.oneofKind&&s.value.not.val?.value.oneofKind==i?n=s.value.not.val:"and"==i?"or"==s.value.oneofKind?n.value.and.vals=s.value.or.vals:n.value.and.vals=[this.makeAPLValue(a,this.valuePicker.getInputValue())]:"or"==i?"and"==s.value.oneofKind?n.value.or.vals=s.value.and.vals:n.value.or.vals=[this.makeAPLValue(a,this.valuePicker.getInputValue())]:"min"==i?"max"==s.value.oneofKind?n.value.min.vals=s.value.max.vals:n.value.min.vals=[this.makeAPLValue(a,this.valuePicker.getInputValue())]:"max"==i?"min"==s.value.oneofKind?n.value.max.vals=s.value.min.vals:n.value.max.vals=[this.makeAPLValue(a,this.valuePicker.getInputValue())]:"and"==s.value.oneofKind&&s.value.and.vals?.[0]?.value.oneofKind==i?n=s.value.and.vals[0]:"or"==s.value.oneofKind&&s.value.or.vals?.[0]?.value.oneofKind==i?n=s.value.or.vals[0]:"min"==s.value.oneofKind&&s.value.min.vals?.[0]?.value.oneofKind==i?n=s.value.min.vals[0]:"max"==s.value.oneofKind&&s.value.max.vals?.[0]?.value.oneofKind==i?n=s.value.max.vals[0]:"cmp"==i&&(n.value.cmp.lhs=this.makeAPLValue(a,this.valuePicker.getInputValue()))),s?s.value=n.value:this.setSourceValue(e,n)}else this.setSourceValue(e,void 0);t.rotationChangeEmitter.emit(e)}}}),this.currentKind=void 0,this.valuePicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){const e=this.kindPicker.getInputValue();return e?_s.create({value:{oneofKind:e,...(()=>{const t={};return e&&this.valuePicker&&(t[e]=this.valuePicker.getInputValue()),t})()}}):void 0}setInputValue(e){const t=e?.value.oneofKind;this.updateValuePicker(t),t&&e&&this.valuePicker.setInputValue(e.value[t])}makeAPLValue(e,t){if(!e)return _s.create();const i={oneofKind:e};return i[e]=t,_s.create({value:i})}updateValuePicker(e){const t=this.currentKind;if(e==t)return;if(this.currentKind=e,this.valuePicker&&(this.valuePicker.rootElem.remove(),this.valuePicker=null),!e)return;this.kindPicker.setInputValue(e);const i=Pu[e];this.valuePicker=i.factory(this.rootElem,this.modObject,{changedEvent:e=>e.rotationChangeEmitter,getValue:()=>{const t=this.getSourceValue();return t&&t.value[e]||i.newValue()},setValue:(t,i,s)=>{const a=this.getSourceValue();a&&(a.value[e]=s),i.rotationChangeEmitter.emit(t)}})}}function Su(e,t){return{field:e,newValue:_s.create,factory:(e,t,i)=>new xu(e,t,i),...t||{}}}function Eu(e){return{field:e,newValue:()=>[],factory:(e,t,i)=>new bd(e,t,{...i,setValue:(e,t,s)=>{i.setValue(e,t,s.map((e=>e||_s.create())))},itemLabel:"Value",newItem:_s.create,copyItem:e=>e?_s.clone(e):e,newItemPicker:(e,i,s,a)=>new xu(e,t,a),allowedActions:["create","delete"],actions:{create:{useIcon:!0}}})}}function yu(e){return{label:e.label,submenu:e.submenu,shortDescription:e.shortDescription,fullDescription:e.fullDescription,newValue:e.newValue,includeIf:e.includeIf,factory:vu(e.newValue,e.fields)}}const Pu={const:yu({label:"Const",shortDescription:"A fixed value.",fullDescription:"\n\t\t<p>\n\t\t\tExamples:\n\t\t\t<ul>\n\t\t\t\t<li><b>Number:</b> '123', '0.5', '-10'</li>\n\t\t\t\t<li><b>Time:</b> '100ms', '5s', '3m'</li>\n\t\t\t\t<li><b>Percentage:</b> '30%'</li>\n\t\t\t</ul>\n\t\t</p>\n\t\t",newValue:ki.create,fields:[bu("val")]}),cmp:yu({label:"Compare",submenu:["Logic"],shortDescription:"Compares two values.",newValue:Ci.create,fields:[Su("lhs"),(ku="op",{field:ku,newValue:()=>ys.OpEq,factory:(e,t,i)=>new Ps(e,t,{...i,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:ys.OpEq,label:"=="},{value:ys.OpNe,label:"!="},{value:ys.OpGe,label:">="},{value:ys.OpGt,label:">"},{value:ys.OpLe,label:"<="},{value:ys.OpLt,label:"<"}]})}),Su("rhs")]}),math:yu({label:"Math",submenu:["Logic"],shortDescription:"Do basic math on two values.",newValue:Li.create,fields:[Su("lhs"),function(e){return{field:e,newValue:()=>ks.OpAdd,factory:(e,t,i)=>new Ps(e,t,{...i,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:ks.OpAdd,label:"+"},{value:ks.OpSub,label:"-"},{value:ks.OpMul,label:"*"},{value:ks.OpDiv,label:"/"}]})}}("op"),Su("rhs")]}),max:yu({label:"Max",submenu:["Logic"],shortDescription:"Returns the largest value among the subvalues.",newValue:Ti.create,fields:[Eu("vals")]}),min:yu({label:"Min",submenu:["Logic"],shortDescription:"Returns the smallest value among the subvalues.",newValue:_i.create,fields:[Eu("vals")]}),and:yu({label:"All of",submenu:["Logic"],shortDescription:"Returns <b>True</b> if all of the sub-values are <b>True</b>, otherwise <b>False</b>",newValue:Ni.create,fields:[Eu("vals")]}),or:yu({label:"Any of",submenu:["Logic"],shortDescription:"Returns <b>True</b> if any of the sub-values are <b>True</b>, otherwise <b>False</b>",newValue:Ri.create,fields:[Eu("vals")]}),not:yu({label:"Not",submenu:["Logic"],shortDescription:"Returns the opposite of the inner value, i.e. <b>True</b> if the value is <b>False</b> and vice-versa.",newValue:Ai.create,fields:[Su("val")]}),currentTime:yu({label:"Current Time",submenu:["Encounter"],shortDescription:"Elapsed time of the current sim iteration.",newValue:Di.create,fields:[]}),currentTimePercent:yu({label:"Current Time (%)",submenu:["Encounter"],shortDescription:"Elapsed time of the current sim iteration, as a percentage.",newValue:Mi.create,fields:[]}),remainingTime:yu({label:"Remaining Time",submenu:["Encounter"],shortDescription:"Elapsed time of the remaining sim iteration.",newValue:Vi.create,fields:[]}),remainingTimePercent:yu({label:"Remaining Time (%)",submenu:["Encounter"],shortDescription:"Elapsed time of the remaining sim iteration, as a percentage.",newValue:Ui.create,fields:[]}),isExecutePhase:yu({label:"Is Execute Phase",submenu:["Encounter"],shortDescription:"<b>True</b> if the encounter is in Execute Phase, meaning the target's health is less than the given threshold, otherwise <b>False</b>.",newValue:Fi.create,fields:[function(e){return{field:e,newValue:()=>Ls.E20,factory:(e,t,i)=>new Ps(e,t,{...i,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Ls.E20,label:"20%"},{value:Ls.E25,label:"25%"},{value:Ls.E35,label:"35%"}]})}}("threshold")]}),numberTargets:yu({label:"Number of Targets",submenu:["Encounter"],shortDescription:"Count of targets in the current encounter",newValue:Wi.create,fields:[]}),frontOfTarget:yu({label:"Front of Target",submenu:["Encounter"],shortDescription:"<b>True</b> if facing from of target",newValue:Oi.create,fields:[]}),currentHealth:yu({label:"Health",submenu:["Resources"],shortDescription:"Amount of currently available Health.",newValue:Hi.create,fields:[fu("sourceUnit","aura_sources")]}),currentHealthPercent:yu({label:"Health (%)",submenu:["Resources"],shortDescription:"Amount of currently available Health, as a percentage.",newValue:qi.create,fields:[fu("sourceUnit","aura_sources")]}),currentMana:yu({label:"Mana",submenu:["Resources"],shortDescription:"Amount of currently available Mana.",newValue:Bi.create,fields:[]}),currentManaPercent:yu({label:"Mana (%)",submenu:["Resources"],shortDescription:"Amount of currently available Mana, as a percentage.",newValue:zi.create,fields:[]}),currentRage:yu({label:"Rage",submenu:["Resources"],shortDescription:"Amount of currently available Rage.",newValue:ji.create,fields:[]}),currentEnergy:yu({label:"Energy",submenu:["Resources"],shortDescription:"Amount of currently available Energy.",newValue:$i.create,fields:[]}),currentComboPoints:yu({label:"Combo Points",submenu:["Resources"],shortDescription:"Amount of currently available Combo Points.",newValue:Gi.create,fields:[]}),gcdIsReady:yu({label:"GCD Is Ready",submenu:["GCD"],shortDescription:"<b>True</b> if the GCD is not on cooldown, otherwise <b>False</b>.",newValue:Ki.create,fields:[]}),gcdTimeToReady:yu({label:"GCD Time To Ready",submenu:["GCD"],shortDescription:"Amount of time remaining before the GCD comes off cooldown, or <b>0</b> if it is not on cooldown.",newValue:Ji.create,fields:[]}),autoTimeToNext:yu({label:"Time To Next Auto",submenu:["Auto"],shortDescription:"Amount of time remaining before the next Main-hand or Off-hand melee attack, or <b>0</b> if autoattacks are not engaged.",newValue:Zi.create,fields:[function(e){return{field:e,newValue:()=>Cs.Any,factory:(e,t,i)=>new Ps(e,t,{...i,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Cs.Any,label:"Any"},{value:Cs.Melee,label:"Melee"},{value:Cs.MainHand,label:"Main Hand"},{value:Cs.OffHand,label:"Off Hand"},{value:Cs.Ranged,label:"Ranged"}]})}}("autoType")]}),spellCurrentCost:yu({label:"Current Cost",submenu:["Spell"],shortDescription:"Returns current resource cost of spell",newValue:Yi.create,fields:[gu("spellId","castable_spells","")]}),spellCanCast:yu({label:"Can Cast",submenu:["Spell"],shortDescription:"<b>True</b> if all requirements for casting the spell are currently met, otherwise <b>False</b>.",fullDescription:"\n\t\t\t<p>The <b>Cast Spell</b> action does not need to be conditioned on this, because it applies this check automatically.</p>\n\t\t",newValue:Qi.create,fields:[gu("spellId","castable_spells","")]}),spellIsReady:yu({label:"Is Ready",submenu:["Spell"],shortDescription:"<b>True</b> if the spell is not on cooldown, otherwise <b>False</b>.",newValue:Xi.create,fields:[gu("spellId","castable_spells","")]}),spellTimeToReady:yu({label:"Time To Ready",submenu:["Spell"],shortDescription:"Amount of time remaining before the spell comes off cooldown, or <b>0</b> if it is not on cooldown.",newValue:es.create,fields:[gu("spellId","castable_spells","")]}),spellCastTime:yu({label:"Cast Time",submenu:["Spell"],shortDescription:"Amount of time to cast the spell including any haste and spell cast time adjustments.",newValue:ts.create,fields:[gu("spellId","castable_spells","")]}),spellTravelTime:yu({label:"Travel Time",submenu:["Spell"],shortDescription:"Amount of time for the spell to travel to the target.",newValue:is.create,fields:[gu("spellId","castable_spells","")]}),spellCpm:yu({label:"CPM",submenu:["Spell"],shortDescription:"Casts Per Minute for the spell so far in the current iteration.",newValue:ss.create,fields:[gu("spellId","castable_spells","")]}),spellIsChanneling:yu({label:"Is Channeling",submenu:["Spell"],shortDescription:"<b>True</b> if this spell is currently being channeled, otherwise <b>False</b>.",newValue:as.create,fields:[gu("spellId","channel_spells","")]}),spellChanneledTicks:yu({label:"Channeled Ticks",submenu:["Spell"],shortDescription:"The number of completed ticks in the current channel of this spell, or <b>0</b> if the spell is not being channeled.",newValue:ns.create,fields:[gu("spellId","channel_spells","")]}),channelClipDelay:yu({label:"Channel Clip Delay",submenu:["Spell"],shortDescription:"The amount of time specified by the <b>Channel Clip Delay</b> setting.",newValue:os.create,fields:[]}),auraIsActive:yu({label:"Aura Active",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently active, otherwise <b>False</b>.",newValue:ls.create,fields:[fu("sourceUnit","aura_sources"),gu("auraId","auras","sourceUnit")]}),auraIsActiveWithReactionTime:yu({label:"Aura Active (with Reaction Time)",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently active AND it has been active for at least as long as the player reaction time (configured in Settings), otherwise <b>False</b>.",newValue:rs.create,fields:[fu("sourceUnit","aura_sources"),gu("auraId","auras","sourceUnit")]}),auraRemainingTime:yu({label:"Aura Remaining Time",submenu:["Aura"],shortDescription:"Time remaining before this aura will expire, or 0 if the aura is not currently active.",newValue:ds.create,fields:[fu("sourceUnit","aura_sources"),gu("auraId","auras","sourceUnit")]}),auraNumStacks:yu({label:"Aura Num Stacks",submenu:["Aura"],shortDescription:"Number of stacks of the aura.",newValue:cs.create,fields:[fu("sourceUnit","aura_sources"),gu("auraId","stackable_auras","sourceUnit")]}),auraInternalCooldown:yu({label:"Aura Remaining ICD",submenu:["Aura"],shortDescription:"Time remaining before this aura's internal cooldown will be ready, or <b>0</b> if the ICD is ready now.",newValue:hs.create,fields:[fu("sourceUnit","aura_sources"),gu("auraId","icd_auras","sourceUnit")]}),auraIcdIsReadyWithReactionTime:yu({label:"Aura ICD Is Ready (with Reaction Time)",submenu:["Aura"],shortDescription:"<b>True</b> if the aura's ICD is currently ready OR it was put on CD recently, within the player's reaction time (configured in Settings), otherwise <b>False</b>.",newValue:ms.create,fields:[fu("sourceUnit","aura_sources"),gu("auraId","icd_auras","sourceUnit")]}),auraShouldRefresh:yu({label:"Should Refresh Aura",submenu:["Aura"],shortDescription:"Whether this aura should be refreshed, e.g. for the purpose of maintaining a debuff.",fullDescription:"\n\t\t<p>This condition checks not only the specified aura but also any other auras on the same unit, including auras applied by other raid members, which apply the same debuff category.</p>\n\t\t<p>For example, 'Should Refresh Debuff(Sunder Armor)' will return <b>False</b> if the unit has an active Expose Armor aura.</p>\n\t\t",newValue:()=>us.create({maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[fu("sourceUnit","aura_sources_targets_first"),gu("auraId","exclusive_effect_auras","sourceUnit","currentTarget"),Su("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before the aura expires when it may be refreshed."})]}),dotIsActive:yu({label:"Dot Is Active",submenu:["DoT"],shortDescription:"<b>True</b> if the specified dot is currently ticking, otherwise <b>False</b>.",newValue:ps.create,fields:[fu("targetUnit","targets"),gu("spellId","dot_spells","")]}),dotRemainingTime:yu({label:"Dot Remaining Time",submenu:["DoT"],shortDescription:"Time remaining before the last tick of this DoT will occur, or 0 if the DoT is not currently ticking.",newValue:gs.create,fields:[fu("targetUnit","targets"),gu("spellId","dot_spells","")]}),sequenceIsComplete:yu({label:"Sequence Is Complete",submenu:["Sequence"],shortDescription:"<b>True</b> if there are no more subactions left to execute in the sequence, otherwise <b>False</b>.",newValue:fs.create,fields:[bu("sequenceName")]}),sequenceIsReady:yu({label:"Sequence Is Ready",submenu:["Sequence"],shortDescription:"<b>True</b> if the next subaction in the sequence is ready to be executed, otherwise <b>False</b>.",newValue:Is.create,fields:[bu("sequenceName")]}),sequenceTimeToReady:yu({label:"Sequence Time To Ready",submenu:["Sequence"],shortDescription:"Returns the amount of time remaining until the next subaction in the sequence will be ready.",newValue:ws.create,fields:[bu("sequenceName")]}),totemRemainingTime:yu({label:"Totem Remaining Time",submenu:["Shaman"],shortDescription:"Returns the amount of time remaining until the totem will expire.",newValue:bs.create,includeIf:(e,t)=>e.getClass()==g.ClassShaman,fields:[function(e){return{field:e,newValue:()=>Ts.Water,factory:(e,t,i)=>new Ps(e,t,{...i,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Ts.Earth,label:"Earth"},{value:Ts.Air,label:"Air"},{value:Ts.Fire,label:"Fire"},{value:Ts.Water,label:"Water"}]})}}("totemType")]}),catExcessEnergy:yu({label:"Excess Energy",submenu:["Feral Druid"],shortDescription:"Returns the amount of excess energy available, after subtracting energy that will be needed to maintain DoTs.",newValue:vs.create,includeIf:(e,t)=>e.spec==d.SpecFeralDruid,fields:[]}),catNewSavageRoarDuration:yu({label:"New Savage Roar Duration",submenu:["Feral Druid"],shortDescription:"Returns duration of savage roar based on current combo points",newValue:xs.create,includeIf:(e,t)=>e.spec==d.SpecFeralDruid,fields:[]}),warlockShouldRecastDrainSoul:yu({label:"Should Recast Drain Soul",submenu:["Warlock"],shortDescription:"Returns <b>True</b> if the current Drain Soul channel should be immediately recast, to get a better snapshot.",newValue:Ss.create,includeIf:(e,t)=>e.getClass()==g.ClassWarlock,fields:[]}),warlockShouldRefreshCorruption:yu({label:"Should Refresh Corruption",submenu:["Warlock"],shortDescription:"Returns <b>True</b> if the current Corruption has expired, or should be refreshed to get a better snapshot.",newValue:Es.create,includeIf:(e,t)=>e.getClass()==g.ClassWarlock,fields:[fu("targetUnit","targets")]})};var ku;class Cu extends I{constructor(e,i,s){super(e,"apl-action-picker-root",i,s),t(this,"kindPicker"),t(this,"actionDiv"),t(this,"currentKind"),t(this,"actionPicker"),t(this,"conditionPicker"),this.conditionPicker=new xu(this.rootElem,this.modObject,{label:"If:",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.condition,setValue:(e,t,i)=>{const s=this.getSourceValue();s?(s.condition=i,t.rotationChangeEmitter.emit(e)):this.setSourceValue(e,Ks.create({condition:i}))}}),this.conditionPicker.rootElem.classList.add("apl-action-condition","apl-priority-list-only"),this.actionDiv=document.createElement("div"),this.actionDiv.classList.add("apl-action-picker-action"),this.rootElem.appendChild(this.actionDiv);const a=null!=this.rootElem.closest(".apl-prepull-action-picker"),n=Object.keys(_u).filter((e=>_u[e].includeIf?.(i,a)??!0));this.kindPicker=new Ps(this.actionDiv,i,{defaultLabel:"Action",values:n.map((e=>{const t=_u[e];return{value:e,label:t.label,submenu:t.submenu,tooltip:t.fullDescription?`<p>${t.shortDescription}</p> ${t.fullDescription}`:t.shortDescription}})),equals:(e,t)=>e==t,changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.action.oneofKind,setValue:(e,t,i)=>{const s=this.getSourceValue(),a=s?.action.oneofKind;if(a!=i){if(i){const t=_u[i];let n=this.makeAPLAction(i,t.newValue());s&&a&&this.actionPicker&&("sequence"==i?"strictSequence"==s.action.oneofKind?n.action.sequence.actions=s.action.strictSequence.actions:n.action.sequence.actions=[this.makeAPLAction(a,this.actionPicker.getInputValue())]:"strictSequence"==i?"sequence"==s.action.oneofKind?n.action.strictSequence.actions=s.action.sequence.actions:n.action.strictSequence.actions=[this.makeAPLAction(a,this.actionPicker.getInputValue())]:"sequence"==s.action.oneofKind&&s.action.sequence.actions?.[0]?.action.oneofKind==i?n=s.action.sequence.actions[0]:"strictSequence"==s.action.oneofKind&&s.action.strictSequence.actions?.[0]?.action.oneofKind==i&&(n=s.action.strictSequence.actions[0])),s?s.action=n.action:this.setSourceValue(e,n)}else s.action={oneofKind:i};t.rotationChangeEmitter.emit(e)}}}),this.currentKind=void 0,this.actionPicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){const e=this.kindPicker.getInputValue();return Ks.create({condition:this.conditionPicker.getInputValue(),action:{oneofKind:e,...(()=>{const t={};return e&&this.actionPicker&&(t[e]=this.actionPicker.getInputValue()),t})()}})}setInputValue(e){if(!e)return;this.conditionPicker.setInputValue(e.condition||_s.create());const t=e.action.oneofKind;this.updateActionPicker(t),t&&this.actionPicker.setInputValue(e.action[t])}makeAPLAction(e,t){if(!e)return Ks.create();const i={oneofKind:e};return i[e]=t,Ks.create({action:i})}updateActionPicker(e){const t=this.currentKind;if(e==t)return;if(this.currentKind=e,this.actionPicker&&(this.actionPicker.rootElem.remove(),this.actionPicker=null),!e)return;this.kindPicker.setInputValue(e);const i=_u[e];this.actionPicker=i.factory(this.actionDiv,this.modObject,{changedEvent:e=>e.rotationChangeEmitter,getValue:()=>this.getSourceValue()?.action?.[e]||i.newValue(),setValue:(t,i,s)=>{const a=this.getSourceValue();a&&((a?.action)[e]=s),i.rotationChangeEmitter.emit(t)}}),this.actionPicker.rootElem.classList.add("apl-action-"+e)}}function Lu(e){return{field:e,newValue:()=>[],factory:(e,t,i)=>new bd(e,t,{...i,setValue:(e,t,s)=>{i.setValue(e,t,s.map((e=>e||Ks.create())))},itemLabel:"Action",newItem:Ks.create,copyItem:e=>e?Ks.clone(e):e,newItemPicker:(e,i,s,a)=>new Cu(e,t,a),allowedActions:["create","delete","move"],actions:{create:{useIcon:!0}}})}}function Tu(e){return{label:e.label,submenu:e.submenu,shortDescription:e.shortDescription,fullDescription:e.fullDescription,includeIf:e.includeIf,newValue:e.newValue,factory:vu(e.newValue,e.fields)}}const _u={castSpell:Tu({label:"Cast",shortDescription:"Casts the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.",newValue:Ns.create,fields:[gu("spellId","castable_spells",""),fu("target","targets")]}),multidot:Tu({label:"Multi Dot",submenu:["Casting"],shortDescription:"Keeps a DoT active on multiple targets by casting the specified spell.",includeIf:(e,t)=>!t,newValue:()=>Rs.create({maxDots:3,maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[gu("spellId","dot_spells",""),wu("maxDots",!1,{label:"Max Dots",labelTooltip:"Maximum number of DoTs to simultaneously apply."}),Su("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before a DoT expires when it may be refreshed."})]}),multishield:Tu({label:"Multi Shield",submenu:["Casting"],shortDescription:"Keeps a Shield active on multiple targets by casting the specified spell.",includeIf:(e,t)=>!t&&Gt(e.spec),newValue:()=>As.create({maxShields:3,maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[gu("spellId","shield_spells",""),wu("maxShields",!1,{label:"Max Shields",labelTooltip:"Maximum number of Shields to simultaneously apply."}),Su("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before a Shield expires when it may be refreshed."})]}),channelSpell:Tu({label:"Channel",submenu:["Casting"],shortDescription:"Channels the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.",fullDescription:"\n\t\t\t<p>The difference between channeling a spell vs casting the spell is that channels can be interrupted. If the <b>Interrupt If</b> parameter is empty, this action is equivalent to <b>Cast</b>.</p>\n\t\t\t<p>The channel will be interrupted only if Instant Interrupt is true OR all of the following are true:</p>\n\t\t\t<ul>\n\t\t\t\t<li>Immediately following a tick of the channel</li>\n\t\t\t\t<li>The <b>Interrupt If</b> condition evaluates to <b>True</b></li>\n\t\t\t\t<li>Another action in the APL list is available</li>\n\t\t\t</ul>\n\t\t\t<p>Note that if you simply want to allow other actions to interrupt the channel, set <b>Interrupt If</b> to <b>True</b>.</p>\n\t\t",newValue:()=>Ds.create({interruptIf:{value:{oneofKind:"gcdIsReady",gcdIsReady:{}}}}),fields:[gu("spellId","channel_spells",""),fu("target","targets"),Su("interruptIf",{label:"Interrupt If",labelTooltip:"Condition which must be true to allow the channel to be interrupted."}),Iu("instantInterrupt","Instant Interrupt",{labelTooltip:"If checked, interrupts of this channel will happen instantly after the cast."}),Iu("allowRecast","Recast",{labelTooltip:"If checked, interrupts of this channel will recast the spell."})]}),autocastOtherCooldowns:Tu({label:"Autocast Other Cooldowns",submenu:["Casting"],shortDescription:"Auto-casts cooldowns as soon as they are ready.",fullDescription:"\n\t\t\t<ul>\n\t\t\t\t<li>Does not auto-cast cooldowns which are already controlled by other actions in the priority list.</li>\n\t\t\t\t<li>Cooldowns are usually cast immediately upon becoming ready, but there are some basic smart checks in place, e.g. don't use Mana CDs when near full mana.</li>\n\t\t\t</ul>\n\t\t",includeIf:(e,t)=>!t,newValue:Ms.create,fields:[]}),wait:Tu({label:"Wait",submenu:["Timing"],shortDescription:"Pauses all APL actions for a specified amount of time.",includeIf:(e,t)=>!t,newValue:()=>Vs.create({duration:{value:{oneofKind:"const",const:{val:"1000ms"}}}}),fields:[Su("duration")]}),waitUntil:Tu({label:"Wait Until",submenu:["Timing"],shortDescription:"Pauses all APL actions until the specified condition is <b>True</b>.",includeIf:(e,t)=>!t,newValue:()=>Us.create(),fields:[Su("condition")]}),schedule:Tu({label:"Scheduled Action",submenu:["Timing"],shortDescription:"Executes the inner action once at each specified timing.",includeIf:(e,t)=>!t,newValue:()=>Fs.create({schedule:"0s, 60s",innerAction:{action:{oneofKind:"castSpell",castSpell:{}}}}),fields:[bu("schedule",{label:"Do At",labelTooltip:"Comma-separated list of timings. The inner action will be performed once at each timing."}),function(e){return{field:e,newValue:_s.create,factory:(e,t,i)=>new Cu(e,t,i)}}("innerAction")]}),sequence:Tu({label:"Sequence",submenu:["Sequences"],shortDescription:"A list of sub-actions to execute in the specified order.",fullDescription:"\n\t\t\t<p>Once one of the sub-actions has been performed, the next sub-action will not necessarily be immediately executed next. The system will restart at the beginning of the whole actions list (not the sequence). If the sequence is executed again, it will perform the next sub-action.</p>\n\t\t\t<p>When all actions have been performed, the sequence does NOT automatically reset; instead, it will be skipped from now on. Use the <b>Reset Sequence</b> action to reset it, if desired.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:Ws.create,fields:[bu("name"),Lu("actions")]}),resetSequence:Tu({label:"Reset Sequence",submenu:["Sequences"],shortDescription:"Restarts a sequence, so that the next time it executes it will perform its first sub-action.",fullDescription:"\n\t\t\t<p>Use the <b>name</b> field to refer to the sequence to be reset. The desired sequence must have the same (non-empty) value for its <b>name</b>.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:Os.create,fields:[bu("sequenceName")]}),strictSequence:Tu({label:"Strict Sequence",submenu:["Sequences"],shortDescription:"Like a regular <b>Sequence</b>, except all sub-actions are executed immediately after each other and the sequence resets automatically upon completion.",fullDescription:"\n\t\t\t<p>Strict Sequences do not begin unless ALL sub-actions are ready.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:Hs.create,fields:[Lu("actions")]}),changeTarget:Tu({label:"Change Target",submenu:["Misc"],shortDescription:"Sets the current target, which is the target of auto attacks and most casts by default.",newValue:()=>qs.create(),fields:[fu("newTarget","targets")]}),activateAura:Tu({label:"Activate Aura",submenu:["Misc"],shortDescription:"Activates an aura",includeIf:(e,t)=>t,newValue:()=>Bs.create(),fields:[gu("auraId","auras")]}),cancelAura:Tu({label:"Cancel Aura",submenu:["Misc"],shortDescription:"Deactivates an aura, equivalent to /cancelaura.",newValue:()=>zs.create(),fields:[gu("auraId","auras")]}),triggerIcd:Tu({label:"Trigger ICD",submenu:["Misc"],shortDescription:"Triggers an aura's ICD, putting it on cooldown. Example usage would be to desync an ICD cooldown before combat starts.",includeIf:(e,t)=>t,newValue:()=>js.create(),fields:[gu("auraId","icd_auras")]}),itemSwap:Tu({label:"Item Swap",submenu:["Misc"],shortDescription:"Swaps items, using the swap set specified in Settings.",includeIf:(e,t)=>Gu.includes(e.spec),newValue:()=>Js.create(),fields:[function(e){return{field:e,newValue:()=>Ys.Swap1,factory:(e,t,i)=>new Ps(e,t,{...i,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Ys.Main,label:"Main"},{value:Ys.Swap1,label:"Swapped"}]})}}("swapSet")]}),move:Tu({label:"Move",submenu:["Misc"],shortDescription:"Starts a move to the desired range from target.",newValue:()=>$s.create(),fields:[Su("rangeFromTarget",{label:"to Range",labelTooltip:"Desired range from target."})]}),customRotation:Tu({label:"Custom Rotation",shortDescription:"INTERNAL ONLY",includeIf:(e,t)=>!1,newValue:()=>Zs.create(),fields:[]}),catOptimalRotationAction:Tu({label:"Optimal Rotation Action",submenu:["Feral Druid"],shortDescription:"Executes optimized Feral DPS rotation using hardcoded legacy algorithm.",includeIf:(e,t)=>e.spec==d.SpecFeralDruid,newValue:()=>Gs.create({minCombosForRip:3,maxWaitTime:2,maintainFaerieFire:!1,useShredTrick:!1}),fields:[wu("minCombosForRip",!1,{label:"Min Rip CP",labelTooltip:"Combo Point threshold for allowing a Rip cast"}),wu("maxWaitTime",!0,{label:"Max Wait Time",labelTooltip:"Max seconds to wait for an Energy tick to cast rather than powershifting"}),Iu("maintainFaerieFire","Maintain Faerie Fire",{labelTooltip:"If checked, bundle Faerie Fire refreshes with powershifts. Ignored if an external Faerie Fire debuff is selected in settings."}),Iu("useShredTrick","Use Shred Trick",{labelTooltip:'If checked, enable the "Shred trick" micro-optimization. This should only be used on short fight lengths with full powershifting uptime.'})]})};class Nu extends v{constructor(e,t,i){super(e,"apl-rotation-picker-root"),new bd(this.rootElem,i,{extraCssClasses:["apl-prepull-action-picker"],title:"Prepull Actions",titleTooltip:"Actions to perform before the pull.",itemLabel:"Prepull Action",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.aplRotation.prepullActions,setValue:(e,t,i)=>{t.aplRotation.prepullActions=i,t.rotationChangeEmitter.emit(e)},newItem:()=>Qs.create({action:{},doAtValue:{value:{oneofKind:"const",const:{val:"-1s"}}}}),copyItem:e=>Qs.clone(e),newItemPicker:(e,t,s,a)=>new Ru(e,i,a,s),inlineMenuBar:!0}),new bd(this.rootElem,i,{extraCssClasses:["apl-list-item-picker"],title:"Priority List",titleTooltip:"At each decision point, the simulation will perform the first valid action from this list.",itemLabel:"Action",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.aplRotation.priorityList,setValue:(e,t,i)=>{t.aplRotation.priorityList=i,t.rotationChangeEmitter.emit(e)},newItem:()=>Xs.create({action:{}}),copyItem:e=>Xs.clone(e),newItemPicker:(e,t,s,a)=>new Au(e,i,a,s),inlineMenuBar:!0})}}class Ru extends I{constructor(e,i,s,a){s.enableWhen=()=>!this.getItem().hide,super(e,"apl-list-item-picker-root",i,s),t(this,"player"),t(this,"hidePicker"),t(this,"doAtPicker"),t(this,"actionPicker"),this.player=i;const n=bd.getItemHeaderElem(this);Du(n,i,(e=>e.getCurrentStats().rotationStats?.prepullActions[a]?.warnings||[])),this.hidePicker=new Mu(n,i,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().hide,setValue:(e,t,i)=>{this.getItem().hide=i,this.player.rotationChangeEmitter.emit(e)}}),this.doAtPicker=new du(this.rootElem,this.player,{label:"Do At",labelTooltip:"Time before pull to do the action. Should be negative, and formatted like, '-1s' or '-2500ms'.",extraCssClasses:["apl-prepull-actions-doat"],changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().doAtValue?.value?.const.val||"",setValue:(e,t,i)=>{this.getItem().doAtValue=i?_s.create({value:{oneofKind:"const",const:{val:i}}}):void 0,this.player.rotationChangeEmitter.emit(e)},inline:!0}),this.actionPicker=new Cu(this.rootElem,this.player,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().action,setValue:(e,t,i)=>{this.getItem().action=i,this.player.rotationChangeEmitter.emit(e)}}),this.init()}getItem(){return this.getSourceValue()||Qs.create({action:{}})}getInputElem(){return this.rootElem}getInputValue(){return Qs.create({hide:this.hidePicker.getInputValue(),doAtValue:{value:{oneofKind:"const",const:{val:this.doAtPicker.getInputValue()}}},action:this.actionPicker.getInputValue()})}setInputValue(e){e&&(this.hidePicker.setInputValue(e.hide),this.doAtPicker.setInputValue(e.doAtValue?.value?.const.val||""),this.actionPicker.setInputValue(e.action||Ks.create()))}}class Au extends I{constructor(e,i,s,a){s.enableWhen=()=>!this.getItem().hide,super(e,"apl-list-item-picker-root",i,s),t(this,"player"),t(this,"hidePicker"),t(this,"actionPicker"),this.player=i;const n=bd.getItemHeaderElem(this);Du(n,i,(e=>e.getCurrentStats().rotationStats?.priorityList[a]?.warnings||[])),this.hidePicker=new Mu(n,i,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().hide,setValue:(e,t,i)=>{this.getItem().hide=i,this.player.rotationChangeEmitter.emit(e)}}),this.actionPicker=new Cu(this.rootElem,this.player,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().action,setValue:(e,t,i)=>{this.getItem().action=i,this.player.rotationChangeEmitter.emit(e)}}),this.init()}getItem(){return this.getSourceValue()||Xs.create({action:{}})}getInputElem(){return this.rootElem}getInputValue(){return Xs.create({hide:this.hidePicker.getInputValue(),action:this.actionPicker.getInputValue()})}setInputValue(e){e&&(this.hidePicker.setInputValue(e.hide),this.actionPicker.setInputValue(e.action||Ks.create()))}}function Du(e,t,i){const s=bd.makeActionElem("apl-warnings","fa-exclamation-triangle");s.classList.add("warning","link-warning"),s.setAttribute("data-bs-html","true");const a=da.getOrCreateInstance(s,{customClass:"dropdown-tooltip",title:"Warnings",html:!0});e.appendChild(s);const n=async()=>{a.setContent({".tooltip-inner":""});const e=i(t);if(0==e.length)s.style.visibility="hidden";else{s.style.visibility="visible";const t=await Promise.all(e.map((e=>y.replaceAllInString(e))));a.setContent({".tooltip-inner":`\n\t\t\t\t<p>This action has warnings, and might not behave as expected.</p>\n\t\t\t\t<ul>\n\t\t\t\t\t${t.map((e=>`<li>${e}</li>`)).join("")}\n\t\t\t\t</ul>\n\t\t\t`})}};n(),t.currentStatsEmitter.on(n)}class Mu extends I{constructor(e,i,s){super(e,"hide-picker-root",i,s),t(this,"inputElem"),t(this,"iconElem"),t(this,"tooltip"),this.inputElem=bd.makeActionElem("hide-picker-button","fa-eye"),this.iconElem=this.inputElem.childNodes[0],this.rootElem.appendChild(this.inputElem),this.tooltip=da.getOrCreateInstance(this.inputElem,{title:"Enable/Disable"}),this.init(),this.inputElem.addEventListener("click",(()=>{this.setInputValue(!this.getInputValue()),this.inputChanged(m.nextEventID())}))}getInputElem(){return this.inputElem}getInputValue(){return this.iconElem.classList.contains("fa-eye-slash")}setInputValue(e){e?(this.iconElem.classList.add("fa-eye-slash"),this.iconElem.classList.remove("fa-eye"),this.tooltip.setContent({".tooltip-inner":"Enable Action"})):(this.iconElem.classList.add("fa-eye"),this.iconElem.classList.remove("fa-eye-slash"),this.tooltip.setContent({".tooltip-inner":"Disable Action"}))}}class Vu extends cd{constructor(e,i){super(e,i,{identifier:"rotation-tab",title:"Rotation"}),t(this,"simUI"),t(this,"leftPanel"),t(this,"rightPanel"),this.simUI=i,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("rotation-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("rotation-tab-right","tab-panel-right"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent(),this.updateSections(),this.simUI.player.rotationChangeEmitter.on((()=>this.updateSections()))}buildTabContent(){this.buildHeader(),this.buildAutoContent(),this.buildAplContent(),this.buildSimpleContent(),this.buildSavedDataPickers()}updateSections(){this.rootElem.classList.remove("rotation-type-auto"),this.rootElem.classList.remove("rotation-type-simple"),this.rootElem.classList.remove("rotation-type-apl"),this.rootElem.classList.remove("rotation-type-legacy");const e=this.simUI.player.getRotationType();e==G.TypeAuto?this.rootElem.classList.add("rotation-type-auto"):e==G.TypeSimple?this.rootElem.classList.add("rotation-type-simple"):e==G.TypeAPL?this.rootElem.classList.add("rotation-type-apl"):e==G.TypeLegacy&&this.rootElem.classList.add("rotation-type-legacy")}buildHeader(){const e=document.createElement("div");e.classList.add("rotation-tab-header"),this.leftPanel.appendChild(e),new nn(e,this.simUI.player,{label:"Rotation Type",labelTooltip:"Which set of options to use for specifying the rotation.",inline:!0,values:this.simUI.player.hasSimpleRotationGenerator()?[{value:G.TypeAuto,name:"Auto"},{value:G.TypeSimple,name:"Simple"},{value:G.TypeAPL,name:"APL"}]:[{value:G.TypeAuto,name:"Auto"},{value:G.TypeAPL,name:"APL"}],changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getRotationType(),setValue:(e,t,i)=>{t.aplRotation.type=i,t.rotationChangeEmitter.emit(e)}})}buildAutoContent(){const e=document.createElement("div");e.classList.add("rotation-tab-auto"),this.leftPanel.appendChild(e)}buildAplContent(){const e=document.createElement("div");e.classList.add("rotation-tab-apl"),this.leftPanel.appendChild(e),new Nu(e,this.simUI,this.simUI.player)}buildSimpleContent(){if(!this.simUI.player.hasSimpleRotationGenerator()||!this.simUI.individualConfig.rotationInputs)return;const e="rotation-tab-simple",t=new wn(this.leftPanel,"rotation-settings",{header:{title:"Rotation"}});t.rootElem.classList.add(e);const i=I.newGroupContainer();i.classList.add("rotation-icon-group","icon-group"),t.bodyElement.appendChild(i),this.simUI.individualConfig.rotationIconInputs?.length&&this.configureIconSection(i,this.simUI.individualConfig.rotationIconInputs.map((e=>Xd(i,this.simUI.player,e))),!0),this.configureInputSection(t.bodyElement,this.simUI.individualConfig.rotationInputs),t.bodyElement.querySelectorAll(".input-root").forEach((e=>{e.classList.add("input-inline")}));const s=new wn(this.leftPanel,"cooldown-settings",{header:{title:"Cooldowns",tooltip:"Specify cooldown timings, in seconds. Cooldowns will be used as soon as possible after their specified timings. When not specified, cooldowns will be used when ready and it is sensible to do so.<br><br>Multiple timings can be provided by separating with commas. Any cooldown usages after the last provided timing will use the default logic."}});s.rootElem.classList.add(e),new ru(s.bodyElement,this.simUI.player)}configureInputSection(e,t){t.inputs.forEach((t=>{"number"==t.type?new en(e,this.simUI.player,t):"boolean"==t.type?new an(e,this.simUI.player,{...t,cssScheme:this.simUI.cssScheme}):"enum"==t.type&&new nn(e,this.simUI.player,t)}))}configureIconSection(e,t,i){0==t.length?e.classList.add("hide"):i&&(t.length<=4?e.style.gridTemplateColumns=`repeat(${t.length}, 1fr)`:t.length>4&&t.length<8&&(e.style.gridTemplateColumns=`repeat(${Math.ceil(t.length/2)}, 1fr)`))}buildSavedDataPickers(){const e=new gd(this.rightPanel,this.simUI.player,{label:"Rotation",header:{title:"Saved Rotations"},storageKey:this.simUI.getSavedRotationStorageKey(),getData:e=>ea.create({rotation:_.clone(e.aplRotation)}),setData:(e,t,i)=>{m.freezeAllAndDo((()=>{t.setAplRotation(e,i.rotation||_.create())}))},changeEmitters:[this.simUI.player.rotationChangeEmitter,this.simUI.player.talentsChangeEmitter,this.simUI.player.levelChangeEmitter],equals:(e,t)=>ea.equals(e,t),toJson:e=>ea.toJson(e),fromJson:e=>ea.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),(this.simUI.individualConfig.presets.rotations||[]).forEach((t=>{const i=t.rotation;i.rotation||(i.rotation=_.create()),e.addSavedData({name:t.name,tooltip:t.tooltip,isPreset:!0,data:i,enableWhen:t.enableWhen})}))}))}}class Uu extends cd{constructor(e,i){super(e,i,{identifier:"talents-tab",title:"Talents"}),t(this,"simUI"),t(this,"leftPanel"),t(this,"rightPanel"),this.simUI=i,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("talents-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("talents-tab-right","tab-panel-right","within-raid-sim-hide"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.simUI.player.getClass()==g.ClassHunter?this.buildHunterPickers():this.buildTalentsPicker(this.leftPanel),this.buildSavedTalentsPicker()}buildTalentsPicker(e){new Sa(e,this.simUI.player,{klass:this.simUI.player.getClass(),trees:Va[this.simUI.player.getClass()],changedEvent:e=>e.talentsChangeEmitter,getValue:e=>e.getTalentsString(),setValue:(e,t,i)=>{t.setTalentsString(e,i)},pointsPerRow:5,maxPoints:ta})}buildHunterPickers(){this.leftPanel.innerHTML='\n      <div class="hunter-talents-pickers-container tab-content">\n        <ul class="nav nav-tabs" role="tablist">\n          <li class="nav-item" role="presentation">\n            <a\n              class="nav-link active"\n              type="button"\n              role="tab"\n              data-bs-toggle="tab"\n              data-bs-target="#player-talents-tab"\n              aria-controls="#player-talents-tab"\n              aria-selected="true"\n            >\n              Player\n            </a>\n          </li>\n          <li class="nav-item" role="presentation">\n            <a\n              class="nav-link"\n              type="button"\n              role="tab"\n              data-bs-toggle="tab"\n              data-bs-target="#pet-talents-tab"\n              aria-controls="#pet-talents-tab"\n              aria-selected="false"\n            >\n              Pet</a\n            >\n          </li>\n        </ul>\n        <div id="player-talents-tab" class="tab-pane fade active show" role="tabpanel">\n        </div>\n        <div id="pet-talents-tab" class="tab-pane fade" role="tabpanel">\n        </div>\n      </div>\n    ';const e=this.leftPanel.querySelector("#player-talents-tab");this.buildTalentsPicker(e)}buildSavedTalentsPicker(){const e=new gd(this.rightPanel,this.simUI.player,{label:"Talents",header:{title:"Saved Talents"},storageKey:this.simUI.getSavedTalentsStorageKey(),getData:e=>ia.create({talentsString:e.getTalentsString()}),setData:(e,t,i)=>{m.freezeAllAndDo((()=>{t.setTalentsString(e,i.talentsString)}))},changeEmitters:[this.simUI.player.talentsChangeEmitter,this.simUI.player.levelChangeEmitter],equals:(e,t)=>ia.equals(e,t),toJson:e=>ia.toJson(e),fromJson:e=>ia.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),this.simUI.individualConfig.presets.talents.forEach((t=>{t.isPreset=!0,e.addSavedData({name:t.name,isPreset:!0,data:t.data,enableWhen:t.enableWhen})}))}))}}class Fu extends dn{constructor(e,i,s){super(e,"exporter",{title:s.title,header:s.header,footer:!0}),t(this,"textElem"),t(this,"changedEvent",new m),this.body.innerHTML='\n\t\t\t<textarea spellCheck="false" class="exporter-textarea form-control"></textarea>\n\t\t',this.footer.innerHTML=`\n\t\t\t<button class="exporter-button btn btn-primary clipboard-button me-2">\n\t\t\t\t<i class="fas fa-clipboard"></i>\n\t\t\t\tCopy to Clipboard\n\t\t\t</button>\n\t\t\t${s.allowDownload?'\n\t\t\t\t<button class="exporter-button btn btn-primary download-button">\n\t\t\t\t\t<i class="fa fa-download"></i>\n\t\t\t\t\tDownload\n\t\t\t\t</button>\n\t\t\t':""}\n\t\t`,this.textElem=this.rootElem.getElementsByClassName("exporter-textarea")[0];const a=this.rootElem.getElementsByClassName("clipboard-button")[0];if(a.addEventListener("click",(e=>{const t=this.textElem.textContent;if(null==navigator.clipboard)alert(t);else{navigator.clipboard.writeText(t);const e=a.innerHTML;a.style.width=`${a.getBoundingClientRect().width.toFixed(3)}px`,a.innerHTML='<i class="fas fa-check"></i>&nbsp;Copied',setTimeout((()=>{a.innerHTML=e}),1500)}})),s.allowDownload){this.rootElem.getElementsByClassName("download-button")[0].addEventListener("click",(e=>{const t=this.textElem.textContent;sa(t,"wowsims.json")}))}}init(){this.changedEvent.on((()=>this.updateContent())),this.updateContent()}updateContent(){this.textElem.textContent=this.getData()}}const Wu=class extends Fu{constructor(e,s){super(e,s,{title:"Sharable Link",header:!0}),t(this,"simUI"),t(this,"exportCategories"),this.simUI=s;const a={};i(Za).forEach((e=>a[e]=_r.DEFAULT_CATEGORIES.includes(e))),this.exportCategories=a;const n=document.createElement("div");n.classList.add("link-exporter-pickers"),this.body.prepend(n),Wu.exportPickerConfigs.forEach((e=>{const t=e.category;new an(n,this,{label:e.label,labelTooltip:e.labelTooltip,inline:!0,getValue:()=>this.exportCategories[t],setValue:(e,i,s)=>{this.exportCategories[t]=s,this.changedEvent.emit(e)},changedEvent:()=>this.changedEvent})})),this.init()}getData(){return Wu.createLink(this.simUI,i(Za).filter((e=>this.exportCategories[e])))}static createLink(e,t){t||(t=_r.DEFAULT_CATEGORIES);const i=e.toProto(t),s=ht.toBinary(i),a=Cr.deflate(s,{to:"string"}),n=btoa(a),o=new URL(window.location.href);if(o.hash=n,Ii(t,_r.DEFAULT_CATEGORIES))o.searchParams.delete(_r.CATEGORY_PARAM);else{const e=t.map((e=>_r.CATEGORY_KEYS.get(e))).join("");o.searchParams.set(_r.CATEGORY_PARAM,e)}return o.toString()}};let Ou=Wu;t(Ou,"exportPickerConfigs",[{category:Za.Gear,label:"Gear",labelTooltip:"Also includes bonus stats and weapon swaps."},{category:Za.Talents,label:"Talents",labelTooltip:"Talents and Glyphs."},{category:Za.Rotation,label:"Rotation",labelTooltip:"Includes everything found in the Rotation tab."},{category:Za.Consumes,label:"Consumes",labelTooltip:"Flask, pots, food, etc."},{category:Za.External,label:"Buffs & Debuffs",labelTooltip:"All settings which are applied by other raid members."},{category:Za.Miscellaneous,label:"Misc",labelTooltip:"Spec-specific settings, front/back of target, distance from target, etc."},{category:Za.Encounter,label:"Encounter",labelTooltip:"Fight-related settings."}]);class Hu extends Fu{constructor(e,i){super(e,i,{title:"JSON Export",allowDownload:!0}),t(this,"simUI"),this.simUI=i,this.init()}getData(){return aa(ht.toJson(this.simUI.toProto()),2,((e,t)=>!!["stats","pseudoStats"].includes(t[t.length-1])||(["player","equipment","items"].every(((e,i)=>t[i]==e))||!("player"!=t[0]||"rotation"!=t[1]||!["prepullActions","priorityList"].includes(t[2])))&&t.length>3))}}const qu=class extends Fu{constructor(e,i){super(e,i,{title:"80Upgrades EP Export",allowDownload:!0}),t(this,"simUI"),this.simUI=i,this.init()}getData(){const e=this.simUI.player,t=e.getEpWeights(),i=pa.getAll(),s={};return i.forEach((e=>{const i=qu.getName(e),a=t.getUnitStat(e);0!=a&&""!=i&&(s[i]?s[i]+=a:s[i]=a)})),`https://eightyupgrades.com/ep/import?name=${encodeURIComponent(`${Be[e.spec]} WoWSims Weights`)}`+Object.keys(s).map((e=>`&${e}=${s[e].toFixed(3)}`)).join("")}static getName(e){return e.isStat()?qu.statNames[e.getStat()]:qu.pseudoStatNames[e.getPseudoStat()]||""}};let Bu=qu;t(Bu,"statNames",{[s.StatStrength]:"strength",[s.StatAgility]:"agility",[s.StatStamina]:"stamina",[s.StatIntellect]:"intellect",[s.StatSpirit]:"spirit",[s.StatSpellPower]:"spellPower",[s.StatSpellDamage]:"spellDamage",[s.StatArcanePower]:"arcaneDamage",[s.StatHolyPower]:"holyDamage",[s.StatFirePower]:"fireDamage",[s.StatFrostPower]:"frostDamage",[s.StatNaturePower]:"natureDamage",[s.StatShadowPower]:"shadowDamage",[s.StatMP5]:"mp5",[s.StatSpellHit]:"hitRating",[s.StatSpellCrit]:"critRating",[s.StatSpellHaste]:"hasteRating",[s.StatSpellPenetration]:"spellPen",[s.StatAttackPower]:"attackPower",[s.StatMeleeHit]:"hitRating",[s.StatMeleeCrit]:"critRating",[s.StatMeleeHaste]:"hasteRating",[s.StatArmorPenetration]:"armorPenRating",[s.StatExpertise]:"expertiseRating",[s.StatMana]:"mana",[s.StatEnergy]:"energy",[s.StatRage]:"rage",[s.StatArmor]:"armor",[s.StatRangedAttackPower]:"attackPower",[s.StatDefense]:"defenseRating",[s.StatBlock]:"blockRating",[s.StatBlockValue]:"blockValue",[s.StatDodge]:"dodgeRating",[s.StatParry]:"parryRating",[s.StatResilience]:"resilienceRating",[s.StatHealth]:"health",[s.StatArcaneResistance]:"arcaneResistance",[s.StatFireResistance]:"fireResistance",[s.StatFrostResistance]:"frostResistance",[s.StatNatureResistance]:"natureResistance",[s.StatShadowResistance]:"shadowResistance",[s.StatBonusArmor]:"armorBonus",[s.StatHealing]:"Healing",[s.StatFeralAttackPower]:"feralAttackPower"}),t(Bu,"pseudoStatNames",{[a.PseudoStatMainHandDps]:"dps",[a.PseudoStatRangedDps]:"rangedDps"});const zu=class extends Fu{constructor(e,i){super(e,i,{title:"Pawn EP Export",allowDownload:!0}),t(this,"simUI"),this.simUI=i,this.init()}getData(){const e=this.simUI.player,t=e.getEpWeights(),i=pa.getAll(),s={};return i.forEach((e=>{const i=zu.getName(e),a=t.getUnitStat(e);0!=a&&""!=i&&(s[i]?s[i]+=a:s[i]=a)})),`( Pawn: v1: "${Be[e.spec]} WoWSims Weights": Class=${wt.get(e.getClass())},`+Object.keys(s).map((e=>`${e}=${s[e].toFixed(3)}`)).join(",")+" )"}static getName(e){return e.isStat()?zu.statNames[e.getStat()]:zu.pseudoStatNames[e.getPseudoStat()]||""}};let ju=zu;t(ju,"statNames",{[s.StatStrength]:"Strength",[s.StatAgility]:"Agility",[s.StatStamina]:"Stamina",[s.StatIntellect]:"Intellect",[s.StatSpirit]:"Spirit",[s.StatSpellPower]:"SpellDamage",[s.StatSpellDamage]:"SpellDamage",[s.StatArcanePower]:"ArcaneDamage",[s.StatFirePower]:"FireDamage",[s.StatFrostPower]:"FrostDamage",[s.StatHolyPower]:"HolyDamage",[s.StatNaturePower]:"NatureDamage",[s.StatShadowPower]:"ShadowDamage",[s.StatMP5]:"Mp5",[s.StatSpellHit]:"HitRating",[s.StatSpellCrit]:"CritRating",[s.StatSpellHaste]:"HasteRating",[s.StatSpellPenetration]:"SpellPen",[s.StatAttackPower]:"Ap",[s.StatMeleeHit]:"HitRating",[s.StatMeleeCrit]:"CritRating",[s.StatMeleeHaste]:"HasteRating",[s.StatArmorPenetration]:"ArmorPenetration",[s.StatExpertise]:"ExpertiseRating",[s.StatMana]:"Mana",[s.StatEnergy]:"Energy",[s.StatRage]:"Rage",[s.StatArmor]:"Armor",[s.StatRangedAttackPower]:"Ap",[s.StatDefense]:"DefenseRating",[s.StatBlock]:"BlockRating",[s.StatBlockValue]:"BlockValue",[s.StatDodge]:"DodgeRating",[s.StatParry]:"ParryRating",[s.StatResilience]:"ResilienceRating",[s.StatHealth]:"Health",[s.StatArcaneResistance]:"ArcaneResistance",[s.StatFireResistance]:"FireResistance",[s.StatFrostResistance]:"FrostResistance",[s.StatNatureResistance]:"NatureResistance",[s.StatShadowResistance]:"ShadowResistance",[s.StatBonusArmor]:"Armor2",[s.StatHealing]:"Healing",[s.StatFeralAttackPower]:"FeralAttackPower"}),t(ju,"pseudoStatNames",{[a.PseudoStatMainHandDps]:"MeleeDps",[a.PseudoStatRangedDps]:"RangedDps"});function $u(e,t){return function(e,t){Oa[e]=t}(e,t),t}let Gu=[];class Ku extends un{constructor(e,i,s){super(e,i.sim,{cssClass:s.cssClass,cssScheme:s.cssScheme,spec:i.spec,knownIssues:s.knownIssues,simStatus:wa[i.spec],noticeText:"Disclaimer: Phase 2 support is still in early development. Item and spell effects may not be implemented."}),t(this,"player"),t(this,"individualConfig"),t(this,"raidSimResultsManager"),t(this,"prevEpIterations"),t(this,"prevEpSimResult"),t(this,"dpsRefStat"),t(this,"healRefStat"),t(this,"tankRefStat"),t(this,"bt"),t(this,"spec"),this.rootElem.classList.add("individual-sim-ui"),this.player=i,this.individualConfig=s,this.raidSimResultsManager=null,this.prevEpIterations=0,this.prevEpSimResult=null,(s.itemSwapConfig?.itemSlots||[]).length>0&&!Gu.includes(i.spec)&&Gu.push(i.spec),this.addWarning({updateOn:m.onAny([this.player.gearChangeEmitter,this.player.professionChangeEmitter]),getContent:()=>{const e=this.player.getGear().getFailedProfessionRequirements(this.player.getProfessions());return 0==e.length?"":e.map((e=>`${e.name} requires ${At.get(e.requiredProfession)}, but it is not selected.`))}}),this.addWarning({updateOn:m.onAny([this.player.talentsChangeEmitter,this.player.levelChangeEmitter]),getContent:()=>{const e=na(this.player.getTalentsString());return 0==e?"":e<this.player.getLevel()-9?"Unspent talent points.":e>this.player.getLevel()-9?"More talent points spent than current level selected.":""}}),this.addWarning({updateOn:m.onAny([this.player.gearChangeEmitter,this.player.talentsChangeEmitter]),getContent:()=>this.player.canDualWield2H()||(this.player.getEquippedItem(M.ItemSlotMainHand)?.item.handType!=re.HandTypeTwoHand||null==this.player.getEquippedItem(M.ItemSlotOffHand))&&this.player.getEquippedItem(M.ItemSlotOffHand)?.item.handType!=re.HandTypeTwoHand?"":"Dual wielding two-handed weapon(s) without Titan's Grip spec."}),(s.warnings||[]).forEach((e=>this.addWarning(e(this)))),this.isWithinRaidSim||this.sim.waitForInit().then((()=>{this.loadSettings(),Gt(this.player.spec)&&alert("*** WARNING - USE AT YOUR OWN RISK ***\n\nThe entire concept of a healing sim is EXPERIMENTAL. All results should be taken with an EXTREMELY large grain of salt.\n\nThis tool is currently more similar to a spreadsheet than a true sim. Options for specifying incoming damage profiles in order to have proper reactive rotations have not yet been added.")})),this.addSidebarComponents(),this.addGearTab(),this.bt=this.addBulkTab(),this.addSettingsTab(),this.addTalentsTab(),this.addRotationTab(),this.isWithinRaidSim||this.addDetailedResultsTab(),this.addTopbarComponents()}loadSettings(){const e=m.nextEventID();m.freezeAllAndDo((()=>{this.applyDefaults(e);const t=window.localStorage.getItem(this.getSettingsStorageKey());if(null!=t)try{const i=ht.fromJsonString(t);this.fromProto(e,i)}catch(i){console.warn("Failed to parse saved settings: "+i)}try{const t=_r.tryParseUrlLocation(window.location);t&&this.fromProto(e,t.settings,t.categories)}catch(i){console.warn("Failed to parse link settings: "+i)}window.location.hash="",this.player.setName(e,"Player"),this.changeEmitter.on((e=>{const t=ht.toJsonString(this.toProto());window.localStorage.setItem(this.getSettingsStorageKey().replace("wotlk","sod"),t),window.localStorage.setItem(this.getSettingsStorageKey(),t)}))}))}addSidebarComponents(){var e,t,i,s;this.raidSimResultsManager=oa(this),e=this,t=this.individualConfig.epStats,i=this.individualConfig.epPseudoStats,s=this.individualConfig.epReferenceStat,e.addAction("Stat Weights","ep-weights-action",(()=>{new In(e,t,i||[],s)})),new gn(this.rootElem.getElementsByClassName("sim-sidebar-footer")[0],this.player,this.individualConfig.displayStats,this.individualConfig.modifyDisplayStats)}addGearTab(){new fd(this.simTabContentsContainer,this).rootElem.classList.add("active","show")}addBulkTab(){let e=new pd(this.simTabContentsContainer,this);return e.navLink.hidden=!this.sim.getShowExperimental(),this.sim.showExperimentalChangeEmitter.on((()=>{e.navLink.hidden=!this.sim.getShowExperimental()})),e}addSettingsTab(){new ou(this.simTabContentsContainer,this)}addTalentsTab(){new Uu(this.simTabContentsContainer,this)}addRotationTab(){new Vu(this.simTabContentsContainer,this)}addDetailedResultsTab(){this.addTab("Results","detailed-results-tab",'\n\t\t\t<div class="detailed-results">\n\t\t\t</div>\n\t\t'),new la(this.rootElem.getElementsByClassName("detailed-results")[0],this,this.raidSimResultsManager)}addTopbarComponents(){this.simHeader.addImportLink("JSON",(e=>new Nr(this.rootElem,this)),!0),this.simHeader.addImportLink("Addon",(e=>new Ar(this.rootElem,this)),!0),this.simHeader.addExportLink("Link",(e=>new Ou(this.rootElem,this)),!1),this.simHeader.addExportLink("JSON",(e=>new Hu(this.rootElem,this)),!0)}applyDefaults(e){m.freezeAllAndDo((()=>{const t=oe(this.player.spec),i=Gt(this.player.spec);this.player.applySharedDefaults(e),this.player.setRace(e,this.individualConfig.defaults.race??A[this.player.spec][0]),this.player.setLevel(e,D[wa[this.player.spec].phase]),this.player.setGear(e,this.sim.db.lookupEquipmentSpec(this.individualConfig.defaults.gear)),this.player.setItemSwapGear(e,new T({})),this.player.setConsumes(e,this.individualConfig.defaults.consumes),this.player.setTalentsString(e,this.individualConfig.defaults.talents.talentsString),this.player.setSpecOptions(e,this.individualConfig.defaults.specOptions),this.player.setBuffs(e,this.individualConfig.defaults.individualBuffs),this.player.getParty().setBuffs(e,this.individualConfig.defaults.partyBuffs),this.player.getRaid().setBuffs(e,this.individualConfig.defaults.raidBuffs),this.player.setEpWeights(e,this.individualConfig.defaults.epWeights);const s=this.player.getDefaultEpRatios(t,i);this.player.setEpRatios(e,s),this.player.setProfession1(e,this.individualConfig.defaults.other?.profession1||O.Engineering),this.player.setProfession2(e,this.individualConfig.defaults.other?.profession2||O.ProfessionUnknown),this.player.setDistanceFromTarget(e,this.individualConfig.defaults.other?.distanceFromTarget||0),this.player.setChannelClipDelay(e,this.individualConfig.defaults.other?.channelClipDelay||0),this.isWithinRaidSim?this.sim.raid.setTargetDummies(e,0):(this.sim.raid.setTargetDummies(e,i?9:0),this.sim.encounter.applyDefaults(e),this.sim.raid.setDebuffs(e,this.individualConfig.defaults.debuffs),this.sim.applyDefaults(e,t,i),t?this.sim.raid.setTanks(e,[this.player.makeUnitReference()]):this.sim.raid.setTanks(e,[]))}))}getSavedGearStorageKey(){return this.getStorageKey("__savedGear__")}getSavedRotationStorageKey(){return this.getStorageKey("__savedRotation__")}getSavedSettingsStorageKey(){return this.getStorageKey("__savedSettings__")}getSavedTalentsStorageKey(){return this.getStorageKey("__savedTalents__")}getStorageKey(e){return ra[this.player.spec]+e}toProto(e){const t=t=>!e||0==e.length||e.includes(t),i=ht.create({player:this.player.toProto(!0,!1,e)});return t(Za.Miscellaneous)&&ht.mergePartial(i,{tanks:this.sim.raid.getTanks()}),t(Za.Encounter)&&ht.mergePartial(i,{encounter:this.sim.encounter.toProto()}),t(Za.External)&&ht.mergePartial(i,{partyBuffs:this.player.getParty()?.getBuffs()||h.create(),raidBuffs:this.sim.raid.getBuffs(),debuffs:this.sim.raid.getDebuffs(),targetDummies:this.sim.raid.getTargetDummies()}),t(Za.UISettings)&&ht.mergePartial(i,{settings:this.sim.toProto(),epWeightsStats:this.player.getEpWeights().toProto(),epRatios:this.player.getEpRatios(),dpsRefStat:this.dpsRefStat,healRefStat:this.healRefStat,tankRefStat:this.tankRefStat}),i}toLink(){return Ou.createLink(this)}fromProto(e,t,i){const s=e=>!i||0==i.length||i.includes(e),a=oe(this.player.spec),n=Gt(this.player.spec);m.freezeAllAndDo((()=>{if(t.player){if(this.player.fromProto(e,t.player,i),s(Za.Miscellaneous)&&this.sim.raid.setTanks(e,t.tanks||[]),s(Za.External)){this.sim.raid.setBuffs(e,t.raidBuffs||fe.create()),this.sim.raid.setDebuffs(e,t.debuffs||Ie.create());const i=this.player.getParty();i&&i.setBuffs(e,t.partyBuffs||h.create()),this.sim.raid.setTargetDummies(e,t.targetDummies)}if(s(Za.Encounter)&&this.sim.encounter.fromProto(e,t.encounter||he.create()),s(Za.UISettings)){t.epWeightsStats?this.player.setEpWeights(e,ga.fromProto(t.epWeightsStats)):this.player.setEpWeights(e,this.individualConfig.defaults.epWeights);const i=this.player.getDefaultEpRatios(a,n);if(t.epRatios){const s=new Array(i.length-t.epRatios.length).fill(0);this.player.setEpRatios(e,t.epRatios.concat(s))}else this.player.setEpRatios(e,i);t.dpsRefStat&&(this.dpsRefStat=t.dpsRefStat),t.healRefStat&&(this.healRefStat=t.healRefStat),t.tankRefStat&&(this.tankRefStat=t.tankRefStat),t.settings?this.sim.fromProto(e,t.settings):this.sim.applyDefaults(e,a,n)}}}))}}function Ju(e,t,i){return function(e,t,i){let s=[];null!=i.talentTree&&s.push((e=>e.getTalentTree()==i.talentTree));null!=i.talentTrees&&s.push((e=>(i.talentTrees||[]).includes(e.getTalentTree())));null!=i.faction&&s.push((e=>e.getFaction()==i.faction));null!=i.customCondition&&s.push(i.customCondition);return{name:e,tooltip:i.tooltip||Kh,gear:t,enableWhen:s.length>0?e=>s.every((t=>t(e))):void 0}}(e,ft.fromJson(t),i||{})}function Zu(e,t,i){return Qu(e,ea.create({rotation:_.fromJson(t)}),i)}function Yu(e,t,i,s){return Qu(e,ea.create({rotation:{type:G.TypeSimple,simple:{specRotationJson:JSON.stringify(P[t].rotationToJson(i))}}}),s)}function Qu(e,t,i){let s=[];return null!=i?.talentTree&&s.push((e=>e.getTalentTree()==i.talentTree)),null!=i?.customCondition&&s.push(i.customCondition),{name:e,rotation:t,enableWhen:s.length>0?e=>s.every((t=>t(e))):void 0}}export{Gh as $,Yc as A,nm as B,Br as C,Wr as D,zr as E,wh as F,$r as G,qr as H,Ku as I,Jm as J,jr as K,zd as L,cm as M,Qh as N,Ha as O,Ba as P,nn as Q,Vr as R,Qa as S,Or as T,va as U,dn as V,cd as W,gd as X,_d as Y,wn as Z,vd as _,Zu as a,Ad as a0,Lr as a1,Fu as a2,za as a3,ja as a4,un as a5,Ia as a6,Ur as a7,Dm as a8,Mm as a9,Vm as aa,em as ab,om as ac,hm as ad,Ym as ae,Qm as af,Xm as ag,eu as ah,rm as ai,ga as b,Hm as c,qm as d,Bm as e,sh as f,vh as g,Sh as h,tm as i,Qd as j,Bd as k,dm as l,Ju as m,am as n,Fm as o,Fr as p,Gd as q,$u as r,Od as s,Ud as t,Hd as u,Fd as v,Yu as w,sm as x,mm as y,Hr as z};
//# sourceMappingURL=preset_utils-828125b5.chunk.js.map
